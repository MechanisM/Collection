/**
 * $.Collection
 * 
 * autor: kobezzza (kobezzza@gmail.com | http://kobezzza.com)
 * version: 3.3
 * date: 06.01.2012 17:54:46
 */
 var nimble={name:"nimble",version:"1.0.1",nimble:function(){return this.name+" "+this.version},CONTEXT_SEPARATOR:" ",QUERY_SEPARATOR:"/",SUBQUERY_SEPARATOR:"{",METHOD_SEPARATOR:"->",CHILDREN:">",ORDER:["eq(",")"],trim:function(d){d=d.replace(/^\s\s*/,"");for(var a=/\s/,b=d.length;a.test(d.charAt(b-=1)););return d.substring(0,b+1)},isString:function(d){return Object.prototype.toString.call(d)==="[object String]"},isNumber:function(d){return Object.prototype.toString.call(d)==="[object Number]"},isArray:function(d){return Object.prototype.toString.call(d)===
"[object Array]"},isExist:function(d){return d!==undefined&&d!=="undefined"&&d!==null&&d!==""},expr:function(d,a){a=a!==undefined||a!==null?a:"";if(this.isString(d)&&d.search(/^[+-\\*/]{1}=/)!==-1){d=d.split("=");isNaN(d[1])||(d[1]=+d[1]);switch(d[0]){case "+":d=a+d[1];break;case "-":d=a-d[1];break;case "*":d=a*d[1];break;case "/":d=a/d[1]}}return d},byLink:function(d,a,b,e){a=a.toString().replace(RegExp("\\s*"+this.CHILDREN+"\\s*","g")," "+this.CHILDREN+" ").split(this.CONTEXT_SEPARATOR);e=e||false;
var c=this.CHILDREN,g=0,f=0,j,k,h,l=a.length;for(k=l;(k-=1)>-1;){a[k]=this.trim(a[k]);if(a[k]===""){a.splice(k,1);g-=1}else if(a[k]!==this.CHILDREN){if(k>g)g=k;f+=1}}l=a.length;if(d===false)return a.join("");else if(this.isNumber(d)){if((d=+d)<0)d+=f;if(b===undefined){k=-1;for(h=0;(k+=1)<l;)if(a[k]!==this.CHILDREN)if((h+=1)===d){a.splice(k+1,l);return a.join("")}}else{k=l;for(h=0;(k-=1)>-1;)if(a[k]!==this.CHILDREN)if((h+=1)===d){a.splice(0,k);return a.join("")}}}for(k=-1;(k+=1)<l;)switch(a[k]){case this.CHILDREN:c=
a[k];break;default:if(c===this.CHILDREN&&a[k].substring(0,this.ORDER[0].length)!==this.ORDER[0])if(k===g&&b!==undefined)if(e===false)d[a[k]]=this.expr(b,d[a[k]]);else if(nimble.isArray(d))d.splice(a[k],1);else delete d[a[k]];else d=d[a[k]];else{f=a[k].substring(this.ORDER[0].length);f=f.substring(0,f.length-1);f=+f;if(this.isArray(d))if(k===g&&b!==undefined)if(f>=0)if(e===false)d[f]=this.expr(b,d[f]);else d.splice(f,1);else if(e===false)d[d.length+f]=this.expr(b,d[d.length+f]);else d.splice(d.length+
f,1);else d=f>=0?d[f]:d[d.length+f];else{if(f<0){h=0;for(j in d)if(d.hasOwnProperty(j))h+=1;f+=h}h=0;for(j in d)if(d.hasOwnProperty(j)){if(f===h){if(k===g&&b!==undefined)if(e===false)d[j]=this.expr(b,d[j]);else delete d[j];else d=d[j];break}h+=1}}}}if(b!==undefined)return this;return d},execEvent:function(d,a,b,e){d=d.split(this.QUERY_SEPARATOR);b=this.isExist(b)?b:[];b=this.isArray(b)?b:[b];for(var c=-1,g=d.length-1;(c+=1)<g;)a=a[d[c]];if(d[c].search(this.SUBQUERY_SEPARATOR)!==-1){d=d[c].split(this.SUBQUERY_SEPARATOR);
a=a[d[0]];d.splice(0,1);b=b.concat(d);return a.apply(e||a,b)}else return a[d[c]].apply(e||a,b)},addElementToObject:function(d,a,b){a=a.split(this.METHOD_SEPARATOR);var e,c={};if(a[1]&&a[1]=="unshift"){c[!isNaN(Number(a[0]))?0:a[0]]=b;for(e in d)if(d.hasOwnProperty(e))c[!isNaN(Number(e))?+e+1:e]=d[e];return c}else if(!a[1]||a[1]=="push")d[a[0]]=b;return true}};
(function(d){d.Collection=function(a,b){a=a||null;b=b||null;if(this.fn&&(!this.fn.name||this.fn.name!=="$.Collection"))return new d.Collection(a,b);d.extend(true,this,d.Collection.storage);var e=this.dObj.active;b&&d.extend(true,e,b);if(d.isString(a)){e.target=d(a);e.collection=null}else e.collection=a};d.Collection.fn=d.Collection.prototype={name:"$.Collection",version:"3.3",collection:function(){return this.name+" "+this.version},ACTIVE:"active",stack:["collection","filter","context","cache","index",
"map","variable","defer","page","parser","appendType","target","calculator","pager","template","numberBreak","pageBreak","resultNull"],getActiveParam:function(a){return this.dObj.sys.flags.use[a]===undefined||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:""},enable:function(a){this.dObj.sys.flags.use[a]=true;return this},disable:function(a){this.dObj.sys.flags.use[a]=false;return this},toggle:function(a){if(this.dObj.sys.flags.use[a]===true)return this.disable(a);return this.enable(a)}};d.fn.collection=
function(a){var b=d.fn.collection.stat,e=function(g){var f=[];g.each(function(j){var k=d(this),h=k.data(),l=k.attr("class")?k.attr("class").split(" "):"",m=l?l.length:0,n;n=k[0];n=n.childNodes;for(var o=n.length,p=-1,s="";(p+=1)<o;)if(n[p].nodeType===3&&d.trim(n[p].textContent))s+=n[p].textContent;n=s?s:false;var q;f.push({});for(q in h)if(h.hasOwnProperty(q))f[j][q]=h[q];if(m){m-=1;f[j][b.classes]={};for(q=-1;(q+=1)<=m;)f[j][b.classes][l[q]]=l[q]}if(k.children().length!==0)f[j][b.childNodes]=e(k.children());
if(n!==false)f[j][b.val]=n.replace(/[\r\t\n]/g," ")});return f},c=e(this);if(a)return new d.Collection(c,a);return new d.Collection(c)};if(!d.fn.collection.stat)d.fn.collection.stat={val:"val",childNodes:"childNodes",classes:"classes"};d.fn.ctplCompile=function(){if(this.length===0)throw Error("DOM element isn't exist!");for(var a=this.html().replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js"),b=a.length,e="var key = i, result = ''; ",c=-1;(c+=1)<b;)e+=c===0||
c%2===0?"result +='"+a[c]+"';":a[c].split("echo").join("result +=");return new Function("el","data","i","cOLength","self","id",e+" return result;")};d.fn.ctplMake=function(a){this.find("[type='text/ctpl']").each(function(){var b=d(this),e=b.data(),c=e.prefix?e.prefix+"_":"";a.pushTemplate(c+e.name,b.ctplCompile());e.set&&e.set===true&&a.setTemplate(c+e.name)})};d.isString=function(a){return nimble.isString(a)};d.isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"};
d.isExist=function(a){return nimble.isExist(a)};d.unshiftArguments=function(a,b){for(var e=[b],c=-1,g=a.length;(c+=1)<g;)e.push(a[c]);return e};d.toUpperCase=function(a,b,e){e=e||0;if(!b)return a.toUpperCase();return a.substring(e,b).toUpperCase()+a.substring(b)};d.toLowerCase=function(a,b,e){e=e||0;if(!b)return a.toLowerCase();return a.substring(e,b).toLowerCase()+a.substring(b)};d.Collection.storage={dObj:{active:{collection:null,filter:false,context:"",cache:{autoIteration:false,iteration:false,
firstIteration:false,lastIteration:false},index:null,map:null,variable:null,defer:"",page:1,parser:false,appendType:"html",target:null,calculator:".line",pager:"#pageControl",template:null,numberBreak:10,pageBreak:10,resultNull:""}}};d.Collection.storage.dObj.sys={flags:{use:{context:true,filter:true,parser:true}}};(function(a){var b,e,c=d.Collection.storage.dObj.sys;for(b=a.length;(b-=1)>-1;){e=d.toUpperCase(a[b],1);c["active"+e+"ID"]=null;c["tmp"+e]={};c[a[b]+"ChangeControl"]=null;c[a[b]+"Back"]=
[]}})(d.Collection.fn.stack);d.Collection.fn._$=function(a,b){var e=this.dObj,c=e.active,g=d.toUpperCase(a,1);c[a]=nimble.expr(b,c[a]||"");e.sys["active"+g+"ID"]=null;return this};d.Collection.fn._update=function(a,b){var e=this.dObj,c=e.active;e=e.sys;var g=d.toUpperCase(a,1),f=e["active"+g+"ID"];c[a]=nimble.expr(b,c[a]||"");if(f)e["tmp"+g][f]=c[a];return this};d.Collection.fn._get=function(a,b){var e=this.dObj;if(b&&b!==this.ACTIVE)return e.sys["tmp"+d.toUpperCase(a,1)][b];return e.active[a]};d.Collection.fn._push=
function(a,b,e){var c=this.dObj.sys,g=d.toUpperCase(a,1),f=c["tmp"+g];c=c["active"+g+"ID"];var j;if(d.isPlainObject(b))for(j in b){if(b.hasOwnProperty(j))if(j===this.ACTIVE)throw Error("invalid property name!");else if(f[j]&&c&&c===j)this._update(a,b[j]);else f[j]=b[j]}else if(b===this.ACTIVE)throw Error("invalid property name!");else if(f[b]&&c&&c===b)this._update(a,e);else f[b]=e;return this};d.Collection.fn._set=function(a,b){var e=this.dObj,c=e.sys,g=d.toUpperCase(a,1),f=a+"ChangeControl",j="active"+
g+"ID";if(c[j]!==b){c[f]=true;c[j]=b}else c[f]=false;c[a+"Back"].push(b);e.active[a]=c["tmp"+g][b];return this};d.Collection.fn._back=function(a,b){var e=this.dObj,c=e.sys,g=d.toUpperCase(a,1),f=c[a+"Back"],j;c[a+"ChangeControl"]=false;j=f.length-(b||1)-1;if(j>=0&&f[j])if(c["tmp"+g][f[j]]){c["active"+g+"ID"]=f[j];e.active[a]=c["tmp"+g][f[j]];f.splice(j+1,f.length)}return this};d.Collection.fn._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};
d.Collection.fn._drop=function(a,b,e,c){e=e===undefined?false:e;var g=this.dObj,f=g.active;g=g.sys;var j=d.toUpperCase(a,1),k="active"+j+"ID";j="tmp"+j;var h=g[k];b=!b?h?[h]:[]:d.isArray(b)||d.isPlainObject(b)?b:[b];var l;if(b[0]&&b[0]!==this.ACTIVE)for(l in b){if(b.hasOwnProperty(l))if(!b[l]||b[l]===this.ACTIVE)if(c===undefined){h&&delete g[j][h];g[k]=null;f[a]=e}else{if(h)g[j][h]=c;f[a]=c}else if(c===undefined){delete g[j][b[l]];if(h&&b[l]===h){g[k]=null;f[a]=e}}else{g[j][b[l]]=c;if(h&&b[l]===h)f[a]=
c}}else if(c===undefined){h&&delete g[j][h];g[k]=null;f[a]=e}else{if(h)g[j][h]=c;f[a]=c}return this};d.Collection.fn._reset=function(a,b,e){return this._drop(a,b||"","",e===undefined?false:e)};d.Collection.fn._resetTo=function(a,b,e){var c=this.dObj;e=!e||e===this.ACTIVE?c.active[a]:c.sys["tmp"+d.toUpperCase(a,1)][e];return this._reset(a,b||"",e)};d.Collection.fn._exist=function(a,b){var e=this.dObj,c=d.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&e.sys["active"+c+"ID"])return true;if(e.sys["tmp"+c][b]!==
undefined)return true;return false};d.Collection.fn._is=function(a,b){if(b===this.dObj.sys["active"+d.toUpperCase(a,1)+"ID"])return true;return false};d.Collection.fn.use=function(a){for(var b=this.stack.length;(b-=1)>-1;)this._exist(this.stack[b],a)&&this._set(this.stack[b],a);return this};d.Collection.fn._prop=function(a,b,e){var c=this.dObj[a];if(arguments.length!==3)if(d.isPlainObject(b))d.extend(c,b);else return c[b];else c[b]=e;return this};d.Collection.fn.active=function(){return this._prop.apply(this,
d.unshiftArguments(arguments,"active"))};(function(a){var b,e=d.Collection.fn,c;for(b=a.length;(b-=1)>-1;){c=d.toUpperCase(a[b],1);e["$"+c]=function(g){return function(f){return this._$(g,f)}}(a[b]);e["update"+c]=function(g){return function(f){return this._update(g,f)}}(a[b]);e["reset"+c+"To"]=function(g){return function(f,j){return this._resetTo(g,f,j)}}(a[b]);e["push"+c]=function(g){return function(){return this._push.apply(this,d.unshiftArguments(arguments,g))}}(a[b]);e["set"+c]=function(g){return function(f){return this._set(g,
f)}}(a[b]);e["pushSet"+c]=function(g){return function(f,j){return this._push(g,f,j)._set(g,f)}}(a[b]);e["back"+c]=function(g){return function(f){return this._back(g,f||"")}}(a[b]);e["back"+c+"If"]=function(g){return function(f){return this._backIf(g,f||"")}}(a[b]);e["drop"+c]=a[b]==="filter"||a[b]==="parser"?function(g){return function(){return this._drop(g,arguments)}}(a[b]):function(g){return function(){return this._drop(g,arguments,null)}}(a[b]);if(a[b]==="filter"||a[b]==="parser")e["reset"+c]=
function(g){return function(){return this._reset(g,arguments)}}(a[b]);else if(a[b]==="page")e["reset"+c]=function(g){return function(){return this._reset(g,arguments,1)}}(a[b]);else if(a[b]==="context")e["reset"+c]=function(g){return function(){return this._reset(g,arguments,"")}}(a[b]);e["is"+c]=function(g){return function(f){return this._is(g,f)}}(a[b]);e["exist"+c]=function(g){return function(f){return this._exist(g,f||"")}}(a[b]);e["get"+c]=function(g){return function(f){return this._get(g,f||
"")}}(a[b])}})(d.Collection.fn.stack);d.Collection.fn.set=function(a,b,e){a=d.isExist(a)?a.toString():"";b=b===undefined?"":b;e=e||"";var c=this.getActiveParam("context").toString();if(!a&&!c)return e&&e!==this.ACTIVE?this._push("collection",e,b):this._update("collection",b);nimble.byLink(this._get("collection",e),c+nimble.CHILDREN+a,b);return this};d.Collection.fn.get=function(a,b){a=d.isExist(a)?a.toString():"";return nimble.byLink(this._get("collection",b||""),this.getActiveParam("context").toString()+
nimble.CHILDREN+a)};d.Collection.fn.add=function(a,b,e,c,g){a=a!==undefined?a:"";b=b||"push";g=g||false;var f,j,k;f=nimble.byLink(this._get("collection",e||""),this.getActiveParam("context").toString());if(typeof f==="object"){k=d.isPlainObject(f);if(c){a=d.isExist(a)?a.toString():"";j=nimble.byLink(this._get("collection",c||""),a);if(k===true){b=b==="push"?this.length(f):b==="unshift"?this.length(f)+nimble.METHOD_SEPARATOR+"unshift":b;k=nimble.addElementToObject(f,b.toString(),j)}else{k=true;f[b](j)}g===
true&&this.disable("context").deleteElementByLink(a,c).enable("context")}else if(k===true){b=b==="push"?this.length(f):b==="unshift"?this.length(f)+nimble.METHOD_SEPARATOR+"unshift":b;k=nimble.addElementToObject(f,b.toString(),a)}else{k=true;f[b](a)}if(k!==true)this.set("",k,e||"")}else throw Error("unable to set property!");return this};d.Collection.fn.push=function(){for(var a=-1,b=arguments.length;(a+=1)<b;)this.add(arguments[a]);return this};d.Collection.fn.unshift=function(){for(var a=arguments.length;(a-=
1)>-1;)this.add(arguments[a],"unshift");return this};d.Collection.fn.deleteElementByLink=function(a,b){a=d.isExist(a)?a.toString():"";var e=this.getActiveParam("context").toString();!a&&!e?this.set("",null):nimble.byLink(this._get("collection",b||""),e+nimble.CHILDREN+a,"",true);return this};d.Collection.fn.deleteElementsByLink=function(a,b){b=b||"";var e,c;if(d.isPlainObject(a))for(e in a){if(a.hasOwnProperty(e))if(d.isArray(a[e]))for(c=a[e].length;(c-=1)>-1;)this.deleteElementByLink(a[e][c],e);
else this.deleteElementByLink(a[e],e)}else if(d.isArray(a))for(c=a.length;(c-=1)>-1;)this.deleteElementByLink(a[c],b);else this.deleteElementByLink(a,b);return this};d.Collection.fn.pop=function(){return this.deleteElementByLink("eq(-1)")};d.Collection.fn.shift=function(){return this.deleteElementByLink("eq(0)")};d.Collection.fn.concat=function(a,b,e){b=d.isExist(b)?b.toString():"";e=e||"";var c=nimble.byLink(this._get("collection",e),this.getActiveParam("context").toString()+nimble.CHILDREN+b);if(typeof c===
"object")if(d.isPlainObject(c))d.extend(true,c,a);else{if(d.isArray(c))if(d.isArray(a)){c=Array.prototype.concat(c,a);this.set(b,c,e)}else this.add(a,"push",e)}else throw Error("incorrect data type!");return this};d.Collection.fn.length=function(a,b){a=d.isExist(a)?a:this.getActiveParam("filter");var e=this.dObj,c,g,f,j,k;if(!d.isFunction(a))if(d.isString(a)&&!d.isExist(b)||d.isArray(a)||d.isPlainObject(a)){b=a;a=false}if(!b||b===this.ACTIVE)c=e.active.collection;else if(d.isString(b))c=e.sys.tmpCollection[b];
else{f=true;c=b}if(c===null)return 0;if(f!==true)c=nimble.byLink(c,this.getActiveParam("context").toString());g=c.length;if(d.isString(c))return g;if(typeof c==="object")if(a===false&&g!==undefined)k=g;else{k=0;if(g!==undefined)if(c.forEach)c.forEach(function(h,l){if(this.customFilter(a,h,c,l,g||null,this,b?b:this.ACTIVE)===true)k+=1},this);else for(j=g;(j-=1)>-1;){if(this.customFilter(a,c[j],c,j,g||null,this,b?b:this.ACTIVE)===true)k+=1}else for(j in c)if(c.hasOwnProperty(j))if(this.customFilter(a,
c[j],c,j,g||null,this,b?b:this.ACTIVE)===true)k+=1}else throw Error("incorrect data type!");return k};d.Collection.fn.each=function(a,b,e,c,g,f,j){a=d.isFunction(a)?{filter:a}:a;b=d.isExist(b)?b:this.getActiveParam("filter");e=d.isExist(e)?e:this.ACTIVE;if(d.isBoolean(e)){j=f;f=g;g=c;c=e;e=this.ACTIVE}c=c===false?false:true;g=parseInt(g)>=0?parseInt(g):false;f=parseInt(f)||false;j=parseInt(j)||false;var k=this.dObj,h,l,m,n=0;h=nimble.byLink(e!==this.ACTIVE?k.sys.tmpCollection[e]:k.active.collection,
this.getActiveParam("context").toString());l=this.length(h);if(d.isArray(h))if(h.some){k=j!==false?h.slice(j):h;k.some(function(o,p){p+=j;if(g!==false&&n===g)return true;if(this.customFilter(b,o,h,p,l,this,e)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter&&a.filter.call(a.filter,o,h,p,l,this,e)===false)return true;if(c===false)return true;n+=1}else if(a.denial&&(f===false||f===0)&&a.denial.call(a.denial,o,h,p,l,this,e)===false)return true;if(a.full&&(f===false||f===0)&&a.full.call(a.full,o,h,p,
l,this,e)===false)return true},this)}else for(m=j!==false?j-1:-1;(m+=1)<l;){if(g!==false&&n===g)break;if(this.customFilter(b,h[m],h,m,l,this,e)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter&&a.filter.call(a.filter,h[m],h,m,l,this,e)===false)break;if(c===false)break;n+=1}else if(a.denial&&(f===false||f===0)&&a.denial.call(a.denial,h[m],h,m,l,this,e)===false)break;if(a.full&&(f===false||f===0)&&a.full.call(a.full,h[m],h,m,l,this,e)===false)break}else for(m in h){if(h.hasOwnProperty(m)){if(g!==false&&
n===g)break;if(j!==false&&j!==0){j-=1;continue}if(this.customFilter(b,h[m],h,m,l,this,e)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter&&a.filter.call(a.filter,h[m],h,m,l,this,e)===false)break;if(c===false)break;n+=1}}else if(a.denial&&(f===false||f===0)&&a.denial.call(a.denial,h[m],h,m,l,this,e)===false)break;if(a.full&&(f===false||f===0)&&a.full.call(a.full,h[m],h,m,l,this,e)===false)break}return this};d.Collection.fn.searchElements=function(a,b,e,c,g,f){a=d.isExist(a)?a:this.getActiveParam("filter");
b=d.isExist(b)?b:this.ACTIVE;if(d.isBoolean(b)){f=g;g=c;c=e;e=b;b=this.ACTIVE}e=e===false?false:true;c=parseInt(c)>=0?parseInt(c):false;g=parseInt(g)||false;f=parseInt(f)||false;var j=[];this.each(function(k,h,l){if(e===true)j.push(l);else{j=l;return false}return true},a,b,e,c,g,f);return j};d.Collection.fn.searchElement=function(a,b){return this.searchElements(a||"",b||"",false)};d.Collection.fn.returnElements=function(a,b,e,c,g,f){a=d.isExist(a)?a:this.getActiveParam("filter");b=d.isExist(b)?b:
this.ACTIVE;if(d.isBoolean(b)){f=g;g=c;c=e;e=b;b=this.ACTIVE}e=e===false?false:true;c=parseInt(c)>=0?parseInt(c):false;g=parseInt(g)||false;f=parseInt(f)||false;var j=[];this.each(function(k,h,l){if(e===true)j.push(h[l]);else{j=h[l];return false}return true},a,b,e,c,g,f);return j};d.Collection.fn.returnElement=function(a,b){return this.returnElements(a||"",b||"",false)};d.Collection.fn.replaceElements=function(a,b,e,c,g,f,j){a=d.isExist(a)?a:this.getActiveParam("filter");e=d.isExist(e)?e:this.ACTIVE;
if(d.isBoolean(e)){j=f;f=g;g=c;c=e;e=this.ACTIVE}c=c===false?false:true;g=parseInt(g)>=0?parseInt(g):false;f=parseInt(f)||false;j=parseInt(j)||false;var k=d.isFunction(b);this.each(function(h,l,m,n,o,p){if(k)b.call(b,h,l,m,n,o,p);else l[m]=nimble.expr(b,l[m]);return true},a,e,c,g,f,j);return this};d.Collection.fn.replaceElement=function(a,b,e){return this.replaceElements(a||"",b,e||"",false)};d.Collection.fn.moveElements=function(a,b,e,c,g,f,j,k,h,l){a=d.isExist(a)?a:this.getActiveParam("filter");
l=l===false?false:true;b=d.isExist(b)?b.toString():"";e=e||"";c=c||"";g=g||"push";f=f===false?false:true;j=parseInt(j)>=0?parseInt(j):false;k=parseInt(k)||false;h=parseInt(h)||false;var m=[],n=d.isArray(nimble.byLink(this._get("collection",c),this.getActiveParam("context").toString())),o=-1;this.disable("context");a=this.searchElements(a,e,f,j,k,h);this.enable("context");if(f===true)for(f=a.length;(o+=1)<f;){this.add(b+nimble.CHILDREN+a[o],n===true?g:a[o]+nimble.METHOD_SEPARATOR+g,c,e);l===true&&
m.push(a[o])}else{this.add(b+nimble.CHILDREN+a,n===true?g:a+nimble.METHOD_SEPARATOR+g,c,e);l===true&&m.push(a)}l===true&&this.disable("context").deleteElementsByLink(m,e).enable("context");return this};d.Collection.fn.moveElement=function(a,b,e,c,g){return this.moveElements(a||"",d.isExist(b)?b.toString():"",e||"",c||"",g||"",false)};d.Collection.fn.copyElements=function(a,b,e,c,g,f,j,k,h){f=f===false?false:true;j=parseInt(j)>=0?parseInt(j):false;k=parseInt(k)||false;h=parseInt(h)||false;return this.moveElements(a||
"",d.isExist(b)?b.toString():"",e||"",c||"",g||"push",f,j,k,h,false)};d.Collection.fn.copyElement=function(a,b,e,c,g){return this.moveElements(a||"",d.isExist(b)?b.toString():"",e||"",c||"",g||"",false,"","","",false)};d.Collection.fn.deleteElements=function(a,b,e,c,g,f){a=d.isExist(a)?a:this.getActiveParam("filter");b=d.isExist(b)?b:this.ACTIVE;if(d.isBoolean(b)){f=g;g=c;c=e;e=b;b=this.ACTIVE}e=e===false?false:true;c=parseInt(c)>=0?parseInt(c):false;g=parseInt(g)||false;f=parseInt(f)||false;a=this.searchElements(a,
b,e,c,g,f);if(e===false)this.deleteElementByLink(a,b);else for(e=a.length;(e-=1)>-1;)this.deleteElementByLink(a[e],b);return this};d.Collection.fn.deleteElement=function(a,b){return this.deleteElements(a||"",b||"",false)};d.Collection.fn.customFilter=function(a,b,e,c,g,f,j){var k=this.dObj,h=k.active;k=k.sys;var l,m,n,o=true,p,s,q,r=-1;if(a===false)return true;if(d.isFunction(a))return a.call(a,b,e,c,g,f,j);if(!a||d.isString(a)&&d.trim(a)===this.ACTIVE){if(h.filter)return h.filter.call(h.filter,b,
e,c,g,f,j);return true}else{if(!d.isArray(a)){if(a.search(/\|\||&&|!|\(|\)/)===-1)return k.tmpFilter[a].call(k.tmpFilter[a],b,e,c,g,f,j);a=d.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ")}m=function(t,w){for(var u=-1,y=t.length,v=0,x=[];(u+=1)<y;){w+=1;if(t[u]==="(")v+=1;if(t[u]===")")if(v===0)return{result:x,iter:w};else v-=1;x.push(t[u])}};for(l=a.length;(r+=1)<l;)if(a[r]==="("||a[r]==="!("){if(a[r].substring(0,1)==="!"){q=
true;a[r]=a[r].substring(1)}else q=false;n=m(a.slice(r+1),r);r=n.iter;n=this.customFilter(n.result,b,e,c,g,f,j);o=!p&&!s?q===true?!n:n:p?q===true?!n:n&&o:q===true?!n:n||o}else if(a[r]!==")"&&a[r]!=="||"&&a[r]!=="&&"){if(a[r].substring(0,1)==="!"){q=true;a[r]=a[r].substring(1)}else q=false;n=a[r]===this.ACTIVE?h.filter:k.tmpFilter[a[r]];n=n.call(n,b,e,c,g,f,j);o=!p&&!s?q===true?!n:n:p?q===true?!n:n&&o:q===true?!n:n||o}else if(a[r]==="||"){p=false;s=true}else if(a[r]==="&&"){s=false;p=true}return o}};
d.Collection.fn.customParser=function(a,b){var e=this.dObj,c=e.active;e=e.sys;var g,f;if(a===false)return b;if(d.isFunction(a))return a.call(a,b,this);if(!a||d.isString(a)&&d.trim(a)===this.ACTIVE){if(c.parser)return c.parser.call(c.parser,b,this)}else{if(d.isString(a)){a=d.trim(a);if(a.search("&&")===-1)return e.tmpParser[a].call(e.tmpParser[a],b,this);a=a.split("&&")}for(f=a.length;(f-=1)>-1;){a[f]=d.trim(a[f]);g=a[f]===this.ACTIVE?c.parser:e.tmpParser[a[f]];b=g.call(g,b,this)}}return b};d.Collection.fn.parentContext=
function(a,b){a=a||1;var e="",c;e=this._get("collection",b||"").split(nimble.CHILDREN);for(c=a;(c-=1)>-1;)e.splice(-1,1);return e.join(nimble.CHILDREN)};d.Collection.fn.parent=function(a,b){var e=this.dObj,c=e.sys;e=e.active;var g=c.contextID,f=this.parentContext.apply(this,arguments);if(!b||b===this.ACTIVE){if(g)c.tmpContext[g]=f;e.context=f}else{c.tmpContext[b]=f;if(g&&b===g)e.context=f}return this};d.Collection.fn.orderBy=function(a,b,e,c){a=a||null;b=b||false;e=e?e===false?null:e:function(k){if(isNaN(k))return k.toUpperCase();
return k};c=c||"";var g,f=function(k){var h=[],l={},m;for(m in k)k.hasOwnProperty(m)&&h.push(m);h.sort(statObj.sort.sortBy(a,b,e));for(m in h)if(h.hasOwnProperty(m))l[h[m]]=k[h[m]];return l},j=function(k){var h=[],l={},m;for(m in k)k.hasOwnProperty(m)&&h.push({key:m,value:k[m]});h.sort(statObj.sort.sortBy(a===true?"value":"value"+statObj.obj.contextSeparator+a,b,e));for(m in h)if(h.hasOwnProperty(m))l[h[m].key]=h[m].value;return l};g=nimble.byLink(this._get("collection",c),this.getActiveParam("context").toString());
if(typeof g==="object")if(d.isArray(g))g.sort(d.Collection.sort.sortBy(a,b,e));else{g=a?j.call(this,g):f.call(this,g);this.set("",g,c||"")}else throw Error("incorrect data type!");return this};d.Collection.fn.toString=function(a,b,e){if(a&&(d.isArray(a)||d.isPlainObject(a))){if(JSON&&JSON.stringify)return JSON.stringify(a,b||"",e||"");throw Error("object JSON is not defined!");}a=nimble.byLink(this._get("collection",a||""),this.getActiveParam("context").toString());if(JSON&&JSON.stringify)return JSON.stringify(a,
b||"",e||"");throw Error("object JSON is not defined!");};d.Collection.fn.valueOf=function(a){return this.length(d.isExist(a)?a:this.ACTIVE)};d.Collection.fn.then=function(a,b){var e=this;arguments.length===1?d.when(e.active("defer")).always(function(){a.apply(e,arguments)}):d.when(e.active("defer")).then(function(){a().apply(e,arguments)},function(){b().apply(e,arguments)});return this};d.Collection.fn.print=function(a,b){b=b||false;var e=this.dObj.active,c={},g,f,j,k=0,h,l=null,m="",n;if(d.isString(a)||
d.isNumeric(a))a={page:a};else if(d.isBoolean(a))b=a;d.extend(true,c,e,a);if(a)c.page=nimble.expr(c.page,e.page||"");if(c.page<1)c.page=1;c.collection=d.isString(c.collection)?this._get("collection",c.collection):c.collection;c.template=d.isString(c.template)?this._get("template",c.template):c.template;c.filter=d.isExist(a.filter)?a.filter:this.getActiveParam("filter");c.parser=d.isExist(a.parser)?a.parser:this.getActiveParam("parser");h=e.page-c.page;e.page=c.page;n=function(o,p,s,q,r){c.callback&&
c.callback.apply(this,arguments);m+=c.template.call(c.template,o,p,s,q,r);k=p;return true};g=nimble.byLink(c.collection,this.getActiveParam("context").toString()+nimble.CHILDREN+(a&&a.context||""));f=this.length();c.numberBreak=!b||c.numberBreak===false?f:c.numberBreak;if(d.isPlainObject(g)||c.cache.iteration===false||c.cache.firstIteration===false||c.cache.lastIteration===false){j=!b||c.page===1?0:(c.page-1)*c.numberBreak;this.each(n,c.filter,this.ACTIVE,true,c.numberBreak,j)}else if(d.isArray(g)&&
c.cache.iteration===true){j=!b||c.filter===false?c.page===1?0:(c.page-1)*c.numberBreak:c.cache.iteration===true?h>0?c.cache.firstIteration:c.cache.lastIteration:i;if(h>0&&b===true&&c.filter!==false){for(h*=c.numberBreak;(j-=1)>-1;)if(this.customFilter(c.filter,g[j],g,j,f,this,this.ACTIVE)===true)if(k===h)break;else k+=1;c.cache.lastIteration=j+=1;l=null}else if(h<0&&b===true&&c.filter!==false)l=Math.abs(h)*c.numberBreak-c.numberBreak||null;this.each(n,c.filter,this.ACTIVE,true,c.numberBreak,l,j)}e.cache.firstIteration=
c.cache.lastIteration;e.cache.lastIteration=k+1;if(c.cache.autoIteration===true)e.cache.iteration=true;m=!m?c.resultNull:this.customParser(c.parser,m);if(c.target===false){c.variable?this._push("variable",c.variable,m):this._$("variable",m);return this}else c.target[c.appendType](m);if(!b)return this;c.nmbOfEntries=c.filter!==false?this.length(c.filter):f;c.nmbOfEntriesInPage=c.target.find(c.calculator).length;c.finNumber=c.numberBreak*c.page-(c.numberBreak-c.nmbOfEntriesInPage);if(c.page!==1&&c.nmbOfEntriesInPage===
0){c.page="-=1";this.print(c,true)}else this.easyPage(c);return this};d.Collection.fn.easyPage=function(a){var b="",e=a.nmbOfEntries%a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak,c=function(h,l,m){var n,o="<"+(h.tag||"span")+' data-page="'+m+'"';if(h.attr)for(n in h.attr)if(h.attr.hasOwnProperty(n))o+=" "+n+'="'+h.attr[n]+'"';if(m===a.page)o+=' class="'+(l&&l.active||"active")+'"';return o+(">"+m+"</"+(h.tag||"span")+">")},g,f=0,j,k;a.pager.find("[data-ctm]").each(function(){if(a.pageBreak<=
2)throw Error('parameter "pageBreak" must be more than 2');var h=d(this),l=h.data("ctm"),m=l.classes;if(l.nav){if(l.nav==="prev"&&a.page===1||l.nav==="next"&&a.finNumber===a.nmbOfEntries)h.addClass(m&&m.disabled||"disabled");else if(l.nav==="prev"||l.nav==="next")h.removeClass(m&&m.disabled||"disabled");if(l.nav==="pageList"){if(e>a.pageBreak){f=a.pageBreak%2!==0?1:0;k=j=(a.pageBreak-f)/2;if(a.page-f<j)j=0;else{j=a.page-j-f;if(a.page+k>e)j-=a.page+k-e}g=j;for(f=-1;(g+=1)<=e&&(f+=1)!==null;){if(f===
a.pageBreak&&g!==a.page)break;b+=c(l,m||"",g)}}else for(g=0;(g+=1)<=e;)b+=c(l,m||"",g);h.html(b)}}else if(l.info){a.nmbOfEntriesInPage===0?h.addClass(m&&m.noData||"noData"):h.removeClass(m&&m.noData||"noData");switch(l.info){case "page":h.html(a.page);break;case "total":h.html(a.nmbOfEntries);break;case "from":h.html((a.page-1)*a.numberBreak+1);break;case "to":h.html(a.finNumber);break;case "inPage":h.html(a.nmbOfEntriesInPage);break;case "nmbOfPages":h.html(a.nmbOfPages)}}});return this};d.Collection.fn.genTable=
function(a,b,e){a=a||4;b=b||"div";e=e===false?false:true;var c=1,g,f=this.dObj.active.target,j=f.find(b).length,k="";f.find(b).each(function(h){this.tagName!=="td"&&d(this).wrap("<td></td>");if(c===a){k="";for(g=-1;(g+=1)<a;){k+="td:eq("+(h-g)+")";if(g!==a-1)k+=","}f.find(k).wrapAll("<tr></tr>");c=0}else if(h===j-1&&c!==a){k="";for(g=-1;(g+=1)<c;){k+="td:eq("+(h-g)+")";if(g!==c-1)k+=","}c-=1;f.find(k).wrapAll("<tr></tr>");if(e===true){for(k="";(c+=1)<a;)k+="<td></td>";f.find("tr:last").append(k)}}c+=
1});f[0].tagName!=="table"&&f.children("tr").wrapAll("<table></table>");return this}})(jQuery);
//