/**
 * $.Collection
 * 
 * autor: kobezzza (kobezzza@gmail.com | http://kobezzza.com)
 * version: 3.4
 * date: 15.01.2012 23:16:19
 */
 var nimble=function(){return{name:"nimble",version:"1.0.2",nimble:function(){return this.name+" "+this.version},CONTEXT_SEPARATOR:" ",QUERY_SEPARATOR:"/",SUBQUERY_SEPARATOR:"{",METHOD_SEPARATOR:"->",CHILDREN:">",ORDER:["eq(",")"],trim:function(d){d=d.replace(/^\s\s*/,"");for(var a=/\s/,c=d.length;a.test(d.charAt(c-=1)););return d.substring(0,c+1)},isString:function(d){return Object.prototype.toString.call(d)==="[object String]"},isNumber:function(d){return Object.prototype.toString.call(d)==="[object Number]"},
isArray:function(d){return Object.prototype.toString.call(d)==="[object Array]"},isExists:function(d){return d!==undefined&&d!=="undefined"&&d!==null&&d!==""},expr:function(d,a){a=a!==undefined||a!==null?a:"";if(this.isString(d)&&d.search(/^[+-\\*/]{1}=/)!==-1){d=d.split("=");isNaN(d[1])||(d[1]=+d[1]);switch(d[0]){case "+":d=a+d[1];break;case "-":d=a-d[1];break;case "*":d=a*d[1];break;case "/":d=a/d[1]}}return d},byLink:function(d,a,c,b){a=a.toString().replace(RegExp("\\s*"+this.CHILDREN+"\\s*","g"),
" "+this.CHILDREN+" ").split(this.CONTEXT_SEPARATOR);b=b||false;for(var e=this.CHILDREN,g=0,f=0,j,h=a.length,l,k;(h-=1)>-1;){a[h]=this.trim(a[h]);if(a[h]===""){a.splice(h,1);g-=1}else if(a[h]!==this.CHILDREN){if(h>g)g=h;f+=1}}k=a.length;if(d===false)return a.join("");else if(this.isNumber(d)){if((d=+d)<0)d+=f;if(c===undefined){h=-1;for(l=0;(h+=1)<k;)if(a[h]!==this.CHILDREN)if((l+=1)===d){a.splice(h+1,k);return a.join("")}}else{h=k;for(l=0;(h-=1)>-1;)if(a[h]!==this.CHILDREN)if((l+=1)===d){a.splice(0,
h);return a.join("")}}}for(h=-1;(h+=1)<k;)switch(a[h]){case this.CHILDREN:e=a[h];break;default:if(e===this.CHILDREN&&a[h].substring(0,this.ORDER[0].length)!==this.ORDER[0])if(h===g&&c!==undefined)if(b===false)d[a[h]]=this.expr(c,d[a[h]]);else if(nimble.isArray(d))d.splice(a[h],1);else delete d[a[h]];else d=d[a[h]];else{f=a[h].substring(this.ORDER[0].length);f=f.substring(0,f.length-1);f=+f;if(this.isArray(d))if(h===g&&c!==undefined)if(f>=0)if(b===false)d[f]=this.expr(c,d[f]);else d.splice(f,1);else if(b===
false)d[d.length+f]=this.expr(c,d[d.length+f]);else d.splice(d.length+f,1);else d=f>=0?d[f]:d[d.length+f];else{if(f<0){l=0;for(j in d)if(d.hasOwnProperty(j))l+=1;f+=l}l=0;for(j in d)if(d.hasOwnProperty(j)){if(f===l){if(h===g&&c!==undefined)if(b===false)d[j]=this.expr(c,d[j]);else delete d[j];else d=d[j];break}l+=1}}}}if(c!==undefined)return this;return d},execEvent:function(d,a,c,b){d=d.split(this.QUERY_SEPARATOR);c=this.isExists(c)?c:[];c=this.isArray(c)?c:[c];for(var e=-1,g=d.length-1;(e+=1)<g;)a=
a[d[e]];if(d[e].search(this.SUBQUERY_SEPARATOR)!==-1){d=d[e].split(this.SUBQUERY_SEPARATOR);a=a[d[0]];d.splice(0,1);c=c.concat(d);return a.apply(b||a,c)}else return a[d[e]].apply(b||a,c)},addElementToObject:function(d,a,c){a=a.split(this.METHOD_SEPARATOR);var b,e={};if(a[1]&&a[1]=="unshift"){e[!isNaN(Number(a[0]))?0:a[0]]=c;for(b in d)if(d.hasOwnProperty(b))e[!isNaN(Number(b))?+b+1:b]=d[b];return e}else if(!a[1]||a[1]=="push")d[a[0]]=c;return true}}}();
(function(d){d.Collection=function(a,c){a=a||null;c=c||null;if(this.fn&&(!this.fn.name||this.fn.name!=="$.Collection"))return new d.Collection(a,c);d.extend(true,this,d.Collection.storage);var b=this.dObj.active;c&&d.extend(true,b,c);if(d.isString(b.filter))b.filter=this._compileFilter(b.filter);if(d.isString(a)){b.target=d(a);b.collection=null}else b.collection=a};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,c){for(var b=-1,e=this.length;(b+=1)<e;)c?a.call(c,this[b],b,this):a(this[b],
b,this)};if(!Array.prototype.some)Array.prototype.some=function(a,c){for(var b=-1,e=this.length,g;(b+=1)<e;){g=c?a.call(c,this[b],b,this):a(this[b],b,this);if(g===true)break}};d.Collection.prototype={name:"$.Collection",version:"3.5",collection:function(){return this.name+" "+this.version},ACTIVE:"active",SHUFFLE:"shuffle",NAMESPACE_SEPARATOR:".",stack:["namespace","collection","filter","context","cache","variable","defer","page","parser","appendType","target","calculator","pager","template","numberBreak",
"pageBreak","resultNull"]};d.fn.collection=function(a){var c=d.fn.collection.stat,b=function(f){f=f.childNodes;for(var j=f.length,h=-1,l="";(h+=1)<j;)if(f[h].nodeType===3&&d.trim(f[h].textContent))l+=f[h].textContent;if(l)return l;return false},e=function(f){var j=[];f.each(function(h){var l=d(this),k=l.data(),m=l.attr("class")?l.attr("class").split(" "):"",n=b(this),o;j.push({});for(o in k)if(k.hasOwnProperty(o))j[h][o]=k[o];if(m){j[h][c.classes]={};m.forEach(function(p){j[h][c.classes][p]=p})}if(l.children().length!==
0)j[h][c.childNodes]=e(l.children());if(n!==false)j[h][c.val]=n.replace(/[\r\t\n]/g," ")});return j},g=e(this);if(a)return new d.Collection(g,a);return new d.Collection(g)};if(!d.fn.collection.stat)d.fn.collection.stat={val:"val",childNodes:"childNodes",classes:"classes"};d.fn.ctplCompile=function(){if(this.length===0)throw Error("DOM element does't exist!");var a="var key = i, result = ''; ";this.html().replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(c,
b){a+=b===0||b%2===0?"result +='"+c+"';":c.split("echo").join("result +=")});return new Function("el","i","data","cOLength","cObj","id",a+" return result;")};d.fn.ctplMake=function(a){this.each(function(){var c=d(this),b=c.data("ctpl"),e,g=b.prefix?b.prefix+"_":"";if(d.isString(b))b=d.parseJSON(b);a._push("template",g+b.name,c.ctplCompile());b.set&&b.set===true&&a._set("template",g+b.name);for(e in b)if(b.hasOwnProperty(e))if(!(e==="prefix"||e==="set"||e==="print"||e==="name")){if(e==="target"||e===
"pager")b[e]=d(b[e]);a._push(e,g+b.name,b[e]);b.set&&b.set===true&&a._set(e,g+b.name);if(e==="filter"||e==="parser")b[e]=g+b.name}if(b.print&&b.print===true){b.template=b.name;a.print(b)}});return this};d.isString=function(a){return nimble.isString(a)};d.isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"};d.isExists=function(a){return nimble.isExists(a)};d.unshiftArguments=function(a,c){for(var b=[c],e=-1,g=a.length;(e+=1)<g;)b.push(a[e]);return b};d.toUpperCase=function(a,
c,b){b=b||0;c=d.isExists(c)?b+c:a.length;return a.substring(0,b)+a.substring(b,c).toUpperCase()+a.substring(c)};d.toLowerCase=function(a,c,b){b=b||0;c=d.isExists(c)?b+c:a.length;return a.substring(0,b)+a.substring(b,c).toLowerCase()+a.substring(c)};d.getRandomInt=function(a,c){return Math.floor(Math.random()*(c-a+1))+a};d.Collection.storage={dObj:{active:{namespace:"nm",collection:null,filter:false,context:"",cache:{autoIteration:true,iteration:true,firstIteration:false,lastIteration:false},variable:null,
defer:"",page:1,parser:false,appendType:"html",target:null,calculator:".line",pager:null,template:null,numberBreak:10,pageBreak:10,resultNull:""}}};d.Collection.storage.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};(function(a){var c,b=d.Collection.storage.dObj.sys;a.forEach(function(e){c=d.toUpperCase(e,1);b["active"+c+"ID"]=null;b["tmp"+c]={};b[e+"ChangeControl"]=null;b[e+"Back"]=[]})})(d.Collection.prototype.stack);d.Collection.prototype._new=function(a,c){var b=this.dObj.active,
e=d.toUpperCase(a,1);b[a]=(a==="filter"||a==="parser")&&d.isString(c)&&c.search(/^:/)!==-1?this["_compile"+d.toUpperCase(a,1)](c):nimble.expr(c,b[a]||"");this.dObj.sys["active"+e+"ID"]=null;return this};d.Collection.prototype._update=function(a,c){var b=this.dObj.active,e=this.dObj.sys,g=this._getActiveID(a);b[a]=(a==="filter"||a==="parser")&&d.isString(c)&&c.search(/^:/)!==-1?this["_compile"+d.toUpperCase(a,1)](c):nimble.expr(c,b[a]||"");if(g)e["tmp"+d.toUpperCase(a,1)][g]=b[a];return this};d.Collection.prototype._get=
function(a,c){if(c&&c!==this.ACTIVE){if(!this._exists(a,c))throw Error('the object "'+c+'" -> "'+a+"\" doesn't exist in the stack!");return this.dObj.sys["tmp"+d.toUpperCase(a,1)][c]}return this.dObj.active[a]};d.Collection.prototype._push=function(a,c,b){var e=this.dObj.sys["tmp"+d.toUpperCase(a,1)],g=this._getActiveID(a),f;if(d.isPlainObject(c))for(f in c){if(c.hasOwnProperty(f))if(f===this.ACTIVE)throw Error("invalid property name!");else if(e[f]&&g&&g===f)this._update(a,c[f]);else e[f]=(a==="filter"||
a==="parser")&&d.isString(c[f])&&b.search(/^:/)!==-1?this["_compile"+d.toUpperCase(a,1)](c[f]):c[f]}else if(c===this.ACTIVE)throw Error("invalid property name!");else if(e[c]&&g&&g===c)this._update(a,b);else e[c]=(a==="filter"||a==="parser")&&d.isString(b)&&b.search(/^:/)!==-1?this["_compile"+d.toUpperCase(a,1)](b):b;return this};d.Collection.prototype._set=function(a,c){var b=this.dObj.sys,e=d.toUpperCase(a,1),g=a+"ChangeControl",f="active"+e+"ID";if(!this._exists(a,c))throw Error('the object "'+
c+'" -> "'+a+"\" doesn't exist in the stack!");if(b[f]!==c){b[g]=true;b[f]=c}else b[g]=false;b[a+"Back"].push(c);this.dObj.active[a]=b["tmp"+e][c];return this};d.Collection.prototype._back=function(a,c){var b=this.dObj.sys,e=d.toUpperCase(a,1),g=b[a+"Back"],f=g.length-(c||1)-1;if(f>=0&&g[f])if(b["tmp"+e][g[f]]){this._set(a,g[f]);b[a+"ChangeControl"]=false;g.splice(f+1,g.length)}return this};d.Collection.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,
arguments);return this};d.Collection.prototype._drop=function(a,c,b,e){b=b===undefined?false:b;var g=this.dObj.active,f=this.dObj.sys,j=d.toUpperCase(a,1),h="active"+j+"ID";j="tmp"+j;var l=this._getActiveID(a);c=!c?l?[l]:[]:d.isArray(c)||d.isPlainObject(c)?c:[c];var k;if(c[0]&&c[0]!==this.ACTIVE)for(k in c){if(c.hasOwnProperty(k))if(!c[k]||c[k]===this.ACTIVE)if(e===undefined){l&&delete f[j][l];f[h]=null;g[a]=b}else{if(l)f[j][l]=e;g[a]=e}else if(e===undefined){delete f[j][c[k]];if(l&&c[k]===l){f[h]=
null;g[a]=b}}else{f[j][c[k]]=e;if(l&&c[k]===l)g[a]=e}}else if(e===undefined){l&&delete f[j][l];f[h]=null;g[a]=b}else{if(l)f[j][l]=e;g[a]=e}return this};d.Collection.prototype._reset=function(a,c,b){return this._drop(a,c||"","",b===undefined?false:b)};d.Collection.prototype._resetTo=function(a,c,b){b=!b||b===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+d.toUpperCase(a,1)][b];return this._reset(a,c||"",b)};d.Collection.prototype._exists=function(a,c){var b=d.toUpperCase(a,1);if((!c||c===this.ACTIVE)&&
this._getActiveID(a))return true;if(this.dObj.sys["tmp"+b][c]!==undefined)return true;return false};d.Collection.prototype._getActiveID=function(a){return this.dObj.sys["active"+d.toUpperCase(a,1)+"ID"]};d.Collection.prototype._isActive=function(a,c){if(c===this._getActiveID(a))return true;return false};d.Collection.prototype.use=function(a){this.stack.forEach(function(c){var b,e,g;if(this._exists(c,a))this._set(c,a);else{b=a.split(this.NAMESPACE_SEPARATOR);for(g=b.length;(g-=1)>-1;){b.splice(g,1);
e=b.join(this.NAMESPACE_SEPARATOR);if(this._exists(c,e)){this._set(c,e);break}}}},this);return this};d.Collection.prototype._prop=function(a,c,b){var e=this.dObj[a];if(arguments.length!==3)if(d.isPlainObject(c))d.extend(e,c);else return e[c];else e[c]=b;return this};d.Collection.prototype.active=function(){return this._prop.apply(this,d.unshiftArguments(arguments,"active"))};(function(a){var c=d.Collection.prototype,b;a.forEach(function(e){b=d.toUpperCase(e,1);c["new"+b]=function(g){return function(f){return this._new(g,
f)}}(e);c["update"+b]=function(g){return function(f){return this._update(g,f)}}(e);c["reset"+b+"To"]=function(g){return function(f,j){return this._resetTo(g,f,j)}}(e);c["push"+b]=function(g){return function(){return this._push.apply(this,d.unshiftArguments(arguments,g))}}(e);c["set"+b]=function(g){return function(f){return this._set(g,f)}}(e);c["pushSet"+b]=function(g){return function(f,j){return this._push(g,f,j)._set(g,f)}}(e);c["back"+b]=function(g){return function(f){return this._back(g,f||"")}}(e);
c["back"+b+"If"]=function(g){return function(f){return this._backIf(g,f||"")}}(e);c["drop"+b]=e==="filter"||e==="parser"?function(g){return function(){return this._drop(g,arguments)}}(e):function(g){return function(){return this._drop(g,arguments,null)}}(e);if(e==="filter"||e==="parser")c["reset"+b]=function(g){return function(){return this._reset(g,arguments)}}(e);else if(e==="page")c["reset"+b]=function(g){return function(){return this._reset(g,arguments,1)}}(e);else if(e==="context")c["reset"+
b]=function(g){return function(){return this._reset(g,arguments,"")}}(e);c["isActive"+b]=function(g){return function(f){return this._isActive(g,f)}}(e);c["exists"+b]=function(g){return function(f){return this._exists(g,f||"")}}(e);c["get"+b+"ActiveID"]=function(g){return function(){return this._getActiveID(g)}}(e);c["get"+b]=function(g){return function(f){return this._get(g,f||"")}}(e)})})(d.Collection.prototype.stack);d.Collection.prototype._setOne=function(a,c,b){a=d.isExists(a)?a.toString():"";
c=c===undefined?"":c;b=b||"";var e=this._getActiveParam("context");if(!a&&!e)return b&&b!==this.ACTIVE?this._push("collection",b,c):this._update("collection",c);nimble.byLink(this._get("collection",b),e+nimble.CHILDREN+a,c);return this};d.Collection.prototype._getOne=function(a,c){a=d.isExists(a)?a.toString():"";return nimble.byLink(this._get("collection",c||""),this._getActiveParam("context")+nimble.CHILDREN+a)};d.Collection.prototype.add=function(a,c,b,e,g){a=a!==undefined?a:"";c=c||"push";b=b||
"";g=g||false;var f,j,h;f=nimble.byLink(this._get("collection",b),this._getActiveParam("context"));if(typeof f==="object"){if(e){a=d.isExists(a)?a.toString():"";j=nimble.byLink(this._get("collection",e||""),a);if(d.isPlainObject(f)){c=c==="push"?this.length(f):c==="unshift"?this.length(f)+nimble.METHOD_SEPARATOR+"unshift":c;h=nimble.addElementToObject(f,c.toString(),j)}else{h=true;f[c](j)}g===true&&this.disable("context")._removeOne(a,e).enable("context")}else if(d.isPlainObject(f)){c=c==="push"?
this.length(f):c==="unshift"?this.length(f)+nimble.METHOD_SEPARATOR+"unshift":c;h=nimble.addElementToObject(f,c.toString(),a)}else{h=true;f[c](a)}h!==true&&this._setOne("",h,b)}else throw Error("unable to set property!");return this};d.Collection.prototype.push=function(a,c){return this.add(a,"",c||"")};d.Collection.prototype.unshift=function(a,c){return this.add(a,"unshift",c||"")};d.Collection.prototype._removeOne=function(a,c){a=d.isExists(a)?a.toString():"";var b=this._getActiveParam("context");
!a&&!b?this._setOne("",null):nimble.byLink(this._get("collection",c||""),b+nimble.CHILDREN+a,"",true);return this};d.Collection.prototype._remove=function(a,c){c=c||"";var b,e;if(d.isPlainObject(a))for(b in a){if(a.hasOwnProperty(b))if(d.isArray(a[b]))for(e=a[b].length;(e-=1)>-1;)this._removeOne(a[b][e],b);else this._removeOne(a[b],b)}else if(d.isArray(a))for(e=a.length;(e-=1)>-1;)this._removeOne(a[e],c);else this._removeOne(a,c);return this};d.Collection.prototype.pop=function(a){return this._removeOne("eq(-1)",
a||"")};d.Collection.prototype.shift=function(a){return this._removeOne("eq(0)",a||"")};d.Collection.prototype.concat=function(a,c,b){c=d.isExists(c)?c.toString():"";b=b||"";var e=nimble.byLink(this._get("collection",b),this._getActiveParam("context")+nimble.CHILDREN+c);if(typeof e==="object")if(d.isPlainObject(e))d.extend(true,e,a);else{if(d.isArray(e))if(d.isArray(a)){e=Array.prototype.concat(e,a);this._setOne(c,e,b)}else this.add(a,"push",b)}else throw Error("incorrect data type!");return this};
d.Collection.prototype.length=function(a,c){a=a||"";var b={},e,g,f,j;if(!d.isFunction(a))if(d.isString(a)&&!this._filterTest(a)&&!d.isExists(c)||d.isArray(a)||d.isPlainObject(a)){c=a;a=false}if(!c||c===this.ACTIVE)e=this._get("collection");else if(d.isString(c))e=this._get("collection",c);else{g=true;e=c}if(e===null)return 0;if(g!==true)e=nimble.byLink(e,this._getActiveParam("context"));if(d.isString(e))return e.length;if(typeof e!=="object")throw Error("incorrect data type!");if(a===false&&e.length!==
undefined)j=e.length;else{j=0;if(e.length!==undefined)e.forEach(function(h,l){if(this._customFilter(a,h,l,e,j||null,this,c?c:this.ACTIVE,b)===true)j+=1},this);else for(f in e)if(e.hasOwnProperty(f))if(this._customFilter(a,e[f],f,e,j||null,this,c?c:this.ACTIVE,b)===true)j+=1}b.name&&this._drop("filter","__tmp:"+b.name);return j};d.Collection.prototype.forEach=function(a,c,b,e,g,f,j){a=d.isFunction(a)?{filter:a}:a;c=c||"";b=d.isExists(b)?b:this.ACTIVE;if(d.isBoolean(b)){j=f;f=g;g=e;e=b;b=this.ACTIVE}e=
e===false?false:true;g=parseInt(g)>=0?parseInt(g):false;f=parseInt(f)||false;j=parseInt(j)||false;var h={},l,k,m,n=0,o=false,p;l=nimble.byLink(this._get("collection",b),this._getActiveParam("context"));if(typeof l!=="object")throw Error("incorrect data type!");k=this.length(l);if(d.isArray(l)){m=j!==false?l.slice(j):l;m.some(function(q,r){r+=j;if(g!==false&&n===g)return true;if(this._customFilter(c,q,r,l,k,this,b,h)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter)o=a.filter.call(a.filter,q,r,l,k,
this,b)===false;if(e===false)o=true;n+=1}else if(a.denial&&(f===false||f===0)){p=a.denial.call(a.denial,q,r,l,k,this,b);if(o===false&&p===false)o=true}if(a.full&&(f===false||f===0)){p=a.full.call(a.full,q,r,l,k,this,b);if(o===false&&p===false)o=true}if(o===true)return true;p=""},this)}else for(m in l)if(l.hasOwnProperty(m)){if(g!==false&&n===g)break;if(j!==false&&j!==0)j-=1;else{if(this._customFilter(c,l[m],m,l,k,this,b,h)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter)o=a.filter.call(a.filter,
l[m],m,l,k,this,b)===false;if(e===false)o=true;n+=1}else if(a.denial&&(f===false||f===0)){p=a.denial.call(a.denial,l[m],m,l,k,this,b);if(o===false&&p===false)o=true}if(a.full&&(f===false||f===0)){p=a.full.call(a.full,l[m],m,l,k,this,b);if(o===false&&p===false)o=true}if(o===true)break;p=""}}h.name&&this._drop("filter","__tmp:"+h.name);return this};d.Collection.prototype.search=function(a,c,b,e,g,f){a=a||"";c=d.isExists(c)?c:this.ACTIVE;if(d.isBoolean(c)){f=g;g=e;e=b;b=c;c=this.ACTIVE}b=b===false?false:
true;e=parseInt(e)>=0?parseInt(e):false;g=parseInt(g)||false;f=parseInt(f)||false;var j=b===true?[]:-1;this.forEach(function(h,l){if(b===true)j.push(l);else j=l;return true},a,c,b,e,g,f);return j};d.Collection.prototype.searchOne=function(a,c){return this.search(d.isExists(a)?a:"",c||"",false)};d.Collection.prototype.indexOf=function(a,c,b){b=b||"";c=c||"";var e=nimble.byLink(this._get("collection",b),this._getActiveParam("context"));if(d.isArray(e)&&e.indexOf){if(c)return e.indexOf(a,c);return e.indexOf(a)}else return this.search(function(g){return g===
a},b,false,"","",c)};d.Collection.prototype.lastIndexOf=function(a,c,b){b=b||"";c=c||"";var e=nimble.byLink(this._get("collection",b),this._getActiveParam("context"));if(d.isArray(e)&&e.lastIndexOf){if(c)return e.lastIndexOf(a,c);return e.lastIndexOf(a)}else{c=this.search(function(g){return g===a},b,"","","",c);return c[c.length-1]!==undefined?c[c.length-1]:-1}};d.Collection.prototype.get=function(a,c,b,e,g,f){if(d.isNumeric(a)||arguments.length<2&&d.isString(a)&&!this._filterTest(a)||arguments.length===
0||arguments.length<2&&a===null)return this._getOne(a,c||"");a=a=a||"";c=d.isExists(c)?c:this.ACTIVE;if(d.isBoolean(c)){f=g;g=e;e=b;b=c;c=this.ACTIVE}b=b===false?false:true;e=parseInt(e)>=0?parseInt(e):false;g=parseInt(g)||false;f=parseInt(f)||false;var j=b===true?[]:-1;this.forEach(function(h,l,k){if(b===true)j.push(k[l]);else j=k[l];return true},a,c,b,e,g,f);return j};d.Collection.prototype.getOne=function(a,c){return this.get(d.isExists(a)?a:"",c||"",false)};d.Collection.prototype.set=function(a,
c,b){if(d.isNumeric(a)||arguments.length<3&&d.isString(a)&&!this._filterTest(a)||arguments.length===0||arguments.length<3&&a===null)return this._setOne(a,c,b||"");var e,g=d.isFunction(c);e=d.unshiftArguments(arguments,function(f,j,h,l,k,m){h[j]=g?c.call(c,f,j,h,l,k,m):nimble.expr(c,h[j]);return true});e.splice(2,1);return this.forEach.apply(this,e)};d.Collection.prototype.setOne=function(a,c,b){return this.set(d.isExists(a)?a:"",c,b||"",false)};d.Collection.prototype.map=function(a,c){return this.set(true,
a,c||"")};d.Collection.prototype.some=function(a,c,b){return this.forEach(a,c||"",b||"",false)};d.Collection.prototype.move=function(a,c,b,e,g,f,j,h,l,k){a=a||"";k=k===false?false:true;c=d.isExists(c)?c.toString():"";b=b||"";e=e||"";g=g||"push";f=f===false?false:true;j=parseInt(j)>=0?parseInt(j):false;h=parseInt(h)||false;l=parseInt(l)||false;var m=[],n=d.isArray(nimble.byLink(this._get("collection",e),this._getActiveParam("context")));this.disable("context");a=this.search(a,b,f,j,h,l);this.enable("context");
if(f===true)a.forEach(function(o){this.add(c+nimble.CHILDREN+o,n===true?g:o+nimble.METHOD_SEPARATOR+g,e,b);k===true&&m.push(o)},this);else{this.add(c+nimble.CHILDREN+a,n===true?g:a+nimble.METHOD_SEPARATOR+g,e,b);k===true&&m.push(a)}k===true&&this.disable("context")._remove(m,b).enable("context");return this};d.Collection.prototype.moveOne=function(a,c,b,e,g){return this.move(d.isExists(a)?a:"",d.isExists(c)?c.toString():"",b||"",e||"",g||"",false)};d.Collection.prototype.copy=function(a,c,b,e,g,f,
j,h,l){f=f===false?false:true;j=parseInt(j)>=0?parseInt(j):false;h=parseInt(h)||false;l=parseInt(l)||false;return this.move(d.isExists(a)?a:"",d.isExists(c)?c.toString():"",b||"",e||"",g||"push",f,j,h,l,false)};d.Collection.prototype.copyOne=function(a,c,b,e,g){return this.move(d.isExists(a)?a:"",d.isExists(c)?c.toString():"",b||"",e||"",g||"",false,"","","",false)};d.Collection.prototype.remove=function(a,c){if(d.isNumeric(a)||arguments.length<2&&d.isString(a)&&!this._filterTest(a)||arguments.length===
0||arguments.length<2&&a===null)return this._removeOne(a,c||"");else if(d.isArray(a)||d.isPlainObject(a))return this._remove(a,c||"");var b=this.search.apply(this,arguments),e;if(d.isArray(b))for(e=b.length;(e-=1)>-1;)this._removeOne(b[e],c);else this._removeOne(b,c);return this};d.Collection.prototype.removeOne=function(a,c){return this.remove(d.isExists(a)?a:"",c||"",false)};d.Collection.prototype.sort=function(a,c,b,e){a=a||null;c=c||false;b=b&&b!==true?b===false?null:b:function(k){if(isNaN(k))return k.toUpperCase();
return k};e=e||"";var g=this,f,j=function(k,m){var n=c?-1:1;if(a){k=nimble.byLink(k,a);m=nimble.byLink(m,a)}if(b){k=b(k);m=b(m)}if(c!==g.SHUFFLE){if(k<m)return n*-1;if(k>m)return n;return 0}else return Math.floor(Math.random()*2-1)},h=function(k){var m=[],n={},o;for(o in k)k.hasOwnProperty(o)&&m.push(o);m.sort(j);for(o in m)if(m.hasOwnProperty(o))n[m[o]]=k[m[o]];return n},l=function(k){var m=[],n={},o;for(o in k)k.hasOwnProperty(o)&&m.push({key:o,value:k[o]});a=a===true?"value":"value"+nimble.CHILDREN+
a;m.sort(j);for(o in m)if(m.hasOwnProperty(o))n[m[o].key]=m[o].value;return n};f=nimble.byLink(this._get("collection",e),this._getActiveParam("context"));if(typeof f==="object")if(d.isArray(f))f.sort(j);else{f=a?l(f):h(f);this._setOne("",f,e)}else throw Error("incorrect data type!");return this};d.Collection.prototype.reverse=function(a){a=a||"";var c,b=function(e){var g=[],f={},j;for(j in e)e.hasOwnProperty(j)&&g.push(j);g.reverse();for(j in g)if(g.hasOwnProperty(j))f[g[j]]=e[g[j]];return f};c=nimble.byLink(this._get("collection",
a),this._getActiveParam("context"));if(typeof c==="object")d.isArray(c)?c.reverse():this._setOne("",b(c),a);else throw Error("incorrect data type!");return this};d.Collection.prototype.save=function(a,c,b){if(!localStorage)throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;c="__"+this.name+"__"+this._get("namespace",c||"");var e=a===this.ACTIVE?this._exists("collection")?this._getActiveID("collection"):"":this._isActive("collection",a)?"active":"";b=b===false?sessionStorage:
localStorage;b.setItem(c+":"+a,this.toString(a));b.setItem(c+"__date:"+a,(new Date).toString());b.setItem(c+"__active:"+a,e);b.setItem(c+"__date",(new Date).toString());return this};d.Collection.prototype.saveAll=function(a,c){if(!localStorage)throw Error("your browser doesn't support web storage!");a=a||"";c=c===false?c:true;var b,e=this.dObj.sys.tmpCollection,g=false;this.dropAll(a,c);for(b in e){this._isActive("Collection",b)&&(g=true);e.hasOwnProperty(b)&&this.save(b,a,c)}g===false&&this.save("",
a,c);return this};d.Collection.prototype.load=function(a,c,b){if(!localStorage)throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;c="__"+this.name+"__"+this._get("namespace",c||"");b=b===false?sessionStorage:localStorage;a===this.ACTIVE?this._new("collection",d.parseJSON(b.getItem(c+":"+a))):this._push("collection",a,d.parseJSON(b.getItem(c+":"+a)));b=b.getItem(c+"__active:"+a);if(b===this.ACTIVE)this._set("collection",a);else b&&this._push("collection",b,this._get("collection"))._set("collection",
b);return this};d.Collection.prototype.loadAll=function(a,c,b){b=b?"drop":"load";if(!localStorage)throw Error("your browser doesn't support web storage!");c=c===false?c:true;a=a||"";var e="__"+this.name+"__"+this._get("namespace",a),g=c===false?sessionStorage:localStorage,f=g.length,j,h;try{for(j in g)if(g.hasOwnProperty(j))if((h=j.split(":"))[0]===e)this[b](h[1],a,c)}catch(l){for(;(f-=1)>-1;)if((h=g[f].split(":"))[0]===e)this[b](h[1],a,c)}return this};d.Collection.prototype.loadDate=function(a,c,
b){if(!localStorage)throw Error("your browser doesn't support web storage!");return new Date((b===false?sessionStorage:localStorage).getItem("__"+this.name+"__"+this._get("namespace",c||"")+"__date"+(a?":"+a:"")))};d.Collection.prototype.isExpires=function(a,c,b,e){if(!localStorage)throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(c||"",b||"",e||"")))>a};d.Collection.prototype.drop=function(a,c,b){if(!localStorage)throw Error("your browser doesn't support web storage!");
a=a||this.ACTIVE;c="__"+this.name+"__"+this._get("namespace",c||"");b=b===false?sessionStorage:localStorage;b.removeItem(c+":"+a);b.removeItem(c+"__date:"+a);b.removeItem(c+"__active:"+a);return this};d.Collection.prototype.dropAll=function(a,c){a=a||"";(c===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace",a)+"__date");return this.loadAll(a,c||"",true)};d.Collection.prototype._customFilter=function(a,c,b,e,g,f,j,h){var l,k,m=true,n,o,p,q;if(!a||d.isString(a)&&
(a=d.trim(a))===this.ACTIVE){if(!this._getActiveParam("filter")&&a!==this.ACTIVE)return true;if(this._get("filter")){if(d.isFunction(this._get("filter")))return this._get("filter").call(this._get("filter"),c,b,e,g,f,j);return this._customFilter(this._get("filter"),c,b,e,g,f,j,h)}return true}if(d.isFunction(a))if(!this._getActiveParam("filter")||!h)return a.call(a,c,b,e,g,f,j);else{if(!h.name){for(;this._exists("filter","__tmp:"+(h.name=d.getRandomInt(0,1E4)));)h.name=d.getRandomInt(0,1E4);this._push("filter",
"__tmp:"+h.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+h.name,c,b,e,g,f,j,h)}if(!d.isArray(a)){if(!this._getActiveParam("filter")===false&&h)a=this.ACTIVE+" && ("+a+")";if(a.search(/\|\||&&|!/)===-1){if((a=d.trim(a)).search(/^(?:\(|)*:/)!==-1){k=this._compileFilter(a);return k.call(k,c,b,e,g,f,j)}return this._customFilter(this._get("filter",a),c,b,e,g,f,j,h)}a=d.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ");
for(b=a.length;(b-=1)>-1;)a[b]===""&&a.splice(b,1)}l=function(r,t){for(var s=-1,w=r.length,u=0,v=[];(s+=1)<w;){t+=1;if(r[s]==="("||r[s]==="!(")u+=1;if(r[s]===")")if(u===0)return{result:v,iter:t};else u-=1;v.push(r[s])}};h=a.length;for(b=-1;(b+=1)<h;)if(a[b]==="("||a[b]==="!("){if(a[b].substring(0,1)==="!"){q=true;a[b]=a[b].substring(1)}else q=false;k=l(a.slice(b+1),b);n=k.result.join(" ");b=k.iter;if(n.search(/^:/)!==-1){if(!this._exists("filter","__tmp:"+n)){this._push("filter","__tmp:"+n,this._compileFilter(n));
k.result=this._compileFilter(n)}k.result=this._get("filter","__tmp:"+n)}n=this._customFilter(k.result,c,b,e,g,f,j);m=!o&&!p?q===true?!n:n:o?q===true?!n:n&&m:q===true?!n:n||m}else if(a[b]!==")"&&a[b]!=="||"&&a[b]!=="&&"){if(a[b].substring(0,1)==="!"){q=true;a[b]=a[b].substring(1)}else q=false;n=d.isString(this._get("filter",a[b]))?this._customFilter(this._get("filter",a[b]),c,b,e,g,f,j):this._get("filter",a[b]).call(this._get("filter",a[b]),c,b,e,g,f,j);m=!o&&!p?q===true?!n:n:o?q===true?!n:n&&m:q===
true?!n:n||m}else if(a[b]==="||"){o=false;p=true}else if(a[b]==="&&"){p=false;o=true}return m};d.Collection.prototype._compileFilter=function(a){var c=/^\s*\(*\s*/.exec(a);if(c.length!==0)a=a.substring(c[0].length+1,a.length-c[0].length);a=a.split("<:").join('self.getVariable("').split(":>").join('")');return new Function("el","i","data","cOLength","cObj","id","var key = i; return "+a.replace(/^\s*:/,"")+";")};d.Collection.prototype._customParser=function(a,c){if(d.isFunction(a))return a.call(a,c,
this);if(!a||d.isString(a)&&d.trim(a)===this.ACTIVE){if(this._get("parser")){if(d.isFunction(this._get("parser")))return this._get("parser").call(this._get("parser"),c,this);return this._customParser(this._get("parser"),c)}}else{if(d.isString(a)){a=d.trim(a);if(a.search("&&")===-1)return this._customParser(this._get("parser",a),c);a=a.split("&&")}a.forEach(function(b){b=d.trim(b);c=this._get("parser",b).call(this._get("parser",b),c,this)},this)}return c};d.Collection.prototype._compileParser=function(a){var c=
/^\s*\(*\s*/.exec(a);if(c.length!==0)a=a.substring(c[0].length+1,a.length-c[0].length);a=a.split("<:").join('self.getVariable("').split(":>").join('")');return new Function("str","cObj","return "+a.replace(/^\s*:/,"")+";")};d.Collection.prototype.parentContext=function(a,c){for(var b=this._get("context",c||"").split(nimble.CHILDREN),e=a||1;(e-=1)>-1;)b.splice(-1,1);return b.join(nimble.CHILDREN)};d.Collection.prototype.parent=function(a,c){if(!c)return this._update("context",this.parentContext.apply(this,
arguments));return this._push("context",c,this.parentContext.apply(this,arguments))};d.Collection.prototype._getActiveParam=function(a){var c=this.dObj.sys.flags.use[a]===undefined||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return c?c.toString():"";return c};d.Collection.prototype._filterTest=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(/&&|\|\||:/)!==-1};d.Collection.prototype.enable=function(a){this.dObj.sys.flags.use[a]=true;return this};
d.Collection.prototype.disable=function(a){this.dObj.sys.flags.use[a]=false;return this};d.Collection.prototype.toggle=function(a){if(this.dObj.sys.flags.use[a]===true)return this.disable(a);return this.enable(a)};d.Collection.prototype.toString=function(a,c,b){if(!JSON||!JSON.stringify)throw Error("object JSON is not defined!");c=c||"";b=b||"";if(a&&(d.isArray(a)||d.isPlainObject(a)))return JSON.stringify(a,c,b);return JSON.stringify(nimble.byLink(this._get("collection",a||""),this._getActiveParam("context")),
c,b)};d.Collection.prototype.valueOf=function(){return this.length(this.ACTIVE)};d.Collection.prototype.then=function(a,c){var b=this;arguments.length===1?d.when(this.active("defer")).always(function(){a.apply(b,arguments)}):d.when(this.active("defer")).then(function(){a().apply(b,arguments)},function(){c().apply(b,arguments)});return this};d.Collection.prototype.print=function(a,c){c=c||false;var b={},e,g,f,j=0,h,l=null,k="",m;if(d.isExists(a)&&(d.isString(a)||d.isNumeric(a)))a={page:a};else d.isExists(a)||
(a={page:this._get("page")});d.extend(true,b,this.dObj.active,a);if(a)b.page=nimble.expr(b.page,this._get("page"));if(b.page<1)b.page=1;b.collection=d.isString(b.collection)?this._get("collection",b.collection):b.collection;b.template=d.isString(b.template)?this._get("template",b.template):b.template;b.cache=d.isExists(a.cache)?a.cache:this._getActiveParam("cache");if(c===true)b.cache.iteration=false;h=this._get("page")-b.page;this._update("page",b.page);m=function(n,o,p,q,r,t){b.callback&&b.callback.apply(this,
arguments);k+=b.template.call(b.template,n,o,p,q,r,t);j=o;return true};e=nimble.byLink(b.collection,this._getActiveParam("context")+nimble.CHILDREN+(a&&a.context||""));g=this.length();b.numberBreak=!d.isExists(b.numberBreak)||b.numberBreak===false?g:b.numberBreak;if(d.isPlainObject(e)||b.cache.iteration===false||b.cache.firstIteration===false||b.cache.lastIteration===false){f=!b.pager||b.page===1?0:(b.page-1)*b.numberBreak;this.forEach(m,b.filter,this.ACTIVE,true,b.numberBreak,f);if(b.cache.iteration===
false)b.cache.lastIteration=false}else if(d.isArray(e)&&b.cache.iteration===true){f=!b.pager||b.filter===false?b.page===1?0:(b.page-1)*b.numberBreak:b.cache.iteration===true?h>=0?b.cache.firstIteration:b.cache.lastIteration:i;if(h>0&&b.pager===true&&b.filter!==false){for(h*=b.numberBreak;(f-=1)>-1;)if(this._customFilter(b.filter,e[f],e,f,g,this,this.ACTIVE)===true)if(j===h)break;else j+=1;b.cache.lastIteration=f+=1;l=null}else if(h<0&&b.pager&&b.filter!==false)l=Math.abs(h)*b.numberBreak-b.numberBreak||
null;this.forEach(m,b.filter,this.ACTIVE,true,b.numberBreak,l,f)}if(h!==0&&b.cache.iteration!==false){this._get("cache").firstIteration=b.cache.lastIteration;this._get("cache").lastIteration=j+1}if(b.cache.autoIteration===true)this._get("cache").iteration=true;k=!k?b.resultNull:this._customParser(b.parser,k);if(b.target===false){b.variable?this._push("variable",b.variable,k):this._new("variable",k);return this}else b.target[b.appendType](k);if(!b.pager)return this;b.nmbOfEntries=b.filter!==false?
this.length(b.filter):g;b.nmbOfEntriesInPage=b.target.find(b.calculator).length;b.finNumber=b.numberBreak*b.page-(b.numberBreak-b.nmbOfEntriesInPage);b.page!==1&&b.nmbOfEntriesInPage===0?this.updatePage(b.page-=1).print(b,true,true):this.easyPage(b);return this};d.Collection.prototype.easyPage=function(a){var c=this,b="",e=a.nmbOfEntries%a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak,g=function(k,m,n){var o,p="<"+(k.tag||"span")+' data-page="'+n+'"';if(k.attr)for(o in k.attr)if(k.attr.hasOwnProperty(o))p+=
" "+o+'="'+k.attr[o]+'"';if(n===a.page)p+=' class="'+(m&&m.active||"active")+'"';return p+(">"+n+"</"+(k.tag||"span")+">")},f,j=0,h,l;a.pager.find(".ctm").each(function(){if(a.pageBreak<=2)throw Error('parameter "pageBreak" must be more than 2');var k=d(this),m=k.data("ctm"),n=m.classes;if(m.nav){if((m.nav==="prev"||m.nav==="next")&&!k.data("ctm-delegated"))k.click(function(){if(!d(this).hasClass(m.classes&&m.classes.disabled||"disabled")){m.nav==="prev"&&(a.page="-=1");m.nav==="next"&&(a.page="+=1");
db.print(a)}}).data("ctm-delegated",true);if(m.nav==="prev"&&a.page===1||m.nav==="next"&&a.finNumber===a.nmbOfEntries)k.addClass(n&&n.disabled||"disabled");else if(m.nav==="prev"||m.nav==="next")k.removeClass(n&&n.disabled||"disabled");if(m.nav==="pageList"){if(e>a.pageBreak){j=a.pageBreak%2!==0?1:0;l=h=(a.pageBreak-j)/2;if(a.page-j<h)h=0;else{h=a.page-h-j;if(a.page+l>e)h-=a.page+l-e}f=h;for(j=-1;(f+=1)<=e&&(j+=1)!==null;){if(j===a.pageBreak&&f!==a.page)break;b+=g(m,n||"",f)}}else for(f=0;(f+=1)<=
e;)b+=g(m,n||"",f);k.html(b);k.data("ctm-delegated")||k.on("click",m.tag||"span",function(){var o=d(this);if(!o.hasClass(m.classes&&m.classes.active||"active")){a.page=o.data("page");c.print(a)}}).data("ctm-delegated",true)}}else if(m.info){a.nmbOfEntriesInPage===0?k.addClass(n&&n.noData||"noData"):k.removeClass(n&&n.noData||"noData");switch(m.info){case "page":k.html(a.page);break;case "total":k.html(a.nmbOfEntries);break;case "from":k.html((a.page-1)*a.numberBreak+1);break;case "to":k.html(a.finNumber);
break;case "inPage":k.html(a.nmbOfEntriesInPage);break;case "nmbOfPages":k.html(a.nmbOfPages)}}});return this};d.Collection.prototype.genTable=function(a,c,b){a=a||4;c=c||"div";b=b===false?false:true;var e=1,g,f=this._get("target"),j=f.find(c).length,h="";f.find(c).each(function(l){this.tagName!=="td"&&d(this).wrap("<td></td>");if(e===a){h="";for(g=-1;(g+=1)<a;){h+="td:eq("+(l-g)+")";if(g!==a-1)h+=","}f.find(h).wrapAll("<tr></tr>");e=0}else if(l===j-1&&e!==a){h="";for(g=-1;(g+=1)<e;){h+="td:eq("+
(l-g)+")";if(g!==e-1)h+=","}e-=1;f.find(h).wrapAll("<tr></tr>");if(b===true){for(h="";(e+=1)<a;)h+="<td></td>";f.find("tr:last").append(h)}}e+=1});f[0].tagName!=="table"&&f.children("tr").wrapAll("<table></table>");return this}})(jQuery);
//