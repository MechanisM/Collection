/**
 * $.Collection
 * 
 * autor: kobezzza (kobezzza@gmail.com | http://kobezzza.com)
 * version: 3.3.2
 * date: 08.01.2012 02:29:21
 */
 var nimble={name:"nimble",version:"1.0.1",nimble:function(){return this.name+" "+this.version},CONTEXT_SEPARATOR:" ",QUERY_SEPARATOR:"/",SUBQUERY_SEPARATOR:"{",METHOD_SEPARATOR:"->",CHILDREN:">",ORDER:["eq(",")"],trim:function(d){d=d.replace(/^\s\s*/,"");for(var a=/\s/,b=d.length;a.test(d.charAt(b-=1)););return d.substring(0,b+1)},isString:function(d){return Object.prototype.toString.call(d)==="[object String]"},isNumber:function(d){return Object.prototype.toString.call(d)==="[object Number]"},isArray:function(d){return Object.prototype.toString.call(d)===
"[object Array]"},isExist:function(d){return d!==undefined&&d!=="undefined"&&d!==null&&d!==""},expr:function(d,a){a=a!==undefined||a!==null?a:"";if(this.isString(d)&&d.search(/^[+-\\*/]{1}=/)!==-1){d=d.split("=");isNaN(d[1])||(d[1]=+d[1]);switch(d[0]){case "+":d=a+d[1];break;case "-":d=a-d[1];break;case "*":d=a*d[1];break;case "/":d=a/d[1]}}return d},byLink:function(d,a,b,c){a=a.toString().replace(RegExp("\\s*"+this.CHILDREN+"\\s*","g")," "+this.CHILDREN+" ").split(this.CONTEXT_SEPARATOR);c=c||false;
var f=this.CHILDREN,e=0,g=0,h,j,k,l=a.length;for(j=l;(j-=1)>-1;){a[j]=this.trim(a[j]);if(a[j]===""){a.splice(j,1);e-=1}else if(a[j]!==this.CHILDREN){if(j>e)e=j;g+=1}}l=a.length;if(d===false)return a.join("");else if(this.isNumber(d)){if((d=+d)<0)d+=g;if(b===undefined){j=-1;for(k=0;(j+=1)<l;)if(a[j]!==this.CHILDREN)if((k+=1)===d){a.splice(j+1,l);return a.join("")}}else{j=l;for(k=0;(j-=1)>-1;)if(a[j]!==this.CHILDREN)if((k+=1)===d){a.splice(0,j);return a.join("")}}}for(j=-1;(j+=1)<l;)switch(a[j]){case this.CHILDREN:f=
a[j];break;default:if(f===this.CHILDREN&&a[j].substring(0,this.ORDER[0].length)!==this.ORDER[0])if(j===e&&b!==undefined)if(c===false)d[a[j]]=this.expr(b,d[a[j]]);else if(nimble.isArray(d))d.splice(a[j],1);else delete d[a[j]];else d=d[a[j]];else{g=a[j].substring(this.ORDER[0].length);g=g.substring(0,g.length-1);g=+g;if(this.isArray(d))if(j===e&&b!==undefined)if(g>=0)if(c===false)d[g]=this.expr(b,d[g]);else d.splice(g,1);else if(c===false)d[d.length+g]=this.expr(b,d[d.length+g]);else d.splice(d.length+
g,1);else d=g>=0?d[g]:d[d.length+g];else{if(g<0){k=0;for(h in d)if(d.hasOwnProperty(h))k+=1;g+=k}k=0;for(h in d)if(d.hasOwnProperty(h)){if(g===k){if(j===e&&b!==undefined)if(c===false)d[h]=this.expr(b,d[h]);else delete d[h];else d=d[h];break}k+=1}}}}if(b!==undefined)return this;return d},execEvent:function(d,a,b,c){d=d.split(this.QUERY_SEPARATOR);b=this.isExist(b)?b:[];b=this.isArray(b)?b:[b];for(var f=-1,e=d.length-1;(f+=1)<e;)a=a[d[f]];if(d[f].search(this.SUBQUERY_SEPARATOR)!==-1){d=d[f].split(this.SUBQUERY_SEPARATOR);
a=a[d[0]];d.splice(0,1);b=b.concat(d);return a.apply(c||a,b)}else return a[d[f]].apply(c||a,b)},addElementToObject:function(d,a,b){a=a.split(this.METHOD_SEPARATOR);var c,f={};if(a[1]&&a[1]=="unshift"){f[!isNaN(Number(a[0]))?0:a[0]]=b;for(c in d)if(d.hasOwnProperty(c))f[!isNaN(Number(c))?+c+1:c]=d[c];return f}else if(!a[1]||a[1]=="push")d[a[0]]=b;return true}};
(function(d){d.Collection=function(a,b){a=a||null;b=b||null;if(this.fn&&(!this.fn.name||this.fn.name!=="$.Collection"))return new d.Collection(a,b);d.extend(true,this,d.Collection.storage);var c=this.dObj.active;b&&d.extend(true,c,b);if(d.isString(a)){c.target=d(a);c.collection=null}else c.collection=a};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=-1,f=this.length;(c+=1)<f;)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.some)Array.prototype.some=function(a,
b){for(var c=-1,f=this.length,e;(c+=1)<f;){e=b?a.call(b,this[c],c,this):a(this[c],c,this);if(e===true)break}};d.Collection.fn=d.Collection.prototype={name:"$.Collection",version:"3.3.2",collection:function(){return this.name+" "+this.version},ACTIVE:"active",stack:["collection","filter","context","cache","index","map","variable","defer","page","parser","appendType","target","calculator","pager","template","numberBreak","pageBreak","resultNull"],getActiveParam:function(a){return this.dObj.sys.flags.use[a]===
undefined||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:""},enable:function(a){this.dObj.sys.flags.use[a]=true;return this},disable:function(a){this.dObj.sys.flags.use[a]=false;return this},toggle:function(a){if(this.dObj.sys.flags.use[a]===true)return this.disable(a);return this.enable(a)}};d.fn.collection=function(a){var b=d.fn.collection.stat,c=function(g){g=g.childNodes;for(var h=g.length,j=-1,k="";(j+=1)<h;)if(g[j].nodeType===3&&d.trim(g[j].textContent))k+=g[j].textContent;if(k)return k;
return false},f=function(g){var h=[];g.each(function(j){var k=d(this),l=k.data(),m=k.attr("class")?k.attr("class").split(" "):"",n=m?m.length:0,o=c(k[0]),p;h.push({});for(p in l)if(l.hasOwnProperty(p))h[j][p]=l[p];if(n){h[j][b.classes]={};m.forEach(function(s){h[j][b.classes][s]=s})}if(k.children().length!==0)h[j][b.childNodes]=f(k.children());if(o!==false)h[j][b.val]=o.replace(/[\r\t\n]/g," ")});return h},e=f(this);if(a)return new d.Collection(e,a);return new d.Collection(e)};if(!d.fn.collection.stat)d.fn.collection.stat=
{val:"val",childNodes:"childNodes",classes:"classes"};d.fn.ctplCompile=function(){if(this.length===0)throw Error("DOM element isn't exist!");var a="var key = i, result = ''; ";this.html().replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(b,c){a+=c===0||c%2===0?"result +='"+b+"';":b.split("echo").join("result +=")});return new Function("el","data","i","cOLength","self","id",a+" return result;")};d.fn.ctplMake=function(a){this.find("[type='text/ctpl']").each(function(){var b=
d(this),c=b.data(),f=c.prefix?c.prefix+"_":"";a.pushTemplate(f+c.name,b.ctplCompile());c.set&&c.set===true&&a.setTemplate(f+c.name)})};d.isString=function(a){return nimble.isString(a)};d.isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"};d.isExist=function(a){return nimble.isExist(a)};d.unshiftArguments=function(a,b){for(var c=[b],f=-1,e=a.length;(f+=1)<e;)c.push(a[f]);return c};d.toUpperCase=function(a,b,c){c=c||0;if(!b)return a.toUpperCase();return a.substring(c,
b).toUpperCase()+a.substring(b)};d.toLowerCase=function(a,b,c){c=c||0;if(!b)return a.toLowerCase();return a.substring(c,b).toLowerCase()+a.substring(b)};d.Collection.storage={dObj:{active:{collection:null,filter:false,context:"",cache:{autoIteration:false,iteration:false,firstIteration:false,lastIteration:false},index:null,map:null,variable:null,defer:"",page:1,parser:false,appendType:"html",target:null,calculator:".line",pager:"#pageControl",template:null,numberBreak:10,pageBreak:10,resultNull:""}}};
d.Collection.storage.dObj.sys={flags:{use:{context:true,filter:true,parser:true}}};(function(a){var b,c=d.Collection.storage.dObj.sys;a.forEach(function(f){b=d.toUpperCase(f,1);c["active"+b+"ID"]=null;c["tmp"+b]={};c[f+"ChangeControl"]=null;c[f+"Back"]=[]})})(d.Collection.fn.stack);d.Collection.fn._$=function(a,b){var c=this.dObj,f=c.active,e=d.toUpperCase(a,1);f[a]=nimble.expr(b,f[a]||"");c.sys["active"+e+"ID"]=null;return this};d.Collection.fn._update=function(a,b){var c=this.dObj,f=c.active;c=
c.sys;var e=d.toUpperCase(a,1),g=c["active"+e+"ID"];f[a]=nimble.expr(b,f[a]||"");if(g)c["tmp"+e][g]=f[a];return this};d.Collection.fn._get=function(a,b){var c=this.dObj;if(b&&b!==this.ACTIVE)return c.sys["tmp"+d.toUpperCase(a,1)][b];return c.active[a]};d.Collection.fn._push=function(a,b,c){var f=this.dObj.sys,e=d.toUpperCase(a,1),g=f["tmp"+e];f=f["active"+e+"ID"];var h;if(d.isPlainObject(b))for(h in b){if(b.hasOwnProperty(h))if(h===this.ACTIVE)throw Error("invalid property name!");else if(g[h]&&f&&
f===h)this._update(a,b[h]);else g[h]=b[h]}else if(b===this.ACTIVE)throw Error("invalid property name!");else if(g[b]&&f&&f===b)this._update(a,c);else g[b]=c;return this};d.Collection.fn._set=function(a,b){var c=this.dObj,f=c.sys,e=d.toUpperCase(a,1),g=a+"ChangeControl",h="active"+e+"ID";if(f[h]!==b){f[g]=true;f[h]=b}else f[g]=false;f[a+"Back"].push(b);c.active[a]=f["tmp"+e][b];return this};d.Collection.fn._back=function(a,b){var c=this.dObj,f=c.sys,e=d.toUpperCase(a,1),g=f[a+"Back"],h;f[a+"ChangeControl"]=
false;h=g.length-(b||1)-1;if(h>=0&&g[h])if(f["tmp"+e][g[h]]){f["active"+e+"ID"]=g[h];c.active[a]=f["tmp"+e][g[h]];g.splice(h+1,g.length)}return this};d.Collection.fn._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};d.Collection.fn._drop=function(a,b,c,f){c=c===undefined?false:c;var e=this.dObj,g=e.active;e=e.sys;var h=d.toUpperCase(a,1),j="active"+h+"ID";h="tmp"+h;var k=e[j];b=!b?k?[k]:[]:d.isArray(b)||d.isPlainObject(b)?b:[b];var l;
if(b[0]&&b[0]!==this.ACTIVE)for(l in b){if(b.hasOwnProperty(l))if(!b[l]||b[l]===this.ACTIVE)if(f===undefined){k&&delete e[h][k];e[j]=null;g[a]=c}else{if(k)e[h][k]=f;g[a]=f}else if(f===undefined){delete e[h][b[l]];if(k&&b[l]===k){e[j]=null;g[a]=c}}else{e[h][b[l]]=f;if(k&&b[l]===k)g[a]=f}}else if(f===undefined){k&&delete e[h][k];e[j]=null;g[a]=c}else{if(k)e[h][k]=f;g[a]=f}return this};d.Collection.fn._reset=function(a,b,c){return this._drop(a,b||"","",c===undefined?false:c)};d.Collection.fn._resetTo=
function(a,b,c){var f=this.dObj;c=!c||c===this.ACTIVE?f.active[a]:f.sys["tmp"+d.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};d.Collection.fn._exist=function(a,b){var c=this.dObj,f=d.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&c.sys["active"+f+"ID"])return true;if(c.sys["tmp"+f][b]!==undefined)return true;return false};d.Collection.fn._is=function(a,b){if(b===this.dObj.sys["active"+d.toUpperCase(a,1)+"ID"])return true;return false};d.Collection.fn.use=function(a){for(var b=this.stack.length;(b-=
1)>-1;)this._exist(this.stack[b],a)&&this._set(this.stack[b],a);return this};d.Collection.fn._prop=function(a,b,c){var f=this.dObj[a];if(arguments.length!==3)if(d.isPlainObject(b))d.extend(f,b);else return f[b];else f[b]=c;return this};d.Collection.fn.active=function(){return this._prop.apply(this,d.unshiftArguments(arguments,"active"))};(function(a){var b=d.Collection.fn,c;a.forEach(function(f){c=d.toUpperCase(f,1);b["$"+c]=function(e){return function(g){return this._$(e,g)}}(f);b["update"+c]=function(e){return function(g){return this._update(e,
g)}}(f);b["reset"+c+"To"]=function(e){return function(g,h){return this._resetTo(e,g,h)}}(f);b["push"+c]=function(e){return function(){return this._push.apply(this,d.unshiftArguments(arguments,e))}}(f);b["set"+c]=function(e){return function(g){return this._set(e,g)}}(f);b["pushSet"+c]=function(e){return function(g,h){return this._push(e,g,h)._set(e,g)}}(f);b["back"+c]=function(e){return function(g){return this._back(e,g||"")}}(f);b["back"+c+"If"]=function(e){return function(g){return this._backIf(e,
g||"")}}(f);b["drop"+c]=f==="filter"||f==="parser"?function(e){return function(){return this._drop(e,arguments)}}(f):function(e){return function(){return this._drop(e,arguments,null)}}(f);if(f==="filter"||f==="parser")b["reset"+c]=function(e){return function(){return this._reset(e,arguments)}}(f);else if(f==="page")b["reset"+c]=function(e){return function(){return this._reset(e,arguments,1)}}(f);else if(f==="context")b["reset"+c]=function(e){return function(){return this._reset(e,arguments,"")}}(f);
b["is"+c]=function(e){return function(g){return this._is(e,g)}}(f);b["exist"+c]=function(e){return function(g){return this._exist(e,g||"")}}(f);b["get"+c]=function(e){return function(g){return this._get(e,g||"")}}(f)})})(d.Collection.fn.stack);d.Collection.fn.set=function(a,b,c){a=d.isExist(a)?a.toString():"";b=b===undefined?"":b;c=c||"";var f=this.getActiveParam("context").toString();if(!a&&!f)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);nimble.byLink(this._get("collection",
c),f+nimble.CHILDREN+a,b);return this};d.Collection.fn.get=function(a,b){a=d.isExist(a)?a.toString():"";return nimble.byLink(this._get("collection",b||""),this.getActiveParam("context").toString()+nimble.CHILDREN+a)};d.Collection.fn.add=function(a,b,c,f,e){a=a!==undefined?a:"";b=b||"push";e=e||false;var g,h,j;g=nimble.byLink(this._get("collection",c||""),this.getActiveParam("context").toString());if(typeof g==="object"){j=d.isPlainObject(g);if(f){a=d.isExist(a)?a.toString():"";h=nimble.byLink(this._get("collection",
f||""),a);if(j===true){b=b==="push"?this.length(g):b==="unshift"?this.length(g)+nimble.METHOD_SEPARATOR+"unshift":b;j=nimble.addElementToObject(g,b.toString(),h)}else{j=true;g[b](h)}e===true&&this.disable("context").deleteElementByLink(a,f).enable("context")}else if(j===true){b=b==="push"?this.length(g):b==="unshift"?this.length(g)+nimble.METHOD_SEPARATOR+"unshift":b;j=nimble.addElementToObject(g,b.toString(),a)}else{j=true;g[b](a)}if(j!==true)this.set("",j,c||"")}else throw Error("unable to set property!");
return this};d.Collection.fn.push=function(a,b){return this.add(a,"",b||"")};d.Collection.fn.unshift=function(a,b){return this.add(a,"unshift",b||"")};d.Collection.fn.deleteElementByLink=function(a,b){a=d.isExist(a)?a.toString():"";var c=this.getActiveParam("context").toString();!a&&!c?this.set("",null):nimble.byLink(this._get("collection",b||""),c+nimble.CHILDREN+a,"",true);return this};d.Collection.fn.deleteElementsByLink=function(a,b){b=b||"";var c,f;if(d.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(d.isArray(a[c]))for(f=
a[c].length;(f-=1)>-1;)this.deleteElementByLink(a[c][f],c);else this.deleteElementByLink(a[c],c)}else if(d.isArray(a))for(f=a.length;(f-=1)>-1;)this.deleteElementByLink(a[f],b);else this.deleteElementByLink(a,b);return this};d.Collection.fn.pop=function(a){return this.deleteElementByLink("eq(-1)",a||"")};d.Collection.fn.shift=function(a){return this.deleteElementByLink("eq(0)",a||"")};d.Collection.fn.concat=function(a,b,c){b=d.isExist(b)?b.toString():"";c=c||"";var f=nimble.byLink(this._get("collection",
c),this.getActiveParam("context").toString()+nimble.CHILDREN+b);if(typeof f==="object")if(d.isPlainObject(f))d.extend(true,f,a);else{if(d.isArray(f))if(d.isArray(a)){f=Array.prototype.concat(f,a);this.set(b,f,c)}else this.add(a,"push",c)}else throw Error("incorrect data type!");return this};d.Collection.fn.length=function(a,b){a=d.isExist(a)?a:this.getActiveParam("filter");var c=this.dObj,f,e,g,h,j;if(!d.isFunction(a))if(d.isString(a)&&!d.isExist(b)||d.isArray(a)||d.isPlainObject(a)){b=a;a=false}if(!b||
b===this.ACTIVE)f=c.active.collection;else if(d.isString(b))f=c.sys.tmpCollection[b];else{g=true;f=b}if(f===null)return 0;if(g!==true)f=nimble.byLink(f,this.getActiveParam("context").toString());e=f.length;if(d.isString(f))return e;if(typeof f==="object")if(a===false&&e!==undefined)j=e;else{j=0;if(e!==undefined)f.forEach(function(k,l){if(this.customFilter(a,k,f,l,e||null,this,b?b:this.ACTIVE)===true)j+=1},this);else for(h in f)if(f.hasOwnProperty(h))if(this.customFilter(a,f[h],f,h,e||null,this,b?
b:this.ACTIVE)===true)j+=1}else throw Error("incorrect data type!");return j};d.Collection.fn.forEach=function(a,b,c,f,e,g,h){a=d.isFunction(a)?{filter:a}:a;b=d.isExist(b)?b:this.getActiveParam("filter");c=d.isExist(c)?c:this.ACTIVE;if(d.isBoolean(c)){h=g;g=e;e=f;f=c;c=this.ACTIVE}f=f===false?false:true;e=parseInt(e)>=0?parseInt(e):false;g=parseInt(g)||false;h=parseInt(h)||false;var j=this.dObj,k,l,m,n=0;k=nimble.byLink(c!==this.ACTIVE?j.sys.tmpCollection[c]:j.active.collection,this.getActiveParam("context").toString());
l=this.length(k);if(d.isArray(k)){j=h!==false?k.slice(h):k;j.some(function(o,p){p+=h;if(e!==false&&n===e)return true;if(this.customFilter(b,o,k,p,l,this,c)===true)if(g!==false&&g!==0)g-=1;else{if(a.filter&&a.filter.call(a.filter,o,k,p,l,this,c)===false)return true;if(f===false)return true;n+=1}else if(a.denial&&(g===false||g===0)&&a.denial.call(a.denial,o,k,p,l,this,c)===false)return true;if(a.full&&(g===false||g===0)&&a.full.call(a.full,o,k,p,l,this,c)===false)return true},this)}else for(m in k){if(k.hasOwnProperty(m)){if(e!==
false&&n===e)break;if(h!==false&&h!==0){h-=1;continue}if(this.customFilter(b,k[m],k,m,l,this,c)===true)if(g!==false&&g!==0)g-=1;else{if(a.filter&&a.filter.call(a.filter,k[m],k,m,l,this,c)===false)break;if(f===false)break;n+=1}}else if(a.denial&&(g===false||g===0)&&a.denial.call(a.denial,k[m],k,m,l,this,c)===false)break;if(a.full&&(g===false||g===0)&&a.full.call(a.full,k[m],k,m,l,this,c)===false)break}return this};d.Collection.fn.searchElements=function(a,b,c,f,e,g){a=d.isExist(a)?a:this.getActiveParam("filter");
b=d.isExist(b)?b:this.ACTIVE;if(d.isBoolean(b)){g=e;e=f;f=c;c=b;b=this.ACTIVE}c=c===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||false;var h=[];this.forEach(function(j,k,l){if(c===true)h.push(l);else{h=l;return false}return true},a,b,c,f,e,g);return h};d.Collection.fn.searchElement=function(a,b){return this.searchElements(a||"",b||"",false)};d.Collection.fn.returnElements=function(a,b,c,f,e,g){a=d.isExist(a)?a:this.getActiveParam("filter");b=d.isExist(b)?
b:this.ACTIVE;if(d.isBoolean(b)){g=e;e=f;f=c;c=b;b=this.ACTIVE}c=c===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||false;var h=[];this.forEach(function(j,k,l){if(c===true)h.push(k[l]);else{h=k[l];return false}return true},a,b,c,f,e,g);return h};d.Collection.fn.returnElement=function(a,b){return this.returnElements(a||"",b||"",false)};d.Collection.fn.replaceElements=function(a,b,c,f,e,g,h){a=d.isExist(a)?a:this.getActiveParam("filter");c=d.isExist(c)?c:this.ACTIVE;
if(d.isBoolean(c)){h=g;g=e;e=f;f=c;c=this.ACTIVE}f=f===false?false:true;e=parseInt(e)>=0?parseInt(e):false;g=parseInt(g)||false;h=parseInt(h)||false;var j=d.isFunction(b);this.forEach(function(k,l,m,n,o,p){if(j)b.call(b,k,l,m,n,o,p);else l[m]=nimble.expr(b,l[m]);return true},a,c,f,e,g,h);return this};d.Collection.fn.replaceElement=function(a,b,c){return this.replaceElements(a||"",b,c||"",false)};d.Collection.fn.moveElements=function(a,b,c,f,e,g,h,j,k,l){a=d.isExist(a)?a:this.getActiveParam("filter");
l=l===false?false:true;b=d.isExist(b)?b.toString():"";c=c||"";f=f||"";e=e||"push";g=g===false?false:true;h=parseInt(h)>=0?parseInt(h):false;j=parseInt(j)||false;k=parseInt(k)||false;var m=[],n=d.isArray(nimble.byLink(this._get("collection",f),this.getActiveParam("context").toString()));this.disable("context");a=this.searchElements(a,c,g,h,j,k);this.enable("context");if(g===true)a.forEach(function(o){this.add(b+nimble.CHILDREN+o,n===true?e:o+nimble.METHOD_SEPARATOR+e,f,c);l===true&&m.push(o)},this);
else{this.add(b+nimble.CHILDREN+a,n===true?e:a+nimble.METHOD_SEPARATOR+e,f,c);l===true&&m.push(a)}l===true&&this.disable("context").deleteElementsByLink(m,c).enable("context");return this};d.Collection.fn.moveElement=function(a,b,c,f,e){return this.moveElements(a||"",d.isExist(b)?b.toString():"",c||"",f||"",e||"",false)};d.Collection.fn.copyElements=function(a,b,c,f,e,g,h,j,k){g=g===false?false:true;h=parseInt(h)>=0?parseInt(h):false;j=parseInt(j)||false;k=parseInt(k)||false;return this.moveElements(a||
"",d.isExist(b)?b.toString():"",c||"",f||"",e||"push",g,h,j,k,false)};d.Collection.fn.copyElement=function(a,b,c,f,e){return this.moveElements(a||"",d.isExist(b)?b.toString():"",c||"",f||"",e||"",false,"","","",false)};d.Collection.fn.deleteElements=function(a,b,c,f,e,g){a=d.isExist(a)?a:this.getActiveParam("filter");b=d.isExist(b)?b:this.ACTIVE;if(d.isBoolean(b)){g=e;e=f;f=c;c=b;b=this.ACTIVE}c=c===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||false;a=this.searchElements(a,
b,c,f,e,g);if(c===false)this.deleteElementByLink(a,b);else for(c=a.length;(c-=1)>-1;)this.deleteElementByLink(a[c],b);return this};d.Collection.fn.deleteElement=function(a,b){return this.deleteElements(a||"",b||"",false)};d.Collection.fn.customFilter=function(a,b,c,f,e,g,h){var j=this.dObj,k=j.active;j=j.sys;var l,m,n,o=true,p,s,r,q=-1;if(a===false)return true;if(d.isFunction(a))return a.call(a,b,c,f,e,g,h);if(!a||d.isString(a)&&d.trim(a)===this.ACTIVE){if(k.filter)return k.filter.call(k.filter,b,
c,f,e,g,h);return true}else{if(!d.isArray(a)){if(a.search(/\|\||&&|!|\(|\)/)===-1)return j.tmpFilter[a].call(j.tmpFilter[a],b,c,f,e,g,h);a=d.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ")}m=function(t,w){for(var u=-1,y=t.length,v=0,x=[];(u+=1)<y;){w+=1;if(t[u]==="(")v+=1;if(t[u]===")")if(v===0)return{result:x,iter:w};else v-=1;x.push(t[u])}};for(l=a.length;(q+=1)<l;)if(a[q]==="("||a[q]==="!("){if(a[q].substring(0,1)==="!"){r=
true;a[q]=a[q].substring(1)}else r=false;n=m(a.slice(q+1),q);q=n.iter;n=this.customFilter(n.result,b,c,f,e,g,h);o=!p&&!s?r===true?!n:n:p?r===true?!n:n&&o:r===true?!n:n||o}else if(a[q]!==")"&&a[q]!=="||"&&a[q]!=="&&"){if(a[q].substring(0,1)==="!"){r=true;a[q]=a[q].substring(1)}else r=false;n=a[q]===this.ACTIVE?k.filter:j.tmpFilter[a[q]];n=n.call(n,b,c,f,e,g,h);o=!p&&!s?r===true?!n:n:p?r===true?!n:n&&o:r===true?!n:n||o}else if(a[q]==="||"){p=false;s=true}else if(a[q]==="&&"){s=false;p=true}return o}};
d.Collection.fn.customParser=function(a,b){var c=this.dObj,f=c.active,e=c.sys,g;if(a===false)return b;if(d.isFunction(a))return a.call(a,b,this);if(!a||d.isString(a)&&d.trim(a)===this.ACTIVE){if(f.parser)return f.parser.call(f.parser,b,this)}else{if(d.isString(a)){a=d.trim(a);if(a.search("&&")===-1)return e.tmpParser[a].call(e.tmpParser[a],b,this);a=a.split("&&")}a.forEach(function(h){h=d.trim(h);g=h===this.ACTIVE?f.parser:e.tmpParser[h];b=g.call(g,b,this)},this)}return b};d.Collection.fn.parentContext=
function(a,b){a=a||1;var c="",f;c=this._get("collection",b||"").split(nimble.CHILDREN);for(f=a;(f-=1)>-1;)c.splice(-1,1);return c.join(nimble.CHILDREN)};d.Collection.fn.parent=function(a,b){var c=this.dObj,f=c.sys;c=c.active;var e=f.contextID,g=this.parentContext.apply(this,arguments);if(!b||b===this.ACTIVE){if(e)f.tmpContext[e]=g;c.context=g}else{f.tmpContext[b]=g;if(e&&b===e)c.context=g}return this};d.Collection.fn.orderBy=function(a,b,c,f){a=a||null;b=b||false;c=c?c===false?null:c:function(j){if(isNaN(j))return j.toUpperCase();
return j};f=f||"";var e,g=function(j){var k=[],l={},m;for(m in j)j.hasOwnProperty(m)&&k.push(m);k.sort(statObj.sort.sortBy(a,b,c));for(m in k)if(k.hasOwnProperty(m))l[k[m]]=j[k[m]];return l},h=function(j){var k=[],l={},m;for(m in j)j.hasOwnProperty(m)&&k.push({key:m,value:j[m]});k.sort(statObj.sort.sortBy(a===true?"value":"value"+statObj.obj.contextSeparator+a,b,c));for(m in k)if(k.hasOwnProperty(m))l[k[m].key]=k[m].value;return l};e=nimble.byLink(this._get("collection",f),this.getActiveParam("context").toString());
if(typeof e==="object")if(d.isArray(e))e.sort(d.Collection.sort.sortBy(a,b,c));else{e=a?h.call(this,e):g.call(this,e);this.set("",e,f||"")}else throw Error("incorrect data type!");return this};d.Collection.fn.toString=function(a,b,c){if(a&&(d.isArray(a)||d.isPlainObject(a))){if(JSON&&JSON.stringify)return JSON.stringify(a,b||"",c||"");throw Error("object JSON is not defined!");}a=nimble.byLink(this._get("collection",a||""),this.getActiveParam("context").toString());if(JSON&&JSON.stringify)return JSON.stringify(a,
b||"",c||"");throw Error("object JSON is not defined!");};d.Collection.fn.valueOf=function(a){return this.length(d.isExist(a)?a:this.ACTIVE)};d.Collection.fn.then=function(a,b){var c=this;arguments.length===1?d.when(c.active("defer")).always(function(){a.apply(c,arguments)}):d.when(c.active("defer")).then(function(){a().apply(c,arguments)},function(){b().apply(c,arguments)});return this};d.Collection.fn.print=function(a,b,c){b=b||false;c=c||false;var f=this.dObj.active,e={},g,h,j=0,k=null,l="",m;
if(d.isExist(a)&&(d.isString(a)||d.isNumeric(a)))a={page:a};else if(d.isBoolean(a))b=a;else d.isExist(a)||(a={page:f.page});d.extend(true,e,f,a);if(a)e.page=nimble.expr(e.page,f.page||"");if(e.page<1)e.page=1;e.collection=d.isString(e.collection)?this._get("collection",e.collection):e.collection;e.template=d.isString(e.template)?this._get("template",e.template):e.template;e.filter=d.isExist(a.filter)?a.filter:this.getActiveParam("filter");e.parser=d.isExist(a.parser)?a.parser:this.getActiveParam("parser");
if(c===true)e.cache.iteration=false;c=f.page-e.page;this.updatePage(e.page);m=function(n,o,p,s,r,q){e.callback&&e.callback.apply(this,arguments);l+=e.template.call(e.template,n,o,p,s,r,q);j=p;return true};a=nimble.byLink(e.collection,this.getActiveParam("context").toString()+nimble.CHILDREN+(a&&a.context||""));g=this.length();e.numberBreak=!b||e.numberBreak===false?g:e.numberBreak;if(d.isPlainObject(a)||e.cache.iteration===false||e.cache.firstIteration===false||e.cache.lastIteration===false){h=!b||
e.page===1?0:(e.page-1)*e.numberBreak;this.forEach(m,e.filter,this.ACTIVE,true,e.numberBreak,h);if(e.cache.iteration===false)e.cache.lastIteration=false}else if(d.isArray(a)&&e.cache.iteration===true){h=!b||e.filter===false?e.page===1?0:(e.page-1)*e.numberBreak:e.cache.iteration===true?c>=0?e.cache.firstIteration:e.cache.lastIteration:i;if(c>0&&b===true&&e.filter!==false){for(c*=e.numberBreak;(h-=1)>-1;)if(this.customFilter(e.filter,a[h],a,h,g,this,this.ACTIVE)===true)if(j===c)break;else j+=1;e.cache.lastIteration=
h+=1;k=null}else if(c<0&&b===true&&e.filter!==false)k=Math.abs(c)*e.numberBreak-e.numberBreak||null;this.forEach(m,e.filter,this.ACTIVE,true,e.numberBreak,k,h)}if(c!==0&&e.cache.iteration!==false){f.cache.firstIteration=e.cache.lastIteration;f.cache.lastIteration=j+1}if(e.cache.autoIteration===true)f.cache.iteration=true;l=!l?e.resultNull:this.customParser(e.parser,l);if(e.target===false){e.variable?this._push("variable",e.variable,l):this._$("variable",l);return this}else e.target[e.appendType](l);
if(!b)return this;e.nmbOfEntries=e.filter!==false?this.length(e.filter):g;e.nmbOfEntriesInPage=e.target.find(e.calculator).length;e.finNumber=e.numberBreak*e.page-(e.numberBreak-e.nmbOfEntriesInPage);e.page!==1&&e.nmbOfEntriesInPage===0?this.updatePage(e.page-=1).print(e,true,true):this.easyPage(e);return this};d.Collection.fn.easyPage=function(a){var b="",c=a.nmbOfEntries%a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak,f=function(k,l,m){var n,o="<"+(k.tag||"span")+
' data-page="'+m+'"';if(k.attr)for(n in k.attr)if(k.attr.hasOwnProperty(n))o+=" "+n+'="'+k.attr[n]+'"';if(m===a.page)o+=' class="'+(l&&l.active||"active")+'"';return o+(">"+m+"</"+(k.tag||"span")+">")},e,g=0,h,j;a.pager.find("[data-ctm]").each(function(){if(a.pageBreak<=2)throw Error('parameter "pageBreak" must be more than 2');var k=d(this),l=k.data("ctm"),m=l.classes;if(l.nav){if(l.nav==="prev"&&a.page===1||l.nav==="next"&&a.finNumber===a.nmbOfEntries)k.addClass(m&&m.disabled||"disabled");else if(l.nav===
"prev"||l.nav==="next")k.removeClass(m&&m.disabled||"disabled");if(l.nav==="pageList"){if(c>a.pageBreak){g=a.pageBreak%2!==0?1:0;j=h=(a.pageBreak-g)/2;if(a.page-g<h)h=0;else{h=a.page-h-g;if(a.page+j>c)h-=a.page+j-c}e=h;for(g=-1;(e+=1)<=c&&(g+=1)!==null;){if(g===a.pageBreak&&e!==a.page)break;b+=f(l,m||"",e)}}else for(e=0;(e+=1)<=c;)b+=f(l,m||"",e);k.html(b)}}else if(l.info){a.nmbOfEntriesInPage===0?k.addClass(m&&m.noData||"noData"):k.removeClass(m&&m.noData||"noData");switch(l.info){case "page":k.html(a.page);
break;case "total":k.html(a.nmbOfEntries);break;case "from":k.html((a.page-1)*a.numberBreak+1);break;case "to":k.html(a.finNumber);break;case "inPage":k.html(a.nmbOfEntriesInPage);break;case "nmbOfPages":k.html(a.nmbOfPages)}}});return this};d.Collection.fn.genTable=function(a,b,c){a=a||4;b=b||"div";c=c===false?false:true;var f=1,e,g=this.dObj.active.target,h=g.find(b).length,j="";g.find(b).each(function(k){this.tagName!=="td"&&d(this).wrap("<td></td>");if(f===a){j="";for(e=-1;(e+=1)<a;){j+="td:eq("+
(k-e)+")";if(e!==a-1)j+=","}g.find(j).wrapAll("<tr></tr>");f=0}else if(k===h-1&&f!==a){j="";for(e=-1;(e+=1)<f;){j+="td:eq("+(k-e)+")";if(e!==f-1)j+=","}f-=1;g.find(j).wrapAll("<tr></tr>");if(c===true){for(j="";(f+=1)<a;)j+="<td></td>";g.find("tr:last").append(j)}}f+=1});g[0].tagName!=="table"&&g.children("tr").wrapAll("<table></table>");return this}})(jQuery);
//