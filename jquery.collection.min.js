/**
 * $.Collection
 * 
 * autor: kobezzza (kobezzza@gmail.com | http://kobezzza.com)
 * version: 3.4
 * date: 15.01.2012 23:16:19
 */
 var nimble=function(){return{name:"nimble",version:"1.0.2",nimble:function(){return this.name+" "+this.version},CONTEXT_SEPARATOR:" ",QUERY_SEPARATOR:"/",SUBQUERY_SEPARATOR:"{",METHOD_SEPARATOR:"->",CHILDREN:">",ORDER:["eq(",")"],trim:function(e){e=e.replace(/^\s\s*/,"");for(var a=/\s/,b=e.length;a.test(e.charAt(b-=1)););return e.substring(0,b+1)},isString:function(e){return Object.prototype.toString.call(e)==="[object String]"},isNumber:function(e){return Object.prototype.toString.call(e)==="[object Number]"},
isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isExists:function(e){return e!==undefined&&e!=="undefined"&&e!==null&&e!==""},expr:function(e,a){a=a!==undefined||a!==null?a:"";if(this.isString(e)&&e.search(/^[+-\\*/]{1}=/)!==-1){e=e.split("=");isNaN(e[1])||(e[1]=+e[1]);switch(e[0]){case "+":e=a+e[1];break;case "-":e=a-e[1];break;case "*":e=a*e[1];break;case "/":e=a/e[1]}}return e},byLink:function(e,a,b,c){a=a.toString().replace(RegExp("\\s*"+this.CHILDREN+"\\s*","g"),
" "+this.CHILDREN+" ").split(this.CONTEXT_SEPARATOR);c=c||false;for(var d=this.CHILDREN,g=0,f=0,h,j=a.length,k,l;(j-=1)>-1;){a[j]=this.trim(a[j]);if(a[j]===""){a.splice(j,1);g-=1}else if(a[j]!==this.CHILDREN){if(j>g)g=j;f+=1}}l=a.length;if(e===false)return a.join("");else if(this.isNumber(e)){if((e=+e)<0)e+=f;if(b===undefined){j=-1;for(k=0;(j+=1)<l;)if(a[j]!==this.CHILDREN)if((k+=1)===e){a.splice(j+1,l);return a.join("")}}else{j=l;for(k=0;(j-=1)>-1;)if(a[j]!==this.CHILDREN)if((k+=1)===e){a.splice(0,
j);return a.join("")}}}for(j=-1;(j+=1)<l;)switch(a[j]){case this.CHILDREN:d=a[j];break;default:if(d===this.CHILDREN&&a[j].substring(0,this.ORDER[0].length)!==this.ORDER[0])if(j===g&&b!==undefined)if(c===false)e[a[j]]=this.expr(b,e[a[j]]);else if(nimble.isArray(e))e.splice(a[j],1);else delete e[a[j]];else e=e[a[j]];else{f=a[j].substring(this.ORDER[0].length);f=f.substring(0,f.length-1);f=+f;if(this.isArray(e))if(j===g&&b!==undefined)if(f>=0)if(c===false)e[f]=this.expr(b,e[f]);else e.splice(f,1);else if(c===
false)e[e.length+f]=this.expr(b,e[e.length+f]);else e.splice(e.length+f,1);else e=f>=0?e[f]:e[e.length+f];else{if(f<0){k=0;for(h in e)if(e.hasOwnProperty(h))k+=1;f+=k}k=0;for(h in e)if(e.hasOwnProperty(h)){if(f===k){if(j===g&&b!==undefined)if(c===false)e[h]=this.expr(b,e[h]);else delete e[h];else e=e[h];break}k+=1}}}}if(b!==undefined)return this;return e},execEvent:function(e,a,b,c){e=e.split(this.QUERY_SEPARATOR);b=this.isExists(b)?b:[];b=this.isArray(b)?b:[b];for(var d=-1,g=e.length-1;(d+=1)<g;)a=
a[e[d]];if(e[d].search(this.SUBQUERY_SEPARATOR)!==-1){e=e[d].split(this.SUBQUERY_SEPARATOR);a=a[e[0]];e.splice(0,1);b=b.concat(e);return a.apply(c||a,b)}else return a[e[d]].apply(c||a,b)},addElementToObject:function(e,a,b){a=a.split(this.METHOD_SEPARATOR);var c,d={};if(a[1]&&a[1]=="unshift"){d[!isNaN(Number(a[0]))?0:a[0]]=b;for(c in e)if(e.hasOwnProperty(c))d[!isNaN(Number(c))?+c+1:c]=e[c];return d}else if(!a[1]||a[1]=="push")e[a[0]]=b;return true}}}();
(function(e){e.Collection=function(a,b){a=a||null;b=b||null;if(this.fn&&(!this.fn.name||this.fn.name!=="$.Collection"))return new e.Collection(a,b);e.extend(true,this,e.Collection.storage);var c=this.dObj.active;b&&e.extend(true,c,b);if(e.isString(c.filter))c.filter=this._compileFilter(c.filter);if(e.isString(a)){c.target=e(a);c.collection=null}else c.collection=a};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=-1,d=this.length;(c+=1)<d;)b?a.call(b,this[c],c,this):a(this[c],
c,this)};if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=-1,d=this.length,g;(c+=1)<d;){g=b?a.call(b,this[c],c,this):a(this[c],c,this);if(g===true)break}};e.Collection.prototype={name:"$.Collection",version:"3.5",collection:function(){return this.name+" "+this.version},ACTIVE:"active",SHUFFLE:"shuffle",NAMESPACE_SEPARATOR:".",stack:["namespace","collection","filter","context","cache","variable","defer","page","parser","appendType","target","calculator","pager","template","numberBreak",
"pageBreak","resultNull"]};e.fn.collection=function(a){var b=e.fn.collection.stat,c=function(f){f=f.childNodes;for(var h=f.length,j=-1,k="";(j+=1)<h;)if(f[j].nodeType===3&&e.trim(f[j].textContent))k+=f[j].textContent;if(k)return k;return false},d=function(f){var h=[];f.each(function(j){var k=e(this),l=k.data(),m=k.attr("class")?k.attr("class").split(" "):"",o=c(this),n;h.push({});for(n in l)if(l.hasOwnProperty(n))h[j][n]=l[n];if(m){h[j][b.classes]={};m.forEach(function(p){h[j][b.classes][p]=p})}if(k.children().length!==
0)h[j][b.childNodes]=d(k.children());if(o!==false)h[j][b.val]=o.replace(/[\r\t\n]/g," ")});return h},g=d(this);if(a)return new e.Collection(g,a);return new e.Collection(g)};if(!e.fn.collection.stat)e.fn.collection.stat={val:"val",childNodes:"childNodes",classes:"classes"};e.fn.ctplCompile=function(){if(this.length===0)throw Error("DOM element does't exist!");var a="var key = i, result = ''; ";this.html().replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(b,
c){a+=c===0||c%2===0?"result +='"+b+"';":b.split("echo").join("result +=")});return new Function("el","i","data","cOLength","cObj","id",a+" return result;")};e.fn.ctplMake=function(a){this.each(function(){var b=e(this),c=b.data("ctpl"),d,g=c.prefix?c.prefix+"_":"";if(e.isString(c))c=e.parseJSON(c);a._push("template",g+c.name,b.ctplCompile());c.set&&c.set===true&&a._set("template",g+c.name);for(d in c)if(c.hasOwnProperty(d))if(!(d==="prefix"||d==="set"||d==="print"||d==="name")){if(d==="target"||d===
"pager")c[d]=e(c[d]);a._push(d,g+c.name,c[d]);c.set&&c.set===true&&a._set(d,g+c.name);if(d==="filter"||d==="parser")c[d]=g+c.name}if(c.print&&c.print===true){c.template=c.name;a.print(c)}});return this};e.isString=function(a){return nimble.isString(a)};e.isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"};e.isExists=function(a){return nimble.isExists(a)};e.unshiftArguments=function(a,b){for(var c=[b],d=-1,g=a.length;(d+=1)<g;)c.push(a[d]);return c};e.toUpperCase=function(a,
b,c){c=c||0;b=e.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toUpperCase()+a.substring(b)};e.toLowerCase=function(a,b,c){c=c||0;b=e.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toLowerCase()+a.substring(b)};e.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a};e.Collection.storage={dObj:{active:{namespace:"nm",collection:null,filter:false,context:"",cache:{autoIteration:true,iteration:true,firstIteration:false,lastIteration:false},variable:null,
defer:"",page:1,parser:false,appendType:"html",target:null,calculator:".line",pager:null,template:null,numberBreak:10,pageBreak:10,resultNull:""}}};e.Collection.storage.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};(function(a){var b,c=e.Collection.storage.dObj.sys;a.forEach(function(d){b=e.toUpperCase(d,1);c["active"+b+"ID"]=null;c["tmp"+b]={};c[d+"ChangeControl"]=null;c[d+"Back"]=[]})})(e.Collection.prototype.stack);e.Collection.prototype._new=function(a,b){var c=this.dObj.active,
d=e.toUpperCase(a,1);c[a]=(a==="filter"||a==="parser")&&e.isString(b)&&b.search(/^:/)!==-1?this["_compile"+e.toUpperCase(a,1)](b):nimble.expr(b,c[a]||"");this.dObj.sys["active"+d+"ID"]=null;return this};e.Collection.prototype._update=function(a,b){var c=this.dObj.active,d=this.dObj.sys,g=this._getActiveID(a);c[a]=(a==="filter"||a==="parser")&&e.isString(b)&&b.search(/^:/)!==-1?this["_compile"+e.toUpperCase(a,1)](b):nimble.expr(b,c[a]||"");if(g)d["tmp"+e.toUpperCase(a,1)][g]=c[a];return this};e.Collection.prototype._get=
function(a,b){if(b&&b!==this.ACTIVE){if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");return this.dObj.sys["tmp"+e.toUpperCase(a,1)][b]}return this.dObj.active[a]};e.Collection.prototype._push=function(a,b,c){var d=this.dObj.sys["tmp"+e.toUpperCase(a,1)],g=this._getActiveID(a),f;if(e.isPlainObject(b))for(f in b){if(b.hasOwnProperty(f))if(f===this.ACTIVE)throw Error("invalid property name!");else if(d[f]&&g&&g===f)this._update(a,b[f]);else d[f]=(a==="filter"||
a==="parser")&&e.isString(b[f])&&c.search(/^:/)!==-1?this["_compile"+e.toUpperCase(a,1)](b[f]):b[f]}else if(b===this.ACTIVE)throw Error("invalid property name!");else if(d[b]&&g&&g===b)this._update(a,c);else d[b]=(a==="filter"||a==="parser")&&e.isString(c)&&c.search(/^:/)!==-1?this["_compile"+e.toUpperCase(a,1)](c):c;return this};e.Collection.prototype._set=function(a,b){var c=this.dObj.sys,d=e.toUpperCase(a,1),g=a+"ChangeControl",f="active"+d+"ID";if(!this._exists(a,b))throw Error('the object "'+
b+'" -> "'+a+"\" doesn't exist in the stack!");if(c[f]!==b){c[g]=true;c[f]=b}else c[g]=false;c[a+"Back"].push(b);this.dObj.active[a]=c["tmp"+d][b];return this};e.Collection.prototype._back=function(a,b){var c=this.dObj.sys,d=e.toUpperCase(a,1),g=c[a+"Back"],f=g.length-(b||1)-1;if(f>=0&&g[f])if(c["tmp"+d][g[f]]){this._set(a,g[f]);c[a+"ChangeControl"]=false;g.splice(f+1,g.length)}return this};e.Collection.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,
arguments);return this};e.Collection.prototype._drop=function(a,b,c,d){c=c===undefined?false:c;var g=this.dObj.active,f=this.dObj.sys,h=e.toUpperCase(a,1),j="active"+h+"ID";h="tmp"+h;var k=this._getActiveID(a);b=!b?k?[k]:[]:e.isArray(b)||e.isPlainObject(b)?b:[b];var l;if(b[0]&&b[0]!==this.ACTIVE)for(l in b){if(b.hasOwnProperty(l))if(!b[l]||b[l]===this.ACTIVE)if(d===undefined){k&&delete f[h][k];f[j]=null;g[a]=c}else{if(k)f[h][k]=d;g[a]=d}else if(d===undefined){delete f[h][b[l]];if(k&&b[l]===k){f[j]=
null;g[a]=c}}else{f[h][b[l]]=d;if(k&&b[l]===k)g[a]=d}}else if(d===undefined){k&&delete f[h][k];f[j]=null;g[a]=c}else{if(k)f[h][k]=d;g[a]=d}return this};e.Collection.prototype._reset=function(a,b,c){return this._drop(a,b||"","",c===undefined?false:c)};e.Collection.prototype._resetTo=function(a,b,c){c=!c||c===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+e.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};e.Collection.prototype._exists=function(a,b){var c=e.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&
this._getActiveID(a))return true;if(this.dObj.sys["tmp"+c][b]!==undefined)return true;return false};e.Collection.prototype._getActiveID=function(a){return this.dObj.sys["active"+e.toUpperCase(a,1)+"ID"]};e.Collection.prototype._isActive=function(a,b){if(b===this._getActiveID(a))return true;return false};e.Collection.prototype.use=function(a){this.stack.forEach(function(b){var c,d,g;if(this._exists(b,a))this._set(b,a);else{c=a.split(this.NAMESPACE_SEPARATOR);for(g=c.length;(g-=1)>-1;){c.splice(g,1);
d=c.join(this.NAMESPACE_SEPARATOR);if(this._exists(b,d)){this._set(b,d);break}}}},this);return this};e.Collection.prototype._prop=function(a,b,c){var d=this.dObj[a];if(arguments.length!==3)if(e.isPlainObject(b))e.extend(d,b);else return d[b];else d[b]=c;return this};e.Collection.prototype.active=function(){return this._prop.apply(this,e.unshiftArguments(arguments,"active"))};(function(a){var b=e.Collection.prototype,c;a.forEach(function(d){c=e.toUpperCase(d,1);b["new"+c]=function(g){return function(f){return this._new(g,
f)}}(d);b["update"+c]=function(g){return function(f){return this._update(g,f)}}(d);b["reset"+c+"To"]=function(g){return function(f,h){return this._resetTo(g,f,h)}}(d);b["push"+c]=function(g){return function(){return this._push.apply(this,e.unshiftArguments(arguments,g))}}(d);b["set"+c]=function(g){return function(f){return this._set(g,f)}}(d);b["pushSet"+c]=function(g){return function(f,h){return this._push(g,f,h)._set(g,f)}}(d);b["back"+c]=function(g){return function(f){return this._back(g,f||"")}}(d);
b["back"+c+"If"]=function(g){return function(f){return this._backIf(g,f||"")}}(d);b["drop"+c]=d==="filter"||d==="parser"?function(g){return function(){return this._drop(g,arguments)}}(d):function(g){return function(){return this._drop(g,arguments,null)}}(d);if(d==="filter"||d==="parser")b["reset"+c]=function(g){return function(){return this._reset(g,arguments)}}(d);else if(d==="page")b["reset"+c]=function(g){return function(){return this._reset(g,arguments,1)}}(d);else if(d==="context")b["reset"+
c]=function(g){return function(){return this._reset(g,arguments,"")}}(d);b["isActive"+c]=function(g){return function(f){return this._isActive(g,f)}}(d);b["exists"+c]=function(g){return function(f){return this._exists(g,f||"")}}(d);b["get"+c+"ActiveID"]=function(g){return function(){return this._getActiveID(g)}}(d);b["get"+c]=function(g){return function(f){return this._get(g,f||"")}}(d)})})(e.Collection.prototype.stack);e.Collection.prototype._setOne=function(a,b,c){a=e.isExists(a)?a.toString():"";
b=b===undefined?"":b;c=c||"";var d=this._getActiveParam("context");if(!a&&!d)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);nimble.byLink(this._get("collection",c),d+nimble.CHILDREN+a,b);return this};e.Collection.prototype._getOne=function(a,b){a=e.isExists(a)?a.toString():"";return nimble.byLink(this._get("collection",b||""),this._getActiveParam("context")+nimble.CHILDREN+a)};e.Collection.prototype.add=function(a,b,c,d,g){a=a!==undefined?a:"";b=b||"push";c=c||
"";g=g||false;var f,h,j;f=nimble.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof f==="object"){if(d){a=e.isExists(a)?a.toString():"";h=nimble.byLink(this._get("collection",d||""),a);if(e.isPlainObject(f)){b=b==="push"?this.length(f):b==="unshift"?this.length(f)+nimble.METHOD_SEPARATOR+"unshift":b;j=nimble.addElementToObject(f,b.toString(),h)}else{j=true;f[b](h)}g===true&&this.disable("context")._removeOne(a,d).enable("context")}else if(e.isPlainObject(f)){b=b==="push"?
this.length(f):b==="unshift"?this.length(f)+nimble.METHOD_SEPARATOR+"unshift":b;j=nimble.addElementToObject(f,b.toString(),a)}else{j=true;f[b](a)}j!==true&&this._setOne("",j,c)}else throw Error("unable to set property!");return this};e.Collection.prototype.push=function(a,b){return this.add(a,"",b||"")};e.Collection.prototype.unshift=function(a,b){return this.add(a,"unshift",b||"")};e.Collection.prototype._removeOne=function(a,b){a=e.isExists(a)?a.toString():"";var c=this._getActiveParam("context");
!a&&!c?this._setOne("",null):nimble.byLink(this._get("collection",b||""),c+nimble.CHILDREN+a,"",true);return this};e.Collection.prototype._remove=function(a,b){b=b||"";var c,d;if(e.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(e.isArray(a[c]))for(d=a[c].length;(d-=1)>-1;)this._removeOne(a[c][d],c);else this._removeOne(a[c],c)}else if(e.isArray(a))for(d=a.length;(d-=1)>-1;)this._removeOne(a[d],b);else this._removeOne(a,b);return this};e.Collection.prototype.pop=function(a){return this._removeOne("eq(-1)",
a||"")};e.Collection.prototype.shift=function(a){return this._removeOne("eq(0)",a||"")};e.Collection.prototype.concat=function(a,b,c){b=e.isExists(b)?b.toString():"";c=c||"";var d=nimble.byLink(this._get("collection",c),this._getActiveParam("context")+nimble.CHILDREN+b);if(typeof d==="object")if(e.isPlainObject(d))e.extend(true,d,a);else{if(e.isArray(d))if(e.isArray(a)){d=Array.prototype.concat(d,a);this._setOne(b,d,c)}else this.add(a,"push",c)}else throw Error("incorrect data type!");return this};
e.Collection.prototype.length=function(a,b){a=a||"";var c={},d,g,f,h;if(!e.isFunction(a))if(e.isString(a)&&!this._filterTest(a)&&!e.isExists(b)||e.isArray(a)||e.isPlainObject(a)){b=a;a=false}if(!b||b===this.ACTIVE)d=this._get("collection");else if(e.isString(b))d=this._get("collection",b);else{g=true;d=b}if(d===null)return 0;if(g!==true)d=nimble.byLink(d,this._getActiveParam("context"));if(e.isString(d))return d.length;if(typeof d!=="object")throw Error("incorrect data type!");if(a===false&&d.length!==
undefined)h=d.length;else{h=0;if(d.length!==undefined)d.forEach(function(j,k){if(this._customFilter(a,j,k,d,h||null,this,b?b:this.ACTIVE,c)===true)h+=1},this);else for(f in d)if(d.hasOwnProperty(f))if(this._customFilter(a,d[f],f,d,h||null,this,b?b:this.ACTIVE,c)===true)h+=1}c.name&&this._drop("filter","__tmp:"+c.name);return h};e.Collection.prototype.forEach=function(a,b,c,d,g,f,h){a=e.isFunction(a)?{filter:a}:a;b=b||"";c=e.isExists(c)?c:this.ACTIVE;if(e.isBoolean(c)){h=f;f=g;g=d;d=c;c=this.ACTIVE}d=
d===false?false:true;g=parseInt(g)>=0?parseInt(g):false;f=parseInt(f)||false;h=parseInt(h)||false;var j={},k,l,m,o=0,n=false,p;k=nimble.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof k!=="object")throw Error("incorrect data type!");l=this.length(k);if(e.isArray(k)){m=h!==false?k.slice(h):k;m.some(function(q,r){r+=h;if(g!==false&&o===g)return true;if(this._customFilter(b,q,r,k,l,this,c,j)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter)n=a.filter.call(a.filter,q,r,k,l,
this,c)===false;if(d===false)n=true;o+=1}else if(a.denial&&(f===false||f===0)){p=a.denial.call(a.denial,q,r,k,l,this,c);if(n===false&&p===false)n=true}if(a.full&&(f===false||f===0)){p=a.full.call(a.full,q,r,k,l,this,c);if(n===false&&p===false)n=true}if(n===true)return true;p=""},this)}else for(m in k)if(k.hasOwnProperty(m)){if(g!==false&&o===g)break;if(h!==false&&h!==0)h-=1;else{if(this._customFilter(b,k[m],m,k,l,this,c,j)===true)if(f!==false&&f!==0)f-=1;else{if(a.filter)n=a.filter.call(a.filter,
k[m],m,k,l,this,c)===false;if(d===false)n=true;o+=1}else if(a.denial&&(f===false||f===0)){p=a.denial.call(a.denial,k[m],m,k,l,this,c);if(n===false&&p===false)n=true}if(a.full&&(f===false||f===0)){p=a.full.call(a.full,k[m],m,k,l,this,c);if(n===false&&p===false)n=true}if(n===true)break;p=""}}j.name&&this._drop("filter","__tmp:"+j.name);return this};e.Collection.prototype.search=function(a,b,c,d,g,f){a=a||"";b=e.isExists(b)?b:this.ACTIVE;if(e.isBoolean(b)){f=g;g=d;d=c;c=b;b=this.ACTIVE}c=c===false?false:
true;d=parseInt(d)>=0?parseInt(d):false;g=parseInt(g)||false;f=parseInt(f)||false;var h=c===true?[]:-1;this.forEach(function(j,k){if(c===true)h.push(k);else h=k;return true},a,b,c,d,g,f);return h};e.Collection.prototype.searchOne=function(a,b){return this.search(e.isExists(a)?a:"",b||"",false)};e.Collection.prototype.indexOf=function(a,b,c){c=c||"";b=b||"";var d=nimble.byLink(this._get("collection",c),this._getActiveParam("context"));if(e.isArray(d)&&d.indexOf){if(b)return d.indexOf(a,b);return d.indexOf(a)}else return this.search(function(g){return g===
a},c,false,"","",b)};e.Collection.prototype.lastIndexOf=function(a,b,c){c=c||"";b=b||"";var d=nimble.byLink(this._get("collection",c),this._getActiveParam("context"));if(e.isArray(d)&&d.lastIndexOf){if(b)return d.lastIndexOf(a,b);return d.lastIndexOf(a)}else{b=this.search(function(g){return g===a},c,"","","",b);return b[b.length-1]!==undefined?b[b.length-1]:-1}};e.Collection.prototype.get=function(a,b,c,d,g,f){if(e.isNumeric(a)||arguments.length<2&&e.isString(a)&&!this._filterTest(a)||arguments.length===
0||arguments.length<2&&a===null)return this._getOne(a,b||"");a=a=a||"";b=e.isExists(b)?b:this.ACTIVE;if(e.isBoolean(b)){f=g;g=d;d=c;c=b;b=this.ACTIVE}c=c===false?false:true;d=parseInt(d)>=0?parseInt(d):false;g=parseInt(g)||false;f=parseInt(f)||false;var h=c===true?[]:-1;this.forEach(function(j,k,l){if(c===true)h.push(l[k]);else h=l[k];return true},a,b,c,d,g,f);return h};e.Collection.prototype.getOne=function(a,b){return this.get(e.isExists(a)?a:"",b||"",false)};e.Collection.prototype.set=function(a,
b,c){if(e.isNumeric(a)||arguments.length<3&&e.isString(a)&&!this._filterTest(a)||arguments.length===0||arguments.length<3&&a===null)return this._setOne(a,b,c||"");var d,g=e.isFunction(b);d=e.unshiftArguments(arguments,function(f,h,j,k,l,m){j[h]=g?b.call(b,f,h,j,k,l,m):nimble.expr(b,j[h]);return true});d.splice(2,1);return this.forEach.apply(this,d)};e.Collection.prototype.setOne=function(a,b,c){return this.set(e.isExists(a)?a:"",b,c||"",false)};e.Collection.prototype.map=function(a,b){return this.set(true,
a,b||"")};e.Collection.prototype.some=function(a,b,c){return this.forEach(a,b||"",c||"",false)};e.Collection.prototype.move=function(a,b,c,d,g,f,h,j,k,l){a=a||"";l=l===false?false:true;b=e.isExists(b)?b.toString():"";c=c||"";d=d||"";g=g||"push";f=f===false?false:true;h=parseInt(h)>=0?parseInt(h):false;j=parseInt(j)||false;k=parseInt(k)||false;var m=[],o=e.isArray(nimble.byLink(this._get("collection",d),this._getActiveParam("context")));this.disable("context");a=this.search(a,c,f,h,j,k);this.enable("context");
if(f===true)a.forEach(function(n){this.add(b+nimble.CHILDREN+n,o===true?g:n+nimble.METHOD_SEPARATOR+g,d,c);l===true&&m.push(n)},this);else{this.add(b+nimble.CHILDREN+a,o===true?g:a+nimble.METHOD_SEPARATOR+g,d,c);l===true&&m.push(a)}l===true&&this.disable("context")._remove(m,c).enable("context");return this};e.Collection.prototype.moveOne=function(a,b,c,d,g){return this.move(e.isExists(a)?a:"",e.isExists(b)?b.toString():"",c||"",d||"",g||"",false)};e.Collection.prototype.copy=function(a,b,c,d,g,f,
h,j,k){f=f===false?false:true;h=parseInt(h)>=0?parseInt(h):false;j=parseInt(j)||false;k=parseInt(k)||false;return this.move(e.isExists(a)?a:"",e.isExists(b)?b.toString():"",c||"",d||"",g||"push",f,h,j,k,false)};e.Collection.prototype.copyOne=function(a,b,c,d,g){return this.move(e.isExists(a)?a:"",e.isExists(b)?b.toString():"",c||"",d||"",g||"",false,"","","",false)};e.Collection.prototype.remove=function(a,b){if(e.isNumeric(a)||arguments.length<2&&e.isString(a)&&!this._filterTest(a)||arguments.length===
0||arguments.length<2&&a===null)return this._removeOne(a,b||"");else if(e.isArray(a)||e.isPlainObject(a))return this._remove(a,b||"");var c=this.search.apply(this,arguments),d;if(e.isArray(c))for(d=c.length;(d-=1)>-1;)this._removeOne(c[d],b);else this._removeOne(c,b);return this};e.Collection.prototype.removeOne=function(a,b){return this.remove(e.isExists(a)?a:"",b||"",false)};e.Collection.prototype.sort=function(a,b,c,d){a=a||null;b=b||false;c=c&&c!==true?c===false?null:c:function(l){if(isNaN(l))return l.toUpperCase();
return l};d=d||"";var g=this,f,h=function(l,m){var o=b?-1:1;if(a){l=nimble.byLink(l,a);m=nimble.byLink(m,a)}if(c){l=c(l);m=c(m)}if(b!==g.SHUFFLE){if(l<m)return o*-1;if(l>m)return o;return 0}else return Math.floor(Math.random()*2-1)},j=function(l){var m=[],o={},n;for(n in l)l.hasOwnProperty(n)&&m.push(n);m.sort(h);for(n in m)if(m.hasOwnProperty(n))o[m[n]]=l[m[n]];return o},k=function(l){var m=[],o={},n;for(n in l)l.hasOwnProperty(n)&&m.push({key:n,value:l[n]});a=a===true?"value":"value"+nimble.CHILDREN+
a;m.sort(h);for(n in m)if(m.hasOwnProperty(n))o[m[n].key]=m[n].value;return o};f=nimble.byLink(this._get("collection",d),this._getActiveParam("context"));if(typeof f==="object")if(e.isArray(f))f.sort(h);else{f=a?k(f):j(f);this._setOne("",f,d)}else throw Error("incorrect data type!");return this};e.Collection.prototype.reverse=function(a){a=a||"";var b,c=function(d){var g=[],f={},h;for(h in d)d.hasOwnProperty(h)&&g.push(h);g.reverse();for(h in g)if(g.hasOwnProperty(h))f[g[h]]=d[g[h]];return f};b=nimble.byLink(this._get("collection",
a),this._getActiveParam("context"));if(typeof b==="object")e.isArray(b)?b.reverse():this._setOne("",c(b),a);else throw Error("incorrect data type!");return this};e.Collection.prototype.save=function(a,b,c){if(!localStorage)throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;b="__"+this.name+"__"+this._get("namespace",b||"");var d=a===this.ACTIVE?this._exists("collection")?this._getActiveID("collection"):"":this._isActive("collection",a)?"active":"";c=c===false?sessionStorage:
localStorage;c.setItem(b+":"+a,this.toString(a));c.setItem(b+"__date:"+a,(new Date).toString());c.setItem(b+"__active:"+a,d);c.setItem(b+"__date",(new Date).toString());return this};e.Collection.prototype.saveAll=function(a,b){if(!localStorage)throw Error("your browser doesn't support web storage!");a=a||"";b=b===false?b:true;var c,d=this.dObj.sys.tmpCollection,g=false;this.dropAll(a,b);for(c in d){this._isActive("Collection",c)&&(g=true);d.hasOwnProperty(c)&&this.save(c,a,b)}g===false&&this.save("",
a,b);return this};e.Collection.prototype.load=function(a,b,c){if(!localStorage)throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;b="__"+this.name+"__"+this._get("namespace",b||"");c=c===false?sessionStorage:localStorage;a===this.ACTIVE?this._new("collection",e.parseJSON(c.getItem(b+":"+a))):this._push("collection",a,e.parseJSON(c.getItem(b+":"+a)));c=c.getItem(b+"__active:"+a);if(c===this.ACTIVE)this._set("collection",a);else c&&this._push("collection",c,this._get("collection"))._set("collection",
c);return this};e.Collection.prototype.loadAll=function(a,b,c){c=c?"drop":"load";if(!localStorage)throw Error("your browser doesn't support web storage!");b=b===false?b:true;a=a||"";var d="__"+this.name+"__"+this._get("namespace",a),g=b===false?sessionStorage:localStorage,f=g.length,h,j;try{for(h in g)if(g.hasOwnProperty(h))if((j=h.split(":"))[0]===d)this[c](j[1],a,b)}catch(k){for(;(f-=1)>-1;)if((j=g[f].split(":"))[0]===d)this[c](j[1],a,b)}return this};e.Collection.prototype.loadDate=function(a,b,
c){if(!localStorage)throw Error("your browser doesn't support web storage!");return new Date((c===false?sessionStorage:localStorage).getItem("__"+this.name+"__"+this._get("namespace",b||"")+"__date"+(a?":"+a:"")))};e.Collection.prototype.isExpires=function(a,b,c,d){if(!localStorage)throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(b||"",c||"",d||"")))>a};e.Collection.prototype.drop=function(a,b,c){if(!localStorage)throw Error("your browser doesn't support web storage!");
a=a||this.ACTIVE;b="__"+this.name+"__"+this._get("namespace",b||"");c=c===false?sessionStorage:localStorage;c.removeItem(b+":"+a);c.removeItem(b+"__date:"+a);c.removeItem(b+"__active:"+a);return this};e.Collection.prototype.dropAll=function(a,b){a=a||"";(b===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace",a)+"__date");return this.loadAll(a,b||"",true)};e.Collection.prototype._customFilter=function(a,b,c,d,g,f,h,j){var k,l=true,m,o,n,p;if(!a){if(!this._getActiveParam("filter"))return true;
if(this._get("filter"))return this._customFilter(this._get("filter"),b,c,d,g,f,h,j);return true}if(e.isFunction(a))if(!this._getActiveParam("filter")||!j)return a.call(a,b,c,d,g,f,h);else{if(!j.name){for(;this._exists("filter","__tmp:"+(j.name=e.getRandomInt(0,1E4)));)j.name=e.getRandomInt(0,1E4);this._push("filter","__tmp:"+j.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+j.name,b,c,d,g,f,h,j)}if(!e.isArray(a)){if(this._getActiveParam("filter")&&j)a=this.ACTIVE+" && ("+a+")";if(a.search(/\|\||&&|!/)===
-1){if((a=e.trim(a)).search(/^(?:\(|)*:/)!==-1){this._exists("filter","__tmp:"+a)||this._push("filter","__tmp:"+a,this._compileFilter(a));return(a=this._get("filter","__tmp:"+a)).call(a,b,c,d,g,f,h)}return this._customFilter(this._get("filter",a),b,c,d,g,f,h,j)}a=e.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ");for(c=a.length;(c-=1)>-1;)a[c]===""&&a.splice(c,1)}k=function(q,r){for(var s=-1,t=q.length,u=0,v=[];(s+=1)<t;){r+=
1;if(q[s]==="("||q[s]==="!(")u+=1;if(q[s]===")")if(u===0)return{result:v,iter:r};else u-=1;v.push(q[s])}};j=a.length;for(c=-1;(c+=1)<j;)if(a[c]==="("||a[c]==="!("){if(a[c].substring(0,1)==="!"){p=true;a[c]=a[c].substring(1)}else p=false;c=(m=k(a.slice(c+1),c)).iter;m=m.result.join(" ");m=this._customFilter(m,b,c,d,g,f,h);l=!o&&!n?p===true?!m:m:o?p===true?!m:m&&l:p===true?!m:m||l}else if(a[c]!==")"&&a[c]!=="||"&&a[c]!=="&&"){if(a[c].substring(0,1)==="!"){p=true;a[c]=a[c].substring(1)}else p=false;
m=this._customFilter(this._get("filter",a[c]),b,c,d,g,f,h);l=!o&&!n?p===true?!m:m:o?p===true?!m:m&&l:p===true?!m:m||l}else if(a[c]==="||"){o=false;n=true}else if(a[c]==="&&"){n=false;o=true}return l};e.Collection.prototype._compileFilter=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('self.getVariable("').split(":>").join('")');return new Function("el","i","data","cOLength","cObj","id","var key = i; return "+a.replace(/^\s*:/,
"")+";")};e.Collection.prototype._customParser=function(a,b,c){if(!a){if(!this._getActiveParam("parser"))return true;if(this._get("parser"))return this._customParser(this._get("parser"),b,c);return true}if(e.isFunction(a))if(!this._getActiveParam("parser")||!c)return a.call(a,b,this);else{if(!c.name){for(;this._exists("parser","__tmp:"+(c.name=e.getRandomInt(0,1E4)));)c.name=e.getRandomInt(0,1E4);this._push("parser","__tmp:"+c.name,a)}return this._customParser(this.ACTIVE+" && __tmp:"+c.name,b,c)}if(e.isString(a)){if(this._getActiveParam("parser")&&
c)a=this.ACTIVE+" && "+a;if((a=e.trim(a)).search("&&")===-1){if(a.search(/^(?:\(|)*:/)!==-1){this._exists("parser","__tmp:"+a)||this._push("parser","__tmp:"+a,this._compileParser(a));return(a=this._get("parser","__tmp:"+a)).call(a,b,this)}return this._customParser(this._get("parser",a),b)}a=a.split("&&")}a.forEach(function(d){b=this._customParser(e.trim(d),b)},this);return b};e.Collection.prototype._compileParser=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-
b[0].length);a=a.split("<:").join('self.getVariable("').split(":>").join('")');return new Function("str","cObj","return "+a.replace(/^\s*:/,"")+";")};e.Collection.prototype.parentContext=function(a,b){for(var c=this._get("context",b||"").split(nimble.CHILDREN),d=a||1;(d-=1)>-1;)c.splice(-1,1);return c.join(nimble.CHILDREN)};e.Collection.prototype.parent=function(a,b){if(!b)return this._update("context",this.parentContext.apply(this,arguments));return this._push("context",b,this.parentContext.apply(this,
arguments))};e.Collection.prototype._getActiveParam=function(a){var b=this.dObj.sys.flags.use[a]===undefined||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return b?b.toString():"";return b};e.Collection.prototype._filterTest=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(/&&|\|\||:/)!==-1};e.Collection.prototype.enable=function(a){this.dObj.sys.flags.use[a]=true;return this};e.Collection.prototype.disable=function(a){this.dObj.sys.flags.use[a]=
false;return this};e.Collection.prototype.toggle=function(a){if(this.dObj.sys.flags.use[a]===true)return this.disable(a);return this.enable(a)};e.Collection.prototype.toString=function(a,b,c){if(!JSON||!JSON.stringify)throw Error("object JSON is not defined!");b=b||"";c=c||"";if(a&&(e.isArray(a)||e.isPlainObject(a)))return JSON.stringify(a,b,c);return JSON.stringify(nimble.byLink(this._get("collection",a||""),this._getActiveParam("context")),b,c)};e.Collection.prototype.valueOf=function(){return this.length(this.ACTIVE)};
e.Collection.prototype.then=function(a,b){var c=this;arguments.length===1?e.when(this.active("defer")).always(function(){a.apply(c,arguments)}):e.when(this.active("defer")).then(function(){a().apply(c,arguments)},function(){b().apply(c,arguments)});return this};e.Collection.prototype.print=function(a,b){b=b||false;var c={},d={},g,f,h,j=0,k,l=null,m="",o;if(e.isExists(a)&&(e.isString(a)||e.isNumeric(a)))a={page:a};else e.isExists(a)||(a={page:this._get("page")});e.extend(true,d,this.dObj.active,a);
if(a)d.page=nimble.expr(d.page,this._get("page"));if(d.page<1)d.page=1;d.collection=e.isString(d.collection)?this._get("collection",d.collection):d.collection;d.template=e.isString(d.template)?this._get("template",d.template):d.template;d.cache=e.isExists(a.cache)?a.cache:this._getActiveParam("cache");if(b===true)d.cache.iteration=false;k=this._get("page")-d.page;this._update("page",d.page);o=function(n,p,q,r,s,t){d.callback&&d.callback.apply(this,arguments);m+=d.template.call(d.template,n,p,q,r,
s,t);j=p;return true};g=nimble.byLink(d.collection,this._getActiveParam("context")+nimble.CHILDREN+(a&&a.context||""));f=this.length();d.numberBreak=!e.isExists(d.numberBreak)||d.numberBreak===false?f:d.numberBreak;if(e.isPlainObject(g)||d.cache.iteration===false||d.cache.firstIteration===false||d.cache.lastIteration===false){h=!d.pager||d.page===1?0:(d.page-1)*d.numberBreak;this.forEach(o,d.filter,this.ACTIVE,true,d.numberBreak,h);if(d.cache.iteration===false)d.cache.lastIteration=false}else if(e.isArray(g)&&
d.cache.iteration===true){h=!d.pager||d.filter===false?d.page===1?0:(d.page-1)*d.numberBreak:d.cache.iteration===true?k>=0?d.cache.firstIteration:d.cache.lastIteration:i;if(k>0&&d.pager===true&&d.filter!==false){for(k*=d.numberBreak;(h-=1)>-1;)if(this._customFilter(d.filter,g[h],g,h,f,this,this.ACTIVE)===true)if(j===k)break;else j+=1;d.cache.lastIteration=h+=1;l=null}else if(k<0&&d.pager&&d.filter!==false)l=Math.abs(k)*d.numberBreak-d.numberBreak||null;this.forEach(o,d.filter,this.ACTIVE,true,d.numberBreak,
l,h)}if(k!==0&&d.cache.iteration!==false){this._get("cache").firstIteration=d.cache.lastIteration;this._get("cache").lastIteration=j+1}if(d.cache.autoIteration===true)this._get("cache").iteration=true;m=!m?d.resultNull:this._customParser(d.parser,m,c);c.name&&this._drop("parser","__tmp:"+c.name);if(d.target===false){d.variable?this._push("variable",d.variable,m):this._new("variable",m);return this}else d.target[d.appendType](m);if(!d.pager)return this;d.nmbOfEntries=d.filter!==false?this.length(d.filter):
f;d.nmbOfEntriesInPage=d.target.find(d.calculator).length;d.finNumber=d.numberBreak*d.page-(d.numberBreak-d.nmbOfEntriesInPage);d.page!==1&&d.nmbOfEntriesInPage===0?this.updatePage(d.page-=1).print(d,true,true):this.easyPage(d);return this};e.Collection.prototype.easyPage=function(a){var b=this,c="",d=a.nmbOfEntries%a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak,g=function(l,m,o){var n,p="<"+(l.tag||"span")+' data-page="'+o+'"';if(l.attr)for(n in l.attr)if(l.attr.hasOwnProperty(n))p+=
" "+n+'="'+l.attr[n]+'"';if(o===a.page)p+=' class="'+(m&&m.active||"active")+'"';return p+(">"+o+"</"+(l.tag||"span")+">")},f,h=0,j,k;a.pager.find(".ctm").each(function(){if(a.pageBreak<=2)throw Error('parameter "pageBreak" must be more than 2');var l=e(this),m=l.data("ctm"),o=m.classes;if(m.nav){if((m.nav==="prev"||m.nav==="next")&&!l.data("ctm-delegated"))l.click(function(){if(!e(this).hasClass(m.classes&&m.classes.disabled||"disabled")){m.nav==="prev"&&(a.page="-=1");m.nav==="next"&&(a.page="+=1");
db.print(a)}}).data("ctm-delegated",true);if(m.nav==="prev"&&a.page===1||m.nav==="next"&&a.finNumber===a.nmbOfEntries)l.addClass(o&&o.disabled||"disabled");else if(m.nav==="prev"||m.nav==="next")l.removeClass(o&&o.disabled||"disabled");if(m.nav==="pageList"){if(d>a.pageBreak){h=a.pageBreak%2!==0?1:0;k=j=(a.pageBreak-h)/2;if(a.page-h<j)j=0;else{j=a.page-j-h;if(a.page+k>d)j-=a.page+k-d}f=j;for(h=-1;(f+=1)<=d&&(h+=1)!==null;){if(h===a.pageBreak&&f!==a.page)break;c+=g(m,o||"",f)}}else for(f=0;(f+=1)<=
d;)c+=g(m,o||"",f);l.html(c);l.data("ctm-delegated")||l.on("click",m.tag||"span",function(){var n=e(this);if(!n.hasClass(m.classes&&m.classes.active||"active")){a.page=n.data("page");b.print(a)}}).data("ctm-delegated",true)}}else if(m.info){a.nmbOfEntriesInPage===0?l.addClass(o&&o.noData||"noData"):l.removeClass(o&&o.noData||"noData");switch(m.info){case "page":l.html(a.page);break;case "total":l.html(a.nmbOfEntries);break;case "from":l.html((a.page-1)*a.numberBreak+1);break;case "to":l.html(a.finNumber);
break;case "inPage":l.html(a.nmbOfEntriesInPage);break;case "nmbOfPages":l.html(a.nmbOfPages)}}});return this};e.Collection.prototype.genTable=function(a,b,c){a=a||4;b=b||"div";c=c===false?false:true;var d=1,g,f=this._get("target"),h=f.find(b).length,j="";f.find(b).each(function(k){this.tagName!=="td"&&e(this).wrap("<td></td>");if(d===a){j="";for(g=-1;(g+=1)<a;){j+="td:eq("+(k-g)+")";if(g!==a-1)j+=","}f.find(j).wrapAll("<tr></tr>");d=0}else if(k===h-1&&d!==a){j="";for(g=-1;(g+=1)<d;){j+="td:eq("+
(k-g)+")";if(g!==d-1)j+=","}d-=1;f.find(j).wrapAll("<tr></tr>");if(c===true){for(j="";(d+=1)<a;)j+="<td></td>";f.find("tr:last").append(j)}}d+=1});f[0].tagName!=="table"&&f.children("tr").wrapAll("<table></table>");return this}})(jQuery);
//