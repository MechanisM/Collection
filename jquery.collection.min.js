/**
 * $.Collection
 * 
 * autor: kobezzza (kobezzza@gmail.com | http://kobezzza.com)
 * version: 3.3.5
 * date: 08.01.2012 14:23:06
 */
 var nimble={name:"nimble",version:"1.0.2",nimble:function(){return this.name+" "+this.version},CONTEXT_SEPARATOR:" ",QUERY_SEPARATOR:"/",SUBQUERY_SEPARATOR:"{",METHOD_SEPARATOR:"->",CHILDREN:">",ORDER:["eq(",")"],trim:function(c){c=c.replace(/^\s\s*/,"");for(var a=/\s/,b=c.length;a.test(c.charAt(b-=1)););return c.substring(0,b+1)},isString:function(c){return Object.prototype.toString.call(c)==="[object String]"},isNumber:function(c){return Object.prototype.toString.call(c)==="[object Number]"},isArray:function(c){return Object.prototype.toString.call(c)===
"[object Array]"},isExist:function(c){return c!==undefined&&c!=="undefined"&&c!==null&&c!==""},expr:function(c,a){a=a!==undefined||a!==null?a:"";if(this.isString(c)&&c.search(/^[+-\\*/]{1}=/)!==-1){c=c.split("=");isNaN(c[1])||(c[1]=+c[1]);switch(c[0]){case "+":c=a+c[1];break;case "-":c=a-c[1];break;case "*":c=a*c[1];break;case "/":c=a/c[1]}}return c},byLink:function(c,a,b,d){if(c===undefined)return false;a=a.toString().replace(RegExp("\\s*"+this.CHILDREN+"\\s*","g")," "+this.CHILDREN+" ").split(this.CONTEXT_SEPARATOR);
d=d||false;var f=this.CHILDREN,e=0,g=0,j,h,k,l=a.length;for(h=l;(h-=1)>-1;){a[h]=this.trim(a[h]);if(a[h]===""){a.splice(h,1);e-=1}else if(a[h]!==this.CHILDREN){if(h>e)e=h;g+=1}}l=a.length;if(c===false)return a.join("");else if(this.isNumber(c)){if((c=+c)<0)c+=g;if(b===undefined){h=-1;for(k=0;(h+=1)<l;)if(a[h]!==this.CHILDREN)if((k+=1)===c){a.splice(h+1,l);return a.join("")}}else{h=l;for(k=0;(h-=1)>-1;)if(a[h]!==this.CHILDREN)if((k+=1)===c){a.splice(0,h);return a.join("")}}}for(h=-1;(h+=1)<l;)switch(a[h]){case this.CHILDREN:f=
a[h];break;default:if(f===this.CHILDREN&&a[h].substring(0,this.ORDER[0].length)!==this.ORDER[0])if(h===e&&b!==undefined)if(d===false)c[a[h]]=this.expr(b,c[a[h]]);else if(nimble.isArray(c))c.splice(a[h],1);else delete c[a[h]];else c=c[a[h]];else{g=a[h].substring(this.ORDER[0].length);g=g.substring(0,g.length-1);g=+g;if(this.isArray(c))if(h===e&&b!==undefined)if(g>=0)if(d===false)c[g]=this.expr(b,c[g]);else c.splice(g,1);else if(d===false)c[c.length+g]=this.expr(b,c[c.length+g]);else c.splice(c.length+
g,1);else c=g>=0?c[g]:c[c.length+g];else{if(g<0){k=0;for(j in c)if(c.hasOwnProperty(j))k+=1;g+=k}k=0;for(j in c)if(c.hasOwnProperty(j)){if(g===k){if(h===e&&b!==undefined)if(d===false)c[j]=this.expr(b,c[j]);else delete c[j];else c=c[j];break}k+=1}}}}if(b!==undefined)return this;return c},execEvent:function(c,a,b,d){c=c.split(this.QUERY_SEPARATOR);b=this.isExist(b)?b:[];b=this.isArray(b)?b:[b];for(var f=-1,e=c.length-1;(f+=1)<e;)a=a[c[f]];if(c[f].search(this.SUBQUERY_SEPARATOR)!==-1){c=c[f].split(this.SUBQUERY_SEPARATOR);
a=a[c[0]];c.splice(0,1);b=b.concat(c);return a.apply(d||a,b)}else return a[c[f]].apply(d||a,b)},addElementToObject:function(c,a,b){a=a.split(this.METHOD_SEPARATOR);var d,f={};if(a[1]&&a[1]=="unshift"){f[!isNaN(Number(a[0]))?0:a[0]]=b;for(d in c)if(c.hasOwnProperty(d))f[!isNaN(Number(d))?+d+1:d]=c[d];return f}else if(!a[1]||a[1]=="push")c[a[0]]=b;return true}};
(function(c){c.Collection=function(a,b){a=a||null;b=b||null;if(this.fn&&(!this.fn.name||this.fn.name!=="$.Collection"))return new c.Collection(a,b);c.extend(true,this,c.Collection.storage);var d=this.dObj.active;b&&c.extend(true,d,b);if(c.isString(a)){d.target=c(a);d.collection=null}else d.collection=a};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var d=-1,f=this.length;(d+=1)<f;)b?a.call(b,this[d],d,this):a(this[d],d,this)};if(!Array.prototype.some)Array.prototype.some=function(a,
b){for(var d=-1,f=this.length,e;(d+=1)<f;){e=b?a.call(b,this[d],d,this):a(this[d],d,this);if(e===true)break}};c.Collection.fn=c.Collection.prototype={name:"$.Collection",version:"3.3.5",collection:function(){return this.name+" "+this.version},ACTIVE:"active",stack:["collection","filter","context","cache","index","map","variable","defer","page","parser","appendType","target","calculator","pager","template","numberBreak","pageBreak","resultNull"],getActiveParam:function(a){return this.dObj.sys.flags.use[a]===
undefined||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:""},filterTest:function(a){return a===this.ACTIVE||this._exist("filter",a)||a.search(/&&|\|\|/)!==-1},enable:function(a){this.dObj.sys.flags.use[a]=true;return this},disable:function(a){this.dObj.sys.flags.use[a]=false;return this},toggle:function(a){if(this.dObj.sys.flags.use[a]===true)return this.disable(a);return this.enable(a)}};c.fn.collection=function(a){var b=c.fn.collection.stat,d=function(g){g=g.childNodes;for(var j=g.length,
h=-1,k="";(h+=1)<j;)if(g[h].nodeType===3&&c.trim(g[h].textContent))k+=g[h].textContent;if(k)return k;return false},f=function(g){var j=[];g.each(function(h){var k=c(this),l=k.data(),m=k.attr("class")?k.attr("class").split(" "):"",n=m?m.length:0,o=d(k[0]),p;j.push({});for(p in l)if(l.hasOwnProperty(p))j[h][p]=l[p];if(n){j[h][b.classes]={};m.forEach(function(r){j[h][b.classes][r]=r})}if(k.children().length!==0)j[h][b.childNodes]=f(k.children());if(o!==false)j[h][b.val]=o.replace(/[\r\t\n]/g," ")});
return j},e=f(this);if(a)return new c.Collection(e,a);return new c.Collection(e)};if(!c.fn.collection.stat)c.fn.collection.stat={val:"val",childNodes:"childNodes",classes:"classes"};c.fn.ctplCompile=function(){if(this.length===0)throw Error("DOM element isn't exist!");var a="var key = i, result = ''; ";this.html().replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(b,d){a+=d===0||d%2===0?"result +='"+b+"';":b.split("echo").join("result +=")});
return new Function("el","data","i","cOLength","cObj","id",a+" return result;")};c.fn.ctplMake=function(a){this.find("[type='text/ctpl']").each(function(){var b=c(this),d=b.data(),f=d.prefix?d.prefix+"_":"";a.pushTemplate(f+d.name,b.ctplCompile());d.set&&d.set===true&&a.setTemplate(f+d.name)})};c.isString=function(a){return nimble.isString(a)};c.isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"};c.isExist=function(a){return nimble.isExist(a)};c.unshiftArguments=function(a,
b){for(var d=[b],f=-1,e=a.length;(f+=1)<e;)d.push(a[f]);return d};c.toUpperCase=function(a,b,d){d=d||0;if(!b)return a.toUpperCase();return a.substring(d,b).toUpperCase()+a.substring(b)};c.toLowerCase=function(a,b,d){d=d||0;if(!b)return a.toLowerCase();return a.substring(d,b).toLowerCase()+a.substring(b)};c.Collection.storage={dObj:{active:{collection:null,filter:false,context:"",cache:{autoIteration:false,iteration:false,firstIteration:false,lastIteration:false},index:null,map:null,variable:null,
defer:"",page:1,parser:false,appendType:"html",target:null,calculator:".line",pager:"#pageControl",template:null,numberBreak:10,pageBreak:10,resultNull:""}}};c.Collection.storage.dObj.sys={flags:{use:{context:true,filter:true,parser:true}}};(function(a){var b,d=c.Collection.storage.dObj.sys;a.forEach(function(f){b=c.toUpperCase(f,1);d["active"+b+"ID"]=null;d["tmp"+b]={};d[f+"ChangeControl"]=null;d[f+"Back"]=[]})})(c.Collection.fn.stack);c.Collection.fn._$=function(a,b){var d=this.dObj,f=d.active,
e=c.toUpperCase(a,1);f[a]=nimble.expr(b,f[a]||"");d.sys["active"+e+"ID"]=null;return this};c.Collection.fn._update=function(a,b){var d=this.dObj,f=d.active;d=d.sys;var e=c.toUpperCase(a,1),g=d["active"+e+"ID"];f[a]=nimble.expr(b,f[a]||"");if(g)d["tmp"+e][g]=f[a];return this};c.Collection.fn._get=function(a,b){var d=this.dObj;if(b&&b!==this.ACTIVE)return d.sys["tmp"+c.toUpperCase(a,1)][b];return d.active[a]};c.Collection.fn._push=function(a,b,d){var f=this.dObj.sys,e=c.toUpperCase(a,1),g=f["tmp"+e];
f=f["active"+e+"ID"];var j;if(c.isPlainObject(b))for(j in b){if(b.hasOwnProperty(j))if(j===this.ACTIVE)throw Error("invalid property name!");else if(g[j]&&f&&f===j)this._update(a,b[j]);else g[j]=b[j]}else if(b===this.ACTIVE)throw Error("invalid property name!");else if(g[b]&&f&&f===b)this._update(a,d);else g[b]=d;return this};c.Collection.fn._set=function(a,b){var d=this.dObj,f=d.sys,e=c.toUpperCase(a,1),g=a+"ChangeControl",j="active"+e+"ID";if(f[j]!==b){f[g]=true;f[j]=b}else f[g]=false;f[a+"Back"].push(b);
d.active[a]=f["tmp"+e][b];return this};c.Collection.fn._back=function(a,b){var d=this.dObj,f=d.sys,e=c.toUpperCase(a,1),g=f[a+"Back"],j;f[a+"ChangeControl"]=false;j=g.length-(b||1)-1;if(j>=0&&g[j])if(f["tmp"+e][g[j]]){f["active"+e+"ID"]=g[j];d.active[a]=f["tmp"+e][g[j]];g.splice(j+1,g.length)}return this};c.Collection.fn._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};c.Collection.fn._drop=function(a,b,d,f){d=d===undefined?false:
d;var e=this.dObj,g=e.active;e=e.sys;var j=c.toUpperCase(a,1),h="active"+j+"ID";j="tmp"+j;var k=e[h];b=!b?k?[k]:[]:c.isArray(b)||c.isPlainObject(b)?b:[b];var l;if(b[0]&&b[0]!==this.ACTIVE)for(l in b){if(b.hasOwnProperty(l))if(!b[l]||b[l]===this.ACTIVE)if(f===undefined){k&&delete e[j][k];e[h]=null;g[a]=d}else{if(k)e[j][k]=f;g[a]=f}else if(f===undefined){delete e[j][b[l]];if(k&&b[l]===k){e[h]=null;g[a]=d}}else{e[j][b[l]]=f;if(k&&b[l]===k)g[a]=f}}else if(f===undefined){k&&delete e[j][k];e[h]=null;g[a]=
d}else{if(k)e[j][k]=f;g[a]=f}return this};c.Collection.fn._reset=function(a,b,d){return this._drop(a,b||"","",d===undefined?false:d)};c.Collection.fn._resetTo=function(a,b,d){var f=this.dObj;d=!d||d===this.ACTIVE?f.active[a]:f.sys["tmp"+c.toUpperCase(a,1)][d];return this._reset(a,b||"",d)};c.Collection.fn._exist=function(a,b){var d=this.dObj,f=c.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&d.sys["active"+f+"ID"])return true;if(d.sys["tmp"+f][b]!==undefined)return true;return false};c.Collection.fn._is=
function(a,b){if(!b)return this.dObj.sys["active"+c.toUpperCase(a,1)+"ID"];if(b===this.dObj.sys["active"+c.toUpperCase(a,1)+"ID"])return true;return false};c.Collection.fn.use=function(a){for(var b=this.stack.length;(b-=1)>-1;)this._exist(this.stack[b],a)&&this._set(this.stack[b],a);return this};c.Collection.fn._prop=function(a,b,d){var f=this.dObj[a];if(arguments.length!==3)if(c.isPlainObject(b))c.extend(f,b);else return f[b];else f[b]=d;return this};c.Collection.fn.active=function(){return this._prop.apply(this,
c.unshiftArguments(arguments,"active"))};(function(a){var b=c.Collection.fn,d;a.forEach(function(f){d=c.toUpperCase(f,1);b["$"+d]=function(e){return function(g){return this._$(e,g)}}(f);b["update"+d]=function(e){return function(g){return this._update(e,g)}}(f);b["reset"+d+"To"]=function(e){return function(g,j){return this._resetTo(e,g,j)}}(f);b["push"+d]=function(e){return function(){return this._push.apply(this,c.unshiftArguments(arguments,e))}}(f);b["set"+d]=function(e){return function(g){return this._set(e,
g)}}(f);b["pushSet"+d]=function(e){return function(g,j){return this._push(e,g,j)._set(e,g)}}(f);b["back"+d]=function(e){return function(g){return this._back(e,g||"")}}(f);b["back"+d+"If"]=function(e){return function(g){return this._backIf(e,g||"")}}(f);b["drop"+d]=f==="filter"||f==="parser"?function(e){return function(){return this._drop(e,arguments)}}(f):function(e){return function(){return this._drop(e,arguments,null)}}(f);if(f==="filter"||f==="parser")b["reset"+d]=function(e){return function(){return this._reset(e,
arguments)}}(f);else if(f==="page")b["reset"+d]=function(e){return function(){return this._reset(e,arguments,1)}}(f);else if(f==="context")b["reset"+d]=function(e){return function(){return this._reset(e,arguments,"")}}(f);b["is"+d]=function(e){return function(g){return this._is(e,g)}}(f);b["exist"+d]=function(e){return function(g){return this._exist(e,g||"")}}(f);b["get"+d]=function(e){return function(g){return this._get(e,g||"")}}(f)})})(c.Collection.fn.stack);c.Collection.fn._setOne=function(a,
b,d){a=c.isExist(a)?a.toString():"";b=b===undefined?"":b;d=d||"";var f=this.getActiveParam("context").toString();if(!a&&!f)return d&&d!==this.ACTIVE?this._push("collection",d,b):this._update("collection",b);nimble.byLink(this._get("collection",d),f+nimble.CHILDREN+a,b);return this};c.Collection.fn._getOne=function(a,b){a=c.isExist(a)?a.toString():"";return nimble.byLink(this._get("collection",b||""),this.getActiveParam("context").toString()+nimble.CHILDREN+a)};c.Collection.fn.add=function(a,b,d,f,
e){a=a!==undefined?a:"";b=b||"push";e=e||false;var g,j,h;g=nimble.byLink(this._get("collection",d||""),this.getActiveParam("context").toString());if(typeof g==="object"){h=c.isPlainObject(g);if(f){a=c.isExist(a)?a.toString():"";j=nimble.byLink(this._get("collection",f||""),a);if(h===true){b=b==="push"?this.length(g):b==="unshift"?this.length(g)+nimble.METHOD_SEPARATOR+"unshift":b;h=nimble.addElementToObject(g,b.toString(),j)}else{h=true;g[b](j)}e===true&&this.disable("context")._removeOne(a,f).enable("context")}else if(h===
true){b=b==="push"?this.length(g):b==="unshift"?this.length(g)+nimble.METHOD_SEPARATOR+"unshift":b;h=nimble.addElementToObject(g,b.toString(),a)}else{h=true;g[b](a)}if(h!==true)this._setOne("",h,d||"")}else throw Error("unable to set property!");return this};c.Collection.fn.push=function(a,b){return this.add(a,"",b||"")};c.Collection.fn.unshift=function(a,b){return this.add(a,"unshift",b||"")};c.Collection.fn._removeOne=function(a,b){a=c.isExist(a)?a.toString():"";var d=this.getActiveParam("context").toString();
!a&&!d?this._setOne("",null):nimble.byLink(this._get("collection",b||""),d+nimble.CHILDREN+a,"",true);return this};c.Collection.fn._remove=function(a,b){b=b||"";var d,f;if(c.isPlainObject(a))for(d in a){if(a.hasOwnProperty(d))if(c.isArray(a[d]))for(f=a[d].length;(f-=1)>-1;)this._removeOne(a[d][f],d);else this._removeOne(a[d],d)}else if(c.isArray(a))for(f=a.length;(f-=1)>-1;)this._removeOne(a[f],b);else this._removeOne(a,b);return this};c.Collection.fn.pop=function(a){return this._removeOne("eq(-1)",
a||"")};c.Collection.fn.shift=function(a){return this._removeOne("eq(0)",a||"")};c.Collection.fn.concat=function(a,b,d){b=c.isExist(b)?b.toString():"";d=d||"";var f=nimble.byLink(this._get("collection",d),this.getActiveParam("context").toString()+nimble.CHILDREN+b);if(typeof f==="object")if(c.isPlainObject(f))c.extend(true,f,a);else{if(c.isArray(f))if(c.isArray(a)){f=Array.prototype.concat(f,a);this._setOne(b,f,d)}else this.add(a,"push",d)}else throw Error("incorrect data type!");return this};c.Collection.fn.length=
function(a,b){a=c.isExist(a)&&a!==true?a:this.getActiveParam("filter");var d=this.dObj,f,e,g,j,h;if(!c.isFunction(a))if(c.isString(a)&&!c.isExist(b)||c.isArray(a)||c.isPlainObject(a)){b=a;a=false}if(!b||b===this.ACTIVE)f=d.active.collection;else if(c.isString(b))f=d.sys.tmpCollection[b];else{g=true;f=b}if(f===null)return 0;if(g!==true)f=nimble.byLink(f,this.getActiveParam("context").toString());e=f.length;if(c.isString(f))return e;if(typeof f==="object")if(a===false&&e!==undefined)h=e;else{h=0;if(e!==
undefined)f.forEach(function(k,l){if(this.customFilter(a,k,f,l,e||null,this,b?b:this.ACTIVE)===true)h+=1},this);else for(j in f)if(f.hasOwnProperty(j))if(this.customFilter(a,f[j],f,j,e||null,this,b?b:this.ACTIVE)===true)h+=1}else throw Error("incorrect data type!");return h};c.Collection.fn.forEach=function(a,b,d,f,e,g,j){a=c.isFunction(a)?{filter:a}:a;b=c.isExist(b)&&b!==true?b:this.getActiveParam("filter");d=c.isExist(d)?d:this.ACTIVE;if(c.isBoolean(d)){j=g;g=e;e=f;f=d;d=this.ACTIVE}f=f===false?
false:true;e=parseInt(e)>=0?parseInt(e):false;g=parseInt(g)||false;j=parseInt(j)||false;var h,k,l,m=0,n=false,o;h=nimble.byLink(this._get("collection",d),this.getActiveParam("context").toString());k=this.length(h);if(c.isArray(h)){l=j!==false?h.slice(j):h;l.some(function(p,r){r+=j;if(e!==false&&m===e)return true;if(this.customFilter(b,p,h,r,k,this,d)===true)if(g!==false&&g!==0)g-=1;else{if(a.filter)n=a.filter.call(a.filter,p,h,r,k,this,d)===false;if(f===false)n=true;m+=1}else if(a.denial&&(g===false||
g===0)){o=a.denial.call(a.denial,p,h,r,k,this,d);if(n===false&&o===false)n=true}if(a.full&&(g===false||g===0)){o=a.full.call(a.full,p,h,r,k,this,d);if(n===false&&o===false)n=true}if(n===true)return true;o=""},this)}else for(l in h){if(h.hasOwnProperty(l)){if(e!==false&&m===e)break;if(j!==false&&j!==0){j-=1;continue}if(this.customFilter(b,h[l],h,l,k,this,d)===true)if(g!==false&&g!==0)g-=1;else{if(a.filter)n=a.filter.call(a.filter,h[l],h,l,k,this,d)===false;if(f===false)n=true;m+=1}}else if(a.denial&&
(g===false||g===0)){o=a.denial.call(a.denial,h[l],h,l,k,this,d);if(n===false&&o===false)n=true}if(a.full&&(g===false||g===0)){o=a.full.call(a.full,h[l],h,l,k,this,d);if(n===false&&o===false)n=true}if(n===true)break;o=""}return this};c.Collection.fn.search=function(a,b,d,f,e,g){a=c.isExist(a)&&a!==true?a:this.getActiveParam("filter");b=c.isExist(b)?b:this.ACTIVE;if(c.isBoolean(b)){g=e;e=f;f=d;d=b;b=this.ACTIVE}d=d===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||
false;var j=d===true?[]:-1;this.forEach(function(h,k,l){if(d===true)j.push(l);else j=l;return true},a,b,d,f,e,g);return j};c.Collection.fn.searchOne=function(a,b){return this.search(c.isExist(a)?a:"",b||"",false)};c.Collection.fn.indexOf=function(a,b,d){d=d||"";b=b||"";var f=nimble.byLink(this._get("collection",d),this.getActiveParam("context").toString());if(c.isArray(f)&&f.indexOf){if(b)return f.indexOf(a,b);return f.indexOf(a)}else return this.search(function(e){return e===a},d,false,"","",b)};
c.Collection.fn.lastIndexOf=function(a,b,d){d=d||"";b=b||"";var f=nimble.byLink(this._get("collection",d),this.getActiveParam("context").toString());if(c.isArray(f)&&f.lastIndexOf){if(b)return f.lastIndexOf(a,b);return f.lastIndexOf(a)}else{b=this.search(function(e){return e===a},d,"","","",b);return b[b.length-1]!==undefined?b[b.length-1]:-1}};c.Collection.fn.get=function(a,b,d,f,e,g){if(c.isNumeric(a)||arguments.length<2&&c.isString(a)&&!this.filterTest(a)||arguments.length===0||arguments.length<
2&&a===null)return this._getOne(a,b||"");a=c.isExist(a)&&a!==true?a:this.getActiveParam("filter");b=c.isExist(b)?b:this.ACTIVE;if(c.isBoolean(b)){g=e;e=f;f=d;d=b;b=this.ACTIVE}d=d===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||false;var j=d===true?[]:-1;this.forEach(function(h,k,l){if(d===true)j.push(k[l]);else j=k[l];return true},a,b,d,f,e,g);return j};c.Collection.fn.getOne=function(a,b){return this.get(c.isExist(a)?a:"",b||"",false)};c.Collection.fn.set=
function(a,b,d,f,e,g,j){if(c.isNumeric(a)||arguments.length<3&&c.isString(a)&&!this.filterTest(a)||arguments.length===0||arguments.length<3&&a===null)return this._setOne(a,b,d||"");a=c.isExist(a)&&a!==true?a:this.getActiveParam("filter");d=c.isExist(d)?d:this.ACTIVE;if(c.isBoolean(d)){j=g;g=e;e=f;f=d;d=this.ACTIVE}f=f===false?false:true;e=parseInt(e)>=0?parseInt(e):false;g=parseInt(g)||false;j=parseInt(j)||false;var h=c.isFunction(b);this.forEach(function(k,l,m,n,o,p){l[m]=h?b.call(b,k,l,m,n,o,p):
nimble.expr(b,l[m]);return true},a,d,f,e,g,j);return this};c.Collection.fn.setOne=function(a,b,d){return this.set(c.isExist(a)?a:"",b,d||"",false)};c.Collection.fn.map=function(a,b){return this.set(true,a,b||"")};c.Collection.fn.move=function(a,b,d,f,e,g,j,h,k,l){a=c.isExist(a)&&a!==true?a:this.getActiveParam("filter");l=l===false?false:true;b=c.isExist(b)?b.toString():"";d=d||"";f=f||"";e=e||"push";g=g===false?false:true;j=parseInt(j)>=0?parseInt(j):false;h=parseInt(h)||false;k=parseInt(k)||false;
var m=[],n=c.isArray(nimble.byLink(this._get("collection",f),this.getActiveParam("context").toString()));this.disable("context");a=this.search(a,d,g,j,h,k);this.enable("context");if(g===true)a.forEach(function(o){this.add(b+nimble.CHILDREN+o,n===true?e:o+nimble.METHOD_SEPARATOR+e,f,d);l===true&&m.push(o)},this);else{this.add(b+nimble.CHILDREN+a,n===true?e:a+nimble.METHOD_SEPARATOR+e,f,d);l===true&&m.push(a)}l===true&&this.disable("context")._remove(m,d).enable("context");return this};c.Collection.fn.moveOne=
function(a,b,d,f,e){return this.move(c.isExist(a)?a:"",c.isExist(b)?b.toString():"",d||"",f||"",e||"",false)};c.Collection.fn.copy=function(a,b,d,f,e,g,j,h,k){g=g===false?false:true;j=parseInt(j)>=0?parseInt(j):false;h=parseInt(h)||false;k=parseInt(k)||false;return this.move(c.isExist(a)?a:"",c.isExist(b)?b.toString():"",d||"",f||"",e||"push",g,j,h,k,false)};c.Collection.fn.copyOne=function(a,b,d,f,e){return this.move(c.isExist(a)?a:"",c.isExist(b)?b.toString():"",d||"",f||"",e||"",false,"","","",
false)};c.Collection.fn.remove=function(a,b,d,f,e,g){if(c.isNumeric(a)||arguments.length<2&&c.isString(a)&&!this.filterTest(a)||arguments.length===0||arguments.length<2&&a===null)return this._removeOne(a,b||"");else if(c.isArray(a)||c.isPlainObject(a))return this._remove(a,b||"");a=c.isExist(a)&&a!==true?a:this.getActiveParam("filter");b=c.isExist(b)?b:this.ACTIVE;if(c.isBoolean(b)){g=e;e=f;f=d;d=b;b=this.ACTIVE}d=d===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||
false;var j=this.search(a,b,d,f,e,g),h;if(d===false)this._removeOne(j,b);else for(h=j.length;(h-=1)>-1;)this._removeOne(j[h],b);return this};c.Collection.fn.removeOne=function(a,b){return this.remove(c.isExist(a)?a:"",b||"",false)};c.Collection.fn.customFilter=function(a,b,d,f,e,g,j){var h=this.dObj,k=h.active;h=h.sys;var l,m,n,o=true,p,r,s,q=-1;if(a===false)return true;if(c.isFunction(a))return a.call(a,b,d,f,e,g,j);if(!a||c.isString(a)&&c.trim(a)===this.ACTIVE){if(k.filter){if(c.isFunction(k.filter))return k.filter.call(k.filter,
b,d,f,e,g,j);return this.customFilter(k.filter,b,d,f,e,g,j)}return true}else{if(!c.isArray(a)){if(a.search(/\|\||&&|!/)===-1){if(a.search(/^\s*=/)!==-1){n=new Function("el","data","i","cOLength","self","id","var key = i; return "+a.replace(/^\s*=/,"")+";");return n.call(n,b,d,f,e,g,j)}if(c.isFunction(h.tmpFilter[a]))return h.tmpFilter[a].call(h.tmpFilter[a],b,d,f,e,g,j);return this.customFilter(h.tmpFilter[a],b,d,f,e,g,j)}a=c.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g,
" $1 ").replace(/(!)\s*/g,"$1")).split(" ")}m=function(t,w){for(var u=-1,y=t.length,v=0,x=[];(u+=1)<y;){w+=1;if(t[u]==="(")v+=1;if(t[u]===")")if(v===0)return{result:x,iter:w};else v-=1;x.push(t[u])}};for(l=a.length;(q+=1)<l;)if(a[q]==="("||a[q]==="!("){if(a[q].substring(0,1)==="!"){s=true;a[q]=a[q].substring(1)}else s=false;n=m(a.slice(q+1),q);q=n.iter;n=this.customFilter(n.result,b,d,f,e,g,j);o=!p&&!r?s===true?!n:n:p?s===true?!n:n&&o:s===true?!n:n||o}else if(a[q]!==")"&&a[q]!=="||"&&a[q]!=="&&"){if(a[q].substring(0,
1)==="!"){s=true;a[q]=a[q].substring(1)}else s=false;n=a[q]===this.ACTIVE?k.filter:h.tmpFilter[a[q]];n=n.call(n,b,d,f,e,g,j);o=!p&&!r?s===true?!n:n:p?s===true?!n:n&&o:s===true?!n:n||o}else if(a[q]==="||"){p=false;r=true}else if(a[q]==="&&"){r=false;p=true}return o}};c.Collection.fn.customParser=function(a,b){var d=this.dObj,f=d.active,e=d.sys,g;if(a===false)return b;if(c.isFunction(a))return a.call(a,b,this);if(!a||c.isString(a)&&c.trim(a)===this.ACTIVE){if(f.parser)return f.parser.call(f.parser,
b,this)}else{if(c.isString(a)){a=c.trim(a);if(a.search("&&")===-1)return e.tmpParser[a].call(e.tmpParser[a],b,this);a=a.split("&&")}a.forEach(function(j){j=c.trim(j);g=j===this.ACTIVE?f.parser:e.tmpParser[j];b=g.call(g,b,this)},this)}return b};c.Collection.fn.parentContext=function(a,b){a=a||1;var d="",f;d=this._get("collection",b||"").split(nimble.CHILDREN);for(f=a;(f-=1)>-1;)d.splice(-1,1);return d.join(nimble.CHILDREN)};c.Collection.fn.parent=function(a,b){var d=this.dObj,f=d.sys;d=d.active;var e=
f.contextID,g=this.parentContext.apply(this,arguments);if(!b||b===this.ACTIVE){if(e)f.tmpContext[e]=g;d.context=g}else{f.tmpContext[b]=g;if(e&&b===e)d.context=g}return this};c.Collection.fn.orderBy=function(a,b,d,f){a=a||null;b=b||false;d=d?d===false?null:d:function(h){if(isNaN(h))return h.toUpperCase();return h};f=f||"";var e,g=function(h){var k=[],l={},m;for(m in h)h.hasOwnProperty(m)&&k.push(m);k.sort(statObj.sort.sortBy(a,b,d));for(m in k)if(k.hasOwnProperty(m))l[k[m]]=h[k[m]];return l},j=function(h){var k=
[],l={},m;for(m in h)h.hasOwnProperty(m)&&k.push({key:m,value:h[m]});k.sort(statObj.sort.sortBy(a===true?"value":"value"+statObj.obj.contextSeparator+a,b,d));for(m in k)if(k.hasOwnProperty(m))l[k[m].key]=k[m].value;return l};e=nimble.byLink(this._get("collection",f),this.getActiveParam("context").toString());if(typeof e==="object")if(c.isArray(e))e.sort(c.Collection.sort.sortBy(a,b,d));else{e=a?j.call(this,e):g.call(this,e);this._setOne("",e,f||"")}else throw Error("incorrect data type!");return this};
c.Collection.fn.toString=function(a,b,d){if(a&&(c.isArray(a)||c.isPlainObject(a))){if(JSON&&JSON.stringify)return JSON.stringify(a,b||"",d||"");throw Error("object JSON is not defined!");}a=nimble.byLink(this._get("collection",a||""),this.getActiveParam("context").toString());if(JSON&&JSON.stringify)return JSON.stringify(a,b||"",d||"");throw Error("object JSON is not defined!");};c.Collection.fn.valueOf=function(){return this.length(this.ACTIVE)};c.Collection.fn.then=function(a,b){var d=this;arguments.length===
1?c.when(d.active("defer")).always(function(){a.apply(d,arguments)}):c.when(d.active("defer")).then(function(){a().apply(d,arguments)},function(){b().apply(d,arguments)});return this};c.Collection.fn.print=function(a,b,d){b=b||false;d=d||false;var f=this.dObj.active,e={},g,j,h=0,k=null,l="",m;if(c.isExist(a)&&(c.isString(a)||c.isNumeric(a)))a={page:a};else if(c.isBoolean(a))b=a;else c.isExist(a)||(a={page:f.page});c.extend(true,e,f,a);if(a)e.page=nimble.expr(e.page,f.page||"");if(e.page<1)e.page=
1;e.collection=c.isString(e.collection)?this._get("collection",e.collection):e.collection;e.template=c.isString(e.template)?this._get("template",e.template):e.template;e.filter=c.isExist(a.filter)&&a.filter!==true?a.filter:this.getActiveParam("filter");e.parser=c.isExist(a.parser)?a.parser:this.getActiveParam("parser");if(d===true)e.cache.iteration=false;d=f.page-e.page;this.updatePage(e.page);m=function(n,o,p,r,s,q){e.callback&&e.callback.apply(this,arguments);l+=e.template.call(e.template,n,o,p,
r,s,q);h=p;return true};a=nimble.byLink(e.collection,this.getActiveParam("context").toString()+nimble.CHILDREN+(a&&a.context||""));g=this.length();e.numberBreak=!b||e.numberBreak===false?g:e.numberBreak;if(c.isPlainObject(a)||e.cache.iteration===false||e.cache.firstIteration===false||e.cache.lastIteration===false){j=!b||e.page===1?0:(e.page-1)*e.numberBreak;this.forEach(m,e.filter,this.ACTIVE,true,e.numberBreak,j);if(e.cache.iteration===false)e.cache.lastIteration=false}else if(c.isArray(a)&&e.cache.iteration===
true){j=!b||e.filter===false?e.page===1?0:(e.page-1)*e.numberBreak:e.cache.iteration===true?d>=0?e.cache.firstIteration:e.cache.lastIteration:i;if(d>0&&b===true&&e.filter!==false){for(d*=e.numberBreak;(j-=1)>-1;)if(this.customFilter(e.filter,a[j],a,j,g,this,this.ACTIVE)===true)if(h===d)break;else h+=1;e.cache.lastIteration=j+=1;k=null}else if(d<0&&b===true&&e.filter!==false)k=Math.abs(d)*e.numberBreak-e.numberBreak||null;this.forEach(m,e.filter,this.ACTIVE,true,e.numberBreak,k,j)}if(d!==0&&e.cache.iteration!==
false){f.cache.firstIteration=e.cache.lastIteration;f.cache.lastIteration=h+1}if(e.cache.autoIteration===true)f.cache.iteration=true;l=!l?e.resultNull:this.customParser(e.parser,l);if(e.target===false){e.variable?this._push("variable",e.variable,l):this._$("variable",l);return this}else e.target[e.appendType](l);if(!b)return this;e.nmbOfEntries=e.filter!==false?this.length(e.filter):g;e.nmbOfEntriesInPage=e.target.find(e.calculator).length;e.finNumber=e.numberBreak*e.page-(e.numberBreak-e.nmbOfEntriesInPage);
e.page!==1&&e.nmbOfEntriesInPage===0?this.updatePage(e.page-=1).print(e,true,true):this.easyPage(e);return this};c.Collection.fn.easyPage=function(a){var b="",d=a.nmbOfEntries%a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak,f=function(k,l,m){var n,o="<"+(k.tag||"span")+' data-page="'+m+'"';if(k.attr)for(n in k.attr)if(k.attr.hasOwnProperty(n))o+=" "+n+'="'+k.attr[n]+'"';if(m===a.page)o+=' class="'+(l&&l.active||"active")+'"';return o+(">"+m+"</"+(k.tag||"span")+">")},
e,g=0,j,h;a.pager.find("[data-ctm]").each(function(){if(a.pageBreak<=2)throw Error('parameter "pageBreak" must be more than 2');var k=c(this),l=k.data("ctm"),m=l.classes;if(l.nav){if(l.nav==="prev"&&a.page===1||l.nav==="next"&&a.finNumber===a.nmbOfEntries)k.addClass(m&&m.disabled||"disabled");else if(l.nav==="prev"||l.nav==="next")k.removeClass(m&&m.disabled||"disabled");if(l.nav==="pageList"){if(d>a.pageBreak){g=a.pageBreak%2!==0?1:0;h=j=(a.pageBreak-g)/2;if(a.page-g<j)j=0;else{j=a.page-j-g;if(a.page+
h>d)j-=a.page+h-d}e=j;for(g=-1;(e+=1)<=d&&(g+=1)!==null;){if(g===a.pageBreak&&e!==a.page)break;b+=f(l,m||"",e)}}else for(e=0;(e+=1)<=d;)b+=f(l,m||"",e);k.html(b)}}else if(l.info){a.nmbOfEntriesInPage===0?k.addClass(m&&m.noData||"noData"):k.removeClass(m&&m.noData||"noData");switch(l.info){case "page":k.html(a.page);break;case "total":k.html(a.nmbOfEntries);break;case "from":k.html((a.page-1)*a.numberBreak+1);break;case "to":k.html(a.finNumber);break;case "inPage":k.html(a.nmbOfEntriesInPage);break;
case "nmbOfPages":k.html(a.nmbOfPages)}}});return this};c.Collection.fn.genTable=function(a,b,d){a=a||4;b=b||"div";d=d===false?false:true;var f=1,e,g=this.dObj.active.target,j=g.find(b).length,h="";g.find(b).each(function(k){this.tagName!=="td"&&c(this).wrap("<td></td>");if(f===a){h="";for(e=-1;(e+=1)<a;){h+="td:eq("+(k-e)+")";if(e!==a-1)h+=","}g.find(h).wrapAll("<tr></tr>");f=0}else if(k===j-1&&f!==a){h="";for(e=-1;(e+=1)<f;){h+="td:eq("+(k-e)+")";if(e!==f-1)h+=","}f-=1;g.find(h).wrapAll("<tr></tr>");
if(d===true){for(h="";(f+=1)<a;)h+="<td></td>";g.find("tr:last").append(h)}}f+=1});g[0].tagName!=="table"&&g.children("tr").wrapAll("<table></table>");return this}})(jQuery);
//