/**
 * $.Collection
 * 
 * autor: kobezzza (kobezzza@gmail.com | http://kobezzza.com)
 * version: 3.1
 * date: 25.10.2011 16:03:41
 */
 (function(h){function x(a){return a<10?"0"+a:a}function E(a){F.lastIndex=0;return F.test(a)?'"'+a.replace(F,function(c){var b=G[c];return typeof b==="string"?b:"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function A(a,c){var b,d,e,f,g=u,j,k=c[a];if(k&&typeof k==="object"&&typeof k.toJSON==="function")k=k.toJSON(a);if(typeof v==="function")k=v.call(c,a,k);switch(typeof k){case "string":return E(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);
case "object":if(!k)return"null";u+=B;j=[];if(h.isArray(k)){f=k.length;for(b=0;b<f;b++)j[b]=A(b,k)||"null";e=j.length===0?"[]":u?"[\n"+u+j.join(",\n"+u)+"\n"+g+"]":"["+j.join(",")+"]";u=g;return e}if(v&&typeof v==="object"){f=v.length;for(b=0;b<f;b++)if(typeof v[b]==="string"){d=v[b];if(e=A(d,k))j.push(E(d)+(u?": ":":")+e)}}else for(d in k)if(Object.prototype.hasOwnProperty.call(k,d))if(e=A(d,k))j.push(E(d)+(u?": ":":")+e);e=j.length===0?"{}":u?"{\n"+u+j.join(",\n"+u)+"\n"+g+"}":"{"+j.join(",")+"}";
u=g;return e}}h.Collection=function(a,c){a=a||null;c=c||null;if(this.fn&&this.fn.jquery)return new h.Collection(a,c);h.extend(true,this,h.Collection.storage);var b=this.dObj.prop;c&&h.extend(true,b,c);if(h.isString(a)){b.activeTarget=h(a);b.activeCollection=null}else b.activeCollection=a};h.Collection.cache={};h.Collection.cache.templateMode={};h.Collection.cache.obj={contextSeparator:"~",subcontextSeparator:"#",methodSeparator:"::",getByLink:function(a,c){c=c.toString().split(this.contextSeparator);
for(var b,d=0,e,f=0,g=c.length;d<g;d++){c[d]=h.trim(c[d]);if(c[d]&&c[d]!==this.subcontextSeparator)if(c[d].search(this.subcontextSeparator)===-1)a=a[c[d]];else{e=+c[d].replace(this.subcontextSeparator,"");if(h.isArray(a))a=e>=0?a[e]:a[a.length+e];else{if(e<0){f=0;for(b in a)a.hasOwnProperty(b)&&f++;e+=f}f=0;for(b in a)if(a.hasOwnProperty(b)){if(e===f){a=a[b];break}f++}}}}return a},setByLink:function(a,c,b){c=c.toString().split(this.contextSeparator);var d,e=0,f,g=0,j=c.length;for(e=j;e--;){c[e]=h.trim(c[e]);
if(c[e]===""||c[e]===this.subcontextSeparator)c.splice(e,1)}j=c.length-1;for(e=0;e<=j;e++)if(c[e].search(this.subcontextSeparator)===-1)if(e===j)a[c[e]]=b;else a=a[c[e]];else{f=+c[e].replace(this.subcontextSeparator,"");if(h.isArray(a))if(e===j)if(f>=0)a[f]=b;else a[a.length+f]=b;else a=f>=0?a[f]:a[a.length+f];else{if(f<0){g=0;for(d in a)a.hasOwnProperty(d)&&g++;f+=g}g=0;for(d in a)if(a.hasOwnProperty(d)){if(f===g){if(e===j)a[d]=b;else a=a[d];break}g++}}}return true},addElementToObject:function(a,
c,b){c=c.split(this.methodSeparator);var d,e={};if(c[1]&&c[1]=="unshift"){e[c[0]]=b;for(d in a)if(a.hasOwnProperty(d))e[d]=a[d];return e}else if(!c[1]||c[1]=="push")a[c[0]]=b;return true}};h.Collection.cache.sort={field:null,rev:false,shuffle:false,fn:null,sortBy:function(a,c,b){this.field=a||null;this.rev=c?c!=="shuffle"?c:false:false;this.shuffle=c?c==="shuffle"?c:false:false;this.fn=b||null;return this.sortHelper},sortHelper:function(a,c){var b=h.Collection.cache.sort,d=b.shuffle?Math.round(Math.random()*
2-1):b.rev?b.rev===true?-1:1:1;if(b.field){a=h.Collection.cache.obj.getByLink(a,b.field);c=h.Collection.cache.obj.getByLink(c,b.field)}if(b.fn){a=b.fn(a);c=b.fn(c)}if(b.shuffle)return d;else{if(a<c)return d*-1;if(a>c)return d;return 0}}};h.Collection.fn=h.Collection.prototype={name:"$.Collection",version:"3.1",collection:function(){return this.name+" "+this.version},active:"active",callee:function(a){return this.dObj.sys[(a||"filter")+"Callee"]}};h.Collection.cache.templateMode.simpleMode=function(a){a=
a||{};var c=a.collection?a.collection.Count:"",b=this.dObj,d=b.sys,e=b.css,f=b.viewVal,g=b.prop;b=a.page||g.activePage;var j=a.selectorOut||g.activeSelectorOut,k=h(a.pager||g.activePager);c=a.countRecords||d.countRecords||c||0;j=a.countRecordsInPage||d.countRecordsInPage||h(j,g.activeTarget).length;g=a.countBreak||g.activeCountBreak;a=a.countTotal||d.countTotal||g*b-(g-j);d=e.pageNumber;var m=e.pagePrev,l=e.pageDisablePrev,n=e.pageNext;e=e.pageDisableNext;var o=f.aPrev,r=f.aNext;f=f.from;var q;if(b===
1&&j===c)h("."+m+",."+l+",."+n+",."+e,k).addClass(e);else{if(a===c)h("."+n,k).replaceWith('<div class="'+e+'">'+r+"</div>");else{q=h("."+e,k);q.length===1?q.replaceWith('<a href="javascript:;" class="'+n+'" data-action="set/page/next">'+r+"</a>"):h("."+n,k).removeClass(e)}if(b===1)h("."+m,k).replaceWith('<div class="'+l+'">'+o+"</div>");else{l=h("."+l,k);l.length===1?l.replaceWith('<a href="javascript:;" class="'+m+'" data-action="set/page/prev">'+o+"</a>"):h("."+m,k).removeClass(e)}}j===0?h("."+
d,k).html(0):h("."+d,k).html((b-1)*g+1+"-"+a+" "+f+" "+c);return true};h.Collection.cache.templateMode.controlMode=function(a){a=a||{};var c=a.collection?a.collection.Count:"",b=this.dObj,d=b.sys,e=b.css,f=b.viewVal,g=b.prop;b=a.page||g.activePage;var j=a.selectorOut||g.activeSelectorOut,k=h(a.pager||g.activePager);c=a.countRecords||d.countRecords||c||0;var m=a.countRecordsInPage||d.countRecordsInPage||h(j,g.activeTarget).length;j=a.countBreak||g.activeCountBreak;d=a.countTotal||d.countTotal||j*b-
(j-m);m=c%j!==0?~~(c/j)+1:c/j;var l="",n=e.pageActive,o=e.pagingLeft,r=e.pagingRight,q=e.pageDisablePrev;e=e.pageDisableNext;var p=f.aPrev,s=f.aNext,t=f.show;f=f.total;if(m>(a.pageBreak||g.activePageBreak)){l+=b!==1?'<a href="javascript:;" data-action="set/page[1">'+p+"</a>":'<div class="'+q+'">'+p+"</div>";g=0;for(a=b-1;a++<m;g++){if(g===0&&b!==1)l+='<a href="javascript:;" data-action="set/page['+(a-1)+'">'+(a-1)+"</a>";if(g===j-1)break;l+=a===b?'<a href="javascript:;" class="'+n+'">'+a+"</a>":'<a href="javascript:;" data-action="set/page['+
a+'">'+a+"</a>"}l+=a!==m+1?'\t\t\t\t\t<a href="javascript:;" data-action="set/page['+(a+1)+'">'+(a+1)+'</a>\t\t\t\t\t<a href="javascript:;" data-action="set/page['+m+'">'+s+"</a>\t\t\t\t":'<div class="'+e+'">'+s+"</div>"}else for(a=0;a++<m;)l+=a===b?'<a href="javascript:;" class="'+n+'">'+a+"</a>":'<a href="javascript:;" data-action="set/page['+a+'">'+a+"</a>";if(c===0)h("."+o+",."+r,k).empty();else{h("."+r,k).html(l);h("."+o,k).html(f+": "+c+". "+t+": "+((b-1)*j+1)+"-"+d)}return true};h.Collection.storage=
{dObj:{prop:{activeCollection:null,activePage:1,activeTarget:null,activeTemplate:null,activeTemplateMode:h.Collection.cache.templateMode.simpleMode,activeCountBreak:10,activePageBreak:10,activeFilter:false,activeParser:false,activeSelectorOut:".SelectorOut",activePager:"#PageControl",activeResultNull:false,activeVar:null,activeContext:"",activeAppendType:"html",activeDefer:"",activeCache:{autoIteration:false,iteration:false,firstIteration:-1,lastIteration:-1},activeIndex:null,activeMap:null}}};h.Collection.storage.dObj.sys=
{countRecords:null,countRecordsInPage:null,countTotal:null,callbackCallee:null,filterCallee:null,templateCallee:null,templateModeCallee:null,parserCallee:null};(function(a){var c,b,d=h.Collection.storage.dObj.sys;for(c=a.length;c--;){b=a[c].substring(0,1).toLowerCase()+a[c].substring(1);d["active"+a[c]+"ID"]=null;d["tmp"+a[c]]={};d[b+"ChangeControl"]=null;d[b+"Back"]=[]}})(["Collection","Page","Target","Filter","Parser","Var","Template","TemplateMode","Context","CountBreak","PageBreak","Pager","SelectorOut",
"ResultNull","AppendType","Defer","Cache","Index","Map"]);h.Collection.storage.dObj.viewVal={aPrev:"&lt;&lt;",aNext:"&gt;&gt;",total:"Total",show:"Show",from:"From",noResultInSearch:"Nothing was found"};h.Collection.storage.dObj.css={pageNumber:"pageNumber",pagePrev:"pagePrev",pageDisablePrev:"pageDisablePrev",pageNext:"pageNext",pageDisableNext:"pageDisableNext",pageActive:"pageActive",pagingRight:"pagingRight",pagingLeft:"pagingLeft",noResult:"noResult"};h.Collection.fn._mod=function(a,c,b){var d=
this.dObj,e=d.prop,f=d.sys;d="active"+a;a=f["tmp"+a];f=f[d+"ID"];var g=function(j,k){if(h.isNumeric(j)||h.isString(j))j+=k;else if(h.isArray(j))j.push(k);else if(h.isBoolean(j))j=k===true&&j===true?false:true;return j};if(b&&b!==this.active){a[b]=g(a[b],c);if(f&&b===f)e[d]=a[b]}else{e[d]=g(e[d],c);if(f)a[f]=e[d]}return this};h.Collection.fn._push=function(a,c,b){var d=this.dObj.sys,e=d["tmp"+a];d=d["active"+a+"ID"];var f;if(h.isPlainObject(c))for(f in c){if(c.hasOwnProperty(f))if(f===this.active)throw Error("Invalid property name!");
else if(e[f]&&d&&d===f)this._update(a,c[f]);else e[f]=c[f]}else if(f===this.active)throw Error("Invalid property name!");else if(e[c]&&d&&d===c)this._update(a,b);else e[c]=b;return this};h.Collection.fn._set=function(a,c){var b=this.dObj,d=b.prop;b=b.sys;var e=a.substring(0,1).toLowerCase()+a.substring(1),f=e+"ChangeControl",g="active"+a,j=g+"ID";if(b[j]!==c){b[f]=true;b[j]=c}else b[f]=false;b[e+"Back"].push(c);d[g]=b["tmp"+a][c];return this};h.Collection.fn._back=function(a,c){var b=this.dObj,d=
b.prop;b=b.sys;var e=a.substring(0,1).toLowerCase()+a.substring(1),f="active"+a,g=b[e+"Back"];b[e+"ChangeControl"]=false;e=g.length-(c||1)-1;if(e>=0&&g[e])if(b["tmp"+a][g[e]]){b[f+"ID"]=g[e];d[f]=b["tmp"+a][g[e]];g.splice(e+1,g.length)}return this};h.Collection.fn._backIf=function(a){if(this.dObj.sys[a.substring(0,1).toLowerCase()+a.substring(1)+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};h.Collection.fn._drop=function(a,c,b){b=b===undefined?false:b;var d=this.dObj,
e=d.prop;d=d.sys;var f="active"+a,g=f+"ID";a="tmp"+a;var j=d[g];c=!c?j?[j]:[]:h.isArray(c)||h.isPlainObject(c)?c:[c];var k;if(c[0]&&c[0]!==this.active)for(k in c){if(c.hasOwnProperty(k))if(!c[k]||c[k]===this.active){j&&delete d[a][j];d[g]=null;e[f]=b}else{delete d[a][c[k]];if(j&&c[k]===j){d[g]=null;e[f]=b}}}else{j&&delete d[a][j];d[g]=null;e[f]=b}return this};h.Collection.fn._reset=function(a,c,b){b=b===undefined?false:b;var d=this.dObj,e=d.prop;d=d.sys;var f="active"+a;a="tmp"+a;var g=d[f+"ID"];
c=!c?g?[g]:[]:h.isArray(c)||h.isPlainObject(c)?c:[c];var j;if(c[0]&&c[0]!==this.active)for(j in c){if(c.hasOwnProperty(j))if(!c[j]||c[j]===this.active){if(g)d[a][g]=b;e[f]=b}else{d[a][c[j]]=b;if(g&&c[j]===g)e[f]=b}}else{if(g)d[a][g]=b;e[f]=b}return this};h.Collection.fn._resetTo=function(a,c,b){var d=this.dObj;return this._reset(a,c||"",!b||b===this.active?d.prop["active"+a]:d.sys["tmp"+a][b])};h.Collection.fn._exist=function(a,c){var b=this.dObj;if((!c||c===this.active)&&b.sys["active"+a+"ID"])return true;
if(b.sys["tmp"+a][c]!==undefined)return true;return false};h.Collection.fn._is=function(a,c){if(c===this.dObj.sys["active"+a+"ID"])return true;return false};h.Collection.fn.use=function(a){this._exist("Collection",a)&&this._set("Collection",a);this._exist("Page",a)&&this._set("Page",a);this._exist("Target",a)&&this._set("Target",a);this._exist("Template",a)&&this._set("Template",a);this._exist("TemplateMode",a)&&this._set("TemplateMode",a);this._exist("Filter",a)&&this._set("Filter",a);this._exist("Parser",
a)&&this._set("Parser",a);this._exist("Var",a)&&this._set("Var",a);this._exist("Context",a)&&this._set("Context",a);this._exist("CountBreak",a)&&this._set("CountBreak",a);this._exist("PageBreak",a)&&this._set("PageBreak",a);this._exist("SelectorOut",a)&&this._set("SelectorOut",a);this._exist("ResultNull",a)&&this._set("ResultNull",a);this._exist("AppendType",a)&&this._set("AppendType",a);this._exist("Defer",a)&&this._set("Defer",a);this._exist("Cache",a)&&this._set("Cache",a);return this};h.Collection.fn._$=
function(a,c){var b=this.dObj,d="active"+a;b.prop[d]=c;b.sys[d+"ID"]=null;return this};h.Collection.fn._update=function(a,c){var b=this.dObj,d=b.prop;b=b.sys;var e="active"+a,f=b[e+"ID"];d[e]=c;if(f)b["tmp"+a][f]=d[e];return this};h.Collection.fn._get=function(a,c){var b=this.dObj;if(c&&c!==this.active)return b.sys["tmp"+a][c];return b.prop["active"+a]};h.Collection.fn._prop=function(a,c,b){var d=this.dObj[a];if(arguments.length!==3)if(h.isPlainObject(c))h.extend(d,c);else return d[c];else d[c]=b;
return this};h.Collection.fn.prop=function(){return this._prop.apply(this,h.unshiftArguments(arguments,"prop"))};h.Collection.fn.css=function(){return this._prop.apply(this,h.unshiftArguments(arguments,"css"))};h.Collection.fn.viewVal=function(){return this._prop.apply(this,h.unshiftArguments(arguments,"viewVal"))};(function(a){var c,b=h.Collection.fn,d;for(c=a.length;c--;){d=a[c]!=="Collection"?a[c]:"";b["$"+d]=function(e){return function(f){return this._$(e,f)}}(a[c]);if(a[c]==="Context")b["mod"+
d]=function(e){return function(){return this._mod.apply(this,h.unshiftArguments(arguments,e))}}(a[c]);b["update"+d]=function(e){return function(f){return this._update(e,f)}}(a[c]);b["reset"+d+"To"]=function(e){return function(f,g){return this._resetTo(e,f,g)}}(a[c]);b["push"+d]=function(e){return function(){return this._push.apply(this,h.unshiftArguments(arguments,e))}}(a[c]);b["set"+d]=function(e){return function(f){return this._set(e,f)}}(a[c]);b["pushSet"+d]=function(e){return function(f,g){return this._push(e,
f,g)._set(e,f)}}(a[c]);b["back"+d]=function(e){return function(f){return this._back(e,f||"")}}(a[c]);b["back"+d+"If"]=function(e){return function(f){return this._backIf(e,f||"")}}(a[c]);b["drop"+d]=a[c]==="Filter"||a[c]==="Parser"?function(e){return function(){return this._drop(e,arguments)}}(a[c]):function(e){return function(){return this._drop(e,arguments,null)}}(a[c]);if(a[c]==="Filter"||a[c]==="Parser")b["reset"+d]=function(e){return function(){return this._reset(e,arguments)}}(a[c]);else if(a[c]===
"Page")b["reset"+d]=function(e){return function(){return this._reset(e,arguments,1)}}(a[c]);else if(a[c]==="Context")b["reset"+d]=function(e){return function(){return this._reset(e,arguments,"")}}(a[c]);b["is"+d]=function(e){return function(f){return this._is(e,f)}}(a[c]);b["exist"+d]=function(e){return function(f){return this._exist(e,f||"")}}(a[c]);b["get"+d]=function(e){return function(f){return this._get(e,f||"")}}(a[c])}})(["Collection","Page","Target","Filter","Parser","Var","Template","TemplateMode",
"Context","CountBreak","PageBreak","Pager","SelectorOut","ResultNull","AppendType","Defer","Cache","Index","Map"]);h.Collection.fn.setElement=function(a,c,b){a=h.isExist(a)?a.toString():"";var d=h.Collection.cache.obj,e=this.dObj,f=e.prop;f.activeContext=f.activeContext.toString();if(!a&&!f.activeContext)return b&&b!==this.active?this._push("Collection",b,c):this._update("Collection",c);d.setByLink(b&&b!==this.active?e.sys.tmpCollection[b]:f.activeCollection,f.activeContext+d.contextSeparator+a,c);
return this};h.Collection.fn.getElement=function(a,c){var b=h.Collection.cache.obj,d=this.dObj,e=d.prop;return b.getByLink(c&&c!==this.active?d.sys.tmpCollection[c]:e.activeCollection,e.activeContext+b.contextSeparator+(a!==undefined?a:""))};h.Collection.fn.addElement=function(a,c,b,d,e){a=a!==undefined?a:"";c=c||"push";e=e===true?true:false;var f=h.Collection.cache.obj,g=this.dObj,j=g.prop;g=g.sys;var k,m;k=f.getByLink(b&&b!==this.active?g.tmpCollection[b]:j.activeCollection,j.activeContext);if(typeof k===
"object"){m=h.isPlainObject(k);if(d){a=h.isExist(a)?a.toString():"";j=f.getByLink(d===this.active?j.activeCollection:g.tmpCollection[d],a);if(m===true){c=c==="push"?this.length(k):c==="unshift"?this.length(k)+f.methodSeparator+"unshift":c;f=f.addElementToObject(k,c.toString(),j)}else{f=true;if(c==="push")k.push(j);else c==="unshift"&&k.unshift(j)}if(e===true){if(g.activeContextID){c=g.activeContextID;e=true}else{c=this._get("Context");e=false}this._$("Context","");d===this.active?this.deleteElementByLink(a):
this.deleteElementByLink(a,d);e===true?this._set("Context",c):this._$("Context",c)}}else if(m===true){c=c==="push"?this.length(k):c==="unshift"?this.length(k)+f.methodSeparator+"unshift":c;f=f.addElementToObject(k,c.toString(),a)}else{f=true;if(c==="push")k.push(a);else c==="unshift"&&k.unshift(a)}if(f!==true)this.setElement("",f,b||"")}else throw Error("Unable to set property!");return this};h.Collection.fn.deleteElementByLink=function(a,c){a=h.isExist(a)?a.toString():"";var b=h.Collection.cache.obj,
d=this.dObj,e=d.prop,f,g=0;g=0;e.activeContext=e.activeContext.toString();if(!a&&!e.activeContext)this.setElement("",null);else{a=(e.activeContext+b.contextSeparator+a).split(b.contextSeparator);for(g=a.length;g--;){a[g]=h.trim(a[g]);if(a[g]===""||a[g]===b.subcontextSeparator)a.splice(g,1)}a=a.join(b.contextSeparator);d=b.getByLink(c&&c!=="active"?d.sys.tmpCollection[c]:e.activeCollection,a.replace(RegExp("[^"+b.contextSeparator+"]+$"),""));a=a.replace(RegExp(".*?([^"+b.contextSeparator+"]+$)"),"$1");
if(h.isArray(d)){a=+a.replace(b.subcontextSeparator,"");a>=0?d.splice(a,1):d.splice(d.length+a,1)}else if(a.search(b.subcontextSeparator)===-1)delete d[a];else{b=+a.replace(b.subcontextSeparator,"");if(b<0){g=0;for(f in d)d.hasOwnProperty(f)&&g++;b+=g}g=0;for(f in d)if(d.hasOwnProperty(f)){if(b===g){delete d[f];break}g++}}}return this};h.Collection.fn.deleteElementsByLink=function(a,c){var b,d;if(h.isPlainObject(a))for(b in a){if(a.hasOwnProperty(b))if(h.isArray(a[b]))for(d=a[b].length;d--;)this.deleteElementByLink(a[b][d],
b);else this.deleteElementByLink(a[b],b)}else if(h.isArray(a))for(d=a.length;d--;)this.deleteElementByLink(a[d],c||"");else this.deleteElementByLink(a,c||"");return this};h.Collection.fn.concat=function(a,c,b){c=h.isExist(c)?c.toString():"";var d=h.Collection.cache.obj,e=this.dObj,f=e.prop;d=d.getByLink(b&&b!==this.active?e.sys.tmpCollection[b]:f.activeCollection,f.activeContext+d.contextSeparator+c);if(typeof d==="object")if(h.isPlainObject(d))h.extend(true,d,a);else{if(h.isArray(d))if(h.isArray(a)){d=
Array.prototype.concat(d,a);this.setElement(c,d,b||"")}else this.addElement(a,"push",b||"")}else throw Error("Incorrect data type!");return this};h.Collection.fn.length=function(a,c){a=h.isExist(a)?a:false;var b=this.dObj,d=b.prop,e,f,g;if(!h.isFunction(a))if(h.isString(a)&&!h.isExist(c)||h.isArray(a)||h.isPlainObject(a)){c=a;a=false}if(!c||c===this.active)b=d.activeCollection;else if(h.isString(c))b=b.sys.tmpCollection[c];else{e=true;b=c}if(e!==true)b=h.Collection.cache.obj.getByLink(b,d.activeContext);
if(b===null)return 0;d=b.length;if(h.isString(b))return d;if(typeof b==="object")if(a===false&&d!==undefined)g=d;else{g=0;for(f in b)if(b.hasOwnProperty(f)&&(a===false||this.customFilter(a,b,f,d||null,this,e===true?"array":c?c:this.active))===true)g++}else throw Error("Incorrect data type!");return g};h.Collection.fn.each=function(a,c,b,d,e,f,g){c=c||false;b=h.isExist(b)?b:this.active;if(h.isBoolean(b)){g=f;f=e;e=d;d=b;b=this.active}d=d===false?false:true;e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||
false;g=parseInt(g)||false;var j=this.dObj,k=j.prop,m=j.sys,l,n=0;j.sys.callbackCallee=a;if(a.before)if(a.before.apply(this,arguments)===false)return this;j=h.Collection.cache.obj.getByLink(b!==this.active?m.tmpCollection[b]:k.activeCollection,k.activeContext);k=this.length(j);if(h.isArray(j)){m=k-1;for(l=g!==false?g-1:-1;l++<m;){if(e!==false&&n===e)break;if(a.beforeFilter)if(a.beforeFilter(j,l,k,this,b)===false)return this;if(c===false||this.customFilter(c,j,l,k,this,b)===true){if(f!==false&&f!==
0){f--;continue}if(a.call(this,j,l,k,this,b)===false)break;if(d===false)break;n++}if(a.afterFilter)if(a.afterFilter(j,l,k,this,b)===false)return this}}else for(l in j)if(j.hasOwnProperty(l)){if(e!==false&&n===e)break;if(g!==false&&g!==0)g--;else{if(a.beforeFilter)if(a.beforeFilter(j,l,k,this,b)===false)return this;if(c===false||this.customFilter(c,j,l,k,this,b)===true){if(f!==false&&f!==0){f--;continue}if(a.call(this,j,l,k,this,b)===false)break;if(d===false)break;n++}if(a.afterFilter)if(a.afterFilter(j,
l,k,this,b)===false)return this}}a.after&&a.after.apply(this,arguments);return this};h.Collection.fn.searchElements=function(a,c,b,d,e,f){a=a||false;c=h.isExist(c)?c:this.active;if(h.isBoolean(c)){f=e;e=d;d=b;b=c;c=this.active}b=b===false?false:true;d=parseInt(d)>=0?parseInt(d):false;e=parseInt(e)||false;f=parseInt(f)||false;var g=[];this.each(function(j,k){if(b===true)g.push(k);else{g=k;return false}return true},a,c,b,d,e,f);return g};h.Collection.fn.searchElement=function(a,c){return this.searchElements(a||
"",c||"",false)};h.Collection.fn.returnElements=function(a,c,b,d,e,f){a=a||false;c=h.isExist(c)?c:this.active;if(h.isBoolean(c)){f=e;e=d;d=b;b=c;c=this.active}b=b===false?false:true;d=parseInt(d)>=0?parseInt(d):false;e=parseInt(e)||false;f=parseInt(f)||false;var g=[];this.each(function(j,k){if(b===true)g.push(j[k]);else{g=j[k];return false}return true},a,c,b,d,e,f);return g};h.Collection.fn.returnElement=function(a,c){return this.returnElements(a||"",c||"",false)};h.Collection.fn.replaceElements=
function(a,c,b,d,e,f,g){a=a||false;b=h.isExist(b)?b:this.active;if(h.isBoolean(b)){g=f;f=e;e=d;d=b;b=this.active}d=d===false?false:true;e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||false;g=parseInt(g)||false;var j=h.isFunction(c);this.each(function(k,m,l,n,o){if(j)c(k,m,l,n,o);else k[m]=c;return true},a,b,d,e,f,g);return this};h.Collection.fn.replaceElement=function(a,c,b){return this.replaceElements(a||"",c,b||"",false)};h.Collection.fn.moveElements=function(a,c,b,d,e,f,g,j,k,m){a=a||false;
m=m===false?false:true;c=h.isExist(c)?c.toString():"";b=b||"";d=d||"";e=e||"push";f=f===false?false:true;g=parseInt(g)>=0?parseInt(g):false;j=parseInt(j)||false;k=parseInt(k)||false;var l=h.Collection.cache.obj,n=this.dObj,o=n.sys,r,q=[];n=h.isArray(l.getByLink(this._get("Collection",d),n.prop.activeContext));if(o.activeContextID){o=o.activeContextID;r=true}else{o=this._get("Context");r=false}this._$("Context",c);a=this.searchElements(a,b,f,g,j,k);r===true?this._set("Context",o):this._$("Context",
o);if(f===true){f=a.length-1;for(g=-1;g++<f;){this.addElement(c+l.contextSeparator+a[g],n===true?e:a[g]+l.methodSeparator+e,d,b);m===true&&q.push(a[g])}}else{this.addElement(c+l.contextSeparator+a,n===true?e:a+l.methodSeparator+e,d,b);m===true&&q.push(a)}if(m===true){this._$("Context",c);this.deleteElementsByLink(q,b);r===true?this._set("Context",o):this._$("Context",o)}return this};h.Collection.fn.moveElement=function(a,c,b,d,e){return this.moveElements(a||"",h.isExist(c)?c.toString():"",b||"",d||
"",e||"",false)};h.Collection.fn.copyElements=function(a,c,b,d,e,f,g,j,k){a=a||false;c=h.isExist(c)?c.toString():"";b=b||"";d=d||"";e=e||"push";f=f===false?false:true;g=parseInt(g)>=0?parseInt(g):false;j=parseInt(j)||false;k=parseInt(k)||false;return this.moveElements(a,c,b,d,e,f,g,j,k,false)};h.Collection.fn.copyElement=function(a,c,b,d,e){return this.moveElements(a||"",h.isExist(c)?c.toString():"",b||"",d||"",e||"",false,"","","",false)};h.Collection.fn.deleteElements=function(a,c,b,d,e,f){a=a||
false;c=h.isExist(c)?c:this.active;if(h.isBoolean(c)){f=e;e=d;d=b;b=c;c=this.active}b=b===false?false:true;d=parseInt(d)>=0?parseInt(d):false;e=parseInt(e)||false;f=parseInt(f)||false;a=this.searchElements(a,c,b,d,e,f);if(b===false)this.deleteElementByLink(a,c);else for(b=a.length;b--;)this.deleteElementByLink(a[b],c);return this};h.Collection.fn.deleteElement=function(a,c){return this.deleteElements(a||"",c||"",false)};h.Collection.fn.customFilter=function(a,c,b,d,e,f){var g,j=this.dObj,k=j.prop,
m=j.sys,l,n,o=true,r,q,p,s=-1;if(h.isFunction(a)){j.sys.filterCallee=a;return a(c,b,d,e,f)}if(!a||h.isString(a)&&h.trim(a)===this.active){if(k.activeFilter){j.sys.filterCallee=k.activeFilter;return k.activeFilter(c,b,d,e,f)}return true}else{if(!h.isArray(a)){if(a.search(/\|\||&&|!|\(|\)/)===-1){j.sys.filterCallee=m.tmpFilter[a];return m.tmpFilter[a](c,b,d,e,f)}a=h.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ")}n=function(t,
y){for(var w=-1,C=t.length-1,z=0,D=[];w++<C;){y++;t[w]==="("&&z++;if(t[w]===")")if(z===0)return{result:D,iter:y};else z--;D.push(t[w])}};for(l=a.length-1;s++<l;)if(a[s]==="("||a[s]==="!("){if(a[s].substring(0,1)==="!"){p=true;a[s]=a[s].substring(1)}else p=false;g=n(a.slice(s+1),s);s=g.iter;g=this.customFilter(g.result,c,b,d,e,f);o=!r&&!q?p===true?!g:g:r?p===true?!g:g&&o:p===true?!g:g||o}else if(a[s]!==")"&&a[s]!=="||"&&a[s]!=="&&"){if(a[s].substring(0,1)==="!"){p=true;a[s]=a[s].substring(1)}else p=
false;g=a[s]===this.active?k.activeFilter:m.tmpFilter[a[s]];j.sys.filterCallee=g;g=g(c,b,d,e,f);o=!r&&!q?p===true?!g:g:r?p===true?!g:g&&o:p===true?!g:g||o}else if(a[s]==="||"){r=false;q=true}else if(a[s]==="&&"){q=false;r=true}return o}};h.Collection.fn.customParser=function(a,c){var b=this.dObj,d=b.prop,e=b.sys,f,g;if(h.isFunction(a)){b.sys.parserCallee=a;return a(c,this)}if(!a||h.isString(a)&&h.trim(a)===this.active){if(d.activeParser){b.sys.parserCallee=d.activeParser;return d.activeParser(c,this)}}else{if(h.isString(a)){a=
h.trim(a);if(a.search("&&")===-1){b.sys.parserCallee=e.tmpParser[a];return e.tmpParser[a](c,this)}a=a.split("&&")}for(g=a.length;g--;){a[g]=h.trim(a[g]);f=a[g]===this.active?d.activeParser:e.tmpParser[a[g]];b.sys.parserCallee=f;c=f(c,this)}}return c};h.Collection.fn.parentContext=function(a,c){a=a||1;var b=this.dObj,d=b.sys,e=b.prop;b="";b=(c&&c!==this.active?d.tmpContext[c]:e.activeContext).split(h.Collection.cache.obj.contextSeparator);for(d=a;d--;)b.splice(-1,1);return b.join(h.Collection.cache.obj.contextSeparator)};
h.Collection.fn.parent=function(a,c){var b=this.dObj,d=b.sys,e=b.prop;b=b.sys.activeContextID;var f=this.parentContext.apply(this,arguments);if(!c||c===this.active){if(b)d.tmpContext[b]=f;e.activeContext=f}else{d.tmpContext[c]=f;if(b&&c===b)e.activeContext=f}return this};h.Collection.fn.orderBy=function(a,c,b,d){a=a||null;c=c||false;b=b?b===false?null:b:function(m){if(isNaN(m))return m.toUpperCase();return m};d=d||"";var e=h.Collection.cache,f=this.dObj,g=f.prop,j=f.sys;f=function(m){var l=[],n={},
o;for(o in m)m.hasOwnProperty(o)&&l.push(o);l.sort(e.sort.sortBy(a,c,b));for(o in l)if(l.hasOwnProperty(o))n[l[o]]=m[l[o]];return n};var k=function(m){var l=[],n={},o;for(o in m)m.hasOwnProperty(o)&&l.push({key:o,value:m[o]});l.sort(e.sort.sortBy(a===true?"value":"value"+e.obj.contextSeparator+a,c,b));for(o in l)if(l.hasOwnProperty(o))n[l[o].key]=l[o].value;return n};g=e.obj.getByLink(d?j.tmpCollection[d]:g.activeCollection,g.activeContext);if(typeof g==="object")if(h.isArray(g))g.sort(e.sort.sortBy(a,
c,b));else{g=a?k.call(this,g):f.call(this,g);this.setElement("",g,d||"")}else throw Error("Incorrect data type!");return this};h.Collection.fn.toString=function(a,c,b){var d=this.dObj,e=d.prop;B=u="";a=a&&h.isString(a)&&a!==this.active?d.sys.tmpCollection[a]:typeof a==="object"?a:e.activeCollection;a=h.Collection.cache.obj.getByLink(a,e.activeContext);if(typeof b==="number")for(e=b;e--;)B+=" ";else if(typeof b==="string")B=b;v=c;if(window.JSON!==undefined)return JSON.stringify(a,c,b);return A("",
{"":a})};h.Collection.fn.valueOf=function(a){return this.length(h.isExist(a)?a:this.active)};if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+x(this.getUTCMonth()+1)+"-"+x(this.getUTCDate())+"T"+x(this.getUTCHours())+":"+x(this.getUTCMinutes())+":"+x(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var F=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
u,B,G={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},v;h.Collection.fn.then=function(a,c){var b=this;arguments.length===1?h.when(this.prop("activeDefer")).always(function(){a.apply(b,arguments)}):h.when(this.prop("activeDefer")).then(function(){a().apply(b,arguments)},function(){c().apply(b,arguments)});return this};h.Collection.fn.print=function(a,c,b,d,e){a=a||{};c=c===false?false:true;b=parseInt(b)>=0?parseInt(b):false;d=parseInt(d)||false;e=parseInt(e)||
false;var f=this.dObj,g=f.prop,j=a.parser||g.activeParser,k=a.template||g.activeTemplate,m=a.target||a.target===false?a.target:g.activeTarget,l=a.resultNull!==undefined?a.resultNull:g.activeResultNull,n="";f.sys.templateCallee=k;this.each(function(o,r,q,p,s){n+=k(o,r,q,p,s);if(c!==true)return false;return true},a.filter||g.activeFilter,"active",c,b,d,e);n=!n?l===false?'<div class="'+f.css.noResult+'">'+f.viewVal.noResultInSearch+"</div>":l:n;n=j!==false?this.customParser(j,n):n;if(m===false)a.variable?
this.PushSetVar(a.variable,n):this.$Var(n);else m[a.appendType||g.activeAppendType](n);return this};h.Collection.fn.extPrint=function(a){a=a||{};var c=this.dObj,b=c.sys,d=c.prop,e,f,g,j=0,k=a.filter?a.filter:d.activeFilter,m=a.parser?a.parser:d.activeParser,l=a.page||d.activePage,n=l===a.page+1,o=a.template||d.activeTemplate,r=a.target||d.activeTarget,q=+a.countBreak||+d.activeCountBreak,p=d.activeCache;g=h.isBoolean(a.cacheIteration)?a.cacheIteration:p.iteration;var s=a.resultNull!==undefined?a.resultNull:
d.activeResultNull,t="",y=function(w,C,z,D,H){t+=o(w,C,z,D,H);j=C;return true};e=h.Collection.cache.obj.getByLink(d.activeCollection,a.context||d.activeContext);f=this.length();q=q===false?f:q;c.sys.templateCallee=o;if(h.isPlainObject(e)||g===false)this.each(y,k,"active",true,q,l===1?q:(l-1)*q);else if(h.isArray(e)&&g===true){g=k===false?l===1?-1:(l-1)*q-1:g===true?n===true?p.firstIteration:p.lastIteration:i;if(n===true&&k!==false){for(;g--;)if(this.customFilter(k,e,g,f,this,"active")===true)if(j===
q)break;else j++;g=g===-1?g:g+1;p.lastIteration=g}this.each(y,k,"active",true,q,null,g);p.firstIteration=p.lastIteration;p.lastIteration=j-1;if(p.autoIteration===true)p.iteration=true}t=!t?s===false?'<div class="'+c.css.noResult+'">'+c.viewVal.noResultInSearch+"</div>":s:t;t=m!==false?this.customParser(m,t):t;r[a.appendType||d.activeAppendType](t);b.countRecords=this.length(k);b.countRecordsInPage=h(a.selectorOut||d.activeSelectorOut,r).length;b.countTotal=q*l-(q-b.countRecordsInPage);h.extend(a,
{countRecords:b.countRecords,countRecordsInPage:b.countRecordsInPage,countTotal:b.countTotal});if(l!==1&&b.countRecordsInPage===0){c.prop.activePage--;this.extPrint.apply(this,arguments)}else this.easyPage(a,c.prop);return this};h.Collection.fn.easyPage=function(){this.dObj.sys.templateModeCallee=this.dObj.prop.activeTemplateMode;this.dObj.prop.activeTemplateMode.apply(this,arguments);return this};h.Collection.fn.genTable=function(a){a=a||4;var c=1,b,d=this.dObj.prop.activeTarget,e=d.children("td").length-
1,f=a-1,g="";d.children("td").each(function(j){if(c===a){g="";for(b=-1;b++<f;){g+="td:eq("+(j-b)+")";if(b!==f)g+=","}h(g,d).wrapAll("<tr></tr>");c=0}else if(j===e&&c!==a){g="";for(b=0;b<c;b++){g+="td:eq("+b+")";if(b!==c-1)g+=","}d.children(g).wrapAll("<tr></tr>");for(g="";c<a;c++)g+="<td></td>";d.children("tr:last").append(g)}c++});d.children("tr").wrapAll("<table></table>");return this};h.Collection.fn.genIndex=function(a){for(var c=this._get("Collection",a),b=0,d,e=arguments.length-1,f={};b++<e;)if(!h.isArray(arguments[b]))for(d=
c.length;d--;)f[c[d][arguments[b]]]=b;console.log(f)};h.fn.collection=function(a){var c=h.fn.collection.stat,b=function(e){var f=[];e.each(function(g){var j=h(this),k=j.data(),m=j.attr("class")?j.attr("class").split(" "):"",l=m?m.length:0,n;n=j[0];n=n.childNodes;for(var o=n.length-1,r=-1,q="";r++<o;)if(n[r].nodeType===3&&h.trim(n[r].textContent))q+=n[r].textContent;n=q?q:false;var p;f.push({});for(p in k)if(k.hasOwnProperty(p))f[g][p]=k[p];if(l){f[g][c.classes]={};for(p=0;p<l;p++)f[g][c.classes][m[p]]=
m[p]}if(j.children().length!==0)f[g][c.childNodes]=b(j.children());if(n!==false)f[g][c.val]=n.replace(/[\r\t\n]/g," ")});return f},d=b(this);if(a)return new h.Collection(d,a);return new h.Collection(d)};if(!h.fn.collection.stat)h.fn.collection.stat={val:"val",childNodes:"childNodes",classes:"classes"};h.fn.tplCompile=function(){if(this.length===0)throw Error("DOM element isn't exist!");for(var a=this.eq(0).html().split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js"),c=a.length-1,b="var result = ''",
d="",e=-1,f,g;e++<c;)if(e===0||e%2===0)b+="+'"+a[e]+"'";else{f=-1;a[e]=a[e].split("`");for(g=a[e].length;f++<g;)if(f===0||f%2===0)a[e][f]&&(d+=a[e][f]);else a[e][f]&&(b+="+"+a[e][f])}b+=";";return new Function("$this","i","aLength","$obj","id",b+d+" return result;")};h.isString=function(a){return Object.prototype.toString.call(a)==="[object String]"};h.isBoolean=function(a){return Object.prototype.toString.call(a)==="[object Boolean]"};h.isExist=function(a){return a!==undefined&&a!=="undefined"&&
a!==null&&a!==""};h.unshiftArguments=function(a,c){for(var b=[c],d=0,e=a.length;d<e;d++)b.push(a[d]);return b}})(jQuery);
//