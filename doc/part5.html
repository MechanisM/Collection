<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>my document</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
	<script src="http://www.kobezzza.com/files/collection/jquery.collection.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="scripts/shCore.js"></script>
	<script type="text/javascript" src="scripts/shBrushJScript.js"></script>
	<script type="text/javascript" src="scripts/shBrushXml.js"></script>
	<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css">
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>
	<h1>Использование реляционного фреймворка $.Collection</h1>
	<h2>Глава 5. Стек.</h2>
	<p>
		И вновь мы возвращаемся к понятию стека, но зачем? Дело в  том, что помимо стека коллекций существует довольно большое количество  параметров — все они содержат примерно одинаковое API, так что изучить эти  возможности не составит труда. В таблице ниже приводятся все стековые параметры  и методы, которые они поддерживают.
	</p>
<table class="b-scheme_data_stack">
		<tr>
			<td><em>параметр / метод</em></td>
			<th scope="col">new</th>
			<th scope="col">update</th>
			<th scope="col">push</th>
			<th scope="col">set</th>
			<th scope="col">pushSet</th>
			<th scope="col">get</th>
			<th scope="col">back</th>
			<th scope="col">backIf</th>
			<th scope="col">drop</th>
			<th scope="col">reset</th>
			<th scope="col">resetTo</th>
			<th scope="col">is</th>
			<th scope="col">exists</th>
			<th scope="col">active</th>
			<th scope="col">getActiveID</th>
		</tr>
		<tr>
			<th scope="row">namespace</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">collection</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">page</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">target</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">filter</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">parser</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">variable</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">template</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">context</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">numberBreak</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">pageBreak</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">pager</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">calculator</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">resultNull</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">appendType</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">defer</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
		<tr>
			<th scope="row">cache</th>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td>&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
			<td class="b-scheme__col_selected_true">&nbsp;</td>
		</tr>
	</table>
	<p>
		Из этой таблицы видно, что для всех стековых параметров  существую практически одни и те же методы, интерфейсы соответственно одинаковы  также. Форма записи методов можно  вписать в формулу: названиеМетодаНазваниеПараметра, например: newFilter,  pushSetTemplate и т.д. Однако для некоторых методов интерфейс может содержать  немного другой вид (backif, resetTo, getActiveID), например: backNamespaceIf,  resetFilterTo, getDeferActiveID и т.д.. Логично, что у всех стековых параметров  есть также активные аналоги, которые используются по умолчанию, однако для  некоторых параметров активность — это не просто использование по умолчанию, а  дополнительная логика.
	</p>
<h3>Стек фильтров</h3>
	<p>
		Фильтры — являются стековым параметром, т.е. мы можем  создавать заранее различные условия и использовать их потом в выборках.
	</p>
<pre class="brush: js">
var db = new $.Collection([
	{name: &quot;Koba&quot;, age: 22, lvl: 80},
	{name: &quot;Over&quot;, age: 27, lvl: 90},
	{name: &quot;Drobila&quot;, age: 29, lvl: 85},
	{name: &quot;Nerzum&quot;, age: 20, lvl: 75}
]);

// создадим несколько фильтров в стеке
db.pushFilter({
	getKoba: &quot;:el.name === 'Koba'&quot;,
	getByAge: function (el, i, data, cOLength, id) {
		return el.age &gt; 22;
	},
	getByLvlAndAge: &quot;(:el.lvl &gt;= 80) &amp;&amp; getByAge&quot;,
	extrim: &quot;getByLvlAndAge || getKoba&quot;
});

// получим значения по фильтру extrim
db.get(&quot;extrim&quot;);
// комбинировать фильтры можно и в методах
db.get("getByLvlAndAge &amp;&amp; (:el.name == 'Nerzum')");</pre>
<p>
	Как видите, использование стека для фильтров позволяет  строить очень сложные и мобильные запросы, а также даст дополнительный прирост  скорости, т.к. запросы, указанные в стеке компилируются заранее. Вы могли  заметить, что в стеке фильтров мы также можем использовать сокращённые записи  функций и различные комбинации. Однако это ещё не всё, у активных фильтров есть  одно особенное свойство — они не просто используются по умолчанию, а  выполняются всегда!
</p>
<pre class="brush: js">
// назначим активный фильтр getKoba
db.setFilter(&quot;getKoba&quot;)

// сделаем запрос по фильтру getByLvlAndAge, но т.к. у нас активный фильтр getKoba, то результирующий запрос будет типа getKoba &amp;&amp; getByLvlAndAge
db.get(&quot;getByLvlAndAge&quot;);

// сделаем запрос по одному активному фильтру
// укажем значение true, чтобы пояснить методу, что нам нужна выборка по условию
// т.к. get без параметров вернёт исходный объект, как будто бы  мы делали прямой запрос
db.get(true);</pre>
<p>
	У фильтров, есть также стековый метод reset (resetFilter) 
	—
	он сбрасывает указанный фильтр в значение false (т.е. без фильтра).
</p>
<h3>Стек контекстов</h3>
<p>
Контекст —
это один из самых мощных механизмов $.Collection, он позволяет задать «точку старта» для поиска и выборки элементов.
</p>
<pre class="brush: js">
// создадим коллекцию, каталог музыкальных иснтрументов
// первичный уровень таблицы будет хеш-таблицей, где ключ — тип инструмента
var db = new $.Collection({
	guitar: [
		fender: [
			{model: &quot;JAGUAR BLACKTOP HH RW BLK&quot;, price: 27921},
			{model: &quot;STRATOCASTER BLACKTOP HH MN BLK&quot;, price: 28390},
			{model: &quot;STANDARD TELECASTER &quot;, price: 18518}
		],
		gibson: [
			{model: &quot;CUSTOM SHOP LES PAUL CUSTOM EB/GH&quot;, price: 159505},
			{model: &quot;LES PAUL STUDIO FIREBURST CHROME HARDWARE&quot;, price: 50525}
		]
	],
	bassGuitar: [
		fender: [
			{model: &quot;STANDARD JAZZ BASS RW Sunburst&quot;, price: 32205},
			{model: &quot;STANDARD PRECISION BASS&quot;, price: 30640}
		]
	]
});

// теперь выберем все гитары фирмы fender
// для этого сделаем прямой запрос через get
db.get("guitar > fender");

// выберем модели, дешевле 20-ти тысяч
db.get(":el.price < 20000"); // ошибка, свойство price не найдено, т.к. отсчёт идёт с самого первого объекта, а не с guitar > fender

// чтобы установить нужную точку отсчёта, установим активный контекст
db.newContext("guitar > fender");

// теперь снова сделаем get запрос
db.get(":el.price < 20000"); // всё ок, т.к. теперь задан нужный контекст обхода

// в случае задания в get прямой ссылки, она также будет теперь отталкиваться от активного контекста
db.get("guitar > fender > 0"); // ошибка
db.get("0"); // вернёт запрашиваемый элемент</pre>
<p>
	Выходит, что почти все методы $.Collcetion работают в рамках активного контекста (по умолчанию равен пустой строке), исключение составляют стековые методы, например: getCollection (всегда будет возвращать искомую коллекцию вне зависимости от контекста).
</p>
<p>
Использование контекста поможет вам построить по настоящему сложную логику отношений и связей, в своей коллекции. В дополнение к стандартным методам у стека есть ещё несколько дополнительных: parent и parentContext. Первый меняет активный контекст на n (по умолчанию на 1) уровней вверх, а метод 
parentContext
возвращает родительский контекст.
</p>
<pre class="brush: js">db.newContext(&quot;a &gt; b &gt; c&quot;);

db.parentContext(); // &quot;a &gt; b&quot;
db.parentContext(2); // &quot;a&quot;

db.parent(2);
db.getContext(); // &quot;a&quot;</pre>
<p>
	Метод 
resetContext сбрасывает указанный контекст в значение &quot;&quot;.
</p>
	<h3>Стек временных переменных</h3>
	<p>
		Временные переменные (variable) — это просто возможность  сохранять временные данные, не создавая внешних переменных, а внутри одного  экземпляра $.Collection. Принципы работы со стеком идентичны другим параметрам,  что мы с вами уже рассматривали, но есть одна особенность.
	</p>
<pre class="brush: js">db.pushVariable({
	i: 20,
	tmpObj: [1, 2, 3]
});

// мы можем использовать сокращённую запись вызова переменной в строчных функциях (вместо getVariable)
db.get(&quot;:el == &lt;:i:&gt;&quot;);
db.get(&quot;:el == cObj.getVariable('i')&quot;);

db.get(&quot;:i == &lt;:tmpObj:&gt;[0]&quot;);</pre>
<p>
 Также некоторые методы умеют автоматически выгружать свои данные в переменную.
</p>
<h3>Сборка стековых параметров</h3>
<p>
	Стек $.Collection помогает нам разделать логику внутри экземпляра, но он может стать виновником «лишнего» кода, допустим:
</p>
<pre class="brush: js">
// используем стек, как пространство имён
db
	.setCollection(&quot;users&quot;)
	.setContext(&quot;users&quot;)
	.setTemplate(&quot;users&quot;)
	.setParser(&quot;users&quot;);

// теперь нам нужно переключиться на другое пространство имён
db
	.setCollection(&quot;documents&quot;)
	.setContext(&quot;documents&quot;)
	.setTemplate(&quot;documents&quot;)
	.setParser(&quot;documents&quot;);
</pre>
<p>
	Как видите, что код получается не очень красивым, т.к. получается много одинаковых декларативных методов, но на помощь нам приходит метод сборок стековых параметров. Перепишем наш код:
</p>
<pre class="brush: js">
db.use(&quot;users&quot;);
db.use(&quot;documents&quot;);</pre>
<p>
	Я думаю, что вы согласитесь, что так запись выглядит гораздо  красивее, и всегда будет занимать одну строчку вне зависимости от количества  параметров. Как же работает use? Очень просто, если в стеке есть параметр с  указанным именем, то он делается активным, а если нет, то ничего не происходит.  Дополнительной возможностью метода use является поддержка пространства имён,  например:
</p>
<pre class="brush: js">
// выбираем users
db.use(&quot;users&quot;);

// а теперь нужно выбрать те же параметры, кроме одного (например,  collection должен быть users-w), и придётся написать что-то вроде
db.use(&quot;users&quot;).setCollection(&quot;users-w&quot;); // помимо избыточности синтаксиса даст ещё лишнюю историю активности

// а можно использовать пространство имён
// дадим нашей второй коллекции ИД users.w и напишем use
db.use(&quot;users.w&quot;); // коллекция users.w будет выбрана, а остальные параметры будут users, т.к. в стеке нету больше параметров с приставкой .w

// пространства имён поддерживают вложенность
db.use(&quot;users.w.sub.next&quot;); // будут искаться параметры users.w.sub.next, затем: users.w.sub, users.w, users
</pre>
</body>
</html>
