<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>my document</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
	<script src="http://www.kobezzza.com/files/collection/jquery.collection.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="scripts/shCore.js"></script>
	<script type="text/javascript" src="scripts/shBrushJScript.js"></script>
	<script type="text/javascript" src="scripts/shBrushXml.js"></script>
	<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css">
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>
	<h1>Использование реляционного фреймворка $.Collection</h1>
	<h2>Глава 1. Введение.</h2>
	<p>
		Эта статья является первой из серии. Для начала пару слов о $.Collection — это  своего рода «палочка-выручалочка», когда дело касается работы с массивами и  объектами в JavaScript,  что-то типа SQL Lite,  только который есть везде.
	Для чего это нужно? Для того, чтобы проще и быстрее создавать «богатые» веб-интерфейсы, писать настольные приложения на JS
	или дополнения к браузерам.
	Разумеется, что целевая аудитория этих статей 
	—
	это опытные разработчики.
	</p>
	<p>
	Примеры использования: карта путей от компании Yandex (<a href="http://metrika.yandex.ru/stat/paths/?counter_id=5265289&filter=day&date1=20120219&date2=20120225">ссылка</a>)
	—
	$.Collection
	использовался для фильтрации данных, а также для 
	отображения их на экране клиента.
	</p>
	<h3>
		С чего начать?
</h3>
	<p>Для начала нужно подключить библиотеку jQuery и  собственно сам $.Collection.<br>
		
Вот так будет примерно выглядеть наш код:
</p>
	<pre class="brush: html">&lt;!DOCTYPE HTML&gt;
&lt;html&gt;
	&lt;head&gt;
		&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html;  charset=utf-8&quot;&gt;
		&lt;title&gt;my  document&lt;/title&gt;
		&lt;script  src=&quot;http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
		&lt;script  src=&quot;http://www.kobezzza.com/files/collection/jquery.collection.min.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
		&lt;script type=&quot;text/javascript&quot;&gt;
			/* здесь будем писать наш код */
		&lt;/script&gt;
	&lt;/head&gt;
	
	&lt;body&gt;&lt;/body&gt;
&lt;/html&gt;</pre>
<p>
	После этой подготовки мы можем приступить к работе с  фреймворком. Рассмотрим простенькие примеры:
</p>
<pre class="brush: js">// создадим экземпляр $.Collection
// входным параметром конструктора укажем некоторый массив
var db = new $.Collection([1, 2, 3, 4, 5, 5, 6, 2, 1]);

// а теперь получим длину исходного массива
db.length(); // 9
// выберем все элементы больше трёх
db.get(":el > 3"); // [4, 5, 5, 6] </pre>
<p>
	Как видите, что пользоваться $.Collection очень просто, при этом абсолютно не  важно, что вы используете: массивы или объекты, т.к. все методы $.Collection работают как  с теми, так и с другими, а форма их вызова практически не меняется, т.е.  напишем тот же код, но уже с объектом:
</p>
<pre class="brush: js">// изменим только параметр конструктора
var db = new $.Collection({"a": 1, "b": 2, "c": 3, "d": 4, "e": 5, "f": 5, "g": 6, "h": 2, "i": 1});
db.length(); // 9
db.get(":el > 3"); // [4, 5, 5, 6]</pre>
<p>
	Приятной особенностью является то, что многие методы $.Collection имеют  название, схожее с методами массивов в JavaScript, например: forEach, pop, push, map, sort и т.д., и большинство из них возвращают ссылку на сам экземпляр, т.е. мы можем использовать шаблон написания кода 
«цепочки», как мы могли это делать в jQuery.
</p>
<p>
	Теперь, когда мы немного разобрались, что к чему, давайте  поработаем с примером, который мы можем часто увидеть на практике. Допустим, у  нас есть массив с объектами, в которых храниться информация о пользователях  нашего сайта, например:
</p>
<pre class="brush: js">
var db = [
	{name: &quot;Andrey&quot;, sex: &quot;male&quot;, age: 22},
	{name: &quot;Sergey&quot;, sex: &quot;male&quot;, age: 24},
	{name: &quot;Ann&quot;, sex: &quot;female&quot;, age: 18},
	{name: &quot;Kate&quot;, sex: &quot;female&quot;, age: 21},
	{name: &quot;Vera&quot;, sex: &quot;female&quot;, age: 15},
	{name: &quot;John&quot;, sex: &quot;male&quot;, age: 28},
	{name: &quot;Paul&quot;, sex: &quot;male&quot;, age: 32}
];</pre>
<p>
	А сейчас давайте создадим новый экземпляр $.Collection и посмотрим, как он сможет помочь нам сделать различные выборки:
</p>
<pre class="brush: js">db = new $.Collection(db);

// отсортируем наших пользователей по возрасту (поле age) в порядке возрастания
// для этого воспользуемся методом sort
db.sort(&quot;age&quot;); // правда просто?;)

// удалим всех девушек моложе 18-ти лет
db.remove(&quot;(:el.sex == 'female') &amp;&amp; (:el.age &lt; 18)&quot;);</pre>
<p>
	Остановимся  на условиях, которые мы задавали методами, для указания выборки. Дело в том,  что приведённый выше синтаксис — это не что иное, как сокращённая форма записи  функции обратного вызова, где:
</p>
<pre class="brush: js">el       // строка элемента
i        // номер итерации, также имеет псевдоним key
data     // ссылка на всю коллекцию данных, т.е. el = data[i]
cOLength // функция, возвращает длину «фильтрованной» коллекции (вызов кешируется, поэтому не стоит бояться, что использование функции вызовет сильное замедление)
cObj	  // ссылка на экземпляр $.Collection
id       // идентификатор коллекции</pre>
<p>
	Объявление  строчной функции начинается со знака двоеточия. В примере выше мы также  использовали знаки скобок и логическое И (&amp;&amp;). Использование скобок  необходимо, когда мы задаём сразу несколько функций-условий, однако их можно  также использовать для различных комбинирований условий, логика идентична  нативной JavaScript, вложенность не ограничена (однако не нужно фанатизма, ибо  чем сложнее условие, тем дольше оно будет обрабатываться). Помимо указанного  можно также использовать знаки логического ИЛИ (||) и логического НЕ (!),  логика также идентична нативной JavaScript.
</p>
<pre class="brush: js">
// выберем всех мужчин моложе 30 и всех девушке старше 18
db.get(&quot;((:el.sex == 'female') &amp;&amp; (:el.age &gt; 18)) || ((:el.sex == 'male') &amp;&amp; (:el.age &lt; 30))&quot;);
</pre>
<p>
	Помимо  использования строчного условия, можно использовать непосредственно функцию  обратного вызова, из плюсов такого подхода является более быстрая обработка  запроса, т.к. не приходится тратить время на первичную компиляцию условия, а из  минусов — более громоздкий синтаксис.
</p>
<pre class="brush: js">
// сделаем идентичный запрос, но с использованием функции
db.get(function (el, i, data, cOLength, cObj, id) {
	return (el.sex == 'female' &amp;&amp; el.age &gt; 18) || (el.sex == 'male' &amp;&amp; el.age &lt; 30);
});</pre>
<p>
И последний способ — это обращение к элементу по прямой ссылке:
</p>
<pre class="brush: js">
// выберем первый элемент массива
db.get(0);
// выберем первый с конца элемент массива
db.get(&quot;eq(-1)&quot;);
// выберем свойство name второго с конца элемента массива
db.get(&quot;eq(-2) &gt; name&quot;);</pre>
<p>
	Синтаксис прямого обращения к объекту немного схож с синтаксисом CSS селекторов: оператор «больше» (>) задаёт родительское отношение, где в качестве операндов можно использовать имя ключа или его позицию в коллекции с помощью функции eq, а в случае указания в нём отрицательного значения, то отсчёт идёт с конца.
</p>
<pre class="brush: js">
&quot;first &gt; second &gt; 0&quot; // так бы выглял запрос к obj[&quot;first&quot;][&quot;second&quot;][0], где obj некоторый объект</pre>
<p>
Методы типа: get, set, remove, move поддерживают все 3 вида записи, а какой использовать зависит уже от вас и ситуации. Логично, что способ прямого обращения самый быстрый, т.к. по сути, это явное указание контекста.
</p>
<p>
На этом данная глава подходит к концу, а в следуещей мы более подробно пройдёмся по «условным» методам манипуляций с данными.
</p>
</body>
</html>
