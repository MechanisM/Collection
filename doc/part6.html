<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>my document</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
	<script src="http://www.kobezzza.com/files/collection/jquery.collection.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="scripts/shCore.js"></script>
	<script type="text/javascript" src="scripts/shBrushJScript.js"></script>
	<script type="text/javascript" src="scripts/shBrushXml.js"></script>
	<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css">
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>
	<h1>Использование реляционного фреймворка $.Collection</h1>
	<h2>Глава 6. Перенос. Сортировка.</h2>
	<h3>Перенос</h3>
	<p>
		В $.Collection существует несколько методов для  взаимодействия коллекций в стеке, основным из них является move. Как можно  догадать из названия — этот метод осуществляет перенос данных, а если сказать  более точно, то перенос из одной коллекции в другую.
	</p>
<pre class="brush: js">
var db = new $.Collection();
db.pushCollection({
	table1: [
		{name: &quot;Koba&quot;, age: 22, lvl: 80},
		{name: &quot;Over&quot;, age: 27, lvl: 90},
		{name: &quot;Drobila&quot;, age: 29, lvl: 85},
		{name: &quot;Nerzum&quot;, age: 20, lvl: 75}
	],
	table2: [1, 2, 3]
});

// перенесём первый элемент коллекции из table1 в table2
db.move(&quot;0&quot;, &quot;&quot;, &quot;table1&quot;, &quot;table2&quot;);
// перенесём name из последнего элемента коллекции из table1 в table2
db.move(&quot;eq(-1) &gt; name&quot;, &quot;&quot;, &quot;table1&quot;, &quot;table2&quot;);

// перенесём все элементы, где age &gt; 22 из table1 в table2
db.move(&quot;:age &gt; 22&quot;, &quot;&quot;, &quot;table1&quot;, &quot;table2&quot;);
</pre>
<p>
Как видите, всё довольно просто, а теперь давайте разберём входные параметры:
</p>
<ol>
	<li>Фильтр для выборки элементов для переноса или прямая ссылка;</li>
	<li>Дополнительный контекст, для объекта из которого беруться элементы для переноса (активный контекст для этого элемента не работает);</li>
	<li>ИД таблицы, из которой осуществляется перенос;</li>
	<li>ИД таблицы, в которую осуществляют перенос (учитывается активный контекст).</li>
	</ol>
<p>
	Если указать одинаковый ИД для таблицы источника и таблицы  цели, то перенос будет осуществляться в пределах одной коллекции. У метода move  существуют методы обёртки: moveOne (осуществляет перенос только одного  элемента), copy (копирует элемент из одной коллекции в другую, в отличие от  move не удаляет элемент из переносимой коллекции), copyOne (осуществляет  копирование одного элемента).
</p>
<h3>Сортировка</h3>
<p>
	Для сортировки в $.Collection реализовано два метода: sort и  reverse. Как и у массивов: первый метод осуществляет непосредственно саму  сортировку, а второй переворачивает исходную коллекцию. Давайте разберёмся на  примерах:
</p>
<pre class="brush: js">
var db = new $.Collection([
	{name: &quot;Koba&quot;, age: 22, lvl: 80, attr: {money: 100}},
	{name: &quot;Over&quot;, age: 27, lvl: 90, attr: {money: 200}},
	{name: &quot;Drobila&quot;, age: 29, lvl: 85, attr: {money: 120}},
	{name: &quot;Nerzum&quot;, age: 20, lvl: 75, attr: {money: 60}}
]);

// отсортируем коллекцию по полю name в порядке возрастания
db.sort(&quot;name&quot;); 
// отсортируем коллекцию по полю name в порядке убывания
db.sort(&quot;name&quot;, true); 
// отсортируем коллекцию по полю name в порядке убывания и учитывая регистр
db.sort(&quot;name&quot;, true, false); 
// перемешаем массив в случайном порядке
db.sort(&quot;&quot;, &quot;shuffle&quot;); 
// отсортируем коллекцию по полю money
db.sort(&quot;attr &gt; money&quot;); 
// отсортируем коллекцию по полю money, задав дополнительную функцию, которая будет сравнивать логарифмы
db.sort(&quot;attr &gt; money&quot;, &quot;&quot;, function (el) { return Math.log(el); });

var db2 = new $.Collection([6, 5, 1, 2, 3, 8]);
// простая сортировка
db2.sort();

var db3 = new $.Collection({b: 1, a: 4, n: 1: d: 8});
// сортировка по ключам
db2.sort();
// простая сортировка, т.е. по значению ключа, также как и в случае массивов, можно использовать прямые ссылки
db2.sort(true);</pre>
<p>
	Давайте разберём входные параметры метода sort:
</p>
<ol>
	<li>Имя поля (если нужно, можно использовать прямые ссылки), для объекта, если имя поля не задано, то сортировка идёт по ключам;</li>
	<li>Порядок сортировки — если задать true, то сортировка будет идти по убыванию;</li>
	<li>Функция дополнительной обработки (например, по умолчанию все строки сравниваются в одном регистре, чтобы отменить это нужно задать false);</li>
	<li>ИД сортируемой коллекции.</li>
	</ol>
<p>
	Метод reverse переворачивает коллекцию и в качестве входного параметра может принимать один единственный параметр — ИД коллекции.
</p>
</body>
</html>
