/**
 * Collection v3.7.2 | http://collection-js.com
 * 
 * Copyright 2012, Andrey Kobets (Kobezzza | kobezzza@gmail.com | http://kobezzza.com)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
 var Collection;
(function(){var g=Collection=function(a,b){a=a||null;b=b||"";var c=Collection;if(!this||!this.name||this.name!=="Collection")return new c(a,b);c.extend(true,this,c.fields);var d=this.dObj.active,e=c.drivers.dom;b&&c.extend(true,d,b);if(this._isStringExpression(d.filter))d.filter=this._compileFilter(d.filter);if(this._isStringExpression(d.parser))d.parser=this._compileParser(d.parser);if(c.isString(d.target))d.target=e.find(d.target);if(c.isString(d.pager))d.pager=e.find(d.pager);d.collection=a},x=
typeof debugMode!=="undefined"&&debugMode===true,A;Collection.byLink=function(a,b,c,d){b=b.toString().replace(RegExp("\\s*"+g.CHILDREN+"\\s*","g"),g.CONTEXT+g.CHILDREN+g.CONTEXT).split(g.CONTEXT);d=d||false;for(var e=a,f=g.CHILDREN,h=0,j=0,k,m=b.length,q,i;(m-=1)>-1;){b[m]=b[m].trim();if(b[m]===""){b.splice(m,1);h-=1}else if(b[m]!==g.CHILDREN){if(m>h)h=m;j+=1}}i=b.length;if(a===false)return b.join("");else if(g.isNumber(a)){if((a=+a)<0)a+=j;if(typeof c==="undefined"){m=-1;for(q=0;(m+=1)<i;)if(b[m]!==
g.CHILDREN)if((q+=1)===a){b.splice(m+1,i);return b.join("")}}else{m=i;for(q=0;(m-=1)>-1;)if(b[m]!==g.CHILDREN)if((q+=1)===a){b.splice(0,m);return b.join("")}}}for(m=-1;(m+=1)<i;)switch(b[m]){case g.CHILDREN:f=b[m];break;default:if(f===g.CHILDREN&&b[m].substring(0,g.ORDER[0].length)!==g.ORDER[0])if(m===h&&typeof c!=="undefined")if(d===false)a[b[m]]=g.expr(c,a[b[m]]);else if(g.isArray(a))a.splice(b[m],1);else delete a[b[m]];else a=a[b[m]];else{j=b[m].substring(g.ORDER[0].length);j=j.substring(0,j.length-
1);j=+j;if(g.isArray(a))if(m===h&&typeof c!=="undefined")if(j>=0)if(d===false)a[j]=g.expr(c,a[j]);else a.splice(j,1);else if(d===false)a[a.length+j]=g.expr(c,a[a.length+j]);else a.splice(a.length+j,1);else a=j>=0?a[j]:a[a.length+j];else{if(j<0){q=0;for(k in a)if(a.hasOwnProperty(k))q+=1;j+=q}q=0;for(k in a)if(a.hasOwnProperty(k)){if(j===q){if(m===h&&typeof c!=="undefined")if(d===false)a[k]=g.expr(c,a[k]);else delete a[k];else a=a[k];break}q+=1}}}}if(typeof c!=="undefined")return e;return a};Collection.execEvent=
function(a,b,c,d){a=a.split(g.QUERY);c=g.isExists(c)?c:[];c=g.isArray(c)?c:[c];for(var e=-1,f=a.length-1;(e+=1)<f;)b=b[a[e]];d=d||b;if(a[e].search(g.SUBQUERY)!==-1){a=a[e].split(g.SUBQUERY);b=b[a[0]];a.splice(0,1);c=c.concat(a);return b.apply(d,c)}else return b[a[e]].apply(d,c)};Collection.CONTEXT="__context__";Collection.QUERY="/";Collection.SUBQUERY="{";Collection.METHOD="->";Collection.CHILDREN=">";Collection.ORDER=["eq(",")"];Collection.DOM=["<?js","?>"];Collection.ECHO="echo";Collection.VAL=
"val";Collection.CHILD_NODES="childNodes";Collection.CLASSES="classes";Collection.objToString=function(a){if(typeof a==="undefined")return g.prototype.collection();return Object.prototype.toString.call(a)};Collection.types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};Collection.type=function(a){return a==null?String(a):g.types[g.objToString(a)]||
"object"};Collection.isWindow=function(a){return a&&typeof a==="object"&&"setInterval"in a};Collection.isString=function(a){return g.type(a)==="string"};Collection.isNumber=function(a){return g.type(a)==="number"};Collection.isBoolean=function(a){return g.type(a)==="boolean"};Collection.isFunction=function(a){return g.type(a)==="function"};Collection.isArray=function(a){return g.type(a)==="array"};Collection.isPlainObject=function(a){if(!a||g.type(a)!=="object"||a.nodeType||g.isWindow(a))return false;
try{if(a.constructor&&!a.hasOwnProperty("constructor")&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))return false}catch(b){return false}for(var c in a);return c===undefined||a.hasOwnProperty(c)};Collection.isCollection=function(a){return g.isArray(a)||g.isPlainObject(a)};Collection.isExists=function(a){return typeof a!=="undefined"&&a!==null&&a!==""};if(!String.prototype.trim||x)String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=a.length;/\s/.test(a.charAt(b-=1)););
return a.substring(0,b+1)};Collection.toUpperCase=function(a,b,c){c=c||0;b=g.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toUpperCase()+a.substring(b)};Collection.toLowerCase=function(a,b,c){c=c||0;b=g.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toLowerCase()+a.substring(b)};Collection.expr=function(a,b){b=g.isExists(b)?b:"";if(g.isString(a)&&a.search(/^[+-\\*\/]{1}=/)!==-1){a=a.split("=");isNaN(a[1])||(a[1]=+a[1]);switch(a[0]){case "+":a=b+a[1];break;case "-":a=
b-a[1];break;case "*":a=b*a[1];break;case "/":a=b/a[1]}}return a};Collection.getRandomInt=function(a,b){a=a||0;return Math.floor(Math.random()*((b||10)-a+1))+a};Collection.date=function(a){return new Date(a)};Collection.between=function(a,b,c,d){a=g.date(a);if(d===true)g.date(b)<=a&&g.date(c);else if(d==="left")g.date(b)<=a&&g.date(c);else d==="right"&&g.date(b)<a&&g.date(c);return g.date(b)<a&&a<g.date(c)};Collection.extend=function(){var a,b,c,d,e,f=arguments[0]||{},h=0,j=arguments.length,k=false;
if(g.isBoolean(f)){k=f;f=arguments[1]||{};h=1}if(typeof f!=="object"&&!g.isFunction(f))f={};if(j===h){f=g;h-=1}for(;(h+=1)<j;)if(g.isExists(a=arguments[h]))for(b in a){c=f[b];d=a[b];if(f!==d)if(k&&d&&(g.isPlainObject(d)||(e=g.isArray(d)))){if(e){e=false;c=c&&g.isArray(c)?c:[]}else c=c&&g.isPlainObject(c)?c:{};f[b]=g.extend(k,c,d)}else if(typeof d!=="undefined")f[b]=d}return f};Collection.addElementToObject=function(a,b,c){b=b.split(g.METHOD);var d,e={};if(b[1]&&b[1]==="unshift"){e[!isNaN(Number(b[0]))?
0:b[0]]=c;for(d in a)if(a.hasOwnProperty(d))e[!isNaN(Number(d))?+d+1:d]=a[d];return e}else if(!b[1]||b[1]==="push")a[b[0]]=c;return true};Collection.unshift=function(a,b){var c=[b],d,e;try{e=a.callee}catch(f){e=true}if(e)Array.prototype.forEach.call(a,function(h){c.push(h)});else for(d in a)a.hasOwnProperty(d)&&c.push(a[d]);return c};Collection.toArray=function(a){var b=[],c,d;try{d=a.callee}catch(e){d=true}if(d)Array.prototype.forEach.call(a,function(f){b.push(f)});else for(c in a)a.hasOwnProperty(c)&&
b.push(a[c]);return b};if(!Array.prototype.forEach||x)Array.prototype.forEach=function(a,b){for(var c=-1,d=this.length;(c+=1)<d;)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.some||x)Array.prototype.some=function(a,b){for(var c=-1,d=this.length,e;(c+=1)<d;)if(e=b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.every||x)Array.prototype.every=function(a,b){for(var c=-1,d=this.length,e,f=true;(c+=1)<d;){e=b?a.call(b,this[c],c,this):a(this[c],
c,this);if(f===true&&!e){f=false;break}}return f};if(!Array.prototype.filter||x)Array.prototype.filter=function(a,b){for(var c=-1,d=this.length,e=[];(c+=1)<d;)if(b)a.call(b,this[c],c,this)&&e.push(this[c]);else a(this[c],c,this)&&e.push(this[c]);return e};if(!Array.prototype.map||x)Array.prototype.map=function(a,b){for(var c=-1,d=this.length,e=[];(c+=1)<d;)b?e.push(a.call(b,this[c],c,this)):e.push(a(this[c],c,this));return e};if(!Array.prototype.indexOf||x)Array.prototype.indexOf=function(a,b){for(var c=
(b||0)-1,d=this.length;(c+=1)<d;)if(this[c]===a)return c;return-1};if(!Array.prototype.lastIndexOf||x)Array.prototype.lastIndexOf=function(a,b){var c=b||this.length;if(c<0)c=this.length+c;for(;(c-=1)>-1;)if(this[c]===a)return c;return-1};if(!Array.prototype.reduce||x)Array.prototype.reduce=function(a,b){var c=0,d=this.length,e;if(d===1)return this[0];for(e=b?b:this[0];(c+=1)<d;)e=a(e,this[c],c,this);return e};if(!Array.prototype.reduceRight||x)Array.prototype.reduceRight=function(a,b){var c=this.length-
1,d;if(this.length===1)return this[0];for(d=b?b:this[c];(c-=1)>-1;)d=a(d,this[c],c,this);return d};Collection.prototype={name:"Collection",version:"3.7.2",collection:function(){return this.name+" "+this.version},ACTIVE:"active",DISABLED:"disabled",NO_DATA:"no-data",CTM_SIMPLE_TAG:"span",CTM:"ctm",TABLE_SIMPLE_TAG:"div",TABLE_DEF_COUNT:4,SHUFFLE:"shuffle",NAMESPACE:".",SPLITTER:">>>",SHORT_SPLITTER:">>",VARIABLE:["<:",":>"],WITH:"+",DEF:":",DEF_REGEXP:/^\s*:/,FILTER_REGEXP:/&&|\|\||:|!/,stack:[{namespace:""},
{collection:""},{filter:""},{context:""},{cache:""},{variable:""},{defer:""},{page:""},{parser:""},{toHTML:""},{target:""},{calculator:""},{pager:""},{template:""},{breaker:""},{navBreaker:""},{resultNull:""}]};var w=Collection.prototype;Collection.drivers={};Collection.drivers.dom={find:function(a,b){if(!this.lib)throw Error("DOM driver is not defined!");return this.engines[this.lib].find(a||"",b||"")},children:function(a,b){var c=[];Array.prototype.forEach.call(a.childNodes,function(d){if(d.nodeType===
1)if(b)d[b]&&c.push(d);else c.push(d)});return c},data:function(a,b){var c=a.attributes,d={};c&&c.length>0&&Array.prototype.forEach.call(c,function(e){if(e.name.substring(0,5)==="data-")d[e.name.replace("data-","")]=g.isString(e.value)&&e.value.search(/^\{|\[/)!==-1?JSON.parse(e.value):e.value});if(b)return d[b];return d},text:function(a){a=a.childNodes;var b="";Array.prototype.forEach.call(a,function(c){if(c.nodeType===3&&c.textContent.trim())b+=c.textContent});if(b)return b;return false},bind:function(a,
b,c){if(this.engines[this.lib][b]){this.engines[this.lib][b](a,c);return this}document.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c);return this},addClass:function(a,b){if(a.className.split(" ").indexOf(b)===-1)a.className+=" "+b;return this},hasClass:function(a,b){return a.className.split(" ").indexOf(b)!==-1},removeClass:function(a,b){var c=[];a.className.split(" ").forEach(function(d){d!==b&&c.push(d)});a.className=c.join(" ");return this},engines:{qsa:{is:function(){if(typeof qsa!==
"undefined")return true},find:function(a,b){return qsa.querySelectorAll(a,b)}},sizzle:{is:function(){if(typeof Sizzle!=="undefined")return true},find:function(a,b){return Sizzle(a,b)}},jQuery:{is:function(){if(typeof jQuery!=="undefined")return true},find:function(a,b){return jQuery(a,b)},click:function(a,b){$(a).click(b)},change:function(a,b){$(a).change(b)}},dojo:{is:function(){if(typeof dojo!=="undefined")return true},find:function(a,b){return b?dojo.query(a,b):dojo.query(a)},click:function(a,
b){dojo.connect(a,"onclick",b)}},mootools:{is:function(){if(typeof MooTools!=="undefined")return true},find:function(a,b){var c;if(b){c=[];$$(b).getElements(a).forEach(function(d){d.forEach(function(e){c.push(e)})})}else c=$$(a);return c}},prototype:{is:function(){if(typeof Prototype!=="undefined")return true},find:function(a,b){return b?b.getElementsBySelector(a):$$(a)}}}};var u=g.drivers.dom;for(A in u.engines)if(u.engines.hasOwnProperty(A))if(u.engines[A].is()){u.lib=A;break}Collection.parseNode=
function(a){var b=[];Array.prototype.forEach.call(a,function(c){if(c.nodeType===1){var d=u.data(c),e=c.hasAttribute("class")?c.getAttribute("class").split(" "):"",f=u.text(c),h,j=b.length;b.push({});for(h in d)if(d.hasOwnProperty(h))b[j][h]=d[h];if(e){b[j][g.CLASSES]={};e.forEach(function(k){b[j][g.CLASSES][k]=k})}if(c.childNodes.length!==0)b[j][g.CHILD_NODES]=g.parseNode(c.childNodes);if(f!==false)b[j][g.VAL]=f.replace(/[\r\t\n]/g," ")}});return b};Collection.fromNode=function(a,b){if(typeof JSON===
"undefined"||!JSON.parse)throw Error("object JSON is not defined!");var c=g.parseNode(u.find(a));if(b)return new g(c,b);return new g(c)};Collection.ctplCompile=function(a){g.isString(a)&&(a=u.find(a));if(a.length===0)throw Error("DOM element does't exist!");a=(a[0]?a[0][0]?a[0][0].innerHTML:a[0].innerHTML:a.innerHTML).replace(/\/\*.*?\*\//g,"").split(this.DOM[1]).join(this.DOM[0]).replace(/[\r\t\n]/g," ").split(this.DOM[0]);var b='var result = ""; ',c=RegExp("\\s+"+this.ECHO+"\\s+");a.forEach(function(d,
e){b+=e===0||e%2===0?'result +="'+d.split('"').join('\\"')+'";':d.split(c).join("result +=")});return new Function("el","key","data","i","length","cObj","id",b+" return result;")};Collection.prototype.ctplMake=function(a){g.isString(a)&&(a=u.find(a));Array.prototype.forEach.call(a,function(b){var c=u.data(b,"ctpl"),d,e=c.prefix?c.prefix+"_":"";this._push("template",e+c.name,g.ctplCompile(b));c.set&&c.set===true&&this._set("template",e+c.name);for(d in c)if(c.hasOwnProperty(d))if(["prefix","set","print",
"name","collection"].indexOf(d)===-1){if(["target","pager"].indexOf(d)!==-1)c[d]=u.find(c[d]);this._push(d,e+c.name,c[d]);c.set&&c.set===true&&this._set(d,e+c.name);if(["filter","parser"].indexOf(d)!==-1)c[d]=e+c.name}if(!c.target){this._push("target",e+c.name,[b.parentNode]);c.set&&c.set===true&&this._set("target",e+c.name)}if(c.print&&c.print===true){c.template=c.name;this.print(c)}},this);return this};Collection.fields={dObj:{active:{namespace:"nm",collection:null,filter:false,context:"",cache:{autoIteration:true,
iteration:true,firstIteration:false,lastIteration:false},variable:null,defer:"",page:1,parser:false,toHTML:"replace",target:null,calculator:null,pager:null,template:null,breaker:null,navBreaker:5,resultNull:""}}};var C=g.fields.dObj.active;Collection.fields.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};var B=g.fields.dObj.sys;Collection.prototype.stack.forEach(function(a){var b,c;for(b in a)if(a.hasOwnProperty(b)){c=g.toUpperCase(b,1);a[b]=C[b];B["active"+c+"Id"]=null;
B["tmp"+c]={};B[b+"ChangeControl"]=null;B[b+"Back"]=[]}});Collection.prototype._new=function(a,b){var c;this["onNew"+d]&&(c=this["onNew"+d](b));if(c===false)return this;c=this.dObj.active;var d=g.toUpperCase(a,1),e=g.drivers.dom;c[a]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b)?this["_compile"+g.toUpperCase(a,1)](b):["target","pager"].indexOf(a)!==-1&&g.isString(b)?e.find.apply(e,g.isArray(b)?b:[b]):g.expr(b,c[a]||"");this.dObj.sys["active"+d+"Id"]=null;return this};Collection.prototype._update=
function(a,b){var c;this["onUpdate"+d]&&(c=this["onUpdate"+d](b));if(c===false)return this;c=this.dObj.active;var d=g.toUpperCase(a,1),e=this._getActiveId(a),f=g.drivers.dom;c[a]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b)?this["_compile"+d](b):["target","pager"].indexOf(a)!==-1&&g.isString(b)?f.find.apply(f,g.isArray(b)?b:[b]):g.expr(b,c[a]||"");if(e)this.dObj.sys["tmp"+d][e]=c[a];return this};Collection.prototype._get=function(a,b){if(b&&b!==this.ACTIVE){if(!this._exists(a,
b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");return this.dObj.sys["tmp"+g.toUpperCase(a,1)][b]}return this.dObj.active[a]};Collection.prototype._push=function(a,b,c){var d;this["onPush"+e]&&(d=this["onPush"+e](b,c||""));if(d===false)return this;var e=g.toUpperCase(a,1);d=this.dObj.sys["tmp"+e];var f=this._getActiveId(a),h,j=g.drivers.dom;if(g.isPlainObject(b))for(h in b){if(b.hasOwnProperty(h))if(h===this.ACTIVE)this._update(a,b[h]);else if(d[h]&&f&&f===h)this._update(a,
b[h]);else d[h]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b[h])?this["_compile"+e](b[h]):["target","pager"].indexOf(a)!==-1&&g.isString(b[h])?j.find.apply(j,g.isArray(b[h])?b[h]:[b[h]]):b[h]}else if(b===this.ACTIVE)this._update(a,c);else if(d[b]&&f&&f===b)this._update(a,c);else d[b]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(c)?this["_compile"+e](c):["target","pager"].indexOf(a)!==-1&&g.isString(c)?j.find.apply(j,g.isArray(c)?c:[c]):c;return this};Collection.prototype._set=
function(a,b){if(!b||b===this.ACTIVE)return this;var c;this["onSet"+d]&&(c=this["onSet"+d](b));if(c===false)return this;c=this.dObj.sys;var d=g.toUpperCase(a,1),e=a+"ChangeControl",f="active"+d+"Id";if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");if(c[f]!==b){c[e]=true;c[f]=b;c[a+"Back"].push(b);this.dObj.active[a]=c["tmp"+d][b]}else c[e]=false;return this};Collection.prototype._back=function(a,b){var c;this["onBack"+d]&&(c=this["onBack"+d](b));if(c===
false)return this;b=b||1;c=this.dObj.sys;var d=g.toUpperCase(a,1),e=c[a+"Back"],f=e.length-b-1;if(f>=0&&e[f])if(c["tmp"+d][e[f]]){this._set(a,e[f]);c[a+"ChangeControl"]=false;e.splice(f+1,e.length)}return this};Collection.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};Collection.prototype._drop=function(a,b,c,d){c=typeof c==="undefined"?false:c;var e;if(typeof d==="undefined")this["onDrop"+h]&&(e=this["onDrop"+h](b,c));
else this["onReset"+h]&&(e=this["onReset"+h](b,d));if(e===false)return this;e=this.dObj.active;var f=this.dObj.sys,h=g.toUpperCase(a,1),j="active"+h+"Id";h="tmp"+h;var k=this._getActiveId(a);b=!b?k?[k]:[]:g.isArray(b)||g.isPlainObject(b)?b:[b];var m;if(b[0]&&b[0]!==this.ACTIVE)for(m in b){if(b.hasOwnProperty(m))if(!b[m]||b[m]===this.ACTIVE)if(typeof d==="undefined"){k&&delete f[h][k];f[j]=null;e[a]=c}else{if(k)f[h][k]=d;e[a]=d}else if(typeof d==="undefined"){delete f[h][b[m]];if(k&&b[m]===k){f[j]=
null;e[a]=c}}else{f[h][b[m]]=d;if(k&&b[m]===k)e[a]=d}}else if(typeof d==="undefined"){k&&delete f[h][k];f[j]=null;e[a]=c}else{if(k)f[h][k]=d;e[a]=d}return this};Collection.prototype._reset=function(a,b,c){return this._drop(a,b||"","",typeof c==="undefined"?false:c)};Collection.prototype._resetTo=function(a,b,c){c=!c||c===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+g.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};Collection.prototype._exists=function(a,b){var c=g.toUpperCase(a,1);if((!b||
b===this.ACTIVE)&&this._getActiveId(a))return true;if(typeof this.dObj.sys["tmp"+c][b]!=="undefined")return true;return false};Collection.prototype._validate=function(a,b){return!b||b===this.ACTIVE||this._exists(a,b)};Collection.prototype._getActiveId=function(a){return this.dObj.sys["active"+g.toUpperCase(a,1)+"Id"]};Collection.prototype._active=function(a,b){if(!b)return this._getActiveId(a);if(b===this._getActiveId(a))return true;return false};Collection.prototype.use=function(a){this.stack.forEach(function(b){var c,
d,e,f;for(f in b)if(b.hasOwnProperty(f))if(this._exists(f,a))this._set(f,a);else{c=a.split(this.NAMESPACE);for(e=c.length;(e-=1)>-1;){c.splice(e,1);d=c.join(this.NAMESPACE);if(this._exists(f,d)){this._set(f,d);break}}}},this);return this};Collection.prototype.stack.forEach(function(a){var b,c;for(b in a)if(a.hasOwnProperty(b)){c=g.toUpperCase(b,1);w["new"+c]=function(d){return function(e){return this._new(d,e)}}(b);w["update"+c]=function(d){return function(e){return this._update(d,e)}}(b);w["reset"+
c]=function(d,e){return function(){return this._reset(d,arguments,e)}}(b,a[b]);w["reset"+c+"To"]=function(d){return function(e,f){return this._resetTo(d,e,f)}}(b);w["push"+c]=function(d){return function(){return this._push.apply(this,g.unshift(arguments,d))}}(b);w["set"+c]=function(d){return function(e){return this._set(d,e)}}(b);w["pushSet"+c]=function(d){return function(e,f){return this._push(d,e,f)._set(d,e)}}(b);w["back"+c]=function(d){return function(e){return this._back(d,e||"")}}(b);w["back"+
c+"If"]=function(d){return function(e){return this._backIf(d,e||"")}}(b);w["drop"+c]=b==="filter"||b==="parser"?function(d){return function(){return this._drop(d,arguments)}}(b):function(d){return function(){return this._drop(d,arguments,null)}}(b);w["active"+c]=function(d){return function(e){return this._active(d,e)}}(b);w["exists"+c]=function(d){return function(e){return this._exists(d,e||"")}}(b);w["validate"+c]=function(d){return function(e){return this._validate(d,e||"")}}(b);w["get"+c+"ActiveId"]=
function(d){return function(){return this._getActiveId(d)}}(b);w["get"+c]=function(d){return function(e){return this._get(d,e||"")}}(b)}});Collection.prototype._setOne=function(a,b,c){var d;this.onSet&&(d=this.onSet.apply(this,arguments));if(d===false)return this;a=g.isExists(a)?a.toString():"";b=typeof b==="undefined"?"":b;c=c||"";d=this._getActiveParam("context");if(!a&&!d)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);g.byLink(this._get("collection",c),d+g.CHILDREN+
a,b);return this};Collection.prototype._getOne=function(a,b){a=g.isExists(a)?a.toString():"";return g.byLink(this._get("collection",b||""),this._getActiveParam("context")+g.CHILDREN+a)};Collection.prototype.add=function(a,b,c){var d;this.onAdd&&(d=this.onAdd.apply(this,arguments));if(d===false)return this;var e;a=typeof a!=="undefined"?a:"";a=g.isString(a)?(e=true)&&a.split(this.SHORT_SPLITTER):a;b=b||"push";c=c||"";d="";if(e)if(a.length===2){d=a[0].trim();a=a[1].trim();if(a.search(/^\{|\[/)!==-1||
!isNaN(parseFloat(a)))a=eval(a)}else a=a[0].trim();e=this._getOne(d,c);if(typeof e!=="object")throw Error("unable to set property!");if(g.isPlainObject(e)){b=b==="push"?this.length(e):b==="unshift"?this.length(e)+g.METHOD+"unshift":b;d=g.addElementToObject(e,b.toString(),a)}else{d=true;e[b](a)}d!==true&&this._setOne("",d,c);return this};Collection.prototype.push=function(a,b){return this.add(a,"",b||"")};Collection.prototype.unshift=function(a,b){return this.add(a,"unshift",b||"")};Collection.prototype._removeOne=
function(a,b){var c;this.onRemove&&(c=this.onRemove.apply(this,arguments));if(c===false)return this;a=g.isExists(a)?a.toString():"";c=this._getActiveParam("context");!a&&!c?this._setOne("",null):g.byLink(this._get("collection",b||""),c+g.CHILDREN+a,"",true);return this};Collection.prototype._remove=function(a,b){b=b||"";var c,d;if(g.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(g.isArray(a[c]))for(d=a[c].length;(d-=1)>-1;)this._removeOne(a[c][d],c);else this._removeOne(a[c],c)}else if(g.isArray(a))for(d=
a.length;(d-=1)>-1;)this._removeOne(a[d],b);else this._removeOne(a,b);return this};Collection.prototype.concat=function(a,b){var c,d;this.onConcat&&(c=this.onConcat.apply(this,arguments));if(c===false)return this;b=(b=b||"").split(this.DEF);d=b.length===2?b[1].trim():"";b=b[0].trim();c=this._getOne(d,b);if(typeof c!=="object")throw Error("incorrect data type!");if(g.isPlainObject(c))g.extend(true,c,a);else if(g.isArray(c))if(g.isArray(a)){c=Array.prototype.concat(c,a);this._setOne(d,c,b)}else this.add(a,
"push",b);return this};Collection.prototype.length=function(a,b,c,d,e,f,h){var j;if(!g.isFunction(a))if(g.isString(a)&&!this._isFilter(a)&&!g.isExists(b)||g.isCollection(a)){b=a;a=false}b=b?g.isString(b)?this._get("collection",b):b:this._get("collection");if(b===null)return 0;if(g.isString(b))return b.length;if((a===true||!a)&&!this._getActiveParam("filter")&&typeof b.length!=="undefined")j=b.length;else{j=0;this.forEach(function(){j+=1},a,b,true,c||"",d||"",e||"",f||"",h||"")}return j};Collection.prototype.forEach=
function(a,b,c,d,e,f,h,j,k){a=this._isStringExpression(a)?this._compileFunc(a):a;b=g.isString(b=b||"")?b.split(this.SHORT_SPLITTER):b;c=c||"";d=d===false?false:true;e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||false;h=parseInt(h)||false;j=parseInt(j)||false;k=k||false;var m=this,q={},i=[],o="",r,s,l,p,n=0,t=0,v=false;if(g.isArray(b))if(b.length===2){o=b[0].trim();b=b[1].trim()}else b=b[0].trim();r=!g.isCollection(c)?this._getOne(o,c):c;if(typeof r!=="object")throw Error("incorrect data type!");
s=function(){if(!s.val)s.val=m.length(b,c);return s.val};l=function(z,y){if(!l.val)l.val=m.length(z||"",y||"");return l.val};if(g.isArray(r)){i=h!==false&&!k?r.slice(h):r;if(k)for(p=i.length-h;(p-=1)>-1;){if(j&&p===j)break;if(e!==false&&t===e)break;if(this._customFilter(b,i[p],p,r,n,l,this,c,q)===true)if(f!==false&&f!==0)f-=1;else{v=a.call(a,i[p],p,r,n,s,this,c)===false;if(d===false)v=true;t+=1}n+=1;if(v===true)break}else i.some(function(z,y){y+=h;if(j&&y===j)return true;if(e!==false&&t===e)return true;
if(this._customFilter(b,z,y,r,n,l,this,c,q)===true)if(f!==false&&f!==0)f-=1;else{v=a.call(a,z,y,r,n,s,this,c)===false;if(d===false)v=true;t+=1}n+=1;if(v===true)return true},this)}else if(k){for(p in r)r.hasOwnProperty(p)&&i.push(p);for(p=i.length-h;(p-=1)>-1;){if(j&&p===j)break;if(e!==false&&t===e)break;if(this._customFilter(b,r[i[p]],i[p],r,n,l,this,c,q)===true)if(f!==false&&f!==0)f-=1;else{v=a.call(a,r[i[p]],i[p],r,n,s,this,c)===false;if(d===false)v=true;t+=1}n+=1;if(v===true)break}}else for(p in r)if(r.hasOwnProperty(p)){if(j&&
n===j)break;if(e!==false&&t===e)break;if(h!==false&&h!==0)h-=1;else{if(this._customFilter(b,r[p],p,r,n,l,this,c,q)===true)if(f!==false&&f!==0)f-=1;else{v=a.call(a,r[p],p,r,n,s,this,c)===false;if(d===false)v=true;t+=1}n+=1;if(v===true)break}}q.name&&this._drop("filter","__tmp:"+q.name);l=s=null;return this};Collection.prototype.some=function(a,b,c,d,e,f,h){return this.forEach(a,b||"",c||"",false,"",d||"",e||"",f||"",h||"")};Collection.prototype.search=function(a,b,c){b=this._splitId(b);c=c===false?
false:true;var d=c===true?[]:-1,e=b.to,f=b.set,h=g.toArray(arguments);b=h[1]=b.id;h.unshift(c===true?function(j,k){d.push(k)}:function(j,k){d=k});this.forEach.apply(this,h);if(e)return this._saveResult(e,f,d);return d};Collection.prototype.searchOne=function(a,b,c,d,e,f){return this.search(a||"",b||"",false,"",c||"",d||"",e||"",f||"")};Collection.prototype.indexOf=function(a,b,c){return this.searchOne(function(d){return d===a},c||"","",b||"")};Collection.prototype.lastIndexOf=function(a,b,c){return this.searchOne(function(d){return d===
a},c||"","",b||"","",true)};Collection.prototype.get=function(a,b,c,d,e,f,h,j){b=this._splitId(b);var k,m=b.to,q=b.set,i=g.toArray(arguments);b=i[1]=b.id;if(g.isArray(a)){k=[];a.forEach(function(o){k=k.concat(this.get(o,b,c||"",d||"",e||"",f||"",h||"",j||""))},this)}else if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)k=this._getOne(a,b);else{c=c===false?false:true;k=c===true||g.isArray(a)?[]:-1;i.unshift(c===true?function(o,r,s){k.push(s[r])}:function(o,r,s){k=
s[r]});this.forEach.apply(this,i)}if(m)return this._saveResult(m,q,k);return k};Collection.prototype.getOne=function(a,b,c,d,e,f){return this.get(a||"",b||"",false,"",c||"",d||"",e||"",f||"")};Collection.prototype.set=function(a,b,c){if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)return this._setOne(a,b,c||"");var d;this.onSet&&(d=this.onSet.apply(this,arguments));if(d===false)return this;b=this._isStringExpression(b)?this._compileFunc(b):b;d=g.isFunction(b);
d=g.unshift(arguments,d?function(e,f,h){var j=b.apply(b,arguments);if(typeof j!=="undefined")h[f]=j}:function(e,f,h){h[f]=g.expr(b,h[f])});d.splice(2,1);return this.forEach.apply(this,d)};Collection.prototype.setOne=function(a,b,c,d,e,f,h){return this.set(a||"",b,c||"",false,"",d||"",e||"",f||"",h||"")};Collection.prototype.map=function(a,b,c){c=this._splitId(c);var d,e=c.to,f=c.set,h=g.toArray(arguments),j,k,m;c=h[2]=c.id;a=this._isStringExpression(a)?this._compileFilter(a):a||"";j=g.isFunction(a);
k=!j&&g.isExists(a);d=(m=g.isArray(this._getOne("",c)))?[]:{};h.unshift(j?m?function(){d.push(a.apply(a,arguments))}:function(q,i){d[i]=a.apply(a,arguments)}:k?m?function(q,i,o){d.push(g.expr(a,o[i]))}:function(q,i,o){d[i]=g.expr(a,o[i])}:m?function(q,i,o){d.push(o[i])}:function(q,i,o){d[i]=o[i]});h.splice(1,1);this.forEach.apply(this,h);if(e)return this._saveResult(e,f,d);return d};Collection.prototype.move=function(a,b,c,d,e,f,h,j,k,m){m=m===false?false:true;var q;m&&this.onMove&&(q=this.onMove.apply(this,
arguments));!m&&this.onCopy&&(q=this.onCopy.apply(this,arguments));if(q===false)return this;a=a||"";b=this._splitId(b);var i=[],o;q=b.to;var r=b.set,s,l=g.toArray(arguments);b=l[1]=b.id;if((!b||b===this.ACTIVE)&&r===true){if(s=this._active("collection"))b=s}else s=true;l.splice(2,1);l.unshift(function(p,n){i.push(n);o.push(p)});if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false){o=this._getOne(a,b);i.push(a)}else{o=[];this.forEach.apply(this,l)}this._saveResult(q,
r,o);if(m===true&&s)k===true?i.forEach(function(p){this._removeOne(p,b)},this):this._remove(i,b);return this};Collection.prototype.moveOne=function(a,b,c,d,e,f,h){return this.move(a||"",b||"",c||"",false,"",d||"",e||"",f||"",h||"")};Collection.prototype.copy=function(a,b,c,d,e,f,h){return this.move(a||"",b||"",c||"push",d===false?false:true,e||"",f||"",h||"",false)};Collection.prototype.copyOne=function(a,b,c,d,e,f,h){return this.move(a||"",b||"",c||"",false,"",d||"",e||"",f||"",h||"",false)};Collection.prototype.remove=
function(a,b,c,d,e,f,h,j){if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)return this._removeOne(a,b||"");else if(g.isArray(a)||g.isPlainObject(a))return this._remove(a,b||"");var k=this.search.apply(this,arguments);if(g.isArray(k))j===true?k.forEach(function(m){this._removeOne(m,b)},this):this._remove(k,b);else this._removeOne(k,b);return this};Collection.prototype.removeOne=function(a,b,c,d,e,f){return this.remove(a||"",b||"",false,"",c||"",d||"",e||"",f||"")};
Collection.prototype.pop=function(a,b,c,d,e){a=a||"";if(g.isNumber(b)||g.isString(b)&&!this._isFilter(b)||arguments.length<2||b===false)return this._removeOne("eq(-1)",a);return this.removeOne(b||"",a,c||"",d||"",e||"",true)};Collection.prototype.shift=function(a,b,c,d,e){a=a||"";if(g.isNumber(b)||g.isString(b)&&!this._isFilter(b)||arguments.length<2||b===false)return this._removeOne("eq(0)",a);return this.removeOne(b||"",a,c||"",d||"",e||"")};Collection.prototype.group=function(a,b,c,d,e,f,h,j,k,
m){a=this._isStringExpression(a=a||"")?this._compileFilter(a):a;c=this._splitId(c);m=m||false;var q=g.isString(a),i={},o=c.to,r=c.set,s=g.toArray(arguments);c=s[2]=c.id;s.unshift(q?m?function(l,p){var n=g.byLink(l,a);if(i[n])i[n].push(p);else i[n]=[p]}:function(l){var p=g.byLink(l,a);if(i[p])i[p].push(l);else i[p]=[l]}:m?function(l,p){var n=a.apply(a,arguments);if(i[n])i[n].push(p);else i[n]=[p]}:function(l){var p=a.apply(a,arguments);if(i[p])i[p].push(l);else i[p]=[l]});s.splice(1,1);this.forEach.apply(this,
s);if(o)return this._saveResult(o,r,i);return i};Collection.prototype.groupLinks=function(a,b,c,d,e,f,h,j,k){return this.group(a||"",b||"",c||"",d===false?false:true,e||"",f||"",h||"",j||"",k||"",true)};Collection.prototype.stat=function(a,b,c,d,e,f,h,j,k){a=(a=a||"count")&&this._isStringExpression(a)?this._compileFilter(a):a;b=(b=b||"")&&this._isStringExpression(b)?this._compileFilter(b):b;d=this._splitId(d);e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||false;h=parseInt(h)||false;j=parseInt(j)||
false;k=k||false;var m=g.isString(a),q=g.isString(b),i=0,o=0,r=d.to,s=d.set;d=d.id;switch(a){case "count":m=function(){i+=1};break;case "summ":m=q?function(l){l=g.byLink(l,b);i+=l;return true}:function(){var l=b.apply(this,arguments);i+=l;return true};break;case "avg":m=q?function(l){l=g.byLink(l,b);o+=1;i+=l;return true}:function(){var l=b.apply(this,arguments);o+=1;i+=l;return true};break;case "max":m=q?function(l){l=g.byLink(l,b);if(l>i)i=l;return true}:function(){var l=b.apply(this,arguments);
if(l>i)i=l;return true};break;case "min":m=q?function(l){l=g.byLink(l,b);if(o===0){i=l;o=1}else if(l<i)i=l;return true}:function(){var l=b.apply(this,arguments);if(o===0){i=l;o=1}else if(l<i)i=l;return true};break;default:m=m?q?function(l){l=g.byLink(l,b);if(o===0){i=l;o=1}else i=g.expr(a+"="+l,i);return true}:function(){var l=b.apply(this,arguments);if(o===0){i=l;o=1}else i=g.expr(a+"="+l,i);return true}:q?function(l){l=g.byLink(l,b);i=a(l,i);return true}:function(){var l=b.apply(this,arguments);
i=a(l,i);return true}}if(a!=="first"&&a!=="last"){this.forEach(m,c||"",d,"",e,f,h,j,k);if(a==="avg")i/=o}else i=a==="first"?this._getOne(g.ORDER[0]+"0"+g.ORDER[1]):this._getOne(g.ORDER[0]+"-1"+g.ORDER[1]);if(r)return this._saveResult(r,s,i);return i};Collection.prototype.groupStat=function(a,b,c,d,e,f,h,j,k){a=(a=a||"count")&&this._isStringExpression(a)?this._compileFilter(a):a;b=(b=b||"")&&this._isStringExpression(b)?this._compileFilter(b):b;d=this._splitId(d);e=parseInt(e)>=0?parseInt(e):false;
f=parseInt(f)||false;h=parseInt(h)||false;j=parseInt(j)||false;k=k||false;var m=g.isString(a),q=g.isString(b),i={},o={},r=d.to,s=d.set,l,p;d=d.id;switch(a){case "count":p=function(){i[this.key]+=1};break;case "summ":p=q?function(n){n=g.byLink(n,b);i[this.key]+=n;return true}:function(){var n=b.apply(this,arguments);i[this.key]+=n;return true};break;case "avg":p=q?function(n){n=g.byLink(n,b);o[this.key]+=1;i[this.key]+=n;return true}:function(){var n=b.apply(this,arguments);o[this.key]+=1;i[this.key]+=
n;return true};break;case "max":p=q?function(n){n=g.byLink(n,b);if(n>i[this.key])i[this.key]=n;return true}:function(){var n=b.apply(this,arguments);if(n>i[this.key])i[this.key]=n;return true};break;case "min":p=q?function(n){n=g.byLink(n,b);if(o[this.key]===0){i[this.key]=n;o[this.key]=1}else if(n<i[this.key])i[this.key]=n;return true}:function(){var n=b.apply(this,arguments);if(o[this.key]===0){i[this.key]=n;o[this.key]=1}else if(n<i[this.key])i[this.key]=n;return true};break;default:p=m?q?function(n){n=
g.byLink(n,b);if(o[this.key]===0){i[this.key]=n;o[this.key]=1}else i[this.key]=g.expr(a+"="+n,i[this.key]);return true}:function(){var n=b.apply(this,arguments);if(o[this.key]===0){i[this.key]=n;o[this.key]=1}else i[this.key]=g.expr(a+"="+n,i[this.key]);return true}:q?function(n){n=g.byLink(n,b);i[this.key]=a(n,i[this.key]);return true}:function(){var n=b.apply(this,arguments);i[this.key]=a(n,i[this.key]);return true}}this.forEach(a!=="first"&&a!=="last"?function(n,t,v,z,y,D,E){i[t]||(i[t]=o[t]=0);
if(a!=="first"&&a!=="last")D._update("context","+="+g.CHILDREN+(p.key=t)).forEach(p,c||"",E,"",e,f,h,j,k).parent();return true}:a==="first"?function(n,t){i[t]||(i[t]=o[t]=0);i[t]=g.byLink(n,g.ORDER[0]+"0"+g.ORDER[1]);return true}:function(n,t){i[t]||(i[t]=o[t]=0);i[t]=g.byLink(n,g.ORDER[0]+"-1"+g.ORDER[1]);return true},"",d);if(a==="avg")for(l in i)if(i.hasOwnProperty(l))i[l]/=o[l];if(r)return this._saveResult(r,s,i);return i};Collection._sortObject=function(a,b,c){b=[];var d={},e;for(e in a)a.hasOwnProperty(e)&&
b.push({key:e,value:a[e]});b.sort(c);for(e in b)if(b.hasOwnProperty(e))d[b[e].key]=b[e].value;return d};Collection._sortObjectByKey=function(a,b){var c=[],d={},e;for(e in a)a.hasOwnProperty(e)&&c.push(e);c.sort(b);for(e in c)if(c.hasOwnProperty(e))d[c[e]]=a[c[e]];return d};Collection.prototype.sort=function(a,b,c,d){var e;this.onSort&&(e=this.onSort.apply(this,arguments));if(e===false)return this;a=typeof a!=="undefined"?a:"";a=g.isString(a)?a.split(this.SHORT_SPLITTER):a;b=b||false;c=c||"";d=d&&
d!==true?d===false?"":d:function(j){if(g.isString(j))return j.toUpperCase();return j};d=this._isStringExpression(d)?this._compileFilter(d):d;var f=this,h;h="";e=function(j,k){var m=b?-1:1;if(a)if(g.isFunction(a)){j=a(j,c);k=a(k,c)}else{j=g.byLink(j,a);k=g.byLink(k,a)}if(d){j=d(j,c);k=d(k,c)}if(b!==f.SHUFFLE){if(j<k)return m*-1;if(j>k)return m;return 0}else return Math.round(Math.random()*2-1)};if(g.isArray(a))if(a[1]){h=a[0].trim();a=a[1].trim()}else a=a[0].trim();a=this._isStringExpression(a)?this._compileFilter(a):
a;h=this._getOne(h,c);if(typeof h!=="object")throw Error("incorrect data type!");if(Collection.isArray(h))h.sort(e);else{if(a){a=a===true?"value":"value"+g.CHILDREN+a;h=g._sortObject(h,a,e)}else h=g._sortObjectByKey(h,e);this._setOne("",h,c)}return this};Collection._reverseObject=function(a){var b=[],c={},d;for(d in a)a.hasOwnProperty(d)&&b.push(d);b.reverse();for(d in b)if(b.hasOwnProperty(d))c[b[d]]=a[b[d]];return c};Collection.prototype.reverse=function(a){var b;this.onReverse&&(b=this.onReverse.apply(this,
arguments));if(b===false)return this;a=(a=a||"").split(this.DEF);b=a[1]?a[1].trim():"";a=a[0].trim();b=this._getOne(b,a);if(typeof b!=="object")throw Error("incorrect data type!");g.isArray(b)?b.reverse():this._setOne("",g._reverseObject(b),a);return this};Collection.prototype.save=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");var c;this.onSave&&(c=this.onSave.apply(this,arguments));if(c===false)return this;a=a||this.ACTIVE;c="__"+this.name+
"__"+this._get("namespace");var d=a===this.ACTIVE?this._exists("collection")?this._getActiveId("collection"):"":this._active("collection",a)?"active":"",e=b===false?sessionStorage:localStorage;e.setItem(c+":"+a,this.toString(a));e.setItem(c+"__date:"+a,(new Date).toString());e.setItem(c+"__active:"+a,d);e.setItem(c+"__date",(new Date).toString());return this};Collection.prototype.saveAll=function(a){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===
false?a:true;var b,c=this.dObj.sys.tmpCollection,d=false;for(b in c){this._active("Collection",b)&&(d=true);c.hasOwnProperty(b)&&this.save(b,a)}d===false&&this.save("",a);return this};Collection.prototype.load=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");if(typeof JSON==="undefined"||!JSON.parse)throw Error("object JSON is not defined!");var c;this.onLoad&&(c=this.onLoad.apply(this,arguments));if(c===false)return this;a=a||this.ACTIVE;
c="__"+this.name+"__"+this._get("namespace");var d=b===false?sessionStorage:localStorage;a===this.ACTIVE?this._new("collection",JSON.parse(d.getItem(c+":"+a))):this._push("collection",a,JSON.parse(d.getItem(c+":"+a)));c=d.getItem(c+"__active:"+a);if(c===this.ACTIVE)this._set("collection",a);else c&&this._push("collection",c,this._get("collection"))._set("collection",c);return this};Collection.prototype.loadAll=function(a,b){b=b?"drop":"load";if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");
a=a===false?a:true;var c="__"+this.name+"__"+this._get("namespace"),d=a===false?sessionStorage:localStorage,e=d.length,f,h;try{for(f in d)if(d.hasOwnProperty(f))if((h=f.split(":"))[0]===c)this[b](h[1],a)}catch(j){for(;(e-=1)>-1;)if((h=d[e].split(":"))[0]===c)this[b](h[1],a)}return this};Collection.prototype.loadDate=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date((b===false?sessionStorage:localStorage).getItem("__"+this.name+
"__"+this._get("namespace")+"__date"+(a?":"+a:"")))};Collection.prototype.isExpired=function(a,b,c){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(b||"",c||"")))>a};Collection.prototype.drop=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");var c;this.onDrop&&(c=this.onDrop.apply(this,arguments));if(c===false)return this;a=a||this.ACTIVE;c="__"+this.name+
"__"+this._get("namespace");var d=b===false?sessionStorage:localStorage;d.removeItem(c+":"+a);d.removeItem(c+"__date:"+a);d.removeItem(c+"__active:"+a);return this};Collection.prototype.dropAll=function(a){(a===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace")+"__date");return this.loadAll(a||"",true)};Collection.prototype._customFilter=function(a,b,c,d,e,f,h,j,k){var m,q=true,i,o,r,s,l;if(!a||a===true){if(!this._getActiveParam("filter"))return true;if(this._get("filter"))return this._customFilter(this._get("filter"),
b,c,d,e,f,h,j,k);return true}if(g.isFunction(a))if(!this._getActiveParam("filter")||!k)return a.call(a,b,c,d,e,f,h,j);else{if(!k.name){for(;this._exists("filter","__tmp:"+(k.name=g.getRandomInt(0,1E4)));)k.name=g.getRandomInt(0,1E4);this._push("filter","__tmp:"+k.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+k.name,b,c,d,e,f,h,j,k)}if(!g.isArray(a)){if(this._getActiveParam("filter")&&k)a=this.ACTIVE+" && ("+a+")";if(this._isStringExpression(a=a.trim())){this._exists("filter","__tmp:"+
a)||this._push("filter","__tmp:"+a,this._compileFilter(a));return(a=this._get("filter","__tmp:"+a)).call(a,b,c,d,e,f,h,j)}a=a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1").trim().split(" ");for(l=a.length;(l-=1)>-1;)a[l]===""&&a.splice(l,1)}m=function(p,n){for(var t=-1,v=p.length,z=0,y=[];(t+=1)<v;){n+=1;if(p[t]==="("||p[t]==="!(")z+=1;if(p[t]===")")if(z===0)return{result:y,iter:n};else z-=1;y.push(p[t])}};k=a.length;for(l=-1;(l+=1)<k;)if(a[l]===
"("||a[l]==="!("){if(a[l].substring(0,1)==="!"){s=true;a[l]=a[l].substring(1)}else s=false;l=(i=m(a.slice(l+1),l)).iter;i=i.result.join(" ");i=this._customFilter(i,b,c,d,e,f,h,j);q=!o&&!r?s===true?!i:i:o?s===true?!i:i&&q:s===true?!i:i||q}else if(a[l]!==")"&&a[l]!=="||"&&a[l]!=="&&"){if(a[l].substring(0,1)==="!"){s=true;a[l]=a[l].substring(1)}else s=false;i=this._customFilter(this._get("filter",a[l]),b,c,d,e,f,h,j);q=!o&&!r?s===true?!i:i:o?s===true?!i:i&&q:s===true?!i:i||q}else if(a[l]==="||"){o=false;
r=true}else if(a[l]==="&&"){r=false;o=true}return q};Collection.prototype._compileFilter=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split(this.VARIABLE[0]).join('cObj.getVariable("').split(this.VARIABLE[1]).join('")');return new Function("el","key","data","i","length","cObj","id","return "+a.replace(this.DEF_REGEXP,"")+";")};Collection.prototype._customParser=function(a,b,c){if(!a||a===true){if(!this._getActiveParam("parser"))return b;
if(this._get("parser"))return this._customParser(this._get("parser"),b,c);return b}if(g.isFunction(a))if(!this._getActiveParam("parser")||!c)return a.call(a,b,this);else{if(!c.name){for(;this._exists("parser","__tmp:"+(c.name=g.getRandomInt(0,1E4)));)c.name=g.getRandomInt(0,1E4);this._push("parser","__tmp:"+c.name,a)}return this._customParser(this.ACTIVE+" && __tmp:"+c.name,b,c)}if(g.isString(a)){if(this._getActiveParam("parser")&&c)a=this.ACTIVE+" && "+a;if(this._isStringExpression(a=a.trim())){this._exists("parser",
"__tmp:"+a)||this._push("parser","__tmp:"+a,this._compileParser(a));return(a=this._get("parser","__tmp:"+a)).call(a,b,this)}a=a.split("&&")}a.forEach(function(d){b=this._customParser(d.trim(),b)},this);return b};Collection.prototype._compileParser=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split(this.VARIABLE[0]).join('cObj.getVariable("').split(this.VARIABLE[1]).join('")');return new Function("str","cObj","return "+a.replace(this.DEF_REGEXP,
"")+";")};Collection.prototype._compileFunc=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split(this.VARIABLE[0]).join('cObj.getVariable("').split(this.VARIABLE[1]).join('")');return new Function("el","key","data","i","length","cObj","id",a.replace(this.DEF_REGEXP,"")+";")};Collection.prototype.parentContext=function(a,b){for(var c=this._get("context",b||"").split(g.CHILDREN),d=a||1;(d-=1)>-1;)c.splice(-1,1);return c.join(g.CHILDREN)};
Collection.prototype.parent=function(a,b){if(!b)return this._update("context",this.parentContext(a));return this._push("context",b,this.parentContext(a,b))};Collection.prototype._getActiveParam=function(a){var b=typeof this.dObj.sys.flags.use[a]==="undefined"||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return b?b.toString():"";return b};Collection.prototype._isFilter=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(this.FILTER_REGEXP)!==-1};
Collection.prototype._isStringExpression=function(a){return g.isString(a)&&a.search(this.DEF_REGEXP)!==-1};Collection.prototype._splitId=function(a){a=a||"";var b={};if(a.search(this.SPLITTER)!==-1){b.id=a.split(this.SPLITTER);b.set=true}else{b.id=a.split(this.SHORT_SPLITTER);b.set=false}b.to=b.id[1]?b.id[1].trim():"";b.id=b.id[0].trim();return b};Collection.prototype._saveResult=function(a,b,c,d){a=a.split(this.WITH);d=d||false;var e;if(a[1]){a=a[1].split(this.DEF);e=a[1]?a[1].trim():"";a=a[0].trim();
if(this._validate("collection",a))d?this.concat(c,a+":"+e):this.disable("context").concat(c,a+":"+e).enable("context");else this._push("collection",a,c)}else{a=a[0].split(this.DEF);e=a[1]?a[1].trim():"";a=a[0].trim();if(this._validate("collection",a)&&(e||d))d?this._setOne(e,c,a):this.disable("context")._setOne(e,c,a).enable("context");else this._push("collection",a,c)}if(b===true)return this._set("collection",a);return this};Collection.prototype.enable=function(){Array.prototype.forEach.call(arguments,
function(a){this.dObj.sys.flags.use[a]=true},this);return this};Collection.prototype.disable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=false},this);return this};Collection.prototype.toggle=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]===true?this.disable(arguments[A]):this.enable(arguments[A])},this)};Collection.prototype.toString=function(a,b,c){if(typeof JSON==="undefined"||!JSON.stringify)throw Error("object JSON is not defined!");
a=a||"";b=b||"";c=c||"";var d;if(g.isCollection(a))return JSON.stringify(a,b,c);a=a.split(this.DEF);d=a.length===2?a[1].trim():"";a=a[0].trim();return JSON.stringify(this._getOne(d,a),b,c)};Collection.prototype.valueOf=function(a){if(a==="object")return this;return this.length(this.ACTIVE)};Collection.prototype.print=function(a,b){b=b||false;var c=this,d={},e={},f={},h,j,k,m,q=0,i,o=null,r=false,s,l="",p,n;if(g.isExists(a)&&(g.isString(a)||g.isNumber(a)))a={page:a};else g.isExists(a)||(a={page:this._get("page")});
g.extend(true,f,this.dObj.active,a);if(a)f.page=g.expr(f.page,this._get("page"));if(f.page<1)f.page=1;f.collection=g.isString(f.collection)?this._get("collection",f.collection):f.collection;f.template=g.isString(f.template)?this._get("template",f.template):f.template;f.cache=g.isExists(a.cache)?a.cache:this._getActiveParam("cache");f.target=g.isString(f.target)?u.find(f.target):f.target;f.pager=g.isString(f.pager)?u.find(f.pager):f.pager;f.filter=this._isStringExpression(f.filter)?this._compileFilter(f.filter):
f.filter;f.parser=this._isStringExpression(f.parser)?this._compileParser(f.parser):f.parser;f.callback=f.callback&&this._isStringExpression(f.callback)?this._compileFunc(f.callback):f.callback;if(b===true)f.cache.iteration=false;i=this._get("page")-f.page;this._update("page",f.page);p=function(t,v){f.callback&&f.callback.apply(f.callback,arguments);l+=f.template.apply(f.template,arguments);q=v;if(r===false)r=v;return true};h=g.byLink(f.collection,this._getActiveParam("context")+g.CHILDREN+(a&&a.context||
""));j=this.length(f.collection);k=function(t,v){if(!k.val)k.val=c.length(t||"",v||"");return k.val};s=Boolean(f.breaker&&(f.filter||this._getActiveParam("filter")));f.breaker=f.breaker||j;if(g.isPlainObject(h)||!f.cache||f.cache.iteration===false||f.cache.firstIteration===false||f.cache.lastIteration===false){m=!f.breaker||f.page===1?0:(f.page-1)*f.breaker;this.forEach(p,f.filter,this.ACTIVE,true,f.breaker,m);if(f.cache&&f.cache.iteration===false)f.cache.lastIteration=false}else if(g.isArray(h)&&
f.cache.iteration===true){m=!s?f.page===1?0:(f.page-1)*f.breaker:i>=0?f.cache.firstIteration:f.cache.lastIteration;if(s)if(i>0){for(i*=f.breaker;(m-=1)>-1;)if(this._customFilter(f.filter,h[m],h,m,k,this,this.ACTIVE,e)===true)if(q===i)break;else q+=1;f.cache.lastIteration=m+=1;o=null}else if(i<0)o=-i*f.breaker-f.breaker;e.name&&this._drop("filter","__tmp:"+e.name);this.forEach(p,f.filter,this.ACTIVE,true,f.breaker,o,m)}if(f.cache){if(i!==0&&f.cache.iteration!==false){this._get("cache").firstIteration=
r;this._get("cache").lastIteration=q+1}if(f.cache.autoIteration===true)this._get("cache").iteration=true}k=null;l=!l?f.resultNull:this._customParser(f.parser,l,d);d.name&&this._drop("parser","__tmp:"+d.name);if(f.target===false){f.variable?this._push("variable",f.variable,l):this._new("variable",l);return this}else Array.prototype.forEach.call(f.target,function(t){if(f.toHTML==="replace")t.innerHTML=l;else if(f.toHTML==="append")t.innerHTML+=l;else if(f.toHTML==="append")t.innerHTML=l+t.innerHTML;
else return l},this);if(!f.pager)return this;f.nmbOfEntries=f.filter!==false?this.length(f.filter,f.collection):j;f.nmbOfEntriesInPage=f.calculator?u.find(f.calculator,f.target[0]).length:u.children(f.target[0]).length;f.finNumber=f.breaker*f.page-(f.breaker-f.nmbOfEntriesInPage);if(f.page!==1&&f.nmbOfEntriesInPage===0){this.onEmptyPage&&(n=this.onEmptyPage.apply(this,arguments));if(n===false)return this;this._update("page",f.page-=1).print(f,true,true)}else this.easyPage(f);return this};Collection.tpl=
{nav:{event:[{val:["first","prev","next","last"],func:function(a){var b=this,c=a.param,d=a.ctm.classes&&a.ctm.classes.disabled||this.DISABLED;u.bind(a.el,"click",function(){if(!u.hasClass(this,d)){a.key==="first"&&(c.page=1);a.key==="prev"&&(c.page="-=1");a.key==="next"&&(c.page="+=1");a.key==="last"&&(c.page=a.nmbOfPages);b.print(c)}});a.el.setAttribute("data-"+this.CTM+"-event",true)}},{val:["numberSwitch","pageList"],func:function(a){var b=this,c=a.param;if(!a.data[this.CTM+"-event"]){a.tag!==
"select"?u.bind(a.el,"click",function(d){d=d||window.event;d=d.target||d.srcElement;var e=u.data(d);if(d.parentNode!==a.el)return false;if(a.key==="pageList")c.page=+e.page;else{b._push("breaker",c.name||"",+e.breaker);delete c.breaker}b.print(c)}):u.bind(a.el,"change",function(){var d=u.children(this,"selected")[0];if(c.page!==d.value){if(a.key==="pageList")c.page=+d.value;else{b._push("breaker",c.name||"",+d.value);delete c.breaker}b.print(c)}});a.el.setAttribute("data-"+this.CTM+"-event",true)}}}],
action:[{val:["first","prev","next","last"],func:function(a){var b=a.param,c=a.ctm.classes&&a.ctm.classes.disabled||this.DISABLED;["first","prev"].indexOf(a.key)!==-1&&b.page===1||["next","last"].indexOf(a.key)!==-1&&b.finNumber===b.nmbOfEntries?u.addClass(a.el,c):u.removeClass(a.el,c)}},{val:"numberSwitch",func:function(a){var b="";a.ctm.val.forEach(function(c){b+=a.tag==="select"?'<option value="'+c+'" '+(c===a.param.breaker?'selected="selected"':"")+">"+c+"</option>":this._genPage(a,c,true)},this);
a.el.innerHTML=b}},{val:"pageList",func:function(a){var b=a.param,c="",d,e,f=0;if(a.tag==="select")for(d=0;(d+=1)<=a.nmbOfPages;)c+='<option vale="'+d+'" '+(d===b.page?'selected="selected"':"")+">"+d+"</option>";else if(a.nmbOfPages>b.pageBreak){f=b.pageBreak%2!==0?1:0;e=d=(b.pageBreak-f)/2;if(b.page-f<d)d=0;else{d=b.page-d-f;if(b.page+e>a.nmbOfPages)d-=b.page+e-a.nmbOfPages}for(f=-1;(d+=1)<=a.nmbOfPages&&(f+=1)!==null;){if(f===b.pageBreak&&d!==b.page)break;c+=this._genPage(a,d)}}else for(d=0;(d+=
1)<=a.nmbOfPages;)c+=this._genPage(a,d);a.el.innerHTML=c}}]},info:{action:[{func:function(a){var b=a.ctm.classes&&a.ctm.classes.noData||this.NO_DATA;a.param.nmbOfEntriesInPage===0?u.addClass(a.el,b):u.removeClass(a.el,b)}},{func:function(a){var b=this._wrap(a.param.page,a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}},{val:"page",func:function(a){var b=this._wrap(a.param.page,a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}},{val:"total",func:function(a){var b=this._wrap(a.param.nmbOfEntries,
a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}},{val:"from",func:function(a){var b=this._wrap((a.param.page-1)*a.param.breaker+1,a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}},{val:"to",func:function(a){var b=this._wrap(a.param.finNumber,a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}},{val:"inPage",func:function(a){var b=this._wrap(a.param.nmbOfEntriesInPage,a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}},{val:"nmbOfPages",func:function(a){var b=
this._wrap(a.nmbOfPages,a.tag);if(a.tag==="input")a.el.value=b;else a.el.innerHTML=b}}]}};Collection.prototype._wrap=function(a,b){if(b==="select")return'<option value="'+a+'">'+a+"</option>";return a.toString()};Collection.prototype._genPage=function(a,b,c){c=c||false;var d=a.param;a=a.ctm;var e=a.classes&&a.classes.active||this.ACTIVE,f="<"+(a.tag||this.CTM_SIMPLE_TAG)+" "+(!c?'data-page="':'data-breaker="')+b+'"',h=a.attr,j;if(h)for(j in h)if(h.hasOwnProperty(j))f+=" "+j+'="'+h[j]+'"';if(!c&&b===
d.page||c&&b===d.breaker)f+=' class="'+e+'"';return f+(">"+b+"</"+(a.tag||this.CTM_SIMPLE_TAG)+">")};Collection.prototype.easyPage=function(a){if(a.navBreaker<=2)throw Error('parameter "navBreaker" must be more than 2');var b=this,c=a.nmbOfPages||(a.nmbOfEntries%a.breaker!==0?~~(a.nmbOfEntries/a.breaker)+1:a.nmbOfEntries/a.breaker);Array.prototype.forEach.call(a.pager,function(d){Array.prototype.forEach.call(u.find("."+b.CTM,d),function(e){var f=u.data(e),h=f[b.CTM],j={param:a,nmbOfPages:c,el:e,tag:e.tagName.toLowerCase(),
data:f,ctm:h},k;for(k in h)if(h.hasOwnProperty(k)&&g.tpl[k]){e=g.tpl[k];j.key=h[k];e.event&&e.event.forEach(function(m){if((typeof m.val==="undefined"||m.val===h[k]||m.val.indexOf(h[k]))!==-1&&!f["ctm-event"])m.func.call(b,j)});e.action&&e.action.forEach(function(m){if(typeof m.val==="undefined"||m.val===h[k]||m.val.indexOf(h[k])!==-1)m.func.call(b,j)})}})});return this};Collection.prototype.genTable=function(a,b,c,d){if(g.isNumber(a)){d=c;c=b;b=a;a=""}b=b||this.TABLE_DEF_COUNT;c=c||this.TABLE_SIMPLE_TAG;
d=d===false?false:true;var e,f,h,j;a=a?g.isString(a)?u.find(a):a:this._get("target");Array.prototype.forEach.call(a,function(k){f=document.createElement("table");e=0;Array.prototype.forEach.call(u.find(c,k),function(m){if(e===0){h=document.createElement("tr");f.appendChild(h)}j=document.createElement("td");j.appendChild(m);h.appendChild(j);e+=1;if(e===b)e=0});if(d===true)for(e=b-h.childNodes.length;(e-=1)>-1;)h.appendChild(document.createElement("td"));k.appendChild(f)},this);return this}})();
if(typeof $C==="undefined"){var $C=Collection;if(typeof window==="undefined"&&typeof exports!=="undefined")exports.$C=Collection}if(typeof window==="undefined"&&typeof exports!=="undefined")exports.Collection=Collection;
//