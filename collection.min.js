/**
 * Collection v3.6.2 | http://collection-js.com
 * 
 * Copyright 2012, Andrey Kobets (Kobezzza | kobezzza@gmail.com | http://kobezzza.com)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
 var Collection;
(function(){var g=Collection=function(a,b){a=a||null;b=b||"";var c=Collection;if(!this||!this.name||this.name!=="Collection")return new c(a,b);c.extend(true,this,c.fields);var d=this.dObj.active,f=c.drivers.dom;b&&c.extend(true,d,b);if(this._isStringExpression(d.filter))d.filter=this._compileFilter(d.filter);if(this._isStringExpression(d.parser))d.parser=this._compileParser(d.parser);if(c.isString(d.target))d.target=f.find(d.target);if(c.isString(d.pager))d.pager=f.find(d.pager);d.collection=a},y=
typeof window.debug!=="undefined"&&window.debug===true,A;Collection.byLink=function(a,b,c,d){b=b.toString().replace(RegExp("\\s*"+g.CHILDREN+"\\s*","g"),g.CONTEXT+g.CHILDREN+g.CONTEXT).split(g.CONTEXT);d=d||false;for(var f=a,e=g.CHILDREN,i=0,k=0,l,n=b.length,p,h;(n-=1)>-1;){b[n]=b[n].trim();if(b[n]===""){b.splice(n,1);i-=1}else if(b[n]!==g.CHILDREN){if(n>i)i=n;k+=1}}h=b.length;if(a===false)return b.join("");else if(g.isNumber(a)){if((a=+a)<0)a+=k;if(typeof c==="undefined"){n=-1;for(p=0;(n+=1)<h;)if(b[n]!==
g.CHILDREN)if((p+=1)===a){b.splice(n+1,h);return b.join("")}}else{n=h;for(p=0;(n-=1)>-1;)if(b[n]!==g.CHILDREN)if((p+=1)===a){b.splice(0,n);return b.join("")}}}for(n=-1;(n+=1)<h;)switch(b[n]){case g.CHILDREN:e=b[n];break;default:if(e===g.CHILDREN&&b[n].substring(0,g.ORDER[0].length)!==g.ORDER[0])if(n===i&&typeof c!=="undefined")if(d===false)a[b[n]]=g.expr(c,a[b[n]]);else if(g.isArray(a))a.splice(b[n],1);else delete a[b[n]];else a=a[b[n]];else{k=b[n].substring(g.ORDER[0].length);k=k.substring(0,k.length-
1);k=+k;if(g.isArray(a))if(n===i&&typeof c!=="undefined")if(k>=0)if(d===false)a[k]=g.expr(c,a[k]);else a.splice(k,1);else if(d===false)a[a.length+k]=g.expr(c,a[a.length+k]);else a.splice(a.length+k,1);else a=k>=0?a[k]:a[a.length+k];else{if(k<0){p=0;for(l in a)if(a.hasOwnProperty(l))p+=1;k+=p}p=0;for(l in a)if(a.hasOwnProperty(l)){if(k===p){if(n===i&&typeof c!=="undefined")if(d===false)a[l]=g.expr(c,a[l]);else delete a[l];else a=a[l];break}p+=1}}}}if(typeof c!=="undefined")return f;return a};Collection.execEvent=
function(a,b,c,d){a=a.split(g.QUERY);c=g.isExists(c)?c:[];c=g.isArray(c)?c:[c];for(var f=-1,e=a.length-1;(f+=1)<e;)b=b[a[f]];d=d||b;if(a[f].search(g.SUBQUERY)!==-1){a=a[f].split(g.SUBQUERY);b=b[a[0]];a.splice(0,1);c=c.concat(a);return b.apply(d,c)}else return b[a[f]].apply(d,c)};Collection.CONTEXT="__context__";Collection.QUERY="/";Collection.SUBQUERY="{";Collection.METHOD="->";Collection.CHILDREN=">";Collection.ORDER=["eq(",")"];Collection.DOM=["<?js","?>"];Collection.ECHO="echo";Collection.VAL=
"val";Collection.CHILD_NODES="childNodes";Collection.CLASSES="classes";Collection.objToString=function(a){if(typeof a==="undefined")return g.prototype.collection();return Object.prototype.toString.call(a)};Collection.types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};Collection.type=function(a){return a==null?String(a):g.types[g.objToString(a)]||
"object"};Collection.isWindow=function(a){return a&&typeof a==="object"&&"setInterval"in a};Collection.isString=function(a){return g.type(a)==="string"};Collection.isNumber=function(a){return g.type(a)==="number"};Collection.isBoolean=function(a){return g.type(a)==="boolean"};Collection.isFunction=function(a){return g.type(a)==="function"};Collection.isArray=function(a){return g.type(a)==="array"};Collection.isPlainObject=function(a){if(!a||g.type(a)!=="object"||a.nodeType||g.isWindow(a))return false;
try{if(a.constructor&&!a.hasOwnProperty("constructor")&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))return false}catch(b){return false}for(var c in a);return c===undefined||a.hasOwnProperty(c)};Collection.isCollection=function(a){return g.isArray(a)||g.isPlainObject(a)};Collection.isExists=function(a){return typeof a!=="undefined"&&a!==null&&a!==""};if(!String.prototype.trim||y)String.prototype.trim=function(){for(var a=this.replace(/^\s\s*/,""),b=a.length;/\s/.test(a.charAt(b-=1)););
return a.substring(0,b+1)};Collection.toUpperCase=function(a,b,c){c=c||0;b=g.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toUpperCase()+a.substring(b)};Collection.toLowerCase=function(a,b,c){c=c||0;b=g.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toLowerCase()+a.substring(b)};Collection.expr=function(a,b){b=g.isExists(b)?b:"";if(g.isString(a)&&a.search(/^[+-\\*\/]{1}=/)!==-1){a=a.split("=");isNaN(a[1])||(a[1]=+a[1]);switch(a[0]){case "+":a=b+a[1];break;case "-":a=
b-a[1];break;case "*":a=b*a[1];break;case "/":a=b/a[1]}}return a};Collection.getRandomInt=function(a,b){a=a||0;return Math.floor(Math.random()*((b||10)-a+1))+a};Collection.extend=function(){var a,b,c,d,f,e=arguments[0]||{},i=0,k=arguments.length,l=false;if(g.isBoolean(e)){l=e;e=arguments[1]||{};i=1}if(typeof e!=="object"&&!g.isFunction(e))e={};if(k===i){e=g;i-=1}for(;(i+=1)<k;)if(g.isExists(a=arguments[i]))for(b in a){c=e[b];d=a[b];if(e!==d)if(l&&d&&(g.isPlainObject(d)||(f=g.isArray(d)))){if(f){f=
false;c=c&&g.isArray(c)?c:[]}else c=c&&g.isPlainObject(c)?c:{};e[b]=g.extend(l,c,d)}else if(typeof d!=="undefined")e[b]=d}return e};Collection.addElementToObject=function(a,b,c){b=b.split(g.METHOD);var d,f={};if(b[1]&&b[1]==="unshift"){f[!isNaN(Number(b[0]))?0:b[0]]=c;for(d in a)if(a.hasOwnProperty(d))f[!isNaN(Number(d))?+d+1:d]=a[d];return f}else if(!b[1]||b[1]==="push")a[b[0]]=c;return true};Collection.unshift=function(a,b){var c=[b],d;for(d in a)a.hasOwnProperty(d)&&c.push(a[d]);return c};Collection.toArray=
function(a){var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b};if(!Array.prototype.forEach||y)Array.prototype.forEach=function(a,b){for(var c=-1,d=this.length;(c+=1)<d;)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.some||y)Array.prototype.some=function(a,b){for(var c=-1,d=this.length,f;(c+=1)<d;)if(f=b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.every||y)Array.prototype.every=function(a,b){for(var c=-1,d=this.length,f,
e=true;(c+=1)<d;){f=b?a.call(b,this[c],c,this):a(this[c],c,this);if(e===true&&!f){e=false;break}}return e};if(!Array.prototype.filter||y)Array.prototype.filter=function(a,b){for(var c=-1,d=this.length,f=[];(c+=1)<d;)if(b)a.call(b,this[c],c,this)&&f.push(this[c]);else a(this[c],c,this)&&f.push(this[c]);return f};if(!Array.prototype.map||y)Array.prototype.map=function(a,b){for(var c=-1,d=this.length,f=[];(c+=1)<d;)b?f.push(a.call(b,this[c],c,this)):f.push(a(this[c],c,this));return f};if(!Array.prototype.indexOf||
y)Array.prototype.indexOf=function(a,b){for(var c=(b||0)-1,d=this.length;(c+=1)<d;)if(this[c]===a)return c;return-1};if(!Array.prototype.lastIndexOf||y)Array.prototype.lastIndexOf=function(a,b){var c=b||this.length;if(c<0)c=this.length+c;for(;(c-=1)>-1;)if(this[c]===a)return c;return-1};if(!Array.prototype.reduce||y)Array.prototype.reduce=function(a,b){var c=0,d=this.length,f;if(d===1)return this[0];for(f=b?b:this[0];(c+=1)<d;)f=a(f,this[c],c,this);return f};if(!Array.prototype.reduceRight||y)Array.prototype.reduceRight=
function(a,b){var c=this.length-1,d;if(this.length===1)return this[0];for(d=b?b:this[c];(c-=1)>-1;)d=a(d,this[c],c,this);return d};Collection.prototype={name:"Collection",version:"3.7",collection:function(){return this.name+" "+this.version},ACTIVE:"active",SHUFFLE:"shuffle",NAMESPACE:".",SPLITTER:">>>",SHORT_SPLITTER:">>",VARIABLE:["<:",":>"],WITH:"+",DEF:":",DEF_REGEXP:/^\s*:/,FILTER_REGEXP:/&&|\|\||:|!/,stack:[{namespace:""},{collection:""},{filter:""},{context:""},{cache:""},{variable:""},{defer:""},
{page:""},{parser:""},{toHTML:""},{target:""},{calculator:""},{pager:""},{template:""},{breaker:""},{navBreaker:""},{resultNull:""}]};var v=Collection.prototype;Collection.drivers={};Collection.drivers.dom={find:function(a,b){if(!this.lib)throw Error("DOM driver is not defined!");return this.engines[this.lib].find(a||"",b||"")},children:function(a,b){var c=[];Array.prototype.forEach.call(a.childNodes,function(d){if(d.nodeType===1)if(b)d[b]&&c.push(d);else c.push(d)});return c},data:function(a,b){var c=
a.attributes,d={};c&&c.length>0&&Array.prototype.forEach.call(c,function(f){if(f.name.substring(0,5)==="data-")d[f.name.replace("data-","")]=g.isString(f.value)&&f.value.search(/^\{|\[/)!==-1?JSON.parse(f.value):f.value});if(b)return d[b];return d},text:function(a){a=a.childNodes;var b="";Array.prototype.forEach.call(a,function(c){if(c.nodeType===3&&c.textContent.trim())b+=c.textContent});if(b)return b;return false},bind:function(a,b,c){if(this.engines[this.lib][b]){this.engines[this.lib][b](a,c);
return this}document.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c);return this},addClass:function(a,b){if(a.className.split(" ").indexOf(b)===-1)a.className+=" "+b;return this},hasClass:function(a,b){return a.className.split(" ").indexOf(b)!==-1},removeClass:function(a,b){var c=[];a.className.split(" ").forEach(function(d){d!==b&&c.push(d)});a.className=c.join(" ");return this},engines:{qsa:{is:function(){if(typeof qsa!=="undefined")return true},find:function(a,b){return qsa.querySelectorAll(a,
b)}},sizzle:{is:function(){if(typeof Sizzle!=="undefined")return true},find:function(a,b){return Sizzle(a,b)}},jQuery:{is:function(){if(typeof jQuery!=="undefined")return true},find:function(a,b){return jQuery(a,b)},click:function(a,b){$(a).click(b)},change:function(a,b){$(a).change(b)}},dojo:{is:function(){if(typeof dojo!=="undefined")return true},find:function(a,b){return b?dojo.query(a,b):dojo.query(a)},click:function(a,b){dojo.connect(a,"onclick",b)}},mootools:{is:function(){if(typeof MooTools!==
"undefined")return true},find:function(a,b){var c;if(b){c=[];$$(b).getElements(a).forEach(function(d){d.forEach(function(f){c.push(f)})})}else c=$$(a);return c}},prototype:{is:function(){if(typeof Prototype!=="undefined")return true},find:function(a,b){return b?b.getElementsBySelector(a):$$(a)}}}};var x=g.drivers.dom;for(A in x.engines)if(x.engines.hasOwnProperty(A))if(x.engines[A].is()){x.lib=A;break}Collection.parseNode=function(a){var b=[];Array.prototype.forEach.call(a,function(c){if(c.nodeType===
1){var d=x.data(c),f=c.hasAttribute("class")?c.getAttribute("class").split(" "):"",e=x.text(c),i,k=b.length;b.push({});for(i in d)if(d.hasOwnProperty(i))b[k][i]=d[i];if(f){b[k][g.CLASSES]={};f.forEach(function(l){b[k][g.CLASSES][l]=l})}if(c.childNodes.length!==0)b[k][g.CHILD_NODES]=g.parseNode(c.childNodes);if(e!==false)b[k][g.VAL]=e.replace(/[\r\t\n]/g," ")}});return b};Collection.fromNode=function(a,b){if(typeof JSON==="undefined"||!JSON.parse)throw Error("object JSON is not defined!");var c=g.parseNode(x.find(a));
if(b)return new g(c,b);return new g(c)};Collection.ctplCompile=function(a){g.isString(a)&&(a=x.find(a));if(a.length===0)throw Error("DOM element does't exist!");a=(a[0]?a[0][0]?a[0][0].innerHTML:a[0].innerHTML:a.innerHTML).replace(/\/\*.*?\*\//g,"").split(this.DOM[1]).join(this.DOM[0]).replace(/[\r\t\n]/g," ").split(this.DOM[0]);var b='var result = ""; ',c=RegExp("\\s+"+this.ECHO+"\\s+");a.forEach(function(d,f){b+=f===0||f%2===0?'result +="'+d.split('"').join('\\"')+'";':d.split(c).join("result +=")});
return new Function("el","key","data","i","length","cObj","id",b+" return result;")};Collection.prototype.ctplMake=function(a){g.isString(a)&&(a=x.find(a));Array.prototype.forEach.call(a,function(b){var c=x.data(b,"ctpl"),d,f=c.prefix?c.prefix+"_":"";this._push("template",f+c.name,g.ctplCompile(b));c.set&&c.set===true&&this._set("template",f+c.name);for(d in c)if(c.hasOwnProperty(d))if(["prefix","set","print","name","collection"].indexOf(d)===-1){if(["target","pager"].indexOf(d)!==-1)c[d]=x.find(c[d]);
this._push(d,f+c.name,c[d]);c.set&&c.set===true&&this._set(d,f+c.name);if(["filter","parser"].indexOf(d)!==-1)c[d]=f+c.name}if(!c.target){this._push("target",f+c.name,[b.parentNode]);c.set&&c.set===true&&this._set("target",f+c.name)}if(c.print&&c.print===true){c.template=c.name;this.print(c)}},this);return this};Collection.fields={dObj:{active:{namespace:"nm",collection:null,filter:false,context:"",cache:{autoIteration:true,iteration:true,firstIteration:false,lastIteration:false},variable:null,defer:"",
page:1,parser:false,toHTML:"replace",target:null,calculator:null,pager:null,template:null,breaker:null,navBreaker:5,resultNull:""}}};var C=g.fields.dObj.active;Collection.fields.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};var B=g.fields.dObj.sys;Collection.prototype.stack.forEach(function(a){var b,c;for(b in a)if(a.hasOwnProperty(b)){c=g.toUpperCase(b,1);a[b]=C[b];B["active"+c+"Id"]=null;B["tmp"+c]={};B[b+"ChangeControl"]=null;B[b+"Back"]=[]}});Collection.prototype._new=
function(a,b){var c=this.dObj.active,d=g.toUpperCase(a,1),f,e=g.drivers.dom;this["onNew"+d]&&(f=this["onNew"+d](b));if(f===false)return this;c[a]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b)?this["_compile"+g.toUpperCase(a,1)](b):["target","pager"].indexOf(a)!==-1&&g.isString(b)?e.find.apply(e,g.isArray(b)?b:[b]):g.expr(b,c[a]||"");this.dObj.sys["active"+d+"Id"]=null;return this};Collection.prototype._update=function(a,b){var c=this.dObj.active,d=g.toUpperCase(a,1),f,e=this._getActiveId(a),
i=g.drivers.dom;this["onUpdate"+d]&&(f=this["onUpdate"+d](b));if(f===false)return this;c[a]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b)?this["_compile"+d](b):["target","pager"].indexOf(a)!==-1&&g.isString(b)?i.find.apply(i,g.isArray(b)?b:[b]):g.expr(b,c[a]||"");if(e)this.dObj.sys["tmp"+d][e]=c[a];return this};Collection.prototype._get=function(a,b){if(b&&b!==this.ACTIVE){if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");return this.dObj.sys["tmp"+
g.toUpperCase(a,1)][b]}return this.dObj.active[a]};Collection.prototype._push=function(a,b,c){var d=g.toUpperCase(a,1),f,e=this.dObj.sys["tmp"+d],i=this._getActiveId(a),k,l=g.drivers.dom;this["onPush"+d]&&(f=this["onPush"+d](b,c||""));if(f===false)return this;if(g.isPlainObject(b))for(k in b){if(b.hasOwnProperty(k))if(k===this.ACTIVE)this._update(a,b[k]);else if(e[k]&&i&&i===k)this._update(a,b[k]);else e[k]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b[k])?this["_compile"+d](b[k]):
["target","pager"].indexOf(a)!==-1&&g.isString(b[k])?l.find.apply(l,g.isArray(b[k])?b[k]:[b[k]]):b[k]}else if(b===this.ACTIVE)this._update(a,c);else if(e[b]&&i&&i===b)this._update(a,c);else e[b]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(c)?this["_compile"+d](c):["target","pager"].indexOf(a)!==-1&&g.isString(c)?l.find.apply(l,g.isArray(c)?c:[c]):c;return this};Collection.prototype._set=function(a,b){if(!b||b===this.ACTIVE)return this;var c=this.dObj.sys,d=g.toUpperCase(a,1),f,e=
a+"ChangeControl",i="active"+d+"Id";if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");this["onSet"+d]&&(f=this["onSet"+d](b));if(f===false)return this;if(c[i]!==b){c[e]=true;c[i]=b}else c[e]=false;c[a+"Back"].push(b);this.dObj.active[a]=c["tmp"+d][b];return this};Collection.prototype._back=function(a,b){b=b||1;var c=this.dObj.sys,d=g.toUpperCase(a,1),f,e=c[a+"Back"],i=e.length-b-1;this["onBack"+d]&&(f=this["onBack"+d](b));if(f===false)return this;if(i>=
0&&e[i])if(c["tmp"+d][e[i]]){this._set(a,e[i]);c[a+"ChangeControl"]=false;e.splice(i+1,e.length)}return this};Collection.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};Collection.prototype._drop=function(a,b,c,d){c=typeof c==="undefined"?false:c;var f=this.dObj.active,e=this.dObj.sys,i=g.toUpperCase(a,1),k,l="active"+i+"Id",n="tmp"+i,p=this._getActiveId(a),h=!b?p?[p]:[]:g.isArray(b)||g.isPlainObject(b)?b:[b],m;if(typeof d===
"undefined")this["onDrop"+i]&&(k=this["onDrop"+i](b,c));else this["onReset"+i]&&(k=this["onReset"+i](b,d));if(k===false)return this;if(h[0]&&h[0]!==this.ACTIVE)for(m in h){if(h.hasOwnProperty(m))if(!h[m]||h[m]===this.ACTIVE)if(typeof d==="undefined"){p&&delete e[n][p];e[l]=null;f[a]=c}else{if(p)e[n][p]=d;f[a]=d}else if(typeof d==="undefined"){delete e[n][h[m]];if(p&&h[m]===p){e[l]=null;f[a]=c}}else{e[n][h[m]]=d;if(p&&h[m]===p)f[a]=d}}else if(typeof d==="undefined"){p&&delete e[n][p];e[l]=null;f[a]=
c}else{if(p)e[n][p]=d;f[a]=d}return this};Collection.prototype._reset=function(a,b,c){return this._drop(a,b||"","",typeof c==="undefined"?false:c)};Collection.prototype._resetTo=function(a,b,c){c=!c||c===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+g.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};Collection.prototype._exists=function(a,b){var c=g.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&this._getActiveId(a))return true;if(typeof this.dObj.sys["tmp"+c][b]!=="undefined")return true;return false};
Collection.prototype._validate=function(a,b){return!b||b===this.ACTIVE||this._exists(a,b)};Collection.prototype._getActiveId=function(a){return this.dObj.sys["active"+g.toUpperCase(a,1)+"Id"]};Collection.prototype._active=function(a,b){if(!b)return this._getActiveId(a);if(b===this._getActiveId(a))return true;return false};Collection.prototype.use=function(a){this.stack.forEach(function(b){var c,d,f;if(this._exists(b,a))this._set(b,a);else{c=a.split(this.NAMESPACE);for(f=c.length;(f-=1)>-1;){c.splice(f,
1);d=c.join(this.NAMESPACE);if(this._exists(b,d)){this._set(b,d);break}}}},this);return this};Collection.prototype.stack.forEach(function(a){var b,c;for(b in a)if(a.hasOwnProperty(b)){c=g.toUpperCase(b,1);v["new"+c]=function(d){return function(f){return this._new(d,f)}}(b);v["update"+c]=function(d){return function(f){return this._update(d,f)}}(b);v["reset"+c]=function(d,f){return function(){return this._reset(d,arguments,f)}}(b,a[b]);v["reset"+c+"To"]=function(d){return function(f,e){return this._resetTo(d,
f,e)}}(b);v["push"+c]=function(d){return function(){return this._push.apply(this,g.unshift(arguments,d))}}(b);v["set"+c]=function(d){return function(f){return this._set(d,f)}}(b);v["pushSet"+c]=function(d){return function(f,e){return this._push(d,f,e)._set(d,f)}}(b);v["back"+c]=function(d){return function(f){return this._back(d,f||"")}}(b);v["back"+c+"If"]=function(d){return function(f){return this._backIf(d,f||"")}}(b);v["drop"+c]=b==="filter"||b==="parser"?function(d){return function(){return this._drop(d,
arguments)}}(b):function(d){return function(){return this._drop(d,arguments,null)}}(b);v["active"+c]=function(d){return function(f){return this._active(d,f)}}(b);v["exists"+c]=function(d){return function(f){return this._exists(d,f||"")}}(b);v["validate"+c]=function(d){return function(f){return this._validate(d,f||"")}}(b);v["get"+c+"ActiveId"]=function(d){return function(){return this._getActiveId(d)}}(b);v["get"+c]=function(d){return function(f){return this._get(d,f||"")}}(b)}});Collection.prototype._setOne=
function(a,b,c){var d;this.onSet&&(d=this.onSet.apply(this,arguments));if(d===false)return this;a=g.isExists(a)?a.toString():"";b=typeof b==="undefined"?"":b;c=c||"";d=this._getActiveParam("context");if(!a&&!d)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);g.byLink(this._get("collection",c),d+g.CHILDREN+a,b);return this};Collection.prototype._getOne=function(a,b){a=g.isExists(a)?a.toString():"";return g.byLink(this._get("collection",b||""),this._getActiveParam("context")+
g.CHILDREN+a)};Collection.prototype.add=function(a,b,c){var d;this.onAdd&&(d=this.onAdd.apply(this,arguments));if(d===false)return this;var f;a=typeof a!=="undefined"?a:"";a=g.isString(a)?(f=true)&&a.split(this.SHORT_SPLITTER):a;b=b||"push";c=c||"";d="";if(f)if(a[1]){d=a[0].trim();a=a[1].trim();if(a.search(/^\{|\[/)!==-1||!isNaN(parseFloat(a)))a=eval(a)}else a=a[0].trim();f=this._getOne(d,c);if(typeof f!=="object")throw Error("unable to set property!");if(g.isPlainObject(f)){b=b==="push"?this.length(f):
b==="unshift"?this.length(f)+g.METHOD+"unshift":b;d=g.addElementToObject(f,b.toString(),a)}else{d=true;f[b](a)}d!==true&&this._setOne("",d,c);return this};Collection.prototype.push=function(a,b){return this.add(a,"",b||"")};Collection.prototype.unshift=function(a,b){return this.add(a,"unshift",b||"")};Collection.prototype._removeOne=function(a,b){var c;this.onRemove&&(c=this.onRemove.apply(this,arguments));if(c===false)return this;a=g.isExists(a)?a.toString():"";c=this._getActiveParam("context");
!a&&!c?this._setOne("",null):g.byLink(this._get("collection",b||""),c+g.CHILDREN+a,"",true);return this};Collection.prototype._remove=function(a,b){b=b||"";var c,d;if(g.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(g.isArray(a[c]))for(d=a[c].length;(d-=1)>-1;)this._removeOne(a[c][d],c);else this._removeOne(a[c],c)}else if(g.isArray(a))for(d=a.length;(d-=1)>-1;)this._removeOne(a[d],b);else this._removeOne(a,b);return this};Collection.prototype.concat=function(a,b){var c,d;this.onConcat&&(c=
this.onConcat.apply(this,arguments));if(c===false)return this;b=(b=b||"").split(this.DEF);d=b[1]?b[1].trim():"";b=b[0].trim();c=this._getOne(d,b);if(typeof c!=="object")throw Error("incorrect data type!");if(g.isPlainObject(c))g.extend(true,c,a);else if(g.isArray(c))if(g.isArray(a)){c=Array.prototype.concat(c,a);this._setOne(d,c,b)}else this.add(a,"push",b);return this};Collection.prototype.length=function(a,b,c,d,f,e,i,k){c=c===false?false:true;var l;if(!g.isFunction(a))if(g.isString(a)&&!this._isFilter(a)&&
!g.isExists(b)||g.isCollection(a)){b=a;a=false}b=b?g.isString(b)?this._get("collection",b):b:this._get("collection");if(b===null)return 0;if(g.isString(b))return b.length;if((a===true||!a)&&!this._getActiveParam("filter")&&typeof b.length!=="undefined")l=b.length;else{l=0;this.forEach(function(){l+=1},a,b,c,d||"",f||"",e||"",i||"",k||"")}return l};Collection.prototype.forEach=function(a,b,c,d,f,e,i,k,l){a=this._isStringExpression(a)?this._compileFunc(a):a;b=g.isString(b=b||"")?b.split(this.SHORT_SPLITTER):
b;c=c||"";d=d===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;i=parseInt(i)||false;k=parseInt(k)||false;l=l||false;var n=this,p={},h=[],m="",r,s,j,q,o=0,t=0,u=false;if(g.isArray(b))if(b[1]){m=b[0].trim();b=b[1].trim()}else b=b[0].trim();r=!g.isCollection(c)?this._getOne(m,c):c;if(typeof r!=="object")throw Error("incorrect data type!");s=function(){if(!s.val)s.val=n.length(b,c);return s.val};j=function(w,z){if(!j.val)j.val=n.length(w||"",z||"");return j.val};if(g.isArray(r)){h=
i!==false&&!l?r.slice(i):r;if(l)for(q=h.length-i;(q-=1)>-1;){if(k&&q===k)break;if(f!==false&&t===f)break;if(this._customFilter(b,h[q],q,r,o,j,this,c,p)===true)if(e!==false&&e!==0)e-=1;else{u=a.call(a,h[q],q,r,o,s,this,c)===false;if(d===false)u=true;t+=1}o+=1;if(u===true)break}else h.some(function(w,z){z+=i;if(k&&z===k)return true;if(f!==false&&t===f)return true;if(this._customFilter(b,w,z,r,o,j,this,c,p)===true)if(e!==false&&e!==0)e-=1;else{u=a.call(a,w,z,r,o,s,this,c)===false;if(d===false)u=true;
t+=1}o+=1;if(u===true)return true},this)}else if(l){for(q in r)r.hasOwnProperty(q)&&h.push(q);for(q=h.length-i;(q-=1)>-1;){if(k&&q===k)break;if(f!==false&&t===f)break;if(this._customFilter(b,r[h[q]],h[q],r,o,j,this,c,p)===true)if(e!==false&&e!==0)e-=1;else{u=a.call(a,r[h[q]],h[q],r,o,s,this,c)===false;if(d===false)u=true;t+=1}o+=1;if(u===true)break}}else for(q in r)if(r.hasOwnProperty(q)){if(k&&o===k)break;if(f!==false&&t===f)break;if(i!==false&&i!==0)i-=1;else{if(this._customFilter(b,r[q],q,r,o,
j,this,c,p)===true)if(e!==false&&e!==0)e-=1;else{u=a.call(a,r[q],q,r,o,s,this,c)===false;if(d===false)u=true;t+=1}o+=1;if(u===true)break}}p.name&&this._drop("filter","__tmp:"+p.name);j=s=null;return this};Collection.prototype.some=function(a,b,c,d,f,e,i){return this.forEach(a,b||"",c||"",false,"",d||"",f||"",e||"",i||"")};Collection.prototype.search=function(a,b,c){b=this._splitId(b);c=c===false?false:true;var d=c===true?[]:-1,f=b.to,e=b.set,i=g.toArray(arguments);b=i[1]=b.id;i.unshift(c===true?function(k,
l){d.push(l)}:function(k,l){d=l});this.forEach.apply(this,i);if(f)return this._saveResult(f,e,d);return d};Collection.prototype.searchOne=function(a,b,c,d,f,e){return this.search(a||"",b||"",false,"",c||"",d||"",f||"",e||"")};Collection.prototype.indexOf=function(a,b,c){return this.searchOne(function(d){return d===a},c||"","",b||"")};Collection.prototype.lastIndexOf=function(a,b,c){return this.searchOne(function(d){return d===a},c||"","",b||"","",true)};Collection.prototype.get=function(a,b,c,d,f,
e,i,k){b=this._splitId(b);var l,n=b.to,p=b.set,h=g.toArray(arguments);b=h[1]=b.id;if(g.isArray(a)){l=[];a.forEach(function(m){l=l.concat(this.get(m,b,c||"",d||"",f||"",e||"",i||"",k||""))},this)}else if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)l=this._getOne(a,b);else{c=c===false?false:true;l=c===true||g.isArray(a)?[]:-1;h.unshift(c===true?function(m,r,s){l.push(s[r])}:function(m,r,s){l=s[r]});this.forEach.apply(this,h)}if(n)return this._saveResult(n,p,l);
return l};Collection.prototype.getOne=function(a,b,c,d,f,e){return this.get(a||"",b||"",false,"",c||"",d||"",f||"",e||"")};Collection.prototype.set=function(a,b,c){if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)return this._setOne(a,b,c||"");var d;this.onSet&&(d=this.onSet.apply(this,arguments));if(d===false)return this;b=this._isStringExpression(b)?this._compileFunc(b):b;d=g.isFunction(b);d=g.unshift(arguments,d?function(f,e,i){var k=b.apply(b,arguments);if(typeof k!==
"undefined")i[e]=k}:function(f,e,i){i[e]=g.expr(b,i[e])});d.splice(2,1);return this.forEach.apply(this,d)};Collection.prototype.setOne=function(a,b,c,d,f,e,i){return this.set(a||"",b,c||"",false,"",d||"",f||"",e||"",i||"")};Collection.prototype.map=function(a,b,c){c=this._splitId(c);var d,f=c.to,e=c.set,i=g.toArray(arguments),k,l,n;c=i[2]=c.id;a=this._isStringExpression(a)?this._compileFilter(a):a||"";k=g.isFunction(a);l=!k&&g.isExists(a);d=(n=g.isArray(this._getOne("",c)))?[]:{};i.unshift(k?n?function(){d.push(a.apply(a,
arguments))}:function(p,h){d[h]=a.apply(a,arguments)}:l?n?function(p,h,m){d.push(g.expr(a,m[h]))}:function(p,h,m){d[h]=g.expr(a,m[h])}:n?function(p,h,m){d.push(m[h])}:function(p,h,m){d[h]=m[h]});i.splice(1,1);this.forEach.apply(this,i);if(f)return this._saveResult(f,e,d);return d};Collection.prototype.move=function(a,b,c,d,f,e,i,k,l,n){n=n===false?false:true;var p;n&&this.onMove&&(p=this.onMove.apply(this,arguments));!n&&this.onCopy&&(p=this.onCopy.apply(this,arguments));if(p===false)return this;
a=a||"";b=this._splitId(b);var h=[],m;p=b.to;var r=b.set,s=g.toArray(arguments);b=s[1]=b.id;s.splice(2,1);s.unshift(function(j,q){h.push(q);m.push(j)});if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false){m=this._getOne(a,b);h.push(a)}else{m=[];this.forEach.apply(this,s)}this._saveResult(p,r,m);if(n===true)l===true?h.forEach(function(j){this._removeOne(j,b)},this):this._remove(h,b);return this};Collection.prototype.moveOne=function(a,b,c,d,f,e,i){return this.move(a||
"",b||"",c||"",false,"",d||"",f||"",e||"",i||"")};Collection.prototype.copy=function(a,b,c,d,f,e,i){return this.move(a||"",b||"",c||"push",d===false?false:true,f||"",e||"",i||"",false)};Collection.prototype.copyOne=function(a,b,c,d,f,e,i){return this.move(a||"",b||"",c||"",false,"",d||"",f||"",e||"",i||"",false)};Collection.prototype.remove=function(a,b,c,d,f,e,i,k){if(g.isNumber(a)||g.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)return this._removeOne(a,b||"");else if(g.isArray(a)||
g.isPlainObject(a))return this._remove(a,b||"");var l=this.search.apply(this,arguments);if(g.isArray(l))k===true?l.forEach(function(n){this._removeOne(n,b)},this):this._remove(l,b);else this._removeOne(l,b);return this};Collection.prototype.removeOne=function(a,b,c,d,f,e){return this.remove(a||"",b||"",false,"",c||"",d||"",f||"",e||"")};Collection.prototype.pop=function(a,b,c,d,f){a=a||"";if(g.isNumber(b)||g.isString(b)&&!this._isFilter(b)||arguments.length<2||b===false)return this._removeOne("eq(-1)",
a);return this.removeOne(b||"",a,c||"",d||"",f||"",true)};Collection.prototype.shift=function(a,b,c,d,f){a=a||"";if(g.isNumber(b)||g.isString(b)&&!this._isFilter(b)||arguments.length<2||b===false)return this._removeOne("eq(0)",a);return this.removeOne(b||"",a,c||"",d||"",f||"")};Collection.prototype.group=function(a,b,c,d,f,e,i,k,l,n){a=this._isStringExpression(a=a||"")?this._compileFilter(a):a;c=this._splitId(c);n=n||false;var p=g.isString(a),h={},m=c.to,r=c.set,s=g.toArray(arguments);c=s[2]=c.id;
s.unshift(p?n?function(j,q){var o=g.byLink(j,a);if(h[o])h[o].push(q);else h[o]=[q]}:function(j){var q=g.byLink(j,a);if(h[q])h[q].push(j);else h[q]=[j]}:n?function(j,q){var o=a.apply(a,arguments);if(h[o])h[o].push(q);else h[o]=[q]}:function(j){var q=a.apply(a,arguments);if(h[q])h[q].push(j);else h[q]=[j]});s.splice(1,1);this.forEach.apply(this,s);if(m)return this._saveResult(m,r,h);return h};Collection.prototype.groupLinks=function(){var a=Collection.unshift(arguments,action);a.push(true);return this.group.apply(this,
a)};Collection.prototype.stat=function(a,b,c,d,f,e,i,k,l){a=(a=a||"count")&&this._isStringExpression(a)?this._compileFilter(a):a;b=(b=b||"")&&this._isStringExpression(b)?this._compileFilter(b):b;d=this._splitId(d);f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;i=parseInt(i)||false;k=parseInt(k)||false;l=l||false;var n=g.isString(a),p=g.isString(b),h=0,m=0,r=d.to,s=d.set;d=d.id;switch(a){case "count":n=function(){h+=1};break;case "summ":n=p?function(j){j=g.byLink(j,b);h+=j;return true}:function(){var j=
b.apply(this,arguments);h+=j;return true};break;case "avg":n=p?function(j){j=g.byLink(j,b);m+=1;h+=j;return true}:function(){var j=b.apply(this,arguments);m+=1;h+=j;return true};break;case "max":n=p?function(j){j=g.byLink(j,b);if(j>h)h=j;return true}:function(){var j=b.apply(this,arguments);if(j>h)h=j;return true};break;case "min":n=p?function(j){j=g.byLink(j,b);if(m===0){h=j;m=1}else if(j<h)h=j;return true}:function(){var j=b.apply(this,arguments);if(m===0){h=j;m=1}else if(j<h)h=j;return true};break;
default:n=n?p?function(j){j=g.byLink(j,b);if(m===0){h=j;m=1}else h=g.expr(a+"="+j,h);return true}:function(){var j=b.apply(this,arguments);if(m===0){h=j;m=1}else h=g.expr(a+"="+j,h);return true}:p?function(j){j=g.byLink(j,b);h=a(j,h);return true}:function(){var j=b.apply(this,arguments);h=a(j,h);return true}}if(a!=="first"&&a!=="last"){this.forEach(n,c||"",d,"",f,e,i,k,l);if(a==="avg")h/=m}else h=a==="first"?this._getOne(g.ORDER[0]+"0"+g.ORDER[1]):this._getOne(g.ORDER[0]+"-1"+g.ORDER[1]);if(r)return this._saveResult(r,
s,h);return h};Collection.prototype.groupStat=function(a,b,c,d,f,e,i,k,l){a=(a=a||"count")&&this._isStringExpression(a)?this._compileFilter(a):a;b=(b=b||"")&&this._isStringExpression(b)?this._compileFilter(b):b;d=this._splitId(d);f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;i=parseInt(i)||false;k=parseInt(k)||false;l=l||false;var n=g.isString(a),p=g.isString(b),h={},m={},r=d.to,s=d.set,j,q;d=d.id;switch(a){case "count":q=function(){h[this.key]+=1};break;case "summ":q=p?function(o){o=g.byLink(o,
b);h[this.key]+=o;return true}:function(){var o=b.apply(this,arguments);h[this.key]+=o;return true};break;case "avg":q=p?function(o){o=g.byLink(o,b);m[this.key]+=1;h[this.key]+=o;return true}:function(){var o=b.apply(this,arguments);m[this.key]+=1;h[this.key]+=o;return true};break;case "max":q=p?function(o){o=g.byLink(o,b);if(o>h[this.key])h[this.key]=o;return true}:function(){var o=b.apply(this,arguments);if(o>h[this.key])h[this.key]=o;return true};break;case "min":q=p?function(o){o=g.byLink(o,b);
if(m[this.key]===0){h[this.key]=o;m[this.key]=1}else if(o<h[this.key])h[this.key]=o;return true}:function(){var o=b.apply(this,arguments);if(m[this.key]===0){h[this.key]=o;m[this.key]=1}else if(o<h[this.key])h[this.key]=o;return true};break;default:q=n?p?function(o){o=g.byLink(o,b);if(m[this.key]===0){h[this.key]=o;m[this.key]=1}else h[this.key]=g.expr(a+"="+o,h[this.key]);return true}:function(){var o=b.apply(this,arguments);if(m[this.key]===0){h[this.key]=o;m[this.key]=1}else h[this.key]=g.expr(a+
"="+o,h[this.key]);return true}:p?function(o){o=g.byLink(o,b);h[this.key]=a(o,h[this.key]);return true}:function(){var o=b.apply(this,arguments);h[this.key]=a(o,h[this.key]);return true}}this.forEach(a!=="first"&&a!=="last"?function(o,t,u,w,z,D,E){h[t]||(h[t]=m[t]=0);if(a!=="first"&&a!=="last")D._update("context","+="+g.CHILDREN+(q.key=t)).forEach(q,c||"",E,"",f,e,i,k,l).parent();return true}:a==="first"?function(o,t){h[t]||(h[t]=m[t]=0);h[t]=g.byLink(o,g.ORDER[0]+"0"+g.ORDER[1]);return true}:function(o,
t){h[t]||(h[t]=m[t]=0);h[t]=g.byLink(o,g.ORDER[0]+"-1"+g.ORDER[1]);return true},"",d);if(a==="avg")for(j in h)if(h.hasOwnProperty(j))h[j]/=m[j];if(r)return this._saveResult(r,s,h);return h};Collection._sortObject=function(a,b,c){b=[];var d={},f;for(f in a)a.hasOwnProperty(f)&&b.push({key:f,value:a[f]});b.sort(c);for(f in b)if(b.hasOwnProperty(f))d[b[f].key]=b[f].value;return d};Collection._sortObjectByKey=function(a,b){var c=[],d={},f;for(f in a)a.hasOwnProperty(f)&&c.push(f);c.sort(b);for(f in c)if(c.hasOwnProperty(f))d[c[f]]=
a[c[f]];return d};Collection.prototype.sort=function(a,b,c,d){var f;this.onSort&&(f=this.onSort.apply(this,arguments));if(f===false)return this;a=typeof a!=="undefined"?a:"";a=g.isString(a)?a.split(this.SHORT_SPLITTER):a;b=b||false;c=c||"";d=d&&d!==true?d===false?"":d:function(k){if(g.isString(k))return k.toUpperCase();return k};d=this._isStringExpression(d)?this._compileFilter(d):d;var e=this,i;i="";f=function(k,l){var n=b?-1:1;if(a)if(g.isFunction(a)){k=a(k,c);l=a(l,c)}else{k=g.byLink(k,a);l=g.byLink(l,
a)}if(d){k=d(k,c);l=d(l,c)}if(b!==e.SHUFFLE){if(k<l)return n*-1;if(k>l)return n;return 0}else return Math.round(Math.random()*2-1)};if(g.isArray(a))if(a[1]){i=a[0].trim();a=a[1].trim()}else a=a[0].trim();a=this._isStringExpression(a)?this._compileFilter(a):a;i=this._getOne(i,c);if(typeof i!=="object")throw Error("incorrect data type!");if(Collection.isArray(i))i.sort(f);else{if(a){a=a===true?"value":"value"+g.CHILDREN+a;i=g._sortObject(i,a,f)}else i=g._sortObjectByKey(i,f);this._setOne("",i,c)}return this};
Collection._reverseObject=function(a){var b=[],c={},d;for(d in a)a.hasOwnProperty(d)&&b.push(d);b.reverse();for(d in b)if(b.hasOwnProperty(d))c[b[d]]=a[b[d]];return c};Collection.prototype.reverse=function(a){var b;this.onReverse&&(b=this.onReverse.apply(this,arguments));if(b===false)return this;a=(a=a||"").split(this.DEF);b=a[1]?a[1].trim():"";a=a[0].trim();b=this._getOne(b,a);if(typeof b!=="object")throw Error("incorrect data type!");g.isArray(b)?b.reverse():this._setOne("",g._reverseObject(b),
a);return this};Collection.prototype.save=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),d=a===this.ACTIVE?this._exists("collection")?this._getActiveId("collection"):"":this._active("collection",a)?"active":"",f=b===false?sessionStorage:localStorage,e=null;this.onSave&&(e=this.onSave.apply(this,arguments));if(e===false)return this;f.setItem(c+":"+a,this.toString(a));f.setItem(c+
"__date:"+a,(new Date).toString());f.setItem(c+"__active:"+a,d);f.setItem(c+"__date",(new Date).toString());return this};Collection.prototype.saveAll=function(a){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var b,c=this.dObj.sys.tmpCollection,d=false;for(b in c){this._active("Collection",b)&&(d=true);c.hasOwnProperty(b)&&this.save(b,a)}d===false&&this.save("",a);return this};Collection.prototype.load=function(a,b){if(typeof localStorage===
"undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),d=b===false?sessionStorage:localStorage,f=null;this.onLoad&&(f=this.onLoad.apply(this,arguments));if(f===false)return this;a===this.ACTIVE?this._new("collection",JSON.parse(d.getItem(c+":"+a))):this._push("collection",a,JSON.parse(d.getItem(c+":"+a)));c=d.getItem(c+"__active:"+a);if(c===this.ACTIVE)this._set("collection",a);else c&&this._push("collection",c,this._get("collection"))._set("collection",
c);return this};Collection.prototype.loadAll=function(a,b){b=b?"drop":"load";if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var c="__"+this.name+"__"+this._get("namespace"),d=a===false?sessionStorage:localStorage,f=d.length,e,i;try{for(e in d)if(d.hasOwnProperty(e))if((i=e.split(":"))[0]===c)this[b](i[1],a)}catch(k){for(;(f-=1)>-1;)if((i=d[f].split(":"))[0]===c)this[b](i[1],a)}return this};Collection.prototype.loadDate=function(a,b){if(typeof localStorage===
"undefined")throw Error("your browser doesn't support web storage!");return new Date((b===false?sessionStorage:localStorage).getItem("__"+this.name+"__"+this._get("namespace")+"__date"+(a?":"+a:"")))};Collection.prototype.isExpired=function(a,b,c){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(b||"",c||"")))>a};Collection.prototype.drop=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");
a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),d=b===false?sessionStorage:localStorage,f=null;this.onDrop&&(f=this.onDrop.apply(this,arguments));if(f===false)return this;d.removeItem(c+":"+a);d.removeItem(c+"__date:"+a);d.removeItem(c+"__active:"+a);return this};Collection.prototype.dropAll=function(a){(a===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace")+"__date");return this.loadAll(a||"",true)};Collection.prototype._customFilter=function(a,
b,c,d,f,e,i,k,l){var n,p=true,h,m,r,s,j;if(!a||a===true){if(!this._getActiveParam("filter"))return true;if(this._get("filter"))return this._customFilter(this._get("filter"),b,c,d,f,e,i,k,l);return true}if(g.isFunction(a))if(!this._getActiveParam("filter")||!l)return a.call(a,b,c,d,f,e,i,k);else{if(!l.name){for(;this._exists("filter","__tmp:"+(l.name=g.getRandomInt(0,1E4)));)l.name=g.getRandomInt(0,1E4);this._push("filter","__tmp:"+l.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+l.name,
b,c,d,f,e,i,k,l)}if(!g.isArray(a)){if(this._getActiveParam("filter")&&l)a=this.ACTIVE+" && ("+a+")";if(this._isStringExpression(a=a.trim())){this._exists("filter","__tmp:"+a)||this._push("filter","__tmp:"+a,this._compileFilter(a));return(a=this._get("filter","__tmp:"+a)).call(a,b,c,d,f,e,i,k)}a=a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1").trim().split(" ");for(j=a.length;(j-=1)>-1;)a[j]===""&&a.splice(j,1)}n=function(q,o){for(var t=-1,u=
q.length,w=0,z=[];(t+=1)<u;){o+=1;if(q[t]==="("||q[t]==="!(")w+=1;if(q[t]===")")if(w===0)return{result:z,iter:o};else w-=1;z.push(q[t])}};l=a.length;for(j=-1;(j+=1)<l;)if(a[j]==="("||a[j]==="!("){if(a[j].substring(0,1)==="!"){s=true;a[j]=a[j].substring(1)}else s=false;j=(h=n(a.slice(j+1),j)).iter;h=h.result.join(" ");h=this._customFilter(h,b,c,d,f,e,i,k);p=!m&&!r?s===true?!h:h:m?s===true?!h:h&&p:s===true?!h:h||p}else if(a[j]!==")"&&a[j]!=="||"&&a[j]!=="&&"){if(a[j].substring(0,1)==="!"){s=true;a[j]=
a[j].substring(1)}else s=false;h=this._customFilter(this._get("filter",a[j]),b,c,d,f,e,i,k);p=!m&&!r?s===true?!h:h:m?s===true?!h:h&&p:s===true?!h:h||p}else if(a[j]==="||"){m=false;r=true}else if(a[j]==="&&"){r=false;m=true}return p};Collection.prototype._compileFilter=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split(this.VARIABLE[0]).join('cObj.getVariable("').split(this.VARIABLE[1]).join('")');return new Function("el","key","data",
"i","length","cObj","id","return "+a.replace(this.DEF_REGEXP,"")+";")};Collection.prototype._customParser=function(a,b,c){if(!a||a===true){if(!this._getActiveParam("parser"))return b;if(this._get("parser"))return this._customParser(this._get("parser"),b,c);return b}if(g.isFunction(a))if(!this._getActiveParam("parser")||!c)return a.call(a,b,this);else{if(!c.name){for(;this._exists("parser","__tmp:"+(c.name=g.getRandomInt(0,1E4)));)c.name=g.getRandomInt(0,1E4);this._push("parser","__tmp:"+c.name,a)}return this._customParser(this.ACTIVE+
" && __tmp:"+c.name,b,c)}if(g.isString(a)){if(this._getActiveParam("parser")&&c)a=this.ACTIVE+" && "+a;if(this._isStringExpression(a=a.trim())){this._exists("parser","__tmp:"+a)||this._push("parser","__tmp:"+a,this._compileParser(a));return(a=this._get("parser","__tmp:"+a)).call(a,b,this)}a=a.split("&&")}a.forEach(function(d){b=this._customParser(d.trim(),b)},this);return b};Collection.prototype._compileParser=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-
b[0].length);a=a.split(this.VARIABLE[0]).join('cObj.getVariable("').split(this.VARIABLE[1]).join('")');return new Function("str","cObj","return "+a.replace(this.DEF_REGEXP,"")+";")};Collection.prototype._compileFunc=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split(this.VARIABLE[0]).join('cObj.getVariable("').split(this.VARIABLE[1]).join('")');return new Function("el","key","data","i","length","cObj","id",a.replace(this.DEF_REGEXP,"")+
";")};Collection.prototype.parentContext=function(a,b){for(var c=this._get("context",b||"").split(g.CHILDREN),d=a||1;(d-=1)>-1;)c.splice(-1,1);return c.join(g.CHILDREN)};Collection.prototype.parent=function(a,b){if(!b)return this._update("context",this.parentContext(a));return this._push("context",b,this.parentContext(a,b))};Collection.prototype._getActiveParam=function(a){var b=typeof this.dObj.sys.flags.use[a]==="undefined"||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return b?
b.toString():"";return b};Collection.prototype._isFilter=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(this.FILTER_REGEXP)!==-1};Collection.prototype._isStringExpression=function(a){return g.isString(a)&&a.search(this.DEF_REGEXP)!==-1};Collection.prototype._splitId=function(a){a=a||"";var b={};if(a.search(this.SPLITTER)!==-1){b.id=a.split(this.SPLITTER);b.set=true}else{b.id=a.split(this.SHORT_SPLITTER);b.set=false}b.to=b.id[1]?b.id[1].trim():"";b.id=b.id[0].trim();return b};
Collection.prototype._saveResult=function(a,b,c,d){a=a.split(this.WITH);d=d||false;var f;if(a[1]){a=a[1].split(this.DEF);f=a[1]?a[1].trim():"";a=a[0].trim();if(this._validate("collection",a))d?this.concat(c,f,a):this.disable("context").concat(c,f,a).enable("context");else this._push("collection",a,c)}else{a=a[0].split(this.DEF);f=a[1]?a[1].trim():"";a=a[0].trim();if(this._validate("collection",a)&&(f||d))d?this._setOne(f,c,a):this.disable("context")._setOne(f,c,a).enable("context");else this._push("collection",
a,c)}if(b===true)return this._set("collection",a);return this};Collection.prototype.enable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=true},this);return this};Collection.prototype.disable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=false},this);return this};Collection.prototype.toggle=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]===true?this.disable(arguments[A]):this.enable(arguments[A])},
this)};Collection.prototype.toString=function(a,b,c){if(typeof JSON==="undefined"||!JSON.stringify)throw Error("object JSON is not defined!");a=a||"";b=b||"";c=c||"";if(g.isCollection(a))return JSON.stringify(a,b,c);return JSON.stringify(this._getOne("",a),b,c)};Collection.prototype.valueOf=function(a){if(a==="object")return this;return this.length(this.ACTIVE)};Collection.prototype.print=function(a,b){b=b||false;var c=this,d={},f={},e={},i,k,l,n,p=0,h,m=null,r=false,s,j="",q,o,t=g.drivers.dom;if(g.isExists(a)&&
(g.isString(a)||g.isNumber(a)))a={page:a};else g.isExists(a)||(a={page:this._get("page")});g.extend(true,e,this.dObj.active,a);if(a)e.page=g.expr(e.page,this._get("page"));if(e.page<1)e.page=1;e.collection=g.isString(e.collection)?this._get("collection",e.collection):e.collection;e.template=g.isString(e.template)?this._get("template",e.template):e.template;e.cache=g.isExists(a.cache)?a.cache:this._getActiveParam("cache");e.target=g.isString(e.target)?t.find(e.target):e.target;e.pager=g.isString(e.pager)?
t.find(e.pager):e.pager;e.filter=this._isStringExpression(e.filter)?this._compileFilter(e.filter):e.filter;e.parser=this._isStringExpression(e.parser)?this._compileParser(e.parser):e.parser;e.callback=e.callback&&this._isStringExpression(e.callback)?this._compileFunc(e.callback):e.callback;if(b===true)e.cache.iteration=false;h=this._get("page")-e.page;this._update("page",e.page);q=function(u,w){e.callback&&e.callback.apply(e.callback,arguments);j+=e.template.apply(e.template,arguments);p=w;if(r===
false)r=w;return true};i=g.byLink(e.collection,this._getActiveParam("context")+g.CHILDREN+(a&&a.context||""));k=this.length(e.collection);l=function(u,w){if(!l.val)l.val=c.length(u,w);return l.val};s=Boolean(e.breaker&&(e.filter||this._getActiveParam("filter")));e.breaker=e.breaker||k;if(g.isPlainObject(i)||!e.cache||e.cache.iteration===false||e.cache.firstIteration===false||e.cache.lastIteration===false){n=!e.breaker||e.page===1?0:(e.page-1)*e.breaker;this.forEach(q,e.filter,this.ACTIVE,true,e.breaker,
n);if(e.cache&&e.cache.iteration===false)e.cache.lastIteration=false}else if(g.isArray(i)&&e.cache.iteration===true){n=!s?e.page===1?0:(e.page-1)*e.breaker:h>=0?e.cache.firstIteration:e.cache.lastIteration;if(s)if(h>0){for(h*=e.breaker;(n-=1)>-1;)if(this._customFilter(e.filter,i[n],i,n,l,this,this.ACTIVE,f)===true)if(p===h)break;else p+=1;e.cache.lastIteration=n+=1;m=null}else if(h<0)m=-h*e.breaker-e.breaker;f.name&&this._drop("filter","__tmp:"+f.name);this.forEach(q,e.filter,this.ACTIVE,true,e.breaker,
m,n)}if(e.cache){if(h!==0&&e.cache.iteration!==false){this._get("cache").firstIteration=r;this._get("cache").lastIteration=p+1}if(e.cache.autoIteration===true)this._get("cache").iteration=true}l=null;j=!j?e.resultNull:this._customParser(e.parser,j,d);d.name&&this._drop("parser","__tmp:"+d.name);if(e.target===false){e.variable?this._push("variable",e.variable,j):this._new("variable",j);return this}else Array.prototype.forEach.call(e.target,function(u){if(e.toHTML==="replace")u.innerHTML=j;else if(e.toHTML===
"append")u.innerHTML+=j;else u.innerHTML=j+u.innerHTML},this);if(!e.pager)return this;e.nmbOfEntries=e.filter!==false?this.length(e.filter,e.collection):k;e.nmbOfEntriesInPage=e.calculator?t.find(e.calculator,e.target[0]).length:t.children(e.target[0]).length;e.finNumber=e.breaker*e.page-(e.breaker-e.nmbOfEntriesInPage);if(e.page!==1&&e.nmbOfEntriesInPage===0){this.onIPage&&(o=this.onIPage.apply(this,arguments));if(o===false)return this;this._update("page",e.page-=1).print(e,true,true)}else this.easyPage(e);
return this};Collection.prototype.easyPage=function(a){var b=this,c="",d=a.nmbOfPages||(a.nmbOfEntries%a.breaker!==0?~~(a.nmbOfEntries/a.breaker)+1:a.nmbOfEntries/a.breaker),f=function(h,m,r,s){s=s||false;var j,q="<"+(h.tag||"span")+" "+(!s?'data-page="':'data-number-break="')+r+'"';if(h.attr)for(j in h.attr)if(h.attr.hasOwnProperty(j))q+=" "+j+'="'+h.attr[j]+'"';if(!s&&r===a.page||s&&r===a.breaker)q+=' class="'+(m&&m.active||"active")+'"';return q+(">"+r+"</"+(h.tag||"span")+">")},e=function(h,m){if(m===
"select")return'<option value="'+h+'">'+h+"</option>";return h},i,k=0,l,n,p=g.drivers.dom;Array.prototype.forEach.call(a.pager,function(h){Array.prototype.forEach.call(p.find(".ctm",h),function(m){if(a.navBreaker<=2)throw Error('parameter "navBreaker" must be more than 2');c="";var r=m.tagName.toLowerCase(),s=p.data(m),j=s.ctm,q=j.classes;if(j.nav){if(["first","prev","next","last"].indexOf(j.nav)!==-1&&!s["ctm-delegated"]){p.bind(m,"click",function(){if(!p.hasClass(this,j.classes&&j.classes.disabled||
"disabled")){j.nav==="first"&&(a.page=1);j.nav==="prev"&&(a.page="-=1");j.nav==="next"&&(a.page="+=1");j.nav==="last"&&(a.page=d);b.print(a)}});m.setAttribute("data-ctm-delegated",true)}if(["first","prev"].indexOf(j.nav)!==-1&&a.page===1||["next","last"].indexOf(j.nav)!==-1&&a.finNumber===a.nmbOfEntries)p.addClass(m,q&&q.disabled||"disabled");else if(["first","prev","next","last"].indexOf(j.nav)!==-1)p.removeClass(m,q&&q.disabled||"disabled");j.nav==="numberSwitch"&&j.val.forEach(function(o){c+=r===
"select"?'<option vale="'+o+'" '+(o===a.breaker?'selected="selected"':"")+">"+o+"</option>":f(j,q||"",o,true)});if(j.nav==="pageList")if(r==="select")for(i=0;(i+=1)<=d;)c+='<option vale="'+i+'" '+(i===a.page?'selected="selected"':"")+">"+i+"</option>";else if(d>a.navBreaker){k=a.navBreaker%2!==0?1:0;n=l=(a.navBreaker-k)/2;if(a.page-k<l)l=0;else{l=a.page-l-k;if(a.page+n>d)l-=a.page+n-d}i=l;for(k=-1;(i+=1)<=d&&(k+=1)!==null;){if(k===a.navBreaker&&i!==a.page)break;c+=f(j,q||"",i)}}else for(i=0;(i+=1)<=
d;)c+=f(j,q||"",i);if(j.nav==="numberSwitch"||j.nav==="pageList"){m.innerHTML=c;if(!s["ctm-delegated"]){r!=="select"?p.bind(m,"click",function(o){o=o||window.event;o=o.target||o.srcElement;var t=p.data(o);if(o.parentNode!==m)return false;if(j.nav==="pageList")a.page=+t.page;else{b._push("breaker",a.name||"",+t["number-break"]);delete a.breaker}b.print(a)}):p.bind(m,"change",function(){var o=p.children(this,"selected")[0];if(a.page!==o.value){if(s.nav==="pageList")a.page=+o.value;else{b._push("breaker",
a.name||"",+o.value);delete a.breaker}b.print(a)}});m.setAttribute("data-ctm-delegated",true)}}}else if(j.info){a.nmbOfEntriesInPage===0?p.addClass(m,q&&q.noData||"no-data"):p.removeClass(m,q&&q.noData||"no-data");switch(j.info){case "page":if(r==="input")m.value=e(a.page,r);else m.innerHTML=e(a.page,r);break;case "total":if(r==="input")m.value=e(a.nmbOfEntries,r);else m.innerHTML=e(a.nmbOfEntries,r);break;case "from":if(r==="input")m.value=e((a.page-1)*a.breaker+1,r);else m.innerHTML=e((a.page-1)*
a.breaker+1,r);break;case "to":if(r==="input")m.value=e(a.finNumber,r);else m.innerHTML=e(a.finNumber,r);break;case "inPage":if(r==="input")m.value=e(a.nmbOfEntriesInPage,r);else m.innerHTML=e(a.nmbOfEntriesInPage,r);break;case "nmbOfPages":if(r==="input")m.value=e(d,r);else m.innerHTML=e(d,r)}}})});return this};Collection.prototype.genTable=function(a,b,c,d){if(g.isNumber(a)){d=c;c=b;b=a;a=""}b=b||4;c=c||"div";d=d===false?false:true;var f,e,i,k,l=g.drivers.dom;a=a?g.isString(a)?l.find(a):a:this._get("target");
Array.prototype.forEach.call(a,function(n){e=document.createElement("table");f=0;Array.prototype.forEach.call(l.find(c,n),function(p){if(f===0){i=document.createElement("tr");e.appendChild(i)}k=document.createElement("td");k.appendChild(p);i.appendChild(k);f+=1;if(f===b)f=0});if(d===true)for(f=b-i.childNodes.length;(f-=1)>-1;)i.appendChild(document.createElement("td"));n.appendChild(e)},this);return this}})();if(typeof $C==="undefined")var $C=Collection;
//