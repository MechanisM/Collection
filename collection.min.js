/**
 * Collection v3.6.2 | http://collection-js.com
 * 
 * Copyright 2012, Andrey Kobets (Kobezzza | kobezzza@gmail.com | http://kobezzza.com)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
 var Collection;
(function(){Collection=function(a,b){a=a||null;b=b||"";if(!this||!this.name||this.name!=="Collection")return new Collection(a,b);Collection.extend(true,this,Collection.fields);var c=this.dObj.active;b&&Collection.extend(true,c,b);if(this._isStringExpression(c.filter))c.filter=this._compileFilter(c.filter);if(this._isStringExpression(c.parser))c.parser=this._compileParser(c.parser);if(Collection.isString(c.target))c.target=this.drivers.dom.find(c.target);if(Collection.isString(c.pager))c.pager=this.drivers.dom.find(c.pager);
c.collection=a};Collection.byLink=function(a,b,c,d){b=b.toString().replace(RegExp("\\s*"+Collection.CHILDREN+"\\s*","g"),Collection.CONTEXT_SEPARATOR+Collection.CHILDREN+Collection.CONTEXT_SEPARATOR).split(Collection.CONTEXT_SEPARATOR);d=d||false;for(var f=a,e=Collection.CHILDREN,g=0,h=0,i,j=b.length,n,k;(j-=1)>-1;){b[j]=Collection.trim(b[j]);if(b[j]===""){b.splice(j,1);g-=1}else if(b[j]!==Collection.CHILDREN){if(j>g)g=j;h+=1}}k=b.length;if(a===false)return b.join("");else if(Collection.isNumber(a)){if((a=
+a)<0)a+=h;if(typeof c==="undefined"){j=-1;for(n=0;(j+=1)<k;)if(b[j]!==Collection.CHILDREN)if((n+=1)===a){b.splice(j+1,k);return b.join("")}}else{j=k;for(n=0;(j-=1)>-1;)if(b[j]!==Collection.CHILDREN)if((n+=1)===a){b.splice(0,j);return b.join("")}}}for(j=-1;(j+=1)<k;)switch(b[j]){case Collection.CHILDREN:e=b[j];break;default:if(e===Collection.CHILDREN&&b[j].substring(0,Collection.ORDER[0].length)!==Collection.ORDER[0])if(j===g&&typeof c!=="undefined")if(d===false)a[b[j]]=Collection.expr(c,a[b[j]]);
else if(Collection.isArray(a))a.splice(b[j],1);else delete a[b[j]];else a=a[b[j]];else{h=b[j].substring(Collection.ORDER[0].length);h=h.substring(0,h.length-1);h=+h;if(Collection.isArray(a))if(j===g&&typeof c!=="undefined")if(h>=0)if(d===false)a[h]=Collection.expr(c,a[h]);else a.splice(h,1);else if(d===false)a[a.length+h]=Collection.expr(c,a[a.length+h]);else a.splice(a.length+h,1);else a=h>=0?a[h]:a[a.length+h];else{if(h<0){n=0;for(i in a)if(a.hasOwnProperty(i))n+=1;h+=n}n=0;for(i in a)if(a.hasOwnProperty(i)){if(h===
n){if(j===g&&typeof c!=="undefined")if(d===false)a[i]=Collection.expr(c,a[i]);else delete a[i];else a=a[i];break}n+=1}}}}if(typeof c!=="undefined")return f;return a};Collection.execEvent=function(a,b,c,d){a=a.split(Collection.QUERY_SEPARATOR);c=Collection.isExists(c)?c:[];c=Collection.isArray(c)?c:[c];for(var f=-1,e=a.length-1;(f+=1)<e;)b=b[a[f]];d=d||b;if(a[f].search(Collection.SUBQUERY_SEPARATOR)!==-1){a=a[f].split(Collection.SUBQUERY_SEPARATOR);b=b[a[0]];a.splice(0,1);c=c.concat(a);return b.apply(d,
c)}else return b[a[f]].apply(d,c)};Collection.CONTEXT_SEPARATOR="__context__";Collection.QUERY_SEPARATOR="/";Collection.SUBQUERY_SEPARATOR="{";Collection.METHOD_SEPARATOR="->";Collection.CHILDREN=">";Collection.ORDER=["eq(",")"];Collection.objToString=function(a){if(typeof a==="undefined")return Collection.prototype.collection();return Object.prototype.toString.call(a)};Collection.types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function",
"[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};Collection.type=function(a){return a==null?String(a):Collection.types[Collection.objToString(a)]||"object"};Collection.isWindow=function(a){return a&&typeof a==="object"&&"setInterval"in a};Collection.isString=function(a){return Collection.type(a)==="string"};Collection.isNumber=function(a){return Collection.type(a)==="number"};Collection.isBoolean=function(a){return Collection.type(a)==="boolean"};
Collection.isFunction=function(a){return Collection.type(a)==="function"};Collection.isArray=function(a){return Collection.type(a)==="array"};Collection.isPlainObject=function(a){if(!a||Collection.type(a)!=="object"||a.nodeType||Collection.isWindow(a))return false;try{if(a.constructor&&!a.hasOwnProperty("constructor")&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))return false}catch(b){return false}for(var c in a);return c===undefined||a.hasOwnProperty(c)};Collection.isCollection=function(a){return Collection.isArray(a)||
Collection.isPlainObject(a)};Collection.isExists=function(a){return typeof a!=="undefined"&&a!==null&&a!==""};Collection.trim=function(a){a=a.replace(/^\s\s*/,"");for(var b=/\s/,c=a.length;b.test(a.charAt(c-=1)););return a.substring(0,c+1)};Collection.toUpperCase=function(a,b,c){c=c||0;b=Collection.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toUpperCase()+a.substring(b)};Collection.toLowerCase=function(a,b,c){c=c||0;b=Collection.isExists(b)?c+b:a.length;return a.substring(0,
c)+a.substring(c,b).toLowerCase()+a.substring(b)};Collection.expr=function(a,b){b=Collection.isExists(b)?b:"";if(Collection.isString(a)&&a.search(/^[+-\\*\/]{1}=/)!==-1){a=a.split("=");isNaN(a[1])||(a[1]=+a[1]);switch(a[0]){case "+":a=b+a[1];break;case "-":a=b-a[1];break;case "*":a=b*a[1];break;case "/":a=b/a[1]}}return a};Collection.getRandomInt=function(a,b){a=a||0;return Math.floor(Math.random()*((b||10)-a+1))+a};Collection.extend=function(){var a,b,c,d,f,e=arguments[0]||{},g=0,h=arguments.length,
i=false;if(Collection.isBoolean(e)){i=e;e=arguments[1]||{};g=1}if(typeof e!=="object"&&!Collection.isFunction(e))e={};if(h===g){e=Collection;g-=1}for(;(g+=1)<h;)if(Collection.isExists(a=arguments[g]))for(b in a){c=e[b];d=a[b];if(e!==d)if(i&&d&&(Collection.isPlainObject(d)||(f=Collection.isArray(d)))){if(f){f=false;c=c&&Collection.isArray(c)?c:[]}else c=c&&Collection.isPlainObject(c)?c:{};e[b]=Collection.extend(i,c,d)}else if(typeof d!=="undefined")e[b]=d}return e};Collection.addElementToObject=function(a,
b,c){b=b.split(Collection.METHOD_SEPARATOR);var d,f={};if(b[1]&&b[1]==="unshift"){f[!isNaN(Number(b[0]))?0:b[0]]=c;for(d in a)if(a.hasOwnProperty(d))f[!isNaN(Number(d))?+d+1:d]=a[d];return f}else if(!b[1]||b[1]==="push")a[b[0]]=c;return true};Collection.unshiftArguments=function(a,b){for(var c=[b],d=-1,f=a.length;(d+=1)<f;)c.push(a[d]);return c};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=-1,d=this.length;(c+=1)<d;)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.some)Array.prototype.some=
function(a,b){for(var c=-1,d=this.length,f;(c+=1)<d;)if(f=b?a.call(b,this[c],c,this):a(this[c],c,this))return true;return false};if(!Array.prototype.every)Array.prototype.every=function(a,b){for(var c=-1,d=this.length,f,e=true;(c+=1)<d;){f=b?a.call(b,this[c],c,this):a(this[c],c,this);if(e===true&&!f)e=false}return e};if(!Array.prototype.filter)Array.prototype.filter=function(a,b){for(var c=-1,d=this.length,f=[];(c+=1)<d;)if(b)a.call(b,this[c],c,this)&&f.push(this[c]);else a(this[c],c,this)&&f.push(this[c]);
return f};if(!Array.prototype.map)Array.prototype.map=function(a,b){for(var c=-1,d=this.length,f=[];(c+=1)<d;)b?f.push(a.call(b,this[c],c,this)):f.push(a(this[c],c,this));return f};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a,b){for(var c=(b||0)-1,d=this.length;(c+=1)<d;)if(this[c]===a)return c;return-1};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(a,b){for(var c=b||this.length;(c-=1)>-1;)if(this[c]===a)return c;return-1};if(!Array.prototype.reduce)Array.prototype.reduce=
function(a,b){var c=0,d=this.length,f;if(d===1)return this[0];for(f=b?b:this[0];(c+=1)<d;)f=a(f,this[c],c,this);return f};if(!Array.prototype.reduceRight)Array.prototype.reduceRight=function(a,b){var c=this.length-1,d;if(this.length===1)return this[0];for(d=b?b:this[c];(c-=1)>-1;)d=a(d,this[c],c,this);return d};Collection.prototype={name:"Collection",version:"3.7",collection:function(){return this.name+" "+this.version},ACTIVE:"active",SHUFFLE:"shuffle",NAMESPACE_SEPARATOR:".",stack:["namespace",
"collection","filter","context","cache","variable","defer","page","parser","toHTML","target","calculator","pager","template","breaker","navBreaker","resultNull"]};Collection.prototype.drivers=Collection.drivers={};Collection.drivers.dom={find:function(a,b){if(!this.lib)throw Error("DOM driver is not defined!");return this.engines[this.lib].find(a||"",b||"")},children:function(a,b){var c=[];Array.prototype.forEach.call(a.childNodes,function(d){if(d.nodeType===1)if(b)d[b]&&c.push(d);else c.push(d)});
return c},data:function(a,b){var c=a.attributes,d={};c&&c.length>0&&Array.prototype.forEach.call(c,function(f){if(f.name.substring(0,5)==="data-")d[f.name.replace("data-","")]=Collection.isString(f.value)&&f.value.search(/^\{|\[/)!==-1?JSON.parse(f.value):f.value});if(b)return d[b];return d},text:function(a){a=a.childNodes;var b="";Array.prototype.forEach.call(a,function(c){if(c.nodeType===3&&Collection.trim(c.textContent))b+=c.textContent});if(b)return b;return false},bind:function(a,b,c){if(this.engines[this.lib][b]){this.engines[this.lib][b](a,
c);return this}document.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c);return this},addClass:function(a,b){if(a.className.split(" ").indexOf(b)===-1)a.className+=" "+b;return this},hasClass:function(a,b){return a.className.split(" ").indexOf(b)!==-1},removeClass:function(a,b){var c=[];a.className.split(" ").forEach(function(d){d!==b&&c.push(d)});a.className=c.join(" ");return this},engines:{qsa:{is:function(){if(typeof qsa!=="undefined")return true},find:function(a,b){return qsa.querySelectorAll(a,
b)}},sizzle:{is:function(){if(typeof Sizzle!=="undefined")return true},find:function(a,b){return Sizzle(a,b)}},jQuery:{is:function(){if(typeof jQuery!=="undefined")return true},find:function(a,b){return jQuery(a,b)},click:function(a,b){$(a).click(b)},change:function(a,b){$(a).change(b)}},dojo:{is:function(){if(typeof dojo!=="undefined")return true},find:function(a,b){return b?dojo.query(a,b):dojo.query(a)},click:function(a,b){dojo.connect(a,"onclick",b)}},mootools:{is:function(){if(typeof MooTools!==
"undefined")return true},find:function(a,b){var c;if(b){c=[];$$(b).getElements(a).forEach(function(d){d.forEach(function(f){c.push(f)})})}else c=$$(a);return c}},prototype:{is:function(){if(typeof Prototype!=="undefined")return true},find:function(a,b){return b?b.getElementsBySelector(a):$$(a)}}}};(function(){var a,b=Collection.drivers.dom.engines;for(a in b)if(b.hasOwnProperty(a))if(b[a].is()){Collection.drivers.dom.lib=a;return true}})();Collection._inObj=function(a){var b=[],c=Collection.fromNode.stat,
d=Collection.drivers.dom;Array.prototype.forEach.call(a,function(f){if(f.nodeType===1){var e=d.data(f),g=f.hasAttribute("class")?f.getAttribute("class").split(" "):"",h=d.text(f),i,j=b.length;b.push({});for(i in e)if(e.hasOwnProperty(i))b[j][i]=e[i];if(g){b[j][c.classes]={};g.forEach(function(n){b[j][c.classes][n]=n})}if(f.childNodes.length!==0)b[j][c.childNodes]=Collection._inObj(f.childNodes);if(h!==false)b[j][c.val]=h.replace(/[\r\t\n]/g," ")}});return b};Collection.fromNode=function(a,b){if(typeof JSON===
"undefined"||!JSON.parse)throw Error("object JSON is not defined!");var c=Collection._inObj(Collection.drivers.dom.find(a));if(b)return new Collection(c,b);return new Collection(c)};if(!Collection.fromNode.stat)Collection.fromNode.stat={val:"val",childNodes:"childNodes",classes:"classes"};Collection.ctplCompile=function(a){Collection.isString(a)&&(a=Collection.drivers.dom.find(a));if(a.length===0)throw Error("DOM element does't exist!");var b='var result = ""; ';(a[0]?a[0][0]?a[0][0].innerHTML:a[0].innerHTML:
a.innerHTML).replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(c,d){b+=d===0||d%2===0?'result +="'+c.split('"').join('\\"')+'";':c.split("echo").join("result +=")});return new Function("el","key","data","i","length","cObj","id",b+" return result;")};Collection.prototype.ctplMake=function(a){var b=Collection.drivers.dom;Collection.isString(a)&&(a=b.find(a));Array.prototype.forEach.call(a,function(c){var d=b.data(c,"ctpl"),f,e=d.prefix?d.prefix+
"_":"";this._push("template",e+d.name,Collection.ctplCompile(c));d.set&&d.set===true&&this._set("template",e+d.name);for(f in d)if(d.hasOwnProperty(f))if(["prefix","set","print","name","collection"].indexOf(f)===-1){if(["target","pager"].indexOf(f)!==-1)d[f]=b.find(d[f]);this._push(f,e+d.name,d[f]);d.set&&d.set===true&&this._set(f,e+d.name);if(["filter","parser"].indexOf(f)!==-1)d[f]=e+d.name}if(!d.target){this._push("target",e+d.name,[c.parentNode]);d.set&&d.set===true&&this._set("target",e+d.name)}if(d.print&&
d.print===true){d.template=d.name;this.print(d)}},this);return this};Collection.fields={dObj:{active:{namespace:"nm",collection:null,filter:false,context:"",cache:{autoIteration:true,iteration:true,firstIteration:false,lastIteration:false},variable:null,defer:"",page:1,parser:false,toHTML:"replace",target:null,calculator:null,pager:null,template:null,breaker:null,navBreaker:5,resultNull:""}}};Collection.fields.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};(function(a){var b,
c=Collection.fields.dObj.sys;a.forEach(function(d){b=Collection.toUpperCase(d,1);c["active"+b+"ID"]=null;c["tmp"+b]={};c[d+"ChangeControl"]=null;c[d+"Back"]=[]})})(Collection.prototype.stack);Collection.prototype._new=function(a,b){var c=this.dObj.active,d=Collection.toUpperCase(a,1),f;this["onNew"+d]&&(f=this["onNew"+d](b));if(f===false)return this;c[a]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b)?this["_compile"+Collection.toUpperCase(a,1)](b):["target","pager"].indexOf(a)!==
-1&&Collection.isString(b)?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(b)?b:[b]):Collection.expr(b,c[a]||"");this.dObj.sys["active"+d+"ID"]=null;return this};Collection.prototype._update=function(a,b){var c=this.dObj.active,d=Collection.toUpperCase(a,1),f,e=this._getActiveID(a);this["onUpdate"+d]&&(f=this["onUpdate"+d](b));if(f===false)return this;c[a]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b)?this["_compile"+d](b):["target","pager"].indexOf(a)!==-1&&Collection.isString(b)?
this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(b)?b:[b]):Collection.expr(b,c[a]||"");if(e)this.dObj.sys["tmp"+d][e]=c[a];return this};Collection.prototype._get=function(a,b){if(b&&b!==this.ACTIVE){if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");return this.dObj.sys["tmp"+Collection.toUpperCase(a,1)][b]}return this.dObj.active[a]};Collection.prototype._push=function(a,b,c){var d=Collection.toUpperCase(a,1),f,e=this.dObj.sys["tmp"+d],
g=this._getActiveID(a),h;this["onPush"+d]&&(f=this["onPush"+d](b,c||""));if(f===false)return this;if(Collection.isPlainObject(b))for(h in b){if(b.hasOwnProperty(h))if(h===this.ACTIVE)this._update(a,b[h]);else if(e[h]&&g&&g===h)this._update(a,b[h]);else e[h]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(b[h])?this["_compile"+d](b[h]):["target","pager"].indexOf(a)!==-1&&Collection.isString(b[h])?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(b[h])?b[h]:[b[h]]):b[h]}else if(b===
this.ACTIVE)this._update(a,c);else if(e[b]&&g&&g===b)this._update(a,c);else e[b]=["filter","parser"].indexOf(a)!==-1&&this._isStringExpression(c)?this["_compile"+d](c):["target","pager"].indexOf(a)!==-1&&Collection.isString(c)?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(c)?c:[c]):c;return this};Collection.prototype._set=function(a,b){var c=this.dObj.sys,d=Collection.toUpperCase(a,1),f,e=a+"ChangeControl",g="active"+d+"ID";if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+
a+"\" doesn't exist in the stack!");this["onSet"+d]&&(f=this["onSet"+d](b));if(f===false)return this;if(c[g]!==b){c[e]=true;c[g]=b}else c[e]=false;c[a+"Back"].push(b);this.dObj.active[a]=c["tmp"+d][b];return this};Collection.prototype._back=function(a,b){b=b||1;var c=this.dObj.sys,d=Collection.toUpperCase(a,1),f,e=c[a+"Back"],g=e.length-b-1;this["onBack"+d]&&(f=this["onBack"+d](b));if(f===false)return this;if(g>=0&&e[g])if(c["tmp"+d][e[g]]){this._set(a,e[g]);c[a+"ChangeControl"]=false;e.splice(g+
1,e.length)}return this};Collection.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};Collection.prototype._drop=function(a,b,c,d){c=typeof c==="undefined"?false:c;var f=this.dObj.active,e=this.dObj.sys,g=Collection.toUpperCase(a,1),h,i="active"+g+"ID",j="tmp"+g,n=this._getActiveID(a),k=!b?n?[n]:[]:Collection.isArray(b)||Collection.isPlainObject(b)?b:[b],l;if(typeof d==="undefined")this["onDrop"+g]&&(h=this["onDrop"+g](b,
c));else this["onReset"+g]&&(h=this["onReset"+g](b,d));if(h===false)return this;if(k[0]&&k[0]!==this.ACTIVE)for(l in k){if(k.hasOwnProperty(l))if(!k[l]||k[l]===this.ACTIVE)if(typeof d==="undefined"){n&&delete e[j][n];e[i]=null;f[a]=c}else{if(n)e[j][n]=d;f[a]=d}else if(typeof d==="undefined"){delete e[j][k[l]];if(n&&k[l]===n){e[i]=null;f[a]=c}}else{e[j][k[l]]=d;if(n&&k[l]===n)f[a]=d}}else if(typeof d==="undefined"){n&&delete e[j][n];e[i]=null;f[a]=c}else{if(n)e[j][n]=d;f[a]=d}return this};Collection.prototype._reset=
function(a,b,c){return this._drop(a,b||"","",typeof c==="undefined"?false:c)};Collection.prototype._resetTo=function(a,b,c){c=!c||c===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+Collection.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};Collection.prototype._exists=function(a,b){var c=Collection.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&this._getActiveID(a))return true;if(typeof this.dObj.sys["tmp"+c][b]!=="undefined")return true;return false};Collection.prototype._getActiveID=function(a){return this.dObj.sys["active"+
Collection.toUpperCase(a,1)+"ID"]};Collection.prototype._active=function(a,b){if(!b)return this._getActiveID(a);if(b===this._getActiveID(a))return true;return false};Collection.prototype.use=function(a){this.stack.forEach(function(b){var c,d,f;if(this._exists(b,a))this._set(b,a);else{c=a.split(this.NAMESPACE_SEPARATOR);for(f=c.length;(f-=1)>-1;){c.splice(f,1);d=c.join(this.NAMESPACE_SEPARATOR);if(this._exists(b,d)){this._set(b,d);break}}}},this);return this};(function(a){var b=Collection.prototype,
c;a.forEach(function(d){c=Collection.toUpperCase(d,1);b["new"+c]=function(f){return function(e){return this._new(f,e)}}(d);b["update"+c]=function(f){return function(e){return this._update(f,e)}}(d);b["reset"+c+"To"]=function(f){return function(e,g){return this._resetTo(f,e,g)}}(d);b["push"+c]=function(f){return function(){return this._push.apply(this,Collection.unshiftArguments(arguments,f))}}(d);b["set"+c]=function(f){return function(e){return this._set(f,e)}}(d);b["pushSet"+c]=function(f){return function(e,
g){return this._push(f,e,g)._set(f,e)}}(d);b["back"+c]=function(f){return function(e){return this._back(f,e||"")}}(d);b["back"+c+"If"]=function(f){return function(e){return this._backIf(f,e||"")}}(d);b["drop"+c]=d==="filter"||d==="parser"?function(f){return function(){return this._drop(f,arguments)}}(d):function(f){return function(){return this._drop(f,arguments,null)}}(d);if(d==="filter"||d==="parser")b["reset"+c]=function(f){return function(){return this._reset(f,arguments)}}(d);else if(d==="page")b["reset"+
c]=function(f){return function(){return this._reset(f,arguments,1)}}(d);else if(d==="context")b["reset"+c]=function(f){return function(){return this._reset(f,arguments,"")}}(d);b["active"+c]=function(f){return function(e){return this._active(f,e)}}(d);b["exists"+c]=function(f){return function(e){return this._exists(f,e||"")}}(d);b["get"+c+"ActiveID"]=function(f){return function(){return this._getActiveID(f)}}(d);b["get"+c]=function(f){return function(e){return this._get(f,e||"")}}(d)})})(Collection.prototype.stack);
Collection.prototype._setOne=function(a,b,c){a=Collection.isExists(a)?a.toString():"";b=typeof b==="undefined"?"":b;c=c||"";var d=this._getActiveParam("context"),f;this.onSet&&(f=this.onSet.apply(this,arguments));if(f===false)return this;if(!a&&!d)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);Collection.byLink(this._get("collection",c),d+Collection.CHILDREN+a,b);return this};Collection.prototype._getOne=function(a,b){a=Collection.isExists(a)?a.toString():"";return Collection.byLink(this._get("collection",
b||""),this._getActiveParam("context")+Collection.CHILDREN+a)};Collection.prototype.add=function(a,b,c,d,f){a=typeof a!=="undefined"?a:"";b=b||"push";c=c||"";f=f||false;var e,g,h;this.onAdd&&(e=this.onAdd.apply(this,arguments));if(e===false)return this;e=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof e!=="object")throw Error("unable to set property!");if(d){a=Collection.isExists(a)?a.toString():"";g=Collection.byLink(this._get("collection",d||""),a);if(Collection.isPlainObject(e)){b=
b==="push"?this.length(e):b==="unshift"?this.length(e)+Collection.METHOD_SEPARATOR+"unshift":b;h=Collection.addElementToObject(e,b.toString(),g)}else{h=true;e[b](g)}f===true&&this.disable("context")._removeOne(a,d).enable("context")}else if(Collection.isPlainObject(e)){b=b==="push"?this.length(e):b==="unshift"?this.length(e)+Collection.METHOD_SEPARATOR+"unshift":b;h=Collection.addElementToObject(e,b.toString(),a)}else{h=true;e[b](a)}h!==true&&this._setOne("",h,c);return this};Collection.prototype.push=
function(a,b){return this.add(a,"",b||"")};Collection.prototype.unshift=function(a,b){return this.add(a,"unshift",b||"")};Collection.prototype._removeOne=function(a,b){a=Collection.isExists(a)?a.toString():"";var c=this._getActiveParam("context"),d;this.onRemove&&(d=this.onRemove.apply(this,arguments));if(d===false)return this;!a&&!c?this._setOne("",null):Collection.byLink(this._get("collection",b||""),c+Collection.CHILDREN+a,"",true);return this};Collection.prototype._remove=function(a,b){b=b||"";
var c,d;if(Collection.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(Collection.isArray(a[c]))for(d=a[c].length;(d-=1)>-1;)this._removeOne(a[c][d],c);else this._removeOne(a[c],c)}else if(Collection.isArray(a))for(d=a.length;(d-=1)>-1;)this._removeOne(a[d],b);else this._removeOne(a,b);return this};Collection.prototype.pop=function(a){return this._removeOne("eq(-1)",a||"")};Collection.prototype.shift=function(a){return this._removeOne("eq(0)",a||"")};Collection.prototype.concat=function(a,b,
c){b=Collection.isExists(b)?b.toString():"";c=c||"";var d;this.onConcat&&(d=this.onConcat.apply(this,arguments));if(d===false)return this;d=Collection.byLink(this._get("collection",c),this._getActiveParam("context")+Collection.CHILDREN+b);if(typeof d!=="object")throw Error("incorrect data type!");if(Collection.isPlainObject(d))Collection.extend(true,d,a);else if(Collection.isArray(d))if(Collection.isArray(a)){d=Array.prototype.concat(d,a);this._setOne(b,d,c)}else this.add(a,"push",c);return this};
Collection.prototype._empty=function(){return null};Collection.prototype.length=function(a,b,c,d,f,e,g){a=a||"";var h,i,j;if(!Collection.isFunction(a))if(Collection.isString(a)&&!this._isFilter(a)&&!Collection.isExists(b)||Collection.isCollection(a)){b=a;a=false}if(Collection.isBoolean(b)){g=e;e=f;f=d;d=c;c=b;b=this.ACTIVE}else b=b||"";if(b)if(Collection.isString(b))h=this._get("collection",b);else{i=true;h=b}else h=this._get("collection");if(h===null)return 0;if(i!==true)h=Collection.byLink(h,this._getActiveParam("context"));
if(Collection.isString(h))return h.length;if((a===true||!a)&&!this._getActiveParam("filter")&&typeof h.length!=="undefined")j=h.length;else{j=0;this.forEach(function(){j+=1},a,b,c||"",d||"",f||"",e||"",g||"")}return j};Collection.prototype.forEach=function(a,b,c,d,f,e,g,h){a=this._isStringExpression(a)?this._compileFunc(a):a;b=b||"";if(Collection.isBoolean(c)){h=g;g=e;e=f;f=d;d=c;c=this.ACTIVE}else c=c||"";d=d===false?false:true;f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||
false;h=h||false;var i=this,j={},n=[],k,l,o,q,m,p=0,r=0,s=false;k=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof k!=="object")throw Error("incorrect data type!");l=function(){if(!l.val)l.val=i.length(b,c);return l.val};o=function(t,u){if(!o.val)o.val=i.length(t||"",u||"");return o.val};if(Collection.isArray(k)){if(g!==false)h||(q=k.slice(g));else q=k;if(h)for(m=q.length-g;(m-=1)>-1;){if(f!==false&&r===f)return true;if(this._customFilter(b,q[m],m,k,p,o,this,
c,j)===true)if(e!==false&&e!==0)e-=1;else{s=a.call(a,q[m],m,k,p,l,this,c)===false;if(d===false)s=true;r+=1}p+=1;if(s===true)return true}else q.some(function(t,u){u+=g;if(f!==false&&r===f)return true;if(this._customFilter(b,t,u,k,p,o,this,c,j)===true)if(e!==false&&e!==0)e-=1;else{s=a.call(a,t,u,k,p,l,this,c)===false;if(d===false)s=true;r+=1}p+=1;if(s===true)return true},this)}else if(h){for(m in k)k.hasOwnProperty(m)&&n.push(m);for(m=n.length-g;(m-=1)>-1;){if(f!==false&&r===f)return true;if(this._customFilter(b,
k[n[m]],n[m],k,p,o,this,c,j)===true)if(e!==false&&e!==0)e-=1;else{s=a.call(a,k[n[m]],n[m],k,p,l,this,c)===false;if(d===false)s=true;r+=1}p+=1;if(s===true)return true}}else for(m in k)if(k.hasOwnProperty(m)){if(f!==false&&r===f)break;if(g!==false&&g!==0)g-=1;else{if(this._customFilter(b,k[m],m,k,p,o,this,c,j)===true)if(e!==false&&e!==0)e-=1;else{s=a.call(a,k[m],m,k,p,l,this,c)===false;if(d===false)s=true;r+=1}p+=1;if(s===true)break}}j.name&&this._drop("filter","__tmp:"+j.name);o=l=null;return this};
Collection.prototype.some=function(a,b,c,d,f,e){return this.forEach(a,b||"",c||"",false,"",d||"",f||"",e||"")};Collection.prototype.search=function(a,b,c,d,f,e,g){if(Collection.isBoolean(b)){g=e;e=f;f=d;d=c;c=b;b=this.ACTIVE}else b=b||"";c=c===false?false:true;d=parseInt(d)>=0?parseInt(d):false;f=parseInt(f)||false;e=parseInt(e)||false;var h=c===true?[]:-1;this.forEach(function(i,j){if(c===true)h.push(j);else h=j;return true},a||"",b,c,d,f,e,g||false);return h};Collection.prototype.searchOne=function(a,
b,c,d,f){return this.search(a||"",b||"",false,"",c||"",d||"",f||"")};Collection.prototype.indexOf=function(a,b,c){c=c||"";b=b||"";var d=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(Collection.isArray(d)&&d.indexOf){if(b)return d.indexOf(a,b);return d.indexOf(a)}else return this.search(function(f){return f===a},c,false,"","",b)};Collection.prototype.lastIndexOf=function(a,b,c){c=c||"";b=b||"";var d=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));
if(Collection.isArray(d)&&d.lastIndexOf){if(b)return d.lastIndexOf(a,b);return d.lastIndexOf(a)}else{b=this.search(function(f){return f===a},c,"","","",b);return typeof b[b.length-1]!=="undefined"?b[b.length-1]:-1}};Collection.prototype.get=function(a,b,c,d,f,e){if(Collection.isNumber(a)||arguments.length<=2&&!Collection.isBoolean(b)&&Collection.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)return this._getOne(a,b||"");if(Collection.isBoolean(b)){e=f;f=d;d=c;c=b;b=this.ACTIVE}else b=
b||"";c=c===false?false:true;d=parseInt(d)>=0?parseInt(d):false;f=parseInt(f)||false;e=parseInt(e)||false;var g=c===true?[]:-1;this.forEach(function(h,i,j){if(c===true)g.push(j[i]);else g=j[i];return true},a||"",b,c,d,f,e);return g};Collection.prototype.getOne=function(a,b,c,d){return this.get(a||"",b||"",false,"",c||"",d||"")};Collection.prototype.set=function(a,b,c){if(Collection.isNumber(a)||arguments.length<=3&&!Collection.isBoolean(c)&&Collection.isString(a)&&!this._isFilter(a)||arguments.length===
0||a===false)return this._setOne(a,b,c||"");b=this._isStringExpression(b)?this._compileFunc(b):b;var d,f,e,g=Collection.isFunction(b);f=Collection.unshiftArguments(arguments,function(h,i,j,n,k,l,o){if(g){e=b.call(b,h,i,j,n,k,l,o);if(typeof e!=="undefined")j[i]=e}else j[i]=Collection.expr(b,j[i]);return true});f.splice(2,1);this.onSet&&(d=this.onSet.apply(this,arguments));if(d===false)return this;return this.forEach.apply(this,f)};Collection.prototype.setOne=function(a,b,c,d,f,e){return this.set(a||
"",b,c||"",false,"",d||"",f||"",e||"")};Collection.prototype.map=function(a,b,c,d,f,e,g,h){return this.set(b||true,a,c||"",d||"",f||"",e||"",g||"",h||"")};Collection.prototype.move=function(a,b,c,d,f,e,g,h,i,j){a=a||"";j=j===false?false:true;b=Collection.isExists(b)?b.toString():"";c=c||"";d=d||"";f=f||"push";e=e===false?false:true;g=parseInt(g)>=0?parseInt(g):false;h=parseInt(h)||false;i=parseInt(i)||false;var n=[],k=Collection.isArray(Collection.byLink(this._get("collection",d),this._getActiveParam("context"))),
l;l=null;j&&this.onMove&&(l=this.onMove.apply(this,arguments));!j&&this.onCopy&&(l=this.onCopy.apply(this,arguments));if(l===false)return this;this.disable("context");l=Collection.isNumber(a)||arguments.length<=5&&Collection.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false?a:this.search(a,c,e,g,h,i);this.enable("context");if(e===true&&Collection.isArray(l))l.forEach(function(o){this.add(b+Collection.CHILDREN+o,k===true?f:o+Collection.METHOD_SEPARATOR+f,d,c);j===true&&n.push(o)},this);
else{this.add(b+Collection.CHILDREN+l,k===true?f:l+Collection.METHOD_SEPARATOR+f,d,c);j===true&&n.push(l)}j===true&&this.disable("context")._remove(n,c).enable("context");return this};Collection.prototype.moveOne=function(a,b,c,d,f,e,g){return this.move(a||"",Collection.isExists(b)?b.toString():"",c||"",d||"",f||"",false,"",e||"",g||"")};Collection.prototype.copy=function(a,b,c,d,f,e,g,h,i){e=e===false?false:true;g=parseInt(g)>=0?parseInt(g):false;h=parseInt(h)||false;i=parseInt(i)||false;return this.move(a||
"",Collection.isExists(b)?b.toString():"",c||"",d||"",f||"push",e,g,h,i,false)};Collection.prototype.copyOne=function(a,b,c,d,f,e,g){return this.move(a||"",Collection.isExists(b)?b.toString():"",c||"",d||"",f||"",false,"",e||"",g||"",false)};Collection.prototype.remove=function(a,b){if(Collection.isNumber(a)||arguments.length<=2&&!Collection.isBoolean(b)&&Collection.isString(a)&&!this._isFilter(a)||arguments.length===0||a===false)return this._removeOne(a,b||"");else if(Collection.isArray(a)||Collection.isPlainObject(a))return this._remove(a,
b||"");var c=this.search.apply(this,arguments),d=c.length;if(Collection.isArray(c))for(;(d-=1)>-1;)this._removeOne(c[d],b);else this._removeOne(c,b);return this};Collection.prototype.removeOne=function(a,b,c,d){return this.remove(a||"",b||"",false,"",c||"",d||"")};Collection.prototype.group=function(a,b,c,d,f,e,g){a=this._isStringExpression(a=a||"")?this._compileFilter(a):a;c=c||"";g=g||false;d=parseInt(d)>=0?parseInt(d):false;f=parseInt(f)||false;e=parseInt(e)||false;var h=Collection.isString(a),
i={};this.forEach(function(j,n){var k=h?Collection.byLink(j,a):a.apply(a,arguments);if(i[k])i[k].push(!g?j:n);else i[k]=[!g?j:n];return true},b,c,"",d,f,e);return i};Collection.prototype.groupLinks=function(a,b,c,d,f,e){return this.group(a||"",b||"",c||"",d||"",f||"",e||"",true)};Collection.prototype.stat=function(a,b,c,d,f,e,g){a=(a=a||"count")&&this._isStringExpression(a)?this._compileFilter(a):a;b=(b=b||"")&&this._isStringExpression(b)?this._compileFilter(b):b;d=d||"";f=parseInt(f)>=0?parseInt(f):
false;e=parseInt(e)||false;g=parseInt(g)||false;var h=Collection.isString(a),i=0,j=0,n=function(k,l,o,q,m,p,r){k=Collection.isString(b)?Collection.byLink(k,b):b(k,l,o,q,m,p,r);switch(a){case "count":i+=1;break;case "summ":i+=k;break;case "avg":j+=1;i+=k;break;case "max":if(k>i)i=k;break;case "min":if(j===0){i=k;j=1}else if(k<i)i=k;break;default:if(h)if(j===0){i=k;j=1}else i=Collection.expr(a+"="+k,i);else i=a(k,i)}return true};if(a!=="first"&&a!=="last"){this.forEach(n,c||"",d,"",f,e,g);if(a==="avg")i/=
j}else i=a==="first"?this._getOne(Collection.ORDER[0]+"0"+Collection.ORDER[1]):this._getOne(Collection.ORDER[0]+"-1"+Collection.ORDER[1]);return i};Collection.prototype.groupStat=function(a,b,c,d,f,e,g){a=(a=a||"count")&&this._isStringExpression(a)?this._compileFilter(a):a;b=(b=b||"")&&this._isStringExpression(b)?this._compileFilter(b):b;d=d||"";f=parseInt(f)>=0?parseInt(f):false;e=parseInt(e)||false;g=parseInt(g)||false;var h=Collection.isString(a),i={},j={},n,k=function(l,o,q,m,p,r,s){l=Collection.isString(b)?
Collection.byLink(l,b):b(l,o,q,m,p,r,s);switch(a){case "count":i[this.key]+=1;break;case "summ":i[this.key]+=l;break;case "avg":j[this.key]+=1;i[this.key]+=l;break;case "max":if(l>i[this.key])i[this.key]=l;break;case "min":if(j[this.key]===0){i[this.key]=l;j[this.key]=1}else if(l<i[this.key])i[this.key]=l;break;default:if(h)if(j[this.key]===0){i[this.key]=l;j[this.key]=1}else i[this.key]=Collection.expr(a+"="+l,i[this.key]);else i[this.key]=a(l,i[this.key])}return true};this.forEach(function(l,o,
q,m,p,r,s){i[o]||(i[o]=j[o]=0);if(a!=="first"&&a!=="last")r._update("context","+="+Collection.CHILDREN+(k.key=o)).forEach(k,c||"",s,"",f,e,g).parent();else i[o]=a==="first"?Collection.byLink(l,Collection.ORDER[0]+"0"+Collection.ORDER[1]):Collection.byLink(l,Collection.ORDER[0]+"-1"+Collection.ORDER[1]);return true},"",d);if(a==="avg")for(n in i)if(i.hasOwnProperty(n))i[n]/=j[n];return i};Collection._sortObject=function(a,b,c){b=[];var d={},f;for(f in a)a.hasOwnProperty(f)&&b.push({key:f,value:a[f]});
b.sort(c);for(f in b)if(b.hasOwnProperty(f))d[b[f].key]=b[f].value;return d};Collection._sortObjectByKey=function(a,b){var c=[],d={},f;for(f in a)a.hasOwnProperty(f)&&c.push(f);c.sort(b);for(f in c)if(c.hasOwnProperty(f))d[c[f]]=a[c[f]];return d};Collection.prototype.sort=function(a,b,c,d){a=(a=a||"")&&this._isStringExpression(a)?this._compileFilter(a):a;b=b||false;c=c&&c!==true?c===false?"":c:function(h){if(Collection.isString(h))return h.toUpperCase();return h};c=this._isStringExpression(c)?this._compileFilter(c):
c;d=d||"";var f=this,e,g=function(h,i){var j=b?-1:1;if(a)if(Collection.isFunction(a)){h=a(h,d);i=a(i,d)}else{h=Collection.byLink(h,a);i=Collection.byLink(i,a)}if(c){h=c(h,d);i=c(i,d)}if(b!==f.SHUFFLE){if(h<i)return j*-1;if(h>i)return j;return 0}else return Math.round(Math.random()*2-1)};this.onSort&&(e=this.onSort.apply(this,arguments));if(e===false)return this;e=Collection.byLink(this._get("collection",d),this._getActiveParam("context"));if(typeof e!=="object")throw Error("incorrect data type!");
if(Collection.isArray(e))e.sort(g);else{if(a){a=a===true?"value":"value"+Collection.CHILDREN+a;e=Collection._sortObject(e,a,g)}else e=Collection._sortObjectByKey(e,g);this._setOne("",e,d)}return this};Collection._reverseObject=function(a){var b=[],c={},d;for(d in a)a.hasOwnProperty(d)&&b.push(d);b.reverse();for(d in b)if(b.hasOwnProperty(d))c[b[d]]=a[b[d]];return c};Collection.prototype.reverse=function(a){a=a||"";var b;this.onReverse&&(b=this.onReverse.apply(this,arguments));if(b===false)return this;
b=Collection.byLink(this._get("collection",a),this._getActiveParam("context"));if(typeof b!=="object")throw Error("incorrect data type!");Collection.isArray(b)?b.reverse():this._setOne("",Collection._reverseObject(b),a);return this};Collection.prototype.save=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),d=a===this.ACTIVE?this._exists("collection")?this._getActiveID("collection"):
"":this._active("collection",a)?"active":"",f=b===false?sessionStorage:localStorage,e=null;this.onSave&&(e=this.onSave.apply(this,arguments));if(e===false)return this;f.setItem(c+":"+a,this.toString(a));f.setItem(c+"__date:"+a,(new Date).toString());f.setItem(c+"__active:"+a,d);f.setItem(c+"__date",(new Date).toString());return this};Collection.prototype.saveAll=function(a){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var b,c=this.dObj.sys.tmpCollection,
d=false;for(b in c){this._active("Collection",b)&&(d=true);c.hasOwnProperty(b)&&this.save(b,a)}d===false&&this.save("",a);return this};Collection.prototype.load=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),d=b===false?sessionStorage:localStorage,f=null;this.onLoad&&(f=this.onLoad.apply(this,arguments));if(f===false)return this;a===this.ACTIVE?this._new("collection",JSON.parse(d.getItem(c+
":"+a))):this._push("collection",a,JSON.parse(d.getItem(c+":"+a)));c=d.getItem(c+"__active:"+a);if(c===this.ACTIVE)this._set("collection",a);else c&&this._push("collection",c,this._get("collection"))._set("collection",c);return this};Collection.prototype.loadAll=function(a,b){b=b?"drop":"load";if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var c="__"+this.name+"__"+this._get("namespace"),d=a===false?sessionStorage:localStorage,f=d.length,
e,g;try{for(e in d)if(d.hasOwnProperty(e))if((g=e.split(":"))[0]===c)this[b](g[1],a)}catch(h){for(;(f-=1)>-1;)if((g=d[f].split(":"))[0]===c)this[b](g[1],a)}return this};Collection.prototype.loadDate=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date((b===false?sessionStorage:localStorage).getItem("__"+this.name+"__"+this._get("namespace")+"__date"+(a?":"+a:"")))};Collection.prototype.isExpired=function(a,b,c){if(typeof localStorage===
"undefined")throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(b||"",c||"")))>a};Collection.prototype.drop=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),d=b===false?sessionStorage:localStorage,f=null;this.onDrop&&(f=this.onDrop.apply(this,arguments));if(f===false)return this;d.removeItem(c+":"+a);d.removeItem(c+"__date:"+
a);d.removeItem(c+"__active:"+a);return this};Collection.prototype.dropAll=function(a){(a===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace")+"__date");return this.loadAll(a||"",true)};Collection.prototype._customFilter=function(a,b,c,d,f,e,g,h,i){var j,n=true,k,l,o,q,m;if(!a||a===true){if(!this._getActiveParam("filter"))return true;if(this._get("filter"))return this._customFilter(this._get("filter"),b,c,d,f,e,g,h,i);return true}if(Collection.isFunction(a))if(!this._getActiveParam("filter")||
!i)return a.call(a,b,c,d,f,e,g,h);else{if(!i.name){for(;this._exists("filter","__tmp:"+(i.name=Collection.getRandomInt(0,1E4)));)i.name=Collection.getRandomInt(0,1E4);this._push("filter","__tmp:"+i.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+i.name,b,c,d,f,e,g,h,i)}if(!Collection.isArray(a)){if(this._getActiveParam("filter")&&i)a=this.ACTIVE+" && ("+a+")";if(this._isStringExpression(a=Collection.trim(a))){this._exists("filter","__tmp:"+a)||this._push("filter","__tmp:"+a,this._compileFilter(a));
return(a=this._get("filter","__tmp:"+a)).call(a,b,c,d,f,e,g,h)}a=Collection.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ");for(m=a.length;(m-=1)>-1;)a[m]===""&&a.splice(m,1)}j=function(p,r){for(var s=-1,t=p.length,u=0,v=[];(s+=1)<t;){r+=1;if(p[s]==="("||p[s]==="!(")u+=1;if(p[s]===")")if(u===0)return{result:v,iter:r};else u-=1;v.push(p[s])}};i=a.length;for(m=-1;(m+=1)<i;)if(a[m]==="("||a[m]==="!("){if(a[m].substring(0,1)===
"!"){q=true;a[m]=a[m].substring(1)}else q=false;m=(k=j(a.slice(m+1),m)).iter;k=k.result.join(" ");k=this._customFilter(k,b,c,d,f,e,g,h);n=!l&&!o?q===true?!k:k:l?q===true?!k:k&&n:q===true?!k:k||n}else if(a[m]!==")"&&a[m]!=="||"&&a[m]!=="&&"){if(a[m].substring(0,1)==="!"){q=true;a[m]=a[m].substring(1)}else q=false;k=this._customFilter(this._get("filter",a[m]),b,c,d,f,e,g,h);n=!l&&!o?q===true?!k:k:l?q===true?!k:k&&n:q===true?!k:k||n}else if(a[m]==="||"){l=false;o=true}else if(a[m]==="&&"){o=false;l=
true}return n};Collection.prototype._compileFilter=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('cObj.getVariable("').split(":>").join('")');return new Function("el","key","data","i","length","cObj","id","return "+a.replace(/^\s*:/,"")+";")};Collection.prototype._customParser=function(a,b,c){if(!a||a===true){if(!this._getActiveParam("parser"))return b;if(this._get("parser"))return this._customParser(this._get("parser"),
b,c);return b}if(Collection.isFunction(a))if(!this._getActiveParam("parser")||!c)return a.call(a,b,this);else{if(!c.name){for(;this._exists("parser","__tmp:"+(c.name=Collection.getRandomInt(0,1E4)));)c.name=Collection.getRandomInt(0,1E4);this._push("parser","__tmp:"+c.name,a)}return this._customParser(this.ACTIVE+" && __tmp:"+c.name,b,c)}if(Collection.isString(a)){if(this._getActiveParam("parser")&&c)a=this.ACTIVE+" && "+a;if(this._isStringExpression(a=Collection.trim(a))){this._exists("parser","__tmp:"+
a)||this._push("parser","__tmp:"+a,this._compileParser(a));return(a=this._get("parser","__tmp:"+a)).call(a,b,this)}a=a.split("&&")}a.forEach(function(d){b=this._customParser(Collection.trim(d),b)},this);return b};Collection.prototype._compileParser=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('cObj.getVariable("').split(":>").join('")');return new Function("str","cObj","return "+a.replace(/^\s*:/,"")+";")};Collection.prototype._compileFunc=
function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('cObj.getVariable("').split(":>").join('")');return new Function("el","key","data","i","length","cObj","id",a.replace(/^\s*:/,"")+";")};Collection.prototype.parentContext=function(a,b){for(var c=this._get("context",b||"").split(Collection.CHILDREN),d=a||1;(d-=1)>-1;)c.splice(-1,1);return c.join(Collection.CHILDREN)};Collection.prototype.parent=function(a,b){if(!b)return this._update("context",
this.parentContext(a));return this._push("context",b,this.parentContext(a,b))};Collection.prototype._getActiveParam=function(a){var b=typeof this.dObj.sys.flags.use[a]==="undefined"||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return b?b.toString():"";return b};Collection.prototype._isFilter=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(/&&|\|\||:|!/)!==-1};Collection.prototype._isStringExpression=function(a){return Collection.isString(a)&&
a.search(/^:/)!==-1};Collection.prototype.enable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=true},this);return this};Collection.prototype.disable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=false},this);return this};Collection.prototype.toggle=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]===true?this.disable(arguments[key]):this.enable(arguments[key])},this)};Collection.prototype.toString=
function(a,b,c){if(typeof JSON==="undefined"||!JSON.stringify)throw Error("object JSON is not defined!");b=b||"";c=c||"";if(a&&Collection.isCollection(a))return JSON.stringify(a,b,c);return JSON.stringify(Collection.byLink(this._get("collection",a||""),this._getActiveParam("context")),b,c)};Collection.prototype.valueOf=function(a){if(a==="object")return this;return this.length(this.ACTIVE)};Collection.prototype.print=function(a,b){b=b||false;var c=this,d={},f={},e={},g,h,i,j,n=0,k,l=null,o=false,
q,m="",p,r,s=this.drivers.dom;if(Collection.isExists(a)&&(Collection.isString(a)||Collection.isNumber(a)))a={page:a};else Collection.isExists(a)||(a={page:this._get("page")});Collection.extend(true,e,this.dObj.active,a);if(a)e.page=Collection.expr(e.page,this._get("page"));if(e.page<1)e.page=1;e.collection=Collection.isString(e.collection)?this._get("collection",e.collection):e.collection;e.template=Collection.isString(e.template)?this._get("template",e.template):e.template;e.cache=Collection.isExists(a.cache)?
a.cache:this._getActiveParam("cache");e.target=Collection.isString(e.target)?s.find(e.target):e.target;e.pager=Collection.isString(e.pager)?s.find(e.pager):e.pager;e.filter=this._isStringExpression(e.filter)?this._compileFilter(e.filter):e.filter;e.parser=this._isStringExpression(e.parser)?this._compileParser(e.parser):e.parser;e.callback=e.callback&&this._isStringExpression(e.callback)?this._compileFunc(e.callback):e.callback;if(b===true)e.cache.iteration=false;k=this._get("page")-e.page;this._update("page",
e.page);p=function(t,u){e.callback&&e.callback.apply(e.callback,arguments);m+=e.template.apply(e.template,arguments);n=u;if(o===false)o=u;return true};g=Collection.byLink(e.collection,this._getActiveParam("context")+Collection.CHILDREN+(a&&a.context||""));h=this.length(e.collection);i=function(t,u){if(!i.val)i.val=c.length(t,u);return i.val};q=Boolean(e.breaker&&(e.filter||this._getActiveParam("filter")));e.breaker=e.breaker||h;if(Collection.isPlainObject(g)||!e.cache||e.cache.iteration===false||
e.cache.firstIteration===false||e.cache.lastIteration===false){j=!e.breaker||e.page===1?0:(e.page-1)*e.breaker;this.forEach(p,e.filter,this.ACTIVE,true,e.breaker,j);if(e.cache&&e.cache.iteration===false)e.cache.lastIteration=false}else if(Collection.isArray(g)&&e.cache.iteration===true){j=!q?e.page===1?0:(e.page-1)*e.breaker:k>=0?e.cache.firstIteration:e.cache.lastIteration;if(q)if(k>0){for(k*=e.breaker;(j-=1)>-1;)if(this._customFilter(e.filter,g[j],g,j,i,this,this.ACTIVE,f)===true)if(n===k)break;
else n+=1;e.cache.lastIteration=j+=1;l=null}else if(k<0)l=-k*e.breaker-e.breaker;f.name&&this._drop("filter","__tmp:"+f.name);this.forEach(p,e.filter,this.ACTIVE,true,e.breaker,l,j)}if(e.cache){if(k!==0&&e.cache.iteration!==false){this._get("cache").firstIteration=o;this._get("cache").lastIteration=n+1}if(e.cache.autoIteration===true)this._get("cache").iteration=true}i=null;m=!m?e.resultNull:this._customParser(e.parser,m,d);d.name&&this._drop("parser","__tmp:"+d.name);if(e.target===false){e.variable?
this._push("variable",e.variable,m):this._new("variable",m);return this}else Array.prototype.forEach.call(e.target,function(t){if(e.toHTML==="replace")t.innerHTML=m;else if(e.toHTML==="append")t.innerHTML+=m;else t.innerHTML=m+t.innerHTML},this);if(!e.pager)return this;e.nmbOfEntries=e.filter!==false?this.length(e.filter,e.collection):h;e.nmbOfEntriesInPage=e.calculator?s.find(e.calculator,e.target[0]).length:s.children(e.target[0]).length;e.finNumber=e.breaker*e.page-(e.breaker-e.nmbOfEntriesInPage);
if(e.page!==1&&e.nmbOfEntriesInPage===0){this.onIPage&&(r=this.onIPage.apply(this,arguments));if(r===false)return this;this._update("page",e.page-=1).print(e,true,true)}else this.easyPage(e);return this};Collection.prototype.easyPage=function(a){var b=this,c="",d=a.nmbOfPages||(a.nmbOfEntries%a.breaker!==0?~~(a.nmbOfEntries/a.breaker)+1:a.nmbOfEntries/a.breaker),f=function(k,l,o,q){q=q||false;var m,p="<"+(k.tag||"span")+" "+(!q?'data-page="':'data-number-break="')+o+'"';if(k.attr)for(m in k.attr)if(k.attr.hasOwnProperty(m))p+=
" "+m+'="'+k.attr[m]+'"';if(!q&&o===a.page||q&&o===a.breaker)p+=' class="'+(l&&l.active||"active")+'"';return p+(">"+o+"</"+(k.tag||"span")+">")},e=function(k,l){if(l==="select")return'<option value="'+k+'">'+k+"</option>";return k},g,h=0,i,j,n=this.drivers.dom;Array.prototype.forEach.call(a.pager,function(k){Array.prototype.forEach.call(n.find(".ctm",k),function(l){if(a.navBreaker<=2)throw Error('parameter "navBreaker" must be more than 2');c="";var o=l.tagName.toLowerCase(),q=n.data(l),m=q.ctm,
p=m.classes;if(m.nav){if(["first","prev","next","last"].indexOf(m.nav)!==-1&&!q["ctm-delegated"]){n.bind(l,"click",function(){if(!n.hasClass(this,m.classes&&m.classes.disabled||"disabled")){m.nav==="first"&&(a.page=1);m.nav==="prev"&&(a.page="-=1");m.nav==="next"&&(a.page="+=1");m.nav==="last"&&(a.page=d);b.print(a)}});l.setAttribute("data-ctm-delegated",true)}if(["first","prev"].indexOf(m.nav)!==-1&&a.page===1||["next","last"].indexOf(m.nav)!==-1&&a.finNumber===a.nmbOfEntries)n.addClass(l,p&&p.disabled||
"disabled");else if(["first","prev","next","last"].indexOf(m.nav)!==-1)n.removeClass(l,p&&p.disabled||"disabled");m.nav==="numberSwitch"&&m.val.forEach(function(r){c+=o==="select"?'<option vale="'+r+'" '+(r===a.breaker?'selected="selected"':"")+">"+r+"</option>":f(m,p||"",r,true)});if(m.nav==="pageList")if(o==="select")for(g=0;(g+=1)<=d;)c+='<option vale="'+g+'" '+(g===a.page?'selected="selected"':"")+">"+g+"</option>";else if(d>a.navBreaker){h=a.navBreaker%2!==0?1:0;j=i=(a.navBreaker-h)/2;if(a.page-
h<i)i=0;else{i=a.page-i-h;if(a.page+j>d)i-=a.page+j-d}g=i;for(h=-1;(g+=1)<=d&&(h+=1)!==null;){if(h===a.navBreaker&&g!==a.page)break;c+=f(m,p||"",g)}}else for(g=0;(g+=1)<=d;)c+=f(m,p||"",g);if(m.nav==="numberSwitch"||m.nav==="pageList"){l.innerHTML=c;if(!q["ctm-delegated"]){o!=="select"?n.bind(l,"click",function(r){r=r||window.event;r=r.target||r.srcElement;var s=n.data(r);if(r.parentNode!==l)return false;if(m.nav==="pageList")a.page=+s.page;else{b._push("breaker",a.name||"",+s["number-break"]);delete a.breaker}b.print(a)}):
n.bind(l,"change",function(){var r=n.children(this,"selected")[0];if(a.page!==r.value){if(q.nav==="pageList")a.page=+r.value;else{b._push("breaker",a.name||"",+r.value);delete a.breaker}b.print(a)}});l.setAttribute("data-ctm-delegated",true)}}}else if(m.info){a.nmbOfEntriesInPage===0?n.addClass(l,p&&p.noData||"no-data"):n.removeClass(l,p&&p.noData||"no-data");switch(m.info){case "page":if(o==="input")l.value=e(a.page,o);else l.innerHTML=e(a.page,o);break;case "total":if(o==="input")l.value=e(a.nmbOfEntries,
o);else l.innerHTML=e(a.nmbOfEntries,o);break;case "from":if(o==="input")l.value=e((a.page-1)*a.breaker+1,o);else l.innerHTML=e((a.page-1)*a.breaker+1,o);break;case "to":if(o==="input")l.value=e(a.finNumber,o);else l.innerHTML=e(a.finNumber,o);break;case "inPage":if(o==="input")l.value=e(a.nmbOfEntriesInPage,o);else l.innerHTML=e(a.nmbOfEntriesInPage,o);break;case "nmbOfPages":if(o==="input")l.value=e(d,o);else l.innerHTML=e(d,o)}}})});return this};Collection.prototype.genTable=function(a,b,c,d){if(Collection.isNumber(a)){d=
c;c=b;b=a;a=""}b=b||4;c=c||"div";d=d===false?false:true;var f,e,g,h,i=this.drivers.dom;a=a?Collection.isString(a)?i.find(a):a:this._get("target");Array.prototype.forEach.call(a,function(j){e=document.createElement("table");f=0;Array.prototype.forEach.call(i.find(c,j),function(n){if(f===0){g=document.createElement("tr");e.appendChild(g)}h=document.createElement("td");h.appendChild(n);g.appendChild(h);f+=1;if(f===b)f=0});if(d===true)for(f=b-g.childNodes.length;(f-=1)>-1;)g.appendChild(document.createElement("td"));
j.appendChild(e)},this);return this};return Collection})();if(typeof $C==="undefined")var $C=Collection;
//