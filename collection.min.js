/**
 * Collection v3.6 | http://collection-js.com
 * 
 * Copyright 2012, Andrey Kobets (Kobezzza | kobezzza@gmail.com | http://kobezzza.com)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
 var Collection=function(){var d;d=function(a,b){a=a||null;b=b||"";if(!this||!this.name||this.name!=="Collection")return new d(a,b);d.extend(true,this,d.fields);var c=this.dObj.active;b&&d.extend(true,c,b);if(this._exprTest(c.filter))c.filter=this._compileFilter(c.filter);if(this._exprTest(c.parser))c.parser=this._compileParser(c.parser);if(d.isString(c.target))c.target=this.drivers.dom.find(c.target);if(d.isString(c.pager))c.pager=this.drivers.dom.find(c.pager);c.collection=a};d.byLink=function(a,
b,c,e){b=b.toString().replace(RegExp("\\s*"+d.CHILDREN+"\\s*","g"),d.CONTEXT_SEPARATOR+d.CHILDREN+d.CONTEXT_SEPARATOR).split(d.CONTEXT_SEPARATOR);e=e||false;for(var f=d.CHILDREN,g=0,h=0,j,i=b.length,k,l;(i-=1)>-1;){b[i]=d.trim(b[i]);if(b[i]===""){b.splice(i,1);g-=1}else if(b[i]!==d.CHILDREN){if(i>g)g=i;h+=1}}l=b.length;if(a===false)return b.join("");else if(d.isNumber(a)){if((a=+a)<0)a+=h;if(typeof c==="undefined"){i=-1;for(k=0;(i+=1)<l;)if(b[i]!==d.CHILDREN)if((k+=1)===a){b.splice(i+1,l);return b.join("")}}else{i=
l;for(k=0;(i-=1)>-1;)if(b[i]!==d.CHILDREN)if((k+=1)===a){b.splice(0,i);return b.join("")}}}for(i=-1;(i+=1)<l;)switch(b[i]){case d.CHILDREN:f=b[i];break;default:if(f===d.CHILDREN&&b[i].substring(0,d.ORDER[0].length)!==d.ORDER[0])if(i===g&&typeof c!=="undefined")if(e===false)a[b[i]]=d.expr(c,a[b[i]]);else if(d.isArray(a))a.splice(b[i],1);else delete a[b[i]];else a=a[b[i]];else{h=b[i].substring(d.ORDER[0].length);h=h.substring(0,h.length-1);h=+h;if(d.isArray(a))if(i===g&&typeof c!=="undefined")if(h>=
0)if(e===false)a[h]=d.expr(c,a[h]);else a.splice(h,1);else if(e===false)a[a.length+h]=d.expr(c,a[a.length+h]);else a.splice(a.length+h,1);else a=h>=0?a[h]:a[a.length+h];else{if(h<0){k=0;for(j in a)if(a.hasOwnProperty(j))k+=1;h+=k}k=0;for(j in a)if(a.hasOwnProperty(j)){if(h===k){if(i===g&&typeof c!=="undefined")if(e===false)a[j]=d.expr(c,a[j]);else delete a[j];else a=a[j];break}k+=1}}}}if(typeof c!=="undefined")return d;return a};d.execEvent=function(a,b,c,e){a=a.split(d.QUERY_SEPARATOR);c=d.isExists(c)?
c:[];c=d.isArray(c)?c:[c];for(var f=-1,g=a.length-1;(f+=1)<g;)b=b[a[f]];e=e||b;if(a[f].search(d.SUBQUERY_SEPARATOR)!==-1){a=a[f].split(d.SUBQUERY_SEPARATOR);b=b[a[0]];a.splice(0,1);c=c.concat(a);return b.apply(e,c)}else return b[a[f]].apply(e,c)};d.CONTEXT_SEPARATOR="__context__";d.QUERY_SEPARATOR="/";d.SUBQUERY_SEPARATOR="{";d.METHOD_SEPARATOR="->";d.CHILDREN=">";d.ORDER=["eq(",")"];d.toString=function(a){if(typeof a==="undefined")return d.prototype.collection();return Object.prototype.toString.call(a)};
d.isString=function(a){return d.toString(a)==="[object String]"};d.isNumber=function(a){return d.toString(a)==="[object Number]"};d.isBoolean=function(a){return d.toString(a)==="[object Boolean]"};d.isFunction=function(a){return d.toString(a)==="[object Function]"};d.isArray=function(a){return d.toString(a)==="[object Array]"};d.isPlainObject=function(a){return d.toString(a)==="[object Object]"};d.isCollection=function(a){return d.isArray(a)||d.isPlainObject(a)};d.isExists=function(a){return typeof a!==
"undefined"&&a!==null&&a!==""};d.trim=function(a){a=a.replace(/^\s\s*/,"");for(var b=/\s/,c=a.length;b.test(a.charAt(c-=1)););return a.substring(0,c+1)};d.toUpperCase=function(a,b,c){c=c||0;b=d.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toUpperCase()+a.substring(b)};d.toLowerCase=function(a,b,c){c=c||0;b=d.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toLowerCase()+a.substring(b)};d.expr=function(a,b){b=d.isExists(b)?b:"";if(d.isString(a)&&a.search(/^[+-\\*\/]{1}=/)!==
-1){a=a.split("=");isNaN(a[1])||(a[1]=+a[1]);switch(a[0]){case "+":a=b+a[1];break;case "-":a=b-a[1];break;case "*":a=b*a[1];break;case "/":a=b/a[1]}}return a};d.getRandomInt=function(a,b){a=a||0;return Math.floor(Math.random()*((b||10)-a+1))+a};d.find=function(a,b){var c,e;if(d.isArray(b)){b.some(function(f){if(a===f)return e=true});if(e)return e}else for(c in b)if(b.hasOwnProperty(c))if(a===b[c])return c;return false};d.extend=function(){var a,b,c,e,f,g=arguments[0]||{},h=0,j=arguments.length,i=
false;if(d.isBoolean(g)){i=g;g=arguments[1]||{};h=1}if(typeof g!=="object"&&!d.isFunction(g))g={};if(j===h){g=d;h-=1}for(;(h+=1)<j;)if(d.isExists(a=arguments[h]))for(b in a){c=g[b];e=a[b];if(g!==e)if(i&&e&&(d.isPlainObject(e)||(f=d.isArray(e)))){if(f){f=false;c=c&&d.isArray(c)?c:[]}else c=c&&d.isPlainObject(c)?c:{};g[b]=d.extend(i,c,e)}else if(typeof e!=="undefined")g[b]=e}return g};d.addElementToObject=function(a,b,c){b=b.split(d.METHOD_SEPARATOR);var e,f={};if(b[1]&&b[1]==="unshift"){f[!isNaN(Number(b[0]))?
0:b[0]]=c;for(e in a)if(a.hasOwnProperty(e))f[!isNaN(Number(e))?+e+1:e]=a[e];return f}else if(!b[1]||b[1]==="push")a[b[0]]=c;return true};d.unshiftArguments=function(a,b){for(var c=[b],e=-1,f=a.length;(e+=1)<f;)c.push(a[e]);return c};if(!Array.prototype.forEach)Array.prototype.forEach=function(a,b){for(var c=-1,e=this.length;(c+=1)<e;)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=-1,e=this.length,f;(c+=1)<e;){f=b?a.call(b,this[c],
c,this):a(this[c],c,this);if(f===true)break}};d.prototype={name:"Collection",version:"3.6",collection:function(){return this.name+" "+this.version},ACTIVE:"active",SHUFFLE:"shuffle",NAMESPACE_SEPARATOR:".",stack:["namespace","collection","filter","context","cache","variable","defer","page","parser","appendType","target","calculator","pager","template","numberBreak","pageBreak","resultNull"]};d.prototype.drivers=d.drivers={};d.drivers.dom={find:function(a,b){if(!this.lib)throw Error("DOM driver is not defined!");
return this.engines[this.lib].find(a||"",b||"")},children:function(a,b){var c=[];Array.prototype.forEach.call(a.childNodes,function(e){if(e.nodeType===1)if(b)e[b]&&c.push(e);else c.push(e)});return c},data:function(a,b){var c=a.attributes,e={};c&&c.length>0&&Array.prototype.forEach.call(c,function(f){if(f.name.substring(0,5)==="data-")e[f.name.replace("data-","")]=d.isString(f.value)&&f.value.search(/^\{|\[/)!==-1?JSON.parse(f.value):f.value});if(b)return e[b];return e},text:function(a){a=a.childNodes;
var b="";Array.prototype.forEach.call(a,function(c){if(c.nodeType===3&&d.trim(c.textContent))b+=c.textContent});if(b)return b;return false},bind:function(a,b,c){if(this.engines[this.lib][b]){this.engines[this.lib][b](a,c);return this}document.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c);return this},addClass:function(a,b){if(a.className.search(b)===-1)a.className+=" "+b;return this},hasClass:function(a,b){return a.className.search(b)===-1?false:true},removeClass:function(a,b){a.className=
a.className.replace(b,"");return this},engines:{qsa:{is:function(){if(typeof qsa!=="undefined")return true},find:function(a,b){return qsa.querySelectorAll(a,b)}},sizzle:{is:function(){if(typeof Sizzle!=="undefined")return true},find:function(a,b){return Sizzle(a,b)}},jQuery:{is:function(){if(typeof jQuery!=="undefined")return true},find:function(a,b){return jQuery(a,b)},click:function(a,b){$(a).click(b)},change:function(a,b){$(a).change(b)}},dojo:{is:function(){if(typeof dojo!=="undefined")return true},
find:function(a,b){return b?dojo.query(a,b):dojo.query(a)},click:function(a,b){dojo.connect(a,"onclick",b)}},mootools:{is:function(){if(typeof MooTools!=="undefined")return true},find:function(a,b){var c;if(b){c=[];$$(b).getElements(a).forEach(function(e){e.forEach(function(f){c.push(f)})})}else c=$$(a);return c}},prototype:{is:function(){if(typeof Prototype!=="undefined")return true},find:function(a,b){return b?b.getElementsBySelector(a):$$(a)}}}};(function(){var a,b=d.drivers.dom.engines;for(a in b)if(b.hasOwnProperty(a))if(b[a].is()){d.drivers.dom.lib=
a;return true}})();d._inObj=function(a){var b=[],c=d.fromNodes.stat,e=d.drivers.dom;Array.prototype.forEach.call(a,function(f){if(f.nodeType===1){var g=e.data(f),h=f.hasAttribute("class")?f.getAttribute("class").split(" "):"",j=e.text(f),i,k=b.length;b.push({});for(i in g)if(g.hasOwnProperty(i))b[k][i]=g[i];if(h){b[k][c.classes]={};h.forEach(function(l){b[k][c.classes][l]=l})}if(f.childNodes.length!==0)b[k][c.childNodes]=d._inObj(f.childNodes);if(j!==false)b[k][c.val]=j.replace(/[\r\t\n]/g," ")}});
return b};d.fromNodes=function(a,b){if(typeof JSON==="undefined"||!JSON.parse)throw Error("object JSON is not defined!");var c=d._inObj(d.drivers.dom.find(a));if(b)return new d(c,b);return new d(c)};if(!d.fromNodes.stat)d.fromNodes.stat={val:"val",childNodes:"childNodes",classes:"classes"};d.ctplCompile=function(a){d.isString(a)&&(a=d.drivers.dom.find(a));if(a.length===0)throw Error("DOM element does't exist!");var b='var key = i, result = ""; ';(a[0]?a[0][0]?a[0][0].innerHTML:a[0].innerHTML:a.innerHTML).replace(/\/\*.*?\*\//g,
"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(c,e){b+=e===0||e%2===0?'result +="'+c+'";':c.split("echo").join("result +=")});return new Function("el","i","data","cOLength","cObj","id",b+" return result;")};d.prototype.ctplMake=function(a){var b=d.drivers.dom;d.isString(a)&&(a=b.find(a));Array.prototype.forEach.call(a,function(c){var e=b.data(c,"ctpl"),f,g=e.prefix?e.prefix+"_":"";this._push("template",g+e.name,d.ctplCompile(c));e.set&&e.set===true&&this._set("template",
g+e.name);for(f in e)if(e.hasOwnProperty(f))if(!d.find(f,["prefix","set","print","name","collection"])){if(d.find(f,["target","pager"]))e[f]=b.find(e[f]);this._push(f,g+e.name,e[f]);e.set&&e.set===true&&this._set(f,g+e.name);if(d.find(f,["filter","parser"]))e[f]=g+e.name}if(e.print&&e.print===true){e.template=e.name;if(!e.target){this._push("target",g+e.name,[c.parentNode]);e.set&&e.set===true&&this._set("target",g+e.name)}this.print(e)}},this);return this};d.fields={dObj:{active:{namespace:"nm",
collection:null,filter:false,context:"",cache:{autoIteration:true,iteration:true,firstIteration:false,lastIteration:false},variable:null,defer:"",page:1,parser:false,appendType:"html",target:null,calculator:null,pager:null,template:null,numberBreak:null,pageBreak:5,resultNull:""}}};d.fields.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};(function(a){var b,c=d.fields.dObj.sys;a.forEach(function(e){b=d.toUpperCase(e,1);c["active"+b+"ID"]=null;c["tmp"+b]={};c[e+"ChangeControl"]=
null;c[e+"Back"]=[]})})(d.prototype.stack);d.prototype._new=function(a,b){var c=this.dObj.active,e=d.toUpperCase(a,1),f;this["onNew"+e]&&(f=this["onNew"+e](b));if(f===false)return this;c[a]=d.find(a,["filter","parser"])&&this._exprTest(b)?this["_compile"+d.toUpperCase(a,1)](b):d.find(a,["target","pager"])&&d.isString(b)?this.drivers.dom.find.apply(this.drivers.dom,d.isArray(b)?b:[b]):d.expr(b,c[a]||"");this.dObj.sys["active"+e+"ID"]=null;return this};d.prototype._update=function(a,b){var c=this.dObj.active,
e=d.toUpperCase(a,1),f,g=this._getActiveID(a);this["onUpdate"+e]&&(f=this["onUpdate"+e](b));if(f===false)return this;c[a]=d.find(a,["filter","parser"])&&this._exprTest(b)?this["_compile"+e](b):d.find(a,["target","pager"])&&d.isString(b)?this.drivers.dom.find.apply(this.drivers.dom,d.isArray(b)?b:[b]):d.expr(b,c[a]||"");if(g)this.dObj.sys["tmp"+e][g]=c[a];return this};d.prototype._get=function(a,b){if(b&&b!==this.ACTIVE){if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");
return this.dObj.sys["tmp"+d.toUpperCase(a,1)][b]}return this.dObj.active[a]};d.prototype._push=function(a,b,c){var e=d.toUpperCase(a,1),f,g=this.dObj.sys["tmp"+e],h=this._getActiveID(a),j;this["onPush"+e]&&(f=this["onPush"+e](b,c||""));if(f===false)return this;if(d.isPlainObject(b))for(j in b){if(b.hasOwnProperty(j))if(j===this.ACTIVE)this._update(a,b[j]);else if(g[j]&&h&&h===j)this._update(a,b[j]);else g[j]=d.find(a,["filter","parser"])&&this._exprTest(b[j])?this["_compile"+e](b[j]):d.find(a,["target",
"pager"])&&d.isString(b[j])?this.drivers.dom.find.apply(this.drivers.dom,d.isArray(b[j])?b[j]:[b[j]]):b[j]}else if(b===this.ACTIVE)this._update(a,c);else if(g[b]&&h&&h===b)this._update(a,c);else g[b]=d.find(a,["filter","parser"])&&this._exprTest(c)?this["_compile"+e](c):d.find(a,["target","pager"])&&d.isString(c)?this.drivers.dom.find.apply(this.drivers.dom,d.isArray(c)?c:[c]):c;return this};d.prototype._set=function(a,b){var c=this.dObj.sys,e=d.toUpperCase(a,1),f,g=a+"ChangeControl",h="active"+e+
"ID";if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");this["onSet"+e]&&(f=this["onSet"+e](b));if(f===false)return this;if(c[h]!==b){c[g]=true;c[h]=b}else c[g]=false;c[a+"Back"].push(b);this.dObj.active[a]=c["tmp"+e][b];return this};d.prototype._back=function(a,b){b=b||1;var c=this.dObj.sys,e=d.toUpperCase(a,1),f,g=c[a+"Back"],h=g.length-b-1;this["onBack"+e]&&(f=this["onBack"+e](b));if(f===false)return this;if(h>=0&&g[h])if(c["tmp"+e][g[h]]){this._set(a,
g[h]);c[a+"ChangeControl"]=false;g.splice(h+1,g.length)}return this};d.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};d.prototype._drop=function(a,b,c,e){c=typeof c==="undefined"?false:c;var f=this.dObj.active,g=this.dObj.sys,h=d.toUpperCase(a,1),j,i="active"+h+"ID",k="tmp"+h,l=this._getActiveID(a),n=!b?l?[l]:[]:d.isArray(b)||d.isPlainObject(b)?b:[b],m;if(typeof e==="undefined")this["onDrop"+h]&&(j=this["onDrop"+h](b,c));
else this["onReset"+h]&&(j=this["onReset"+h](b,e));if(j===false)return this;if(n[0]&&n[0]!==this.ACTIVE)for(m in n){if(n.hasOwnProperty(m))if(!n[m]||n[m]===this.ACTIVE)if(typeof e==="undefined"){l&&delete g[k][l];g[i]=null;f[a]=c}else{if(l)g[k][l]=e;f[a]=e}else if(typeof e==="undefined"){delete g[k][n[m]];if(l&&n[m]===l){g[i]=null;f[a]=c}}else{g[k][n[m]]=e;if(l&&n[m]===l)f[a]=e}}else if(typeof e==="undefined"){l&&delete g[k][l];g[i]=null;f[a]=c}else{if(l)g[k][l]=e;f[a]=e}return this};d.prototype._reset=
function(a,b,c){return this._drop(a,b||"","",typeof c==="undefined"?false:c)};d.prototype._resetTo=function(a,b,c){c=!c||c===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+d.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};d.prototype._exists=function(a,b){var c=d.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&this._getActiveID(a))return true;if(typeof this.dObj.sys["tmp"+c][b]!=="undefined")return true;return false};d.prototype._getActiveID=function(a){return this.dObj.sys["active"+d.toUpperCase(a,
1)+"ID"]};d.prototype._active=function(a,b){if(!b)return this._getActiveID(a);if(b===this._getActiveID(a))return true;return false};d.prototype.use=function(a){this.stack.forEach(function(b){var c,e,f;if(this._exists(b,a))this._set(b,a);else{c=a.split(this.NAMESPACE_SEPARATOR);for(f=c.length;(f-=1)>-1;){c.splice(f,1);e=c.join(this.NAMESPACE_SEPARATOR);if(this._exists(b,e)){this._set(b,e);break}}}},this);return this};(function(a){var b=d.prototype,c;a.forEach(function(e){c=d.toUpperCase(e,1);b["new"+
c]=function(f){return function(g){return this._new(f,g)}}(e);b["update"+c]=function(f){return function(g){return this._update(f,g)}}(e);b["reset"+c+"To"]=function(f){return function(g,h){return this._resetTo(f,g,h)}}(e);b["push"+c]=function(f){return function(){return this._push.apply(this,d.unshiftArguments(arguments,f))}}(e);b["set"+c]=function(f){return function(g){return this._set(f,g)}}(e);b["pushSet"+c]=function(f){return function(g,h){return this._push(f,g,h)._set(f,g)}}(e);b["back"+c]=function(f){return function(g){return this._back(f,
g||"")}}(e);b["back"+c+"If"]=function(f){return function(g){return this._backIf(f,g||"")}}(e);b["drop"+c]=e==="filter"||e==="parser"?function(f){return function(){return this._drop(f,arguments)}}(e):function(f){return function(){return this._drop(f,arguments,null)}}(e);if(e==="filter"||e==="parser")b["reset"+c]=function(f){return function(){return this._reset(f,arguments)}}(e);else if(e==="page")b["reset"+c]=function(f){return function(){return this._reset(f,arguments,1)}}(e);else if(e==="context")b["reset"+
c]=function(f){return function(){return this._reset(f,arguments,"")}}(e);b["active"+c]=function(f){return function(g){return this._active(f,g)}}(e);b["exists"+c]=function(f){return function(g){return this._exists(f,g||"")}}(e);b["get"+c+"ActiveID"]=function(f){return function(){return this._getActiveID(f)}}(e);b["get"+c]=function(f){return function(g){return this._get(f,g||"")}}(e)})})(d.prototype.stack);d.prototype._setOne=function(a,b,c){a=d.isExists(a)?a.toString():"";b=typeof b==="undefined"?
"":b;c=c||"";var e=this._getActiveParam("context"),f;this.onSet&&(f=this.onSet.apply(this,arguments));if(f===false)return this;if(!a&&!e)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);d.byLink(this._get("collection",c),e+d.CHILDREN+a,b);return this};d.prototype._getOne=function(a,b){a=d.isExists(a)?a.toString():"";return d.byLink(this._get("collection",b||""),this._getActiveParam("context")+d.CHILDREN+a)};d.prototype.add=function(a,b,c,e,f){a=typeof a!=="undefined"?
a:"";b=b||"push";c=c||"";f=f||false;var g,h,j;this.onAdd&&(g=this.onAdd.apply(this,arguments));if(g===false)return this;g=d.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof g!=="object")throw Error("unable to set property!");if(e){a=d.isExists(a)?a.toString():"";h=d.byLink(this._get("collection",e||""),a);if(d.isPlainObject(g)){b=b==="push"?this.length(g):b==="unshift"?this.length(g)+d.METHOD_SEPARATOR+"unshift":b;j=d.addElementToObject(g,b.toString(),h)}else{j=true;g[b](h)}f===
true&&this.disable("context")._removeOne(a,e).enable("context")}else if(d.isPlainObject(g)){b=b==="push"?this.length(g):b==="unshift"?this.length(g)+d.METHOD_SEPARATOR+"unshift":b;j=d.addElementToObject(g,b.toString(),a)}else{j=true;g[b](a)}j!==true&&this._setOne("",j,c);return this};d.prototype.push=function(a,b){return this.add(a,"",b||"")};d.prototype.unshift=function(a,b){return this.add(a,"unshift",b||"")};d.prototype._removeOne=function(a,b){a=d.isExists(a)?a.toString():"";var c=this._getActiveParam("context"),
e;this.onRemove&&(e=this.onRemove.apply(this,arguments));if(e===false)return this;!a&&!c?this._setOne("",null):d.byLink(this._get("collection",b||""),c+d.CHILDREN+a,"",true);return this};d.prototype._remove=function(a,b){b=b||"";var c,e;if(d.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(d.isArray(a[c]))for(e=a[c].length;(e-=1)>-1;)this._removeOne(a[c][e],c);else this._removeOne(a[c],c)}else if(d.isArray(a))for(e=a.length;(e-=1)>-1;)this._removeOne(a[e],b);else this._removeOne(a,b);return this};
d.prototype.pop=function(a){return this._removeOne("eq(-1)",a||"")};d.prototype.shift=function(a){return this._removeOne("eq(0)",a||"")};d.prototype.concat=function(a,b,c){b=d.isExists(b)?b.toString():"";c=c||"";var e;this.onConcat&&(e=this.onConcat.apply(this,arguments));if(e===false)return this;e=d.byLink(this._get("collection",c),this._getActiveParam("context")+d.CHILDREN+b);if(typeof e!=="object")throw Error("incorrect data type!");if(d.isPlainObject(e))d.extend(true,e,a);else if(d.isArray(e))if(d.isArray(a)){e=
Array.prototype.concat(e,a);this._setOne(b,e,c)}else this.add(a,"push",c);return this};d.prototype.length=function(a,b){a=a||"";var c={},e,f,g,h;if(!d.isFunction(a))if(d.isString(a)&&!this._filterTest(a)&&!d.isExists(b)||d.isCollection(a)){b=a;a=false}if(b)if(d.isString(b))e=this._get("collection",b);else{f=true;e=b}else e=this._get("collection");if(e===null)return 0;if(f!==true)e=d.byLink(e,this._getActiveParam("context"));if(d.isString(e))return e.length;if(typeof e!=="object")throw Error("incorrect data type!");
if(a===false&&typeof e.length!=="undefined")h=e.length;else{h=0;if(typeof e.length!=="undefined")e.forEach(function(j,i){if(this._customFilter(a,j,i,e,h||null,this,b?b:this.ACTIVE,c)===true)h+=1},this);else for(g in e)if(e.hasOwnProperty(g))if(this._customFilter(a,e[g],g,e,h||null,this,b?b:this.ACTIVE,c)===true)h+=1}c.name&&this._drop("filter","__tmp:"+c.name);return h};d.prototype.forEach=function(a,b,c,e,f,g,h){b=b||"";if(d.isBoolean(c)){h=g;g=f;f=e;e=c;c=this.ACTIVE}else c=c||"";e=e===false?false:
true;f=parseInt(f)>=0?parseInt(f):false;g=parseInt(g)||false;h=parseInt(h)||false;var j=this,i={},k,l,n,m=0,o=false;k=d.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof k!=="object")throw Error("incorrect data type!");l=function(){if(!l.val)l.val=j.length(b,c);return l.val};if(d.isArray(k)){n=h!==false?k.slice(h):k;n.some(function(s,p){p+=h;if(f!==false&&m===f)return true;if(this._customFilter(b,s,p,k,l,this,c,i)===true)if(g!==false&&g!==0)g-=1;else{o=a.call(a,s,p,k,l,this,
c)===false;if(e===false)o=true;m+=1}if(o===true)return true},this)}else for(n in k)if(k.hasOwnProperty(n)){if(f!==false&&m===f)break;if(h!==false&&h!==0)h-=1;else{if(this._customFilter(b,k[n],n,k,l,this,c,i)===true)if(g!==false&&g!==0)g-=1;else{o=a.call(a,k[n],n,k,l,this,c)===false;if(e===false)o=true;m+=1}if(o===true)break}}i.name&&this._drop("filter","__tmp:"+i.name);l=null;return this};d.prototype.some=function(a,b,c){return this.forEach(a,b||"",c||"",false)};d.prototype.search=function(a,b,c,
e,f,g){if(d.isBoolean(b)){g=f;f=e;e=c;c=b;b=this.ACTIVE}else b=b||"";c=c===false?false:true;e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||false;g=parseInt(g)||false;var h=c===true?[]:-1;this.forEach(function(j,i){if(c===true)h.push(i);else h=i;return true},a||"",b,c,e,f,g);return h};d.prototype.searchOne=function(a,b){return this.search(a||"",b||"",false)};d.prototype.indexOf=function(a,b,c){c=c||"";b=b||"";var e=d.byLink(this._get("collection",c),this._getActiveParam("context"));if(d.isArray(e)&&
e.indexOf){if(b)return e.indexOf(a,b);return e.indexOf(a)}else return this.search(function(f){return f===a},c,false,"","",b)};d.prototype.lastIndexOf=function(a,b,c){c=c||"";b=b||"";var e=d.byLink(this._get("collection",c),this._getActiveParam("context"));if(d.isArray(e)&&e.lastIndexOf){if(b)return e.lastIndexOf(a,b);return e.lastIndexOf(a)}else{b=this.search(function(f){return f===a},c,"","","",b);return typeof b[b.length-1]!=="undefined"?b[b.length-1]:-1}};d.prototype.get=function(a,b,c,e,f,g){if(d.isNumber(a)||
arguments.length<2&&d.isString(a)&&!this._filterTest(a)||arguments.length===0||arguments.length<2&&a===false)return this._getOne(a,b||"");if(d.isBoolean(b)){g=f;f=e;e=c;c=b;b=this.ACTIVE}else b=b||"";c=c===false?false:true;e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||false;g=parseInt(g)||false;var h=c===true?[]:-1;this.forEach(function(j,i,k){if(c===true)h.push(k[i]);else h=k[i];return true},a||"",b,c,e,f,g);return h};d.prototype.getOne=function(a,b){return this.get(a||"",b||"",false)};d.prototype.set=
function(a,b,c){if(d.isNumber(a)||arguments.length<3&&d.isString(a)&&!this._filterTest(a)||arguments.length===0||arguments.length<3&&a===false)return this._setOne(a,b,c||"");var e,f,g=d.isFunction(b);f=d.unshiftArguments(arguments,function(h,j,i,k,l,n){i[j]=g?b.call(b,h,j,i,k,l,n):d.expr(b,i[j]);return true});f.splice(2,1);this.onSet&&(e=this.onSet.apply(this,arguments));if(e===false)return this;return this.forEach.apply(this,f)};d.prototype.setOne=function(a,b,c){return this.set(a||"",b,c||"",false)};
d.prototype.map=function(a,b,c){return this.set(b||"",a,c||"")};d.prototype.move=function(a,b,c,e,f,g,h,j,i,k){a=a||"";k=k===false?false:true;b=d.isExists(b)?b.toString():"";c=c||"";e=e||"";f=f||"push";g=g===false?false:true;h=parseInt(h)>=0?parseInt(h):false;j=parseInt(j)||false;i=parseInt(i)||false;var l=[],n=d.isArray(d.byLink(this._get("collection",e),this._getActiveParam("context"))),m;m=null;k&&this.onMove&&(m=this.onMove.apply(this,arguments));!k&&this.onCopy&&(m=this.onCopy.apply(this,arguments));
if(m===false)return this;this.disable("context");m=d.isNumber(a)||d.isString(a)&&!this._filterTest(a)?a:this.search(a,c,g,h,j,i);this.enable("context");if(g===true&&d.isArray(m))m.forEach(function(o){this.add(b+d.CHILDREN+o,n===true?f:o+d.METHOD_SEPARATOR+f,e,c);k===true&&l.push(o)},this);else{this.add(b+d.CHILDREN+m,n===true?f:m+d.METHOD_SEPARATOR+f,e,c);k===true&&l.push(m)}k===true&&this.disable("context")._remove(l,c).enable("context");return this};d.prototype.moveOne=function(a,b,c,e,f){return this.move(a||
"",d.isExists(b)?b.toString():"",c||"",e||"",f||"",false)};d.prototype.copy=function(a,b,c,e,f,g,h,j,i){g=g===false?false:true;h=parseInt(h)>=0?parseInt(h):false;j=parseInt(j)||false;i=parseInt(i)||false;return this.move(a||"",d.isExists(b)?b.toString():"",c||"",e||"",f||"push",g,h,j,i,false)};d.prototype.copyOne=function(a,b,c,e,f){return this.move(a||"",d.isExists(b)?b.toString():"",c||"",e||"",f||"",false,"","","",false)};d.prototype.remove=function(a,b){if(d.isNumber(a)||arguments.length<2&&d.isString(a)&&
!this._filterTest(a)||arguments.length===0||arguments.length<2&&a===false)return this._removeOne(a,b||"");else if(d.isArray(a)||d.isPlainObject(a))return this._remove(a,b||"");var c=this.search.apply(this,arguments),e=c.length;if(d.isArray(c))for(;(e-=1)>-1;)this._removeOne(c[e],b);else this._removeOne(c,b);return this};d.prototype.removeOne=function(a,b){return this.remove(a||"",b||"",false)};d.prototype.group=function(a,b,c,e,f,g,h){a=this._exprTest(a=a||"")?this._compileFilter(a):a;c=c||"";h=h||
false;e=parseInt(e)>=0?parseInt(e):false;f=parseInt(f)||false;g=parseInt(g)||false;var j=d.isString(a),i={};this.forEach(function(k,l){var n=j?d.byLink(k,a):a.apply(a,arguments);if(i[n])i[n].push(!h?k:l);else i[n]=[!h?k:l];return true},b,c,"",e,f,g);return i};d.prototype.groupLinks=function(a,b,c,e,f,g){return this.group(a||"",b||"",c||"",e||"",f||"",g||"",true)};d.prototype.stat=function(a,b,c,e,f,g,h){a=a||"count";e=e||"";f=parseInt(f)>=0?parseInt(f):false;g=parseInt(g)||false;h=parseInt(h)||false;
var j=d.isString(a),i=0,k=0,l=function(n){n=d.byLink(n,b||"");switch(a){case "count":i+=1;break;case "summ":i+=n;break;case "avg":k+=1;i+=n;break;case "max":if(n>i)i=n;break;case "min":if(k===0){i=n;k=1}else if(n<i)i=n;break;default:if(j)if(k===0){i=n;k=1}else i=d.expr(a+"="+n,i);else i=a(n,i)}return true};if(a!=="first"&&a!=="last"){this.forEach(l,c||"",e,"",f,g,h);if(a==="avg")i/=k}else i=a==="first"?this._getOne(d.ORDER[0]+"0"+d.ORDER[1]):this._getOne(d.ORDER[0]+"-1"+d.ORDER[1]);return i};d.prototype.groupStat=
function(a,b,c,e,f,g,h){a=a||"count";e=e||"";f=parseInt(f)>=0?parseInt(f):false;g=parseInt(g)||false;h=parseInt(h)||false;var j=d.isString(a),i={},k={},l,n=function(m){m=d.byLink(m,b||"");switch(a){case "count":i[this.i]+=1;break;case "summ":i[this.i]+=m;break;case "avg":k[this.i]+=1;i[this.i]+=m;break;case "max":if(m>i[this.i])i[this.i]=m;break;case "min":if(k[this.i]===0){i[this.i]=m;k[this.i]=1}else if(m<i[this.i])i[this.i]=m;break;default:if(j)if(k[this.i]===0){i[this.i]=m;k[this.i]=1}else i[this.i]=
d.expr(a+"="+m,i[this.i]);else i[this.i]=a(m,i[this.i])}return true};this.forEach(function(m,o,s,p,q,r){i[o]||(i[o]=k[o]=0);if(a!=="first"&&a!=="last")q._update("context","+="+d.CHILDREN+(n.i=o)).forEach(n,c||"",r,"",f,g,h).parent();else i[o]=a==="first"?d.byLink(m,d.ORDER[0]+"0"+d.ORDER[1]):d.byLink(m,d.ORDER[0]+"-1"+d.ORDER[1]);return true},"",e);if(a==="avg")for(l in i)if(i.hasOwnProperty(l))i[l]/=k[l];return i};d._sortObject=function(a,b,c){b=[];var e={},f;for(f in a)a.hasOwnProperty(f)&&b.push({key:f,
value:a[f]});b.sort(c);for(f in b)if(b.hasOwnProperty(f))e[b[f].key]=b[f].value;return e};d._sortObjectByKey=function(a,b){var c=[],e={},f;for(f in a)a.hasOwnProperty(f)&&c.push(f);c.sort(b);for(f in c)if(c.hasOwnProperty(f))e[c[f]]=a[c[f]];return e};d.prototype.sort=function(a,b,c,e){a=a||"";b=b||false;c=c&&c!==true?c===false?"":c:function(j){if(d.isString(j))return j.toUpperCase();return j};e=e||"";var f=this,g,h=function(j,i){var k=b?-1:1;if(a){j=d.byLink(j,a);i=d.byLink(i,a)}if(c){j=c(j);i=c(i)}if(b!==
f.SHUFFLE){if(j<i)return k*-1;if(j>i)return k;return 0}else return Math.round(Math.random()*2-1)};this.onSort&&(g=this.onSort.apply(this,arguments));if(g===false)return this;g=d.byLink(this._get("collection",e),this._getActiveParam("context"));if(typeof g!=="object")throw Error("incorrect data type!");if(d.isArray(g))g.sort(h);else{if(a){a=a===true?"value":"value"+d.CHILDREN+a;g=d._sortObject(g,a,h)}else g=d._sortObjectByKey(g,h);this._setOne("",g,e)}return this};d._reverseObject=function(a){var b=
[],c={},e;for(e in a)a.hasOwnProperty(e)&&b.push(e);b.reverse();for(e in b)if(b.hasOwnProperty(e))c[b[e]]=a[b[e]];return c};d.prototype.reverse=function(a){a=a||"";var b;this.onReverse&&(b=this.onReverse.apply(this,arguments));if(b===false)return this;b=d.byLink(this._get("collection",a),this._getActiveParam("context"));if(typeof b!=="object")throw Error("incorrect data type!");d.isArray(b)?b.reverse():this._setOne("",d._reverseObject(b),a);return this};d.prototype.save=function(a,b){if(typeof localStorage===
"undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),e=a===this.ACTIVE?this._exists("collection")?this._getActiveID("collection"):"":this._active("collection",a)?"active":"",f=b===false?sessionStorage:localStorage,g=null;this.onSave&&(g=this.onSave.apply(this,arguments));if(g===false)return this;f.setItem(c+":"+a,this.toString(a));f.setItem(c+"__date:"+a,(new Date).toString());f.setItem(c+"__active:"+a,e);f.setItem(c+
"__date",(new Date).toString());return this};d.prototype.saveAll=function(a){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var b,c=this.dObj.sys.tmpCollection,e=false;for(b in c){this._active("C",b)&&(e=true);c.hasOwnProperty(b)&&this.save(b,a)}e===false&&this.save("",a);return this};d.prototype.load=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+
this.name+"__"+this._get("namespace"),e=b===false?sessionStorage:localStorage,f=null;this.onLoad&&(f=this.onLoad.apply(this,arguments));if(f===false)return this;a===this.ACTIVE?this._new("collection",JSON.parse(e.getItem(c+":"+a))):this._push("collection",a,JSON.parse(e.getItem(c+":"+a)));c=e.getItem(c+"__active:"+a);if(c===this.ACTIVE)this._set("collection",a);else c&&this._push("collection",c,this._get("collection"))._set("collection",c);return this};d.prototype.loadAll=function(a,b){b=b?"drop":
"load";if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var c="__"+this.name+"__"+this._get("namespace"),e=a===false?sessionStorage:localStorage,f=e.length,g,h;try{for(g in e)if(e.hasOwnProperty(g))if((h=g.split(":"))[0]===c)this[b](h[1],a)}catch(j){for(;(f-=1)>-1;)if((h=e[f].split(":"))[0]===c)this[b](h[1],a)}return this};d.prototype.loadDate=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");
return new Date((b===false?sessionStorage:localStorage).getItem("__"+this.name+"__"+this._get("namespace")+"__date"+(a?":"+a:"")))};d.prototype.isExpired=function(a,b,c){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(b||"",c||"")))>a};d.prototype.drop=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),
e=b===false?sessionStorage:localStorage,f=null;this.onDrop&&(f=this.onDrop.apply(this,arguments));if(f===false)return this;e.removeItem(c+":"+a);e.removeItem(c+"__date:"+a);e.removeItem(c+"__active:"+a);return this};d.prototype.dropAll=function(a){(a===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace")+"__date");return this.loadAll(a||"",true)};d.prototype._customFilter=function(a,b,c,e,f,g,h,j){var i,k=true,l,n,m,o;if(!a||a===true){if(!this._getActiveParam("filter"))return true;
if(this._get("filter"))return this._customFilter(this._get("filter"),b,c,e,f,g,h,j);return true}if(d.isFunction(a))if(!this._getActiveParam("filter")||!j)return a.call(a,b,c,e,f,g,h);else{if(!j.name){for(;this._exists("filter","__tmp:"+(j.name=d.getRandomInt(0,1E4)));)j.name=d.getRandomInt(0,1E4);this._push("filter","__tmp:"+j.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+j.name,b,c,e,f,g,h,j)}if(!d.isArray(a)){if(this._getActiveParam("filter")&&j)a=this.ACTIVE+" && ("+a+")";if(a.search(/\|\||&&|!/)===
-1){if((a=d.trim(a)).search(/^(?:\(|)*:/)!==-1){this._exists("filter","__tmp:"+a)||this._push("filter","__tmp:"+a,this._compileFilter(a));return(a=this._get("filter","__tmp:"+a)).call(a,b,c,e,f,g,h)}return this._customFilter(this._get("filter",a),b,c,e,f,g,h,j)}a=d.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ");for(c=a.length;(c-=1)>-1;)a[c]===""&&a.splice(c,1)}i=function(s,p){for(var q=-1,r=s.length,t=0,u=[];(q+=1)<r;){p+=
1;if(s[q]==="("||s[q]==="!(")t+=1;if(s[q]===")")if(t===0)return{result:u,iter:p};else t-=1;u.push(s[q])}};j=a.length;for(c=-1;(c+=1)<j;)if(a[c]==="("||a[c]==="!("){if(a[c].substring(0,1)==="!"){o=true;a[c]=a[c].substring(1)}else o=false;c=(l=i(a.slice(c+1),c)).iter;l=l.result.join(" ");l=this._customFilter(l,b,c,e,f,g,h);k=!n&&!m?o===true?!l:l:n?o===true?!l:l&&k:o===true?!l:l||k}else if(a[c]!==")"&&a[c]!=="||"&&a[c]!=="&&"){if(a[c].substring(0,1)==="!"){o=true;a[c]=a[c].substring(1)}else o=false;
l=this._customFilter(this._get("filter",a[c]),b,c,e,f,g,h);k=!n&&!m?o===true?!l:l:n?o===true?!l:l&&k:o===true?!l:l||k}else if(a[c]==="||"){n=false;m=true}else if(a[c]==="&&"){m=false;n=true}return k};d.prototype._compileFilter=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('self.getVariable("').split(":>").join('")');return new Function("el","i","data","cOLength","cObj","id","var key = i; return "+a.replace(/^\s*:/,"")+
";")};d.prototype._customParser=function(a,b,c){if(!a||a===true){if(!this._getActiveParam("parser"))return b;if(this._get("parser"))return this._customParser(this._get("parser"),b,c);return b}if(d.isFunction(a))if(!this._getActiveParam("parser")||!c)return a.call(a,b,this);else{if(!c.name){for(;this._exists("parser","__tmp:"+(c.name=d.getRandomInt(0,1E4)));)c.name=d.getRandomInt(0,1E4);this._push("parser","__tmp:"+c.name,a)}return this._customParser(this.ACTIVE+" && __tmp:"+c.name,b,c)}if(d.isString(a)){if(this._getActiveParam("parser")&&
c)a=this.ACTIVE+" && "+a;if((a=d.trim(a)).search("&&")===-1){if(a.search(/^(?:\(|)*:/)!==-1){this._exists("parser","__tmp:"+a)||this._push("parser","__tmp:"+a,this._compileParser(a));return(a=this._get("parser","__tmp:"+a)).call(a,b,this)}return this._customParser(this._get("parser",a),b)}a=a.split("&&")}a.forEach(function(e){b=this._customParser(d.trim(e),b)},this);return b};d.prototype._compileParser=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);
a=a.split("<:").join('self.getVariable("').split(":>").join('")');return new Function("str","cObj","return "+a.replace(/^\s*:/,"")+";")};d.prototype.parentContext=function(a,b){for(var c=this._get("context",b||"").split(d.CHILDREN),e=a||1;(e-=1)>-1;)c.splice(-1,1);return c.join(d.CHILDREN)};d.prototype.parent=function(a,b){if(!b)return this._update("context",this.parentContext(a));return this._push("context",b,this.parentContext(a,b))};d.prototype._getActiveParam=function(a){var b=typeof this.dObj.sys.flags.use[a]===
"undefined"||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return b?b.toString():"";return b};d.prototype._filterTest=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(/&&|\|\||:/)!==-1};d.prototype._exprTest=function(a){return d.isString(a)&&a.search(/^:/)!==-1};d.prototype.enable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=true},this);return this};d.prototype.disable=function(){Array.prototype.forEach.call(arguments,
function(a){this.dObj.sys.flags.use[a]=false},this);return this};d.prototype.toggle=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]===true?this.disable(arguments[key]):this.enable(arguments[key])},this)};d.prototype.toString=function(a,b,c){if(typeof JSON==="undefined"||!JSON.stringify)throw Error("object JSON is not defined!");b=b||"";c=c||"";if(a&&d.isCollection(a))return JSON.stringify(a,b,c);return JSON.stringify(d.byLink(this._get("collection",a||""),
this._getActiveParam("context")),b,c)};d.prototype.valueOf=function(){return this.length(this.ACTIVE)};d.prototype.print=function(a,b){b=b||false;var c={},e={},f={},g,h,j,i=0,k,l=null,n=false,m,o="",s,p,q=this.drivers.dom;if(d.isExists(a)&&(d.isString(a)||d.isNumber(a)))a={page:a};else d.isExists(a)||(a={page:this._get("page")});d.extend(true,f,this.dObj.active,a);if(a)f.page=d.expr(f.page,this._get("page"));if(f.page<1)f.page=1;f.collection=d.isString(f.collection)?this._get("collection",f.collection):
f.collection;f.template=d.isString(f.template)?this._get("template",f.template):f.template;f.cache=d.isExists(a.cache)?a.cache:this._getActiveParam("cache");f.target=d.isString(f.target)?q.find(f.target):f.target;f.pager=d.isString(f.pager)?q.find(f.pager):f.pager;if(b===true)f.cache.iteration=false;k=this._get("page")-f.page;this._update("page",f.page);s=function(r,t){f.callback&&f.callback.apply(f.callback,arguments);o+=f.template.apply(f.template,arguments);i=t;if(n===false)n=t;return true};g=
d.byLink(f.collection,this._getActiveParam("context")+d.CHILDREN+(a&&a.context||""));h=this.length();m=Boolean(f.numberBreak&&(f.filter||this._getActiveParam("filter")));f.numberBreak=f.numberBreak||h;if(d.isPlainObject(g)||!f.cache||f.cache.iteration===false||f.cache.firstIteration===false||f.cache.lastIteration===false){j=!f.numberBreak||f.page===1?0:(f.page-1)*f.numberBreak;this.forEach(s,f.filter,this.ACTIVE,true,f.numberBreak,j);if(f.cache&&f.cache.iteration===false)f.cache.lastIteration=false}else if(d.isArray(g)&&
f.cache.iteration===true){j=!m?f.page===1?0:(f.page-1)*f.numberBreak:k>=0?f.cache.firstIteration:f.cache.lastIteration;if(m)if(k>0){for(k*=f.numberBreak;(j-=1)>-1;)if(this._customFilter(f.filter,g[j],g,j,h,this,this.ACTIVE,e)===true)if(i===k)break;else i+=1;f.cache.lastIteration=j+=1;l=null}else if(k<0)l=-k*f.numberBreak-f.numberBreak;e.name&&this._drop("filter","__tmp:"+e.name);this.forEach(s,f.filter,this.ACTIVE,true,f.numberBreak,l,j)}if(f.cache){if(k!==0&&f.cache.iteration!==false){this._get("cache").firstIteration=
n;this._get("cache").lastIteration=i+1}if(f.cache.autoIteration===true)this._get("cache").iteration=true}o=!o?f.resultNull:this._customParser(f.parser,o,c);c.name&&this._drop("parser","__tmp:"+c.name);if(f.target===false){f.variable?this._push("variable",f.variable,o):this._new("variable",o);return this}else Array.prototype.forEach.call(f.target,function(r){if(f.appendType==="html")r.innerHTML=o;else if(f.appendType==="append")r.innerHTML+=o;else r.innerHTML=o+r.innerHTML},this);if(!f.pager)return this;
f.nmbOfEntries=f.filter!==false?this.length(f.filter):h;f.nmbOfEntriesInPage=f.calculator?q.find(f.calculator,f.target[0]).length:q.children(f.target[0]).length;f.finNumber=f.numberBreak*f.page-(f.numberBreak-f.nmbOfEntriesInPage);if(f.page!==1&&f.nmbOfEntriesInPage===0){this.onIPage&&(p=this.onIPage.apply(this,arguments));if(p===false)return this;this._update("page",f.page-=1).print(f,true,true)}else this.easyPage(f);return this};d.prototype.easyPage=function(a){var b=this,c="",e=a.nmbOfPages||(a.nmbOfEntries%
a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak),f=function(n,m,o,s){s=s||false;var p,q="<"+(n.tag||"span")+" "+(!s?'data-page="':'data-number-break="')+o+'"';if(n.attr)for(p in n.attr)if(n.attr.hasOwnProperty(p))q+=" "+p+'="'+n.attr[p]+'"';if(!s&&o===a.page||s&&o===a.numberBreak)q+=' class="'+(m&&m.active||"active")+'"';return q+(">"+o+"</"+(n.tag||"span")+">")},g=function(n,m){if(m==="select")return'<option value="'+n+'">'+n+"</option>";return n},h,j=0,i,k,l=this.drivers.dom;
Array.prototype.forEach.call(a.pager,function(n){Array.prototype.forEach.call(l.find(".ctm",n),function(m){if(a.pageBreak<=2)throw Error('parameter "pageBreak" must be more than 2');c="";var o=m.tagName.toLowerCase(),s=l.data(m),p=s.ctm,q=p.classes;if(p.nav){if(d.find(p.nav,["first","prev","next","last"])&&!s["ctm-delegated"]){l.bind(m,"click",function(){if(!l.hasClass(this,p.classes&&p.classes.disabled||"disabled")){p.nav==="first"&&(a.page=1);p.nav==="prev"&&(a.page="-=1");p.nav==="next"&&(a.page=
"+=1");p.nav==="last"&&(a.page=e);b.print(a)}});m.setAttribute("data-ctm-delegated",true)}if(d.find(p.nav,["first","prev"])&&a.page===1||d.find(p.nav,["next","last"])&&a.finNumber===a.nmbOfEntries)l.addClass(m,q&&q.disabled||"disabled");else if(d.find(p.nav,["first","prev","next","last"]))l.removeClass(m,q&&q.disabled||"disabled");p.nav==="numberSwitch"&&p.val.forEach(function(r){c+=o==="select"?'<option vale="'+r+'" '+(r===a.numberBreak?'selected="selected"':"")+">"+r+"</option>":f(p,q||"",r,true)});
if(p.nav==="pageList")if(o==="select")for(h=0;(h+=1)<=e;)c+='<option vale="'+h+'" '+(h===a.page?'selected="selected"':"")+">"+h+"</option>";else if(e>a.pageBreak){j=a.pageBreak%2!==0?1:0;k=i=(a.pageBreak-j)/2;if(a.page-j<i)i=0;else{i=a.page-i-j;if(a.page+k>e)i-=a.page+k-e}h=i;for(j=-1;(h+=1)<=e&&(j+=1)!==null;){if(j===a.pageBreak&&h!==a.page)break;c+=f(p,q||"",h)}}else for(h=0;(h+=1)<=e;)c+=f(p,q||"",h);if(p.nav==="numberSwitch"||p.nav==="pageList"){m.innerHTML=c;if(!s["ctm-delegated"]){o!=="select"?
l.bind(m,"click",function(r){r=r||window.event;r=r.target||r.srcElement;var t=l.data(r);if(r.parentNode!==m)return false;if(p.nav==="pageList")a.page=+t.page;else{b._push("numberBreak",a.name||"",+t["number-break"]);delete a.numberBreak}b.print(a)}):l.bind(m,"change",function(){var r=l.children(this,"selected")[0];if(a.page!==r.value){if(s.nav==="pageList")a.page=+r.value;else{b._push("numberBreak",a.name||"",+r.value);delete a.numberBreak}b.print(a)}});m.setAttribute("data-ctm-delegated",true)}}}else if(p.info){a.nmbOfEntriesInPage===
0?l.addClass(m,q&&q.noData||"no-data"):l.removeClass(m,q&&q.noData||"no-data");switch(p.info){case "page":if(o==="input")m.value=g(a.page,o);else m.innerHTML=g(a.page,o);break;case "total":if(o==="input")m.value=g(a.nmbOfEntries,o);else m.innerHTML=g(a.nmbOfEntries,o);break;case "from":if(o==="input")m.value=g((a.page-1)*a.numberBreak+1,o);else m.innerHTML=g((a.page-1)*a.numberBreak+1,o);break;case "to":if(o==="input")m.value=g(a.finNumber,o);else m.innerHTML=g(a.finNumber,o);break;case "inPage":if(o===
"input")m.value=g(a.nmbOfEntriesInPage,o);else m.innerHTML=g(a.nmbOfEntriesInPage,o);break;case "nmbOfPages":if(o==="input")m.value=g(e,o);else m.innerHTML=g(e,o)}}})});return this};d.prototype.genTable=function(a,b,c,e){if(d.isNumber(a)){e=c;c=b;b=a;a=""}b=b||4;c=c||"div";e=e===false?false:true;var f,g,h,j,i=this.drivers.dom;a=a?d.isString(a)?i.find(a):a:this._get("target");Array.prototype.forEach.call(a,function(k){g=document.createElement("table");f=0;Array.prototype.forEach.call(i.find(c,k),function(l){if(f===
0){h=document.createElement("tr");g.appendChild(h)}j=document.createElement("td");j.appendChild(l);h.appendChild(j);f+=1;if(f===b)f=0});if(e===true)for(f=b-h.childNodes.length;(f-=1)>-1;)h.appendChild(document.createElement("td"));k.appendChild(g)},this);return this};return d}();if(typeof $C==="undefined")var $C=Collection;
//