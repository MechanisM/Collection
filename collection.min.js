/**
 * Collection v3.6 | http://collection-js.com
 * 
 * Copyright 2012, Andrey Kobets (Kobezzza | kobezzza@gmail.com | http://kobezzza.com)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
 var Collection;
(function(){Collection=function(a,b){a=a||null;b=b||"";if(!this||!this.name||this.name!=="Collection")return new Collection(a,b);Collection.extend(true,this,Collection.fields);var c=this.dObj.active;b&&Collection.extend(true,c,b);if(this._exprTest(c.filter))c.filter=this._compileFilter(c.filter);if(this._exprTest(c.parser))c.parser=this._compileParser(c.parser);if(Collection.isString(c.target))c.target=this.drivers.dom.find(c.target);if(Collection.isString(c.pager))c.pager=this.drivers.dom.find(c.pager);c.collection=
a};Collection.byLink=function(a,b,c,e){b=b.toString().replace(RegExp("\\s*"+Collection.CHILDREN+"\\s*","g"),Collection.CONTEXT_SEPARATOR+Collection.CHILDREN+Collection.CONTEXT_SEPARATOR).split(Collection.CONTEXT_SEPARATOR);e=e||false;for(var d=a,f=Collection.CHILDREN,g=0,i=0,h,j=b.length,k,l;(j-=1)>-1;){b[j]=Collection.trim(b[j]);if(b[j]===""){b.splice(j,1);g-=1}else if(b[j]!==Collection.CHILDREN){if(j>g)g=j;i+=1}}l=b.length;if(a===false)return b.join("");else if(Collection.isNumber(a)){if((a=+a)<
0)a+=i;if(typeof c==="undefined"){j=-1;for(k=0;(j+=1)<l;)if(b[j]!==Collection.CHILDREN)if((k+=1)===a){b.splice(j+1,l);return b.join("")}}else{j=l;for(k=0;(j-=1)>-1;)if(b[j]!==Collection.CHILDREN)if((k+=1)===a){b.splice(0,j);return b.join("")}}}for(j=-1;(j+=1)<l;)switch(b[j]){case Collection.CHILDREN:f=b[j];break;default:if(f===Collection.CHILDREN&&b[j].substring(0,Collection.ORDER[0].length)!==Collection.ORDER[0])if(j===g&&typeof c!=="undefined")if(e===false)a[b[j]]=Collection.expr(c,a[b[j]]);else if(Collection.isArray(a))a.splice(b[j],
1);else delete a[b[j]];else a=a[b[j]];else{i=b[j].substring(Collection.ORDER[0].length);i=i.substring(0,i.length-1);i=+i;if(Collection.isArray(a))if(j===g&&typeof c!=="undefined")if(i>=0)if(e===false)a[i]=Collection.expr(c,a[i]);else a.splice(i,1);else if(e===false)a[a.length+i]=Collection.expr(c,a[a.length+i]);else a.splice(a.length+i,1);else a=i>=0?a[i]:a[a.length+i];else{if(i<0){k=0;for(h in a)if(a.hasOwnProperty(h))k+=1;i+=k}k=0;for(h in a)if(a.hasOwnProperty(h)){if(i===k){if(j===g&&typeof c!==
"undefined")if(e===false)a[h]=Collection.expr(c,a[h]);else delete a[h];else a=a[h];break}k+=1}}}}if(typeof c!=="undefined")return d;return a};Collection.execEvent=function(a,b,c,e){a=a.split(Collection.QUERY_SEPARATOR);c=Collection.isExists(c)?c:[];c=Collection.isArray(c)?c:[c];for(var d=-1,f=a.length-1;(d+=1)<f;)b=b[a[d]];e=e||b;if(a[d].search(Collection.SUBQUERY_SEPARATOR)!==-1){a=a[d].split(Collection.SUBQUERY_SEPARATOR);b=b[a[0]];a.splice(0,1);c=c.concat(a);return b.apply(e,c)}else return b[a[d]].apply(e,
c)};Collection.CONTEXT_SEPARATOR="__context__";Collection.QUERY_SEPARATOR="/";Collection.SUBQUERY_SEPARATOR="{";Collection.METHOD_SEPARATOR="->";Collection.CHILDREN=">";Collection.ORDER=["eq(",")"];Collection.toString=function(a){if(typeof a==="undefined")return Collection.prototype.collection();return Object.prototype.toString.call(a)};Collection.types={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date",
"[object RegExp]":"regexp","[object Object]":"object"};Collection.type=function(a){return a==null?String(a):Collection.types[Collection.toString(a)]||"object"};Collection.isWindow=function(a){return a&&typeof a==="object"&&"setInterval"in a};Collection.isString=function(a){return Collection.type(a)==="string"};Collection.isNumber=function(a){return Collection.type(a)==="number"};Collection.isBoolean=function(a){return Collection.type(a)==="boolean"};Collection.isFunction=function(a){return Collection.type(a)===
"function"};Collection.isArray=function(a){return Collection.type(a)==="array"};Collection.isPlainObject=function(a){if(!a||Collection.type(a)!=="object"||a.nodeType||Collection.isWindow(a))return false;try{if(a.constructor&&!a.hasOwnProperty("constructor")&&!a.constructor.prototype.hasOwnProperty("isPrototypeOf"))return false}catch(b){return false}for(var c in a);return c===undefined||a.hasOwnProperty(c)};Collection.isCollection=function(a){return Collection.isArray(a)||Collection.isPlainObject(a)};
Collection.isExists=function(a){return typeof a!=="undefined"&&a!==null&&a!==""};Collection.trim=function(a){a=a.replace(/^\s\s*/,"");for(var b=/\s/,c=a.length;b.test(a.charAt(c-=1)););return a.substring(0,c+1)};Collection.toUpperCase=function(a,b,c){c=c||0;b=Collection.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toUpperCase()+a.substring(b)};Collection.toLowerCase=function(a,b,c){c=c||0;b=Collection.isExists(b)?c+b:a.length;return a.substring(0,c)+a.substring(c,b).toLowerCase()+
a.substring(b)};Collection.expr=function(a,b){b=Collection.isExists(b)?b:"";if(Collection.isString(a)&&a.search(/^[+-\\*\/]{1}=/)!==-1){a=a.split("=");isNaN(a[1])||(a[1]=+a[1]);switch(a[0]){case "+":a=b+a[1];break;case "-":a=b-a[1];break;case "*":a=b*a[1];break;case "/":a=b/a[1]}}return a};Collection.getRandomInt=function(a,b){a=a||0;return Math.floor(Math.random()*((b||10)-a+1))+a};Collection.find=function(a,b){var c,e;if(Collection.isArray(b)){b.some(function(d){if(a===d)return e=true});if(e)return e}else for(c in b)if(b.hasOwnProperty(c))if(a===
b[c])return c;return false};Collection.extend=function(){var a,b,c,e,d,f=arguments[0]||{},g=0,i=arguments.length,h=false;if(Collection.isBoolean(f)){h=f;f=arguments[1]||{};g=1}if(typeof f!=="object"&&!Collection.isFunction(f))f={};if(i===g){f=Collection;g-=1}for(;(g+=1)<i;)if(Collection.isExists(a=arguments[g]))for(b in a){c=f[b];e=a[b];if(f!==e)if(h&&e&&(Collection.isPlainObject(e)||(d=Collection.isArray(e)))){if(d){d=false;c=c&&Collection.isArray(c)?c:[]}else c=c&&Collection.isPlainObject(c)?c:
{};f[b]=Collection.extend(h,c,e)}else if(typeof e!=="undefined")f[b]=e}return f};Collection.addElementToObject=function(a,b,c){b=b.split(Collection.METHOD_SEPARATOR);var e,d={};if(b[1]&&b[1]==="unshift"){d[!isNaN(Number(b[0]))?0:b[0]]=c;for(e in a)if(a.hasOwnProperty(e))d[!isNaN(Number(e))?+e+1:e]=a[e];return d}else if(!b[1]||b[1]==="push")a[b[0]]=c;return true};Collection.unshiftArguments=function(a,b){for(var c=[b],e=-1,d=a.length;(e+=1)<d;)c.push(a[e]);return c};if(!Array.prototype.forEach)Array.prototype.forEach=
function(a,b){for(var c=-1,e=this.length;(c+=1)<e;)b?a.call(b,this[c],c,this):a(this[c],c,this)};if(!Array.prototype.some)Array.prototype.some=function(a,b){for(var c=-1,e=this.length,d;(c+=1)<e;){d=b?a.call(b,this[c],c,this):a(this[c],c,this);if(d===true)break}};Collection.prototype={name:"Collection",version:"3.6",collection:function(){return this.name+" "+this.version},ACTIVE:"active",SHUFFLE:"shuffle",NAMESPACE_SEPARATOR:".",stack:["namespace","collection","filter","context","cache","variable",
"defer","page","parser","appendType","target","calculator","pager","template","numberBreak","pageBreak","resultNull"]};Collection.prototype.drivers=Collection.drivers={};Collection.drivers.dom={find:function(a,b){if(!this.lib)throw Error("DOM driver is not defined!");return this.engines[this.lib].find(a||"",b||"")},children:function(a,b){var c=[];Array.prototype.forEach.call(a.childNodes,function(e){if(e.nodeType===1)if(b)e[b]&&c.push(e);else c.push(e)});return c},data:function(a,b){var c=a.attributes,
e={};c&&c.length>0&&Array.prototype.forEach.call(c,function(d){if(d.name.substring(0,5)==="data-")e[d.name.replace("data-","")]=Collection.isString(d.value)&&d.value.search(/^\{|\[/)!==-1?JSON.parse(d.value):d.value});if(b)return e[b];return e},text:function(a){a=a.childNodes;var b="";Array.prototype.forEach.call(a,function(c){if(c.nodeType===3&&Collection.trim(c.textContent))b+=c.textContent});if(b)return b;return false},bind:function(a,b,c){if(this.engines[this.lib][b]){this.engines[this.lib][b](a,
c);return this}document.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c);return this},addClass:function(a,b){Collection.find(b,a.className.split(" "))||(a.className+=" "+b);return this},hasClass:function(a,b){return Collection.find(b,a.className.split(" "))},removeClass:function(a,b){var c=[];a.className.split(" ").forEach(function(e){e!==b&&c.push(e)});a.className=c.join(" ");return this},engines:{qsa:{is:function(){if(typeof qsa!=="undefined")return true},find:function(a,b){return qsa.querySelectorAll(a,
b)}},sizzle:{is:function(){if(typeof Sizzle!=="undefined")return true},find:function(a,b){return Sizzle(a,b)}},jQuery:{is:function(){if(typeof jQuery!=="undefined")return true},find:function(a,b){return jQuery(a,b)},click:function(a,b){$(a).click(b)},change:function(a,b){$(a).change(b)}},dojo:{is:function(){if(typeof dojo!=="undefined")return true},find:function(a,b){return b?dojo.query(a,b):dojo.query(a)},click:function(a,b){dojo.connect(a,"onclick",b)}},mootools:{is:function(){if(typeof MooTools!==
"undefined")return true},find:function(a,b){var c;if(b){c=[];$$(b).getElements(a).forEach(function(e){e.forEach(function(d){c.push(d)})})}else c=$$(a);return c}},prototype:{is:function(){if(typeof Prototype!=="undefined")return true},find:function(a,b){return b?b.getElementsBySelector(a):$$(a)}}}};(function(){var a,b=Collection.drivers.dom.engines;for(a in b)if(b.hasOwnProperty(a))if(b[a].is()){Collection.drivers.dom.lib=a;return true}})();Collection._inObj=function(a){var b=[],c=Collection.fromNode.stat,
e=Collection.drivers.dom;Array.prototype.forEach.call(a,function(d){if(d.nodeType===1){var f=e.data(d),g=d.hasAttribute("class")?d.getAttribute("class").split(" "):"",i=e.text(d),h,j=b.length;b.push({});for(h in f)if(f.hasOwnProperty(h))b[j][h]=f[h];if(g){b[j][c.classes]={};g.forEach(function(k){b[j][c.classes][k]=k})}if(d.childNodes.length!==0)b[j][c.childNodes]=Collection._inObj(d.childNodes);if(i!==false)b[j][c.val]=i.replace(/[\r\t\n]/g," ")}});return b};Collection.fromNode=function(a,b){if(typeof JSON===
"undefined"||!JSON.parse)throw Error("object JSON is not defined!");var c=Collection._inObj(Collection.drivers.dom.find(a));if(b)return new Collection(c,b);return new Collection(c)};if(!Collection.fromNode.stat)Collection.fromNode.stat={val:"val",childNodes:"childNodes",classes:"classes"};Collection.ctplCompile=function(a){Collection.isString(a)&&(a=Collection.drivers.dom.find(a));if(a.length===0)throw Error("DOM element does't exist!");var b='var result = ""; ';(a[0]?a[0][0]?a[0][0].innerHTML:a[0].innerHTML:
a.innerHTML).replace(/\/\*.*?\*\//g,"").split("?>").join("<?js").replace(/[\r\t\n]/g," ").split("<?js").forEach(function(c,e){b+=e===0||e%2===0?'result +="'+c.split('"').join('\\"')+'";':c.split("echo").join("result +=")});return new Function("el","key","data","i","length","cObj","id",b+" return result;")};Collection.prototype.ctplMake=function(a){var b=Collection.drivers.dom;Collection.isString(a)&&(a=b.find(a));Array.prototype.forEach.call(a,function(c){var e=b.data(c,"ctpl"),d,f=e.prefix?e.prefix+
"_":"";this._push("template",f+e.name,Collection.ctplCompile(c));e.set&&e.set===true&&this._set("template",f+e.name);for(d in e)if(e.hasOwnProperty(d))if(!Collection.find(d,["prefix","set","print","name","collection"])){if(Collection.find(d,["target","pager"]))e[d]=b.find(e[d]);this._push(d,f+e.name,e[d]);e.set&&e.set===true&&this._set(d,f+e.name);if(Collection.find(d,["filter","parser"]))e[d]=f+e.name}if(e.print&&e.print===true){e.template=e.name;if(!e.target){this._push("target",f+e.name,[c.parentNode]);
e.set&&e.set===true&&this._set("target",f+e.name)}this.print(e)}},this);return this};Collection.fields={dObj:{active:{namespace:"nm",collection:null,filter:false,context:"",cache:{autoIteration:true,iteration:true,firstIteration:false,lastIteration:false},variable:null,defer:"",page:1,parser:false,appendType:"html",target:null,calculator:null,pager:null,template:null,numberBreak:null,pageBreak:5,resultNull:""}}};Collection.fields.dObj.sys={flags:{use:{context:true,filter:true,parser:true,cache:false}}};
(function(a){var b,c=Collection.fields.dObj.sys;a.forEach(function(e){b=Collection.toUpperCase(e,1);c["active"+b+"ID"]=null;c["tmp"+b]={};c[e+"ChangeControl"]=null;c[e+"Back"]=[]})})(Collection.prototype.stack);Collection.prototype._new=function(a,b){var c=this.dObj.active,e=Collection.toUpperCase(a,1),d;this["onNew"+e]&&(d=this["onNew"+e](b));if(d===false)return this;c[a]=Collection.find(a,["filter","parser"])&&this._exprTest(b)?this["_compile"+Collection.toUpperCase(a,1)](b):Collection.find(a,["target",
"pager"])&&Collection.isString(b)?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(b)?b:[b]):Collection.expr(b,c[a]||"");this.dObj.sys["active"+e+"ID"]=null;return this};Collection.prototype._update=function(a,b){var c=this.dObj.active,e=Collection.toUpperCase(a,1),d,f=this._getActiveID(a);this["onUpdate"+e]&&(d=this["onUpdate"+e](b));if(d===false)return this;c[a]=Collection.find(a,["filter","parser"])&&this._exprTest(b)?this["_compile"+e](b):Collection.find(a,["target","pager"])&&
Collection.isString(b)?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(b)?b:[b]):Collection.expr(b,c[a]||"");if(f)this.dObj.sys["tmp"+e][f]=c[a];return this};Collection.prototype._get=function(a,b){if(b&&b!==this.ACTIVE){if(!this._exists(a,b))throw Error('the object "'+b+'" -> "'+a+"\" doesn't exist in the stack!");return this.dObj.sys["tmp"+Collection.toUpperCase(a,1)][b]}return this.dObj.active[a]};Collection.prototype._push=function(a,b,c){var e=Collection.toUpperCase(a,1),d,f=
this.dObj.sys["tmp"+e],g=this._getActiveID(a),i;this["onPush"+e]&&(d=this["onPush"+e](b,c||""));if(d===false)return this;if(Collection.isPlainObject(b))for(i in b){if(b.hasOwnProperty(i))if(i===this.ACTIVE)this._update(a,b[i]);else if(f[i]&&g&&g===i)this._update(a,b[i]);else f[i]=Collection.find(a,["filter","parser"])&&this._exprTest(b[i])?this["_compile"+e](b[i]):Collection.find(a,["target","pager"])&&Collection.isString(b[i])?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(b[i])?
b[i]:[b[i]]):b[i]}else if(b===this.ACTIVE)this._update(a,c);else if(f[b]&&g&&g===b)this._update(a,c);else f[b]=Collection.find(a,["filter","parser"])&&this._exprTest(c)?this["_compile"+e](c):Collection.find(a,["target","pager"])&&Collection.isString(c)?this.drivers.dom.find.apply(this.drivers.dom,Collection.isArray(c)?c:[c]):c;return this};Collection.prototype._set=function(a,b){var c=this.dObj.sys,e=Collection.toUpperCase(a,1),d,f=a+"ChangeControl",g="active"+e+"ID";if(!this._exists(a,b))throw Error('the object "'+
b+'" -> "'+a+"\" doesn't exist in the stack!");this["onSet"+e]&&(d=this["onSet"+e](b));if(d===false)return this;if(c[g]!==b){c[f]=true;c[g]=b}else c[f]=false;c[a+"Back"].push(b);this.dObj.active[a]=c["tmp"+e][b];return this};Collection.prototype._back=function(a,b){b=b||1;var c=this.dObj.sys,e=Collection.toUpperCase(a,1),d,f=c[a+"Back"],g=f.length-b-1;this["onBack"+e]&&(d=this["onBack"+e](b));if(d===false)return this;if(g>=0&&f[g])if(c["tmp"+e][f[g]]){this._set(a,f[g]);c[a+"ChangeControl"]=false;
f.splice(g+1,f.length)}return this};Collection.prototype._backIf=function(a){if(this.dObj.sys[a+"ChangeControl"]===true)return this._back.apply(this,arguments);return this};Collection.prototype._drop=function(a,b,c,e){c=typeof c==="undefined"?false:c;var d=this.dObj.active,f=this.dObj.sys,g=Collection.toUpperCase(a,1),i,h="active"+g+"ID",j="tmp"+g,k=this._getActiveID(a),l=!b?k?[k]:[]:Collection.isArray(b)||Collection.isPlainObject(b)?b:[b],m;if(typeof e==="undefined")this["onDrop"+g]&&(i=this["onDrop"+
g](b,c));else this["onReset"+g]&&(i=this["onReset"+g](b,e));if(i===false)return this;if(l[0]&&l[0]!==this.ACTIVE)for(m in l){if(l.hasOwnProperty(m))if(!l[m]||l[m]===this.ACTIVE)if(typeof e==="undefined"){k&&delete f[j][k];f[h]=null;d[a]=c}else{if(k)f[j][k]=e;d[a]=e}else if(typeof e==="undefined"){delete f[j][l[m]];if(k&&l[m]===k){f[h]=null;d[a]=c}}else{f[j][l[m]]=e;if(k&&l[m]===k)d[a]=e}}else if(typeof e==="undefined"){k&&delete f[j][k];f[h]=null;d[a]=c}else{if(k)f[j][k]=e;d[a]=e}return this};Collection.prototype._reset=
function(a,b,c){return this._drop(a,b||"","",typeof c==="undefined"?false:c)};Collection.prototype._resetTo=function(a,b,c){c=!c||c===this.ACTIVE?this.dObj.active[a]:this.dObj.sys["tmp"+Collection.toUpperCase(a,1)][c];return this._reset(a,b||"",c)};Collection.prototype._exists=function(a,b){var c=Collection.toUpperCase(a,1);if((!b||b===this.ACTIVE)&&this._getActiveID(a))return true;if(typeof this.dObj.sys["tmp"+c][b]!=="undefined")return true;return false};Collection.prototype._getActiveID=function(a){return this.dObj.sys["active"+
Collection.toUpperCase(a,1)+"ID"]};Collection.prototype._active=function(a,b){if(!b)return this._getActiveID(a);if(b===this._getActiveID(a))return true;return false};Collection.prototype.use=function(a){this.stack.forEach(function(b){var c,e,d;if(this._exists(b,a))this._set(b,a);else{c=a.split(this.NAMESPACE_SEPARATOR);for(d=c.length;(d-=1)>-1;){c.splice(d,1);e=c.join(this.NAMESPACE_SEPARATOR);if(this._exists(b,e)){this._set(b,e);break}}}},this);return this};(function(a){var b=Collection.prototype,
c;a.forEach(function(e){c=Collection.toUpperCase(e,1);b["new"+c]=function(d){return function(f){return this._new(d,f)}}(e);b["update"+c]=function(d){return function(f){return this._update(d,f)}}(e);b["reset"+c+"To"]=function(d){return function(f,g){return this._resetTo(d,f,g)}}(e);b["push"+c]=function(d){return function(){return this._push.apply(this,Collection.unshiftArguments(arguments,d))}}(e);b["set"+c]=function(d){return function(f){return this._set(d,f)}}(e);b["pushSet"+c]=function(d){return function(f,
g){return this._push(d,f,g)._set(d,f)}}(e);b["back"+c]=function(d){return function(f){return this._back(d,f||"")}}(e);b["back"+c+"If"]=function(d){return function(f){return this._backIf(d,f||"")}}(e);b["drop"+c]=e==="filter"||e==="parser"?function(d){return function(){return this._drop(d,arguments)}}(e):function(d){return function(){return this._drop(d,arguments,null)}}(e);if(e==="filter"||e==="parser")b["reset"+c]=function(d){return function(){return this._reset(d,arguments)}}(e);else if(e==="page")b["reset"+
c]=function(d){return function(){return this._reset(d,arguments,1)}}(e);else if(e==="context")b["reset"+c]=function(d){return function(){return this._reset(d,arguments,"")}}(e);b["active"+c]=function(d){return function(f){return this._active(d,f)}}(e);b["exists"+c]=function(d){return function(f){return this._exists(d,f||"")}}(e);b["get"+c+"ActiveID"]=function(d){return function(){return this._getActiveID(d)}}(e);b["get"+c]=function(d){return function(f){return this._get(d,f||"")}}(e)})})(Collection.prototype.stack);
Collection.prototype._setOne=function(a,b,c){a=Collection.isExists(a)?a.toString():"";b=typeof b==="undefined"?"":b;c=c||"";var e=this._getActiveParam("context"),d;this.onSet&&(d=this.onSet.apply(this,arguments));if(d===false)return this;if(!a&&!e)return c&&c!==this.ACTIVE?this._push("collection",c,b):this._update("collection",b);Collection.byLink(this._get("collection",c),e+Collection.CHILDREN+a,b);return this};Collection.prototype._getOne=function(a,b){a=Collection.isExists(a)?a.toString():"";return Collection.byLink(this._get("collection",
b||""),this._getActiveParam("context")+Collection.CHILDREN+a)};Collection.prototype.add=function(a,b,c,e,d){a=typeof a!=="undefined"?a:"";b=b||"push";c=c||"";d=d||false;var f,g,i;this.onAdd&&(f=this.onAdd.apply(this,arguments));if(f===false)return this;f=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof f!=="object")throw Error("unable to set property!");if(e){a=Collection.isExists(a)?a.toString():"";g=Collection.byLink(this._get("collection",e||""),a);if(Collection.isPlainObject(f)){b=
b==="push"?this.length(f):b==="unshift"?this.length(f)+Collection.METHOD_SEPARATOR+"unshift":b;i=Collection.addElementToObject(f,b.toString(),g)}else{i=true;f[b](g)}d===true&&this.disable("context")._removeOne(a,e).enable("context")}else if(Collection.isPlainObject(f)){b=b==="push"?this.length(f):b==="unshift"?this.length(f)+Collection.METHOD_SEPARATOR+"unshift":b;i=Collection.addElementToObject(f,b.toString(),a)}else{i=true;f[b](a)}i!==true&&this._setOne("",i,c);return this};Collection.prototype.push=
function(a,b){return this.add(a,"",b||"")};Collection.prototype.unshift=function(a,b){return this.add(a,"unshift",b||"")};Collection.prototype._removeOne=function(a,b){a=Collection.isExists(a)?a.toString():"";var c=this._getActiveParam("context"),e;this.onRemove&&(e=this.onRemove.apply(this,arguments));if(e===false)return this;!a&&!c?this._setOne("",null):Collection.byLink(this._get("collection",b||""),c+Collection.CHILDREN+a,"",true);return this};Collection.prototype._remove=function(a,b){b=b||"";
var c,e;if(Collection.isPlainObject(a))for(c in a){if(a.hasOwnProperty(c))if(Collection.isArray(a[c]))for(e=a[c].length;(e-=1)>-1;)this._removeOne(a[c][e],c);else this._removeOne(a[c],c)}else if(Collection.isArray(a))for(e=a.length;(e-=1)>-1;)this._removeOne(a[e],b);else this._removeOne(a,b);return this};Collection.prototype.pop=function(a){return this._removeOne("eq(-1)",a||"")};Collection.prototype.shift=function(a){return this._removeOne("eq(0)",a||"")};Collection.prototype.concat=function(a,b,
c){b=Collection.isExists(b)?b.toString():"";c=c||"";var e;this.onConcat&&(e=this.onConcat.apply(this,arguments));if(e===false)return this;e=Collection.byLink(this._get("collection",c),this._getActiveParam("context")+Collection.CHILDREN+b);if(typeof e!=="object")throw Error("incorrect data type!");if(Collection.isPlainObject(e))Collection.extend(true,e,a);else if(Collection.isArray(e))if(Collection.isArray(a)){e=Array.prototype.concat(e,a);this._setOne(b,e,c)}else this.add(a,"push",c);return this};
Collection.prototype.length=function(a,b,c){a=a||"";var e={},d,f,g,i=0,h;if(!Collection.isFunction(a))if(Collection.isString(a)&&!this._filterTest(a)&&!Collection.isExists(b)||Collection.isCollection(a)){b=a;a=false}if(b)if(Collection.isString(b))d=this._get("collection",b);else{f=true;d=b}else d=this._get("collection");if(d===null)return 0;if(f!==true)d=Collection.byLink(d,this._getActiveParam("context"));if(Collection.isString(d))return d.length;if(typeof d!=="object")throw Error("incorrect data type!");
if((a===true||!a)&&typeof d.length!=="undefined")h=d.length;else{h=0;if(typeof d.length!=="undefined")d.forEach(function(j,k){if(this._customFilter(a,j,k,d,i,c||null,this,b?b:this.ACTIVE,e)===true)h+=1;i+=1},this);else{for(g in d)if(d.hasOwnProperty(g))if(this._customFilter(a,d[g],g,d,i,c||null,this,b?b:this.ACTIVE,e)===true)h+=1;i+=1}}e.name&&this._drop("filter","__tmp:"+e.name);return h};Collection.prototype.forEach=function(a,b,c,e,d,f,g){b=b||"";if(Collection.isBoolean(c)){g=f;f=d;d=e;e=c;c=this.ACTIVE}else c=
c||"";e=e===false?false:true;d=parseInt(d)>=0?parseInt(d):false;f=parseInt(f)||false;g=parseInt(g)||false;var i=this,h={},j,k,l,m=0,o=0,p=false;j=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(typeof j!=="object")throw Error("incorrect data type!");k=function(){if(!k.val)k.val=i.length(b,c,k);return k.val};k.valueOf=k;if(Collection.isArray(j)){l=g!==false?j.slice(g):j;l.some(function(n,q){q+=g;if(d!==false&&o===d)return true;if(this._customFilter(b,n,q,j,m,k,this,
c,h)===true)if(f!==false&&f!==0)f-=1;else{p=a.call(a,n,q,j,m,k,this,c)===false;if(e===false)p=true;o+=1}m+=1;if(p===true)return true},this)}else for(l in j)if(j.hasOwnProperty(l)){if(d!==false&&o===d)break;if(g!==false&&g!==0)g-=1;else{if(this._customFilter(b,j[l],l,j,m,k,this,c,h)===true)if(f!==false&&f!==0)f-=1;else{p=a.call(a,j[l],l,j,m,k,this,c)===false;if(e===false)p=true;o+=1}m+=1;if(p===true)break}}h.name&&this._drop("filter","__tmp:"+h.name);k=null;return this};Collection.prototype.some=function(a,
b,c){return this.forEach(a,b||"",c||"",false)};Collection.prototype.search=function(a,b,c,e,d,f){if(Collection.isBoolean(b)){f=d;d=e;e=c;c=b;b=this.ACTIVE}else b=b||"";c=c===false?false:true;e=parseInt(e)>=0?parseInt(e):false;d=parseInt(d)||false;f=parseInt(f)||false;var g=c===true?[]:-1;this.forEach(function(i,h){if(c===true)g.push(h);else g=h;return true},a||"",b,c,e,d,f);return g};Collection.prototype.searchOne=function(a,b){return this.search(a||"",b||"",false)};Collection.prototype.indexOf=function(a,
b,c){c=c||"";b=b||"";var e=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(Collection.isArray(e)&&e.indexOf){if(b)return e.indexOf(a,b);return e.indexOf(a)}else return this.search(function(d){return d===a},c,false,"","",b)};Collection.prototype.lastIndexOf=function(a,b,c){c=c||"";b=b||"";var e=Collection.byLink(this._get("collection",c),this._getActiveParam("context"));if(Collection.isArray(e)&&e.lastIndexOf){if(b)return e.lastIndexOf(a,b);return e.lastIndexOf(a)}else{b=
this.search(function(d){return d===a},c,"","","",b);return typeof b[b.length-1]!=="undefined"?b[b.length-1]:-1}};Collection.prototype.get=function(a,b,c,e,d,f){if(Collection.isNumber(a)||arguments.length<=2&&!Collection.isBoolean(b)&&Collection.isString(a)&&!this._filterTest(a)||arguments.length===0||a===false)return this._getOne(a,b||"");if(Collection.isBoolean(b)){f=d;d=e;e=c;c=b;b=this.ACTIVE}else b=b||"";c=c===false?false:true;e=parseInt(e)>=0?parseInt(e):false;d=parseInt(d)||false;f=parseInt(f)||
false;var g=c===true?[]:-1;this.forEach(function(i,h,j){if(c===true)g.push(j[h]);else g=j[h];return true},a||"",b,c,e,d,f);return g};Collection.prototype.getOne=function(a,b){return this.get(a||"",b||"",false)};Collection.prototype.set=function(a,b,c){if(Collection.isNumber(a)||arguments.length<=3&&!Collection.isBoolean(c)&&Collection.isString(a)&&!this._filterTest(a)||arguments.length===0||a===false)return this._setOne(a,b,c||"");var e,d,f=Collection.isFunction(b);d=Collection.unshiftArguments(arguments,
function(g,i,h,j,k,l,m){h[i]=f?b.call(b,g,i,h,j,k,l,m):Collection.expr(b,h[i]);return true});d.splice(2,1);this.onSet&&(e=this.onSet.apply(this,arguments));if(e===false)return this;return this.forEach.apply(this,d)};Collection.prototype.setOne=function(a,b,c){return this.set(a||"",b,c||"",false)};Collection.prototype.map=function(a,b,c){return this.set(b||"",a,c||"")};Collection.prototype.move=function(a,b,c,e,d,f,g,i,h,j){a=a||"";j=j===false?false:true;b=Collection.isExists(b)?b.toString():"";c=
c||"";e=e||"";d=d||"push";f=f===false?false:true;g=parseInt(g)>=0?parseInt(g):false;i=parseInt(i)||false;h=parseInt(h)||false;var k=[],l=Collection.isArray(Collection.byLink(this._get("collection",e),this._getActiveParam("context"))),m;m=null;j&&this.onMove&&(m=this.onMove.apply(this,arguments));!j&&this.onCopy&&(m=this.onCopy.apply(this,arguments));if(m===false)return this;this.disable("context");m=Collection.isNumber(a)||arguments.length<=5&&Collection.isString(a)&&!this._filterTest(a)||arguments.length===
0||a===false?a:this.search(a,c,f,g,i,h);this.enable("context");if(f===true&&Collection.isArray(m))m.forEach(function(o){this.add(b+Collection.CHILDREN+o,l===true?d:o+Collection.METHOD_SEPARATOR+d,e,c);j===true&&k.push(o)},this);else{this.add(b+Collection.CHILDREN+m,l===true?d:m+Collection.METHOD_SEPARATOR+d,e,c);j===true&&k.push(m)}j===true&&this.disable("context")._remove(k,c).enable("context");return this};Collection.prototype.moveOne=function(a,b,c,e,d){return this.move(a||"",Collection.isExists(b)?
b.toString():"",c||"",e||"",d||"",false)};Collection.prototype.copy=function(a,b,c,e,d,f,g,i,h){f=f===false?false:true;g=parseInt(g)>=0?parseInt(g):false;i=parseInt(i)||false;h=parseInt(h)||false;return this.move(a||"",Collection.isExists(b)?b.toString():"",c||"",e||"",d||"push",f,g,i,h,false)};Collection.prototype.copyOne=function(a,b,c,e,d){return this.move(a||"",Collection.isExists(b)?b.toString():"",c||"",e||"",d||"",false,"","","",false)};Collection.prototype.remove=function(a,b){if(Collection.isNumber(a)||
arguments.length<=2&&!Collection.isBoolean(b)&&Collection.isString(a)&&!this._filterTest(a)||arguments.length===0||a===false)return this._removeOne(a,b||"");else if(Collection.isArray(a)||Collection.isPlainObject(a))return this._remove(a,b||"");var c=this.search.apply(this,arguments),e=c.length;if(Collection.isArray(c))for(;(e-=1)>-1;)this._removeOne(c[e],b);else this._removeOne(c,b);return this};Collection.prototype.removeOne=function(a,b){return this.remove(a||"",b||"",false)};Collection.prototype.group=
function(a,b,c,e,d,f,g){a=this._exprTest(a=a||"")?this._compileFilter(a):a;c=c||"";g=g||false;e=parseInt(e)>=0?parseInt(e):false;d=parseInt(d)||false;f=parseInt(f)||false;var i=Collection.isString(a),h={};this.forEach(function(j,k){var l=i?Collection.byLink(j,a):a.apply(a,arguments);if(h[l])h[l].push(!g?j:k);else h[l]=[!g?j:k];return true},b,c,"",e,d,f);return h};Collection.prototype.groupLinks=function(a,b,c,e,d,f){return this.group(a||"",b||"",c||"",e||"",d||"",f||"",true)};Collection.prototype.stat=
function(a,b,c,e,d,f,g){a=a||"count";e=e||"";d=parseInt(d)>=0?parseInt(d):false;f=parseInt(f)||false;g=parseInt(g)||false;var i=Collection.isString(a),h=0,j=0,k=function(l){l=Collection.byLink(l,b||"");switch(a){case "count":h+=1;break;case "summ":h+=l;break;case "avg":j+=1;h+=l;break;case "max":if(l>h)h=l;break;case "min":if(j===0){h=l;j=1}else if(l<h)h=l;break;default:if(i)if(j===0){h=l;j=1}else h=Collection.expr(a+"="+l,h);else h=a(l,h)}return true};if(a!=="first"&&a!=="last"){this.forEach(k,c||
"",e,"",d,f,g);if(a==="avg")h/=j}else h=a==="first"?this._getOne(Collection.ORDER[0]+"0"+Collection.ORDER[1]):this._getOne(Collection.ORDER[0]+"-1"+Collection.ORDER[1]);return h};Collection.prototype.groupStat=function(a,b,c,e,d,f,g){a=a||"count";e=e||"";d=parseInt(d)>=0?parseInt(d):false;f=parseInt(f)||false;g=parseInt(g)||false;var i=Collection.isString(a),h={},j={},k,l=function(m){m=Collection.byLink(m,b||"");switch(a){case "count":h[this.key]+=1;break;case "summ":h[this.key]+=m;break;case "avg":j[this.key]+=
1;h[this.key]+=m;break;case "max":if(m>h[this.key])h[this.key]=m;break;case "min":if(j[this.key]===0){h[this.key]=m;j[this.key]=1}else if(m<h[this.key])h[this.key]=m;break;default:if(i)if(j[this.key]===0){h[this.key]=m;j[this.key]=1}else h[this.key]=Collection.expr(a+"="+m,h[this.key]);else h[this.key]=a(m,h[this.key])}return true};this.forEach(function(m,o,p,n,q,r,s){h[o]||(h[o]=j[o]=0);if(a!=="first"&&a!=="last")r._update("context","+="+Collection.CHILDREN+(l.key=o)).forEach(l,c||"",s,"",d,f,g).parent();
else h[o]=a==="first"?Collection.byLink(m,Collection.ORDER[0]+"0"+Collection.ORDER[1]):Collection.byLink(m,Collection.ORDER[0]+"-1"+Collection.ORDER[1]);return true},"",e);if(a==="avg")for(k in h)if(h.hasOwnProperty(k))h[k]/=j[k];return h};Collection._sortObject=function(a,b,c){b=[];var e={},d;for(d in a)a.hasOwnProperty(d)&&b.push({key:d,value:a[d]});b.sort(c);for(d in b)if(b.hasOwnProperty(d))e[b[d].key]=b[d].value;return e};Collection._sortObjectByKey=function(a,b){var c=[],e={},d;for(d in a)a.hasOwnProperty(d)&&
c.push(d);c.sort(b);for(d in c)if(c.hasOwnProperty(d))e[c[d]]=a[c[d]];return e};Collection.prototype.sort=function(a,b,c,e){a=a||"";b=b||false;c=c&&c!==true?c===false?"":c:function(i){if(Collection.isString(i))return i.toUpperCase();return i};e=e||"";var d=this,f,g=function(i,h){var j=b?-1:1;if(a){i=Collection.byLink(i,a);h=Collection.byLink(h,a)}if(c){i=c(i);h=c(h)}if(b!==d.SHUFFLE){if(i<h)return j*-1;if(i>h)return j;return 0}else return Math.round(Math.random()*2-1)};this.onSort&&(f=this.onSort.apply(this,
arguments));if(f===false)return this;f=Collection.byLink(this._get("collection",e),this._getActiveParam("context"));if(typeof f!=="object")throw Error("incorrect data type!");if(Collection.isArray(f))f.sort(g);else{if(a){a=a===true?"value":"value"+Collection.CHILDREN+a;f=Collection._sortObject(f,a,g)}else f=Collection._sortObjectByKey(f,g);this._setOne("",f,e)}return this};Collection._reverseObject=function(a){var b=[],c={},e;for(e in a)a.hasOwnProperty(e)&&b.push(e);b.reverse();for(e in b)if(b.hasOwnProperty(e))c[b[e]]=
a[b[e]];return c};Collection.prototype.reverse=function(a){a=a||"";var b;this.onReverse&&(b=this.onReverse.apply(this,arguments));if(b===false)return this;b=Collection.byLink(this._get("collection",a),this._getActiveParam("context"));if(typeof b!=="object")throw Error("incorrect data type!");Collection.isArray(b)?b.reverse():this._setOne("",Collection._reverseObject(b),a);return this};Collection.prototype.save=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");
a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),e=a===this.ACTIVE?this._exists("collection")?this._getActiveID("collection"):"":this._active("collection",a)?"active":"",d=b===false?sessionStorage:localStorage,f=null;this.onSave&&(f=this.onSave.apply(this,arguments));if(f===false)return this;d.setItem(c+":"+a,this.toString(a));d.setItem(c+"__date:"+a,(new Date).toString());d.setItem(c+"__active:"+a,e);d.setItem(c+"__date",(new Date).toString());return this};Collection.prototype.saveAll=
function(a){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a===false?a:true;var b,c=this.dObj.sys.tmpCollection,e=false;for(b in c){this._active("Collection",b)&&(e=true);c.hasOwnProperty(b)&&this.save(b,a)}e===false&&this.save("",a);return this};Collection.prototype.load=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),e=b===
false?sessionStorage:localStorage,d=null;this.onLoad&&(d=this.onLoad.apply(this,arguments));if(d===false)return this;a===this.ACTIVE?this._new("collection",JSON.parse(e.getItem(c+":"+a))):this._push("collection",a,JSON.parse(e.getItem(c+":"+a)));c=e.getItem(c+"__active:"+a);if(c===this.ACTIVE)this._set("collection",a);else c&&this._push("collection",c,this._get("collection"))._set("collection",c);return this};Collection.prototype.loadAll=function(a,b){b=b?"drop":"load";if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");
a=a===false?a:true;var c="__"+this.name+"__"+this._get("namespace"),e=a===false?sessionStorage:localStorage,d=e.length,f,g;try{for(f in e)if(e.hasOwnProperty(f))if((g=f.split(":"))[0]===c)this[b](g[1],a)}catch(i){for(;(d-=1)>-1;)if((g=e[d].split(":"))[0]===c)this[b](g[1],a)}return this};Collection.prototype.loadDate=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date((b===false?sessionStorage:localStorage).getItem("__"+this.name+
"__"+this._get("namespace")+"__date"+(a?":"+a:"")))};Collection.prototype.isExpired=function(a,b,c){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");return new Date(new Date-new Date(this.loadDate(b||"",c||"")))>a};Collection.prototype.drop=function(a,b){if(typeof localStorage==="undefined")throw Error("your browser doesn't support web storage!");a=a||this.ACTIVE;var c="__"+this.name+"__"+this._get("namespace"),e=b===false?sessionStorage:localStorage,d=
null;this.onDrop&&(d=this.onDrop.apply(this,arguments));if(d===false)return this;e.removeItem(c+":"+a);e.removeItem(c+"__date:"+a);e.removeItem(c+"__active:"+a);return this};Collection.prototype.dropAll=function(a){(a===false?sessionStorage:localStorage).removeItem("__"+this.name+"__"+this._get("namespace")+"__date");return this.loadAll(a||"",true)};Collection.prototype._customFilter=function(a,b,c,e,d,f,g,i,h){var j,k=true,l,m,o,p,n;if(!a||a===true){if(!this._getActiveParam("filter"))return true;
if(this._get("filter"))return this._customFilter(this._get("filter"),b,c,e,d,f,g,i,h);return true}if(Collection.isFunction(a))if(!this._getActiveParam("filter")||!h)return a.call(a,b,c,e,d,f,g,i);else{if(!h.name){for(;this._exists("filter","__tmp:"+(h.name=Collection.getRandomInt(0,1E4)));)h.name=Collection.getRandomInt(0,1E4);this._push("filter","__tmp:"+h.name,a)}return this._customFilter(this.ACTIVE+" && __tmp:"+h.name,b,c,e,d,f,g,i,h)}if(!Collection.isArray(a)){if(this._getActiveParam("filter")&&
h)a=this.ACTIVE+" && ("+a+")";if(this._exprTest(a=Collection.trim(a))){this._exists("filter","__tmp:"+a)||this._push("filter","__tmp:"+a,this._compileFilter(a));return(a=this._get("filter","__tmp:"+a)).call(a,b,c,e,d,f,g,i)}a=Collection.trim(a.toString().replace(/\s*(\(|\))\s*/g," $1 ").replace(/\s*(\|\||&&)\s*/g," $1 ").replace(/(!)\s*/g,"$1")).split(" ");for(n=a.length;(n-=1)>-1;)a[n]===""&&a.splice(n,1)}j=function(q,r){for(var s=-1,v=q.length,t=0,u=[];(s+=1)<v;){r+=1;if(q[s]==="("||q[s]==="!(")t+=
1;if(q[s]===")")if(t===0)return{result:u,iter:r};else t-=1;u.push(q[s])}};h=a.length;for(n=-1;(n+=1)<h;)if(a[n]==="("||a[n]==="!("){if(a[n].substring(0,1)==="!"){p=true;a[n]=a[n].substring(1)}else p=false;n=(l=j(a.slice(n+1),n)).iter;l=l.result.join(" ");l=this._customFilter(l,b,c,e,d,f,g,i);k=!m&&!o?p===true?!l:l:m?p===true?!l:l&&k:p===true?!l:l||k}else if(a[n]!==")"&&a[n]!=="||"&&a[n]!=="&&"){if(a[n].substring(0,1)==="!"){p=true;a[n]=a[n].substring(1)}else p=false;l=this._customFilter(this._get("filter",
a[n]),b,c,e,d,f,g,i);k=!m&&!o?p===true?!l:l:m?p===true?!l:l&&k:p===true?!l:l||k}else if(a[n]==="||"){m=false;o=true}else if(a[n]==="&&"){o=false;m=true}return k};Collection.prototype._compileFilter=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('cObj.getVariable("').split(":>").join('")');return new Function("el","key","data","i","length","cObj","id","return "+a.replace(/^\s*:/,"")+";")};Collection.prototype._customParser=
function(a,b,c){if(!a||a===true){if(!this._getActiveParam("parser"))return b;if(this._get("parser"))return this._customParser(this._get("parser"),b,c);return b}if(Collection.isFunction(a))if(!this._getActiveParam("parser")||!c)return a.call(a,b,this);else{if(!c.name){for(;this._exists("parser","__tmp:"+(c.name=Collection.getRandomInt(0,1E4)));)c.name=Collection.getRandomInt(0,1E4);this._push("parser","__tmp:"+c.name,a)}return this._customParser(this.ACTIVE+" && __tmp:"+c.name,b,c)}if(Collection.isString(a)){if(this._getActiveParam("parser")&&
c)a=this.ACTIVE+" && "+a;if(this._exprTest(a=Collection.trim(a))){this._exists("parser","__tmp:"+a)||this._push("parser","__tmp:"+a,this._compileParser(a));return(a=this._get("parser","__tmp:"+a)).call(a,b,this)}a=a.split("&&")}a.forEach(function(e){b=this._customParser(Collection.trim(e),b)},this);return b};Collection.prototype._compileParser=function(a){var b=/^\s*\(*\s*/.exec(a);if(b.length!==0)a=a.substring(b[0].length+1,a.length-b[0].length);a=a.split("<:").join('cObj.getVariable("').split(":>").join('")');
return new Function("str","cObj","return "+a.replace(/^\s*:/,"")+";")};Collection.prototype.parentContext=function(a,b){for(var c=this._get("context",b||"").split(Collection.CHILDREN),e=a||1;(e-=1)>-1;)c.splice(-1,1);return c.join(Collection.CHILDREN)};Collection.prototype.parent=function(a,b){if(!b)return this._update("context",this.parentContext(a));return this._push("context",b,this.parentContext(a,b))};Collection.prototype._getActiveParam=function(a){var b=typeof this.dObj.sys.flags.use[a]===
"undefined"||this.dObj.sys.flags.use[a]===true?this.dObj.active[a]:false;if(a==="context")return b?b.toString():"";return b};Collection.prototype._filterTest=function(a){return a===this.ACTIVE||this._exists("filter",a)||a.search(/&&|\|\||:/)!==-1};Collection.prototype._exprTest=function(a){return Collection.isString(a)&&a.search(/^:/)!==-1};Collection.prototype.enable=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=true},this);return this};Collection.prototype.disable=
function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]=false},this);return this};Collection.prototype.toggle=function(){Array.prototype.forEach.call(arguments,function(a){this.dObj.sys.flags.use[a]===true?this.disable(arguments[key]):this.enable(arguments[key])},this)};Collection.prototype.toString=function(a,b,c){if(typeof JSON==="undefined"||!JSON.stringify)throw Error("object JSON is not defined!");b=b||"";c=c||"";if(a&&Collection.isCollection(a))return JSON.stringify(a,
b,c);return JSON.stringify(Collection.byLink(this._get("collection",a||""),this._getActiveParam("context")),b,c)};Collection.prototype.valueOf=function(a){if(a==="object")return this;return this.length(this.ACTIVE)};Collection.prototype.print=function(a,b){b=b||false;var c={},e={},d={},f,g,i,h=0,j,k=null,l=false,m,o="",p,n,q=this.drivers.dom;if(Collection.isExists(a)&&(Collection.isString(a)||Collection.isNumber(a)))a={page:a};else Collection.isExists(a)||(a={page:this._get("page")});Collection.extend(true,
d,this.dObj.active,a);if(a)d.page=Collection.expr(d.page,this._get("page"));if(d.page<1)d.page=1;d.collection=Collection.isString(d.collection)?this._get("collection",d.collection):d.collection;d.template=Collection.isString(d.template)?this._get("template",d.template):d.template;d.cache=Collection.isExists(a.cache)?a.cache:this._getActiveParam("cache");d.target=Collection.isString(d.target)?q.find(d.target):d.target;d.pager=Collection.isString(d.pager)?q.find(d.pager):d.pager;if(b===true)d.cache.iteration=
false;j=this._get("page")-d.page;this._update("page",d.page);p=function(r,s){d.callback&&d.callback.apply(d.callback,arguments);o+=d.template.apply(d.template,arguments);h=s;if(l===false)l=s;return true};f=Collection.byLink(d.collection,this._getActiveParam("context")+Collection.CHILDREN+(a&&a.context||""));g=this.length();m=Boolean(d.numberBreak&&(d.filter||this._getActiveParam("filter")));d.numberBreak=d.numberBreak||g;if(Collection.isPlainObject(f)||!d.cache||d.cache.iteration===false||d.cache.firstIteration===
false||d.cache.lastIteration===false){i=!d.numberBreak||d.page===1?0:(d.page-1)*d.numberBreak;this.forEach(p,d.filter,this.ACTIVE,true,d.numberBreak,i);if(d.cache&&d.cache.iteration===false)d.cache.lastIteration=false}else if(Collection.isArray(f)&&d.cache.iteration===true){i=!m?d.page===1?0:(d.page-1)*d.numberBreak:j>=0?d.cache.firstIteration:d.cache.lastIteration;if(m)if(j>0){for(j*=d.numberBreak;(i-=1)>-1;)if(this._customFilter(d.filter,f[i],f,i,g,this,this.ACTIVE,e)===true)if(h===j)break;else h+=
1;d.cache.lastIteration=i+=1;k=null}else if(j<0)k=-j*d.numberBreak-d.numberBreak;e.name&&this._drop("filter","__tmp:"+e.name);this.forEach(p,d.filter,this.ACTIVE,true,d.numberBreak,k,i)}if(d.cache){if(j!==0&&d.cache.iteration!==false){this._get("cache").firstIteration=l;this._get("cache").lastIteration=h+1}if(d.cache.autoIteration===true)this._get("cache").iteration=true}o=!o?d.resultNull:this._customParser(d.parser,o,c);c.name&&this._drop("parser","__tmp:"+c.name);if(d.target===false){d.variable?
this._push("variable",d.variable,o):this._new("variable",o);return this}else Array.prototype.forEach.call(d.target,function(r){if(d.appendType==="html")r.innerHTML=o;else if(d.appendType==="append")r.innerHTML+=o;else r.innerHTML=o+r.innerHTML},this);if(!d.pager)return this;d.nmbOfEntries=d.filter!==false?this.length(d.filter):g;d.nmbOfEntriesInPage=d.calculator?q.find(d.calculator,d.target[0]).length:q.children(d.target[0]).length;d.finNumber=d.numberBreak*d.page-(d.numberBreak-d.nmbOfEntriesInPage);
if(d.page!==1&&d.nmbOfEntriesInPage===0){this.onIPage&&(n=this.onIPage.apply(this,arguments));if(n===false)return this;this._update("page",d.page-=1).print(d,true,true)}else this.easyPage(d);return this};Collection.prototype.easyPage=function(a){var b=this,c="",e=a.nmbOfPages||(a.nmbOfEntries%a.numberBreak!==0?~~(a.nmbOfEntries/a.numberBreak)+1:a.nmbOfEntries/a.numberBreak),d=function(l,m,o,p){p=p||false;var n,q="<"+(l.tag||"span")+" "+(!p?'data-page="':'data-number-break="')+o+'"';if(l.attr)for(n in l.attr)if(l.attr.hasOwnProperty(n))q+=
" "+n+'="'+l.attr[n]+'"';if(!p&&o===a.page||p&&o===a.numberBreak)q+=' class="'+(m&&m.active||"active")+'"';return q+(">"+o+"</"+(l.tag||"span")+">")},f=function(l,m){if(m==="select")return'<option value="'+l+'">'+l+"</option>";return l},g,i=0,h,j,k=this.drivers.dom;Array.prototype.forEach.call(a.pager,function(l){Array.prototype.forEach.call(k.find(".ctm",l),function(m){if(a.pageBreak<=2)throw Error('parameter "pageBreak" must be more than 2');c="";var o=m.tagName.toLowerCase(),p=k.data(m),n=p.ctm,
q=n.classes;if(n.nav){if(Collection.find(n.nav,["first","prev","next","last"])&&!p["ctm-delegated"]){k.bind(m,"click",function(){if(!k.hasClass(this,n.classes&&n.classes.disabled||"disabled")){n.nav==="first"&&(a.page=1);n.nav==="prev"&&(a.page="-=1");n.nav==="next"&&(a.page="+=1");n.nav==="last"&&(a.page=e);b.print(a)}});m.setAttribute("data-ctm-delegated",true)}if(Collection.find(n.nav,["first","prev"])&&a.page===1||Collection.find(n.nav,["next","last"])&&a.finNumber===a.nmbOfEntries)k.addClass(m,
q&&q.disabled||"disabled");else if(Collection.find(n.nav,["first","prev","next","last"]))k.removeClass(m,q&&q.disabled||"disabled");n.nav==="numberSwitch"&&n.val.forEach(function(r){c+=o==="select"?'<option vale="'+r+'" '+(r===a.numberBreak?'selected="selected"':"")+">"+r+"</option>":d(n,q||"",r,true)});if(n.nav==="pageList")if(o==="select")for(g=0;(g+=1)<=e;)c+='<option vale="'+g+'" '+(g===a.page?'selected="selected"':"")+">"+g+"</option>";else if(e>a.pageBreak){i=a.pageBreak%2!==0?1:0;j=h=(a.pageBreak-
i)/2;if(a.page-i<h)h=0;else{h=a.page-h-i;if(a.page+j>e)h-=a.page+j-e}g=h;for(i=-1;(g+=1)<=e&&(i+=1)!==null;){if(i===a.pageBreak&&g!==a.page)break;c+=d(n,q||"",g)}}else for(g=0;(g+=1)<=e;)c+=d(n,q||"",g);if(n.nav==="numberSwitch"||n.nav==="pageList"){m.innerHTML=c;if(!p["ctm-delegated"]){o!=="select"?k.bind(m,"click",function(r){r=r||window.event;r=r.target||r.srcElement;var s=k.data(r);if(r.parentNode!==m)return false;if(n.nav==="pageList")a.page=+s.page;else{b._push("numberBreak",a.name||"",+s["number-break"]);
delete a.numberBreak}b.print(a)}):k.bind(m,"change",function(){var r=k.children(this,"selected")[0];if(a.page!==r.value){if(p.nav==="pageList")a.page=+r.value;else{b._push("numberBreak",a.name||"",+r.value);delete a.numberBreak}b.print(a)}});m.setAttribute("data-ctm-delegated",true)}}}else if(n.info){a.nmbOfEntriesInPage===0?k.addClass(m,q&&q.noData||"no-data"):k.removeClass(m,q&&q.noData||"no-data");switch(n.info){case "page":if(o==="input")m.value=f(a.page,o);else m.innerHTML=f(a.page,o);break;
case "total":if(o==="input")m.value=f(a.nmbOfEntries,o);else m.innerHTML=f(a.nmbOfEntries,o);break;case "from":if(o==="input")m.value=f((a.page-1)*a.numberBreak+1,o);else m.innerHTML=f((a.page-1)*a.numberBreak+1,o);break;case "to":if(o==="input")m.value=f(a.finNumber,o);else m.innerHTML=f(a.finNumber,o);break;case "inPage":if(o==="input")m.value=f(a.nmbOfEntriesInPage,o);else m.innerHTML=f(a.nmbOfEntriesInPage,o);break;case "nmbOfPages":if(o==="input")m.value=f(e,o);else m.innerHTML=f(e,o)}}})});
return this};Collection.prototype.genTable=function(a,b,c,e){if(Collection.isNumber(a)){e=c;c=b;b=a;a=""}b=b||4;c=c||"div";e=e===false?false:true;var d,f,g,i,h=this.drivers.dom;a=a?Collection.isString(a)?h.find(a):a:this._get("target");Array.prototype.forEach.call(a,function(j){f=document.createElement("table");d=0;Array.prototype.forEach.call(h.find(c,j),function(k){if(d===0){g=document.createElement("tr");f.appendChild(g)}i=document.createElement("td");i.appendChild(k);g.appendChild(i);d+=1;if(d===
b)d=0});if(e===true)for(d=b-g.childNodes.length;(d-=1)>-1;)g.appendChild(document.createElement("td"));j.appendChild(f)},this);return this};return Collection})();if(typeof $C==="undefined")var $C=Collection;
//