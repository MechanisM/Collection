<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>my document</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>
	<script src="http://www.kobezzza.com/files/collection/jquery.collection.min.js" type="text/javascript"></script>
	<script type="text/javascript" src="scripts/shCore.js"></script>
	<script type="text/javascript" src="scripts/shBrushJScript.js"></script>
	<script type="text/javascript" src="scripts/shBrushXml.js"></script>
	<link type="text/css" rel="stylesheet" href="styles/shCoreDefault.css">
	<script type="text/javascript">SyntaxHighlighter.all();</script>
	<link type="text/css" rel="stylesheet" href="main.css">
</head>

<body>
	<h1>Использование реляционного фреймворка $.Collection</h1>
	<h2>Глава 7. Ссылочные методы. Статистика.</h2>
	<h3>Ссылочные методы</h3>
	<p>
		Ссылочные методы — это такие методы, которые осуществляют манипуляции  с данными, по указанной прямой ссылке. Частично мы уже разбирали некоторые  методы, которые могли работать как ссылочные: get, set, remove, move, copy и  т.д. — все эти методы были полиморфны, т.е. могли работать как условные, так и  как ссылочные. Но ещё осталось несколько методов, о которых нужно обязательно  сказать. Первый такой метод — это add, данный метод осуществляет вставку нового  элемента в коллекцию по указанному контексту:
	</p>
<pre class="brush: js">
var db = new $.Collection([]);

// добавим новый элемент в активную коллекцию
db.add({name: &quot;Koba&quot;});
// теперь добавим новому элементу дополнительное свойство
db.newContext(0).add(22, &quot;age&quot;);</pre>
<p>
	Разбор полётов: первым входным параметром метод принимает  новый элемент (активный контекст влияет на то, куда будет вставлен элемент),  вторым  параметром можно указать ключ элемента (если вставляем в объект,  в случае если не укажем, то ключ будет сгенерирован автоматически и будет равен  количеству элементов в объекте) или тип добавления данных: push или unshift (в  случае если нужно вставить и название ключа и тип добавление, можно написать так,  например: age-&gt;unshift, по умолчанию везде используется push), последним  параметром метод принимает ИД коллекции.
</p>
<p>
	Метод имеет обёртки push и unshift, которые имеют 2 входных  параметра: новый элемент и ИД коллекции.
</p>
<p>
	Следующий метод, который мы рассмотрим, будет concat — этот  метод осуществляет конкатенацию коллекций:
</p>
<pre class="brush: js">
var db = new $.Collection([1, [1, 2], 3, 4, 5]);

// простая конкатенация
db.concat([1, 2, 3]);

// конкатенация с дополнительным контекстом
db.concat([1, 2, 3], &quot;1&quot;);</pre>
<p>
	Первым параметром метода принимает коллекцию, которая участвует  в конкатенации, вторым может принимать дополнительный контекст для коллекции, с  которой идёт конкатенация (плюсуется с активным контекстом), а третьим ИД  коллекции. В случае конкатенации массива с массивом используется простой  concat, для объектов extend, а для объекта с массивом либо extend, либо concat  (в зависимости от порядка).
</p>
<h3>Статистика</h3>
<p>
	Часто бывает нужно узнать различную дополнительную информацию о наших данных, например: максимальное значение поля, среднее арифметическое и т.д. В большинстве СУБД для это существуют различные статистические функции, и $.Collection не стал исключением. Для сбора статистики в $.Collection есть 2 метода: stat и groupStat. Первый метод собирает статистику с простой коллекции, а 
groupStat, как с результата группировки.
</p>
<pre class="brush: js">
var db = new $.Collection([
	{name: &quot;Andrey&quot;, sex: &quot;male&quot;, age: 22},
	{name: &quot;Sergey&quot;, sex: &quot;male&quot;, age: 24},
	{name: &quot;Ann&quot;, sex: &quot;female&quot;, age: 18},
	{name: &quot;Andrey2&quot;, sex: &quot;male&quot;, age: 22},
	{name: &quot;Sergey2&quot;, sex: &quot;male&quot;, age: 24},
	{name: &quot;Ann2&quot;, sex: &quot;female&quot;, age: 18},
	{name: &quot;Andrey3&quot;, sex: &quot;male&quot;, age: 22},
	{name: &quot;Sergey3&quot;, sex: &quot;male&quot;, age: 24},
	{name: &quot;Ann3&quot;, sex: &quot;female&quot;, age: 18},
	{name: &quot;Andrey4&quot;, sex: &quot;male&quot;, age: 22},
	{name: &quot;Sergey4&quot;, sex: &quot;male&quot;, age: 24},
	{name: &quot;Ann4&quot;, sex: &quot;female&quot;, age: 18}
]);

// найдём количество записей в коллекции
db.stat(&quot;count&quot;);
// сумма по полю age (можно использовать прямые ссылки)
db.stat(&quot;summ&quot;, &quot;age&quot;);
// среднее арифметическое по полю age
db.stat(&quot;avg&quot;, &quot;age&quot;);
// минимум по полю age (максимум с помощью max)
db.stat(&quot;min&quot;, &quot;age&quot;);
// произвольная статистика: умножение (можно также использовать символы +,-,/)
db.stat(&quot;*&quot;, &quot;age&quot;);
// произвольная статистика: функция обратного вызова (суммирование элементов)
db.stat(function (field, result) {
	return (result += field);
}, &quot;age&quot;);

// для использования метода groupStat, сгруппируем нашу коллекцию, например, по полю sex и добавим в стек
db.pushSetCollection(&quot;group&quot;, db.group(&quot;name&quot;));

// среднеарифметический возраст у групп
db.groupStat(&quot;avg&quot;, &quot;age&quot;);

// все возможные параметры интерфейса такие же, как и у stat
// плюс два новых
// первые элементы в каждой группе
db.groupStat(&quot;first&quot;);
// последние элементы в каждой группе
db.groupStat(&quot;last&quot;);
</pre>
</body>
</html>
